<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>å·¥ç¨‹ãƒ»å·¥æ•°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå…±æœ‰ç‰ˆï¼‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>

    <script>
        // Babelè­¦å‘Šã‚’éè¡¨ç¤ºã«ã™ã‚‹
        console.warn = function (message) {
            if (
                typeof message === "string" &&
                message.includes("You are using the in-browser Babel transformer")
            ) {
                return; // Babelè­¦å‘Šã‚’ç„¡è¦–
            }
            // ãã®ä»–ã®è­¦å‘Šã¯é€šå¸¸é€šã‚Šè¡¨ç¤º
            console.log("Warning:", message);
        };
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
                "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
                "Helvetica Neue", sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg,
                    #0f0f0f 0%,
                    #1a1a1a 50%,
                    #000000 100%);
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (max-width: 768px) {
            .mobile-container {
                padding: 16px 12px;
                padding-bottom: calc(106px + env(safe-area-inset-bottom));
            }

            .mobile-header {
                padding: 8px 12px;
                margin-bottom: 8px;
            }

            .mobile-text-sm {
                font-size: 12px;
            }

            .mobile-text-xs {
                font-size: 10px;
            }

            .mobile-compact-card {
                padding: 8px 12px;
                margin-bottom: 8px;
            }

            /* é…ç·šä»•æ§˜ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´ */
            .space-y-3>* {
                margin-bottom: 0 !important;
            }

            /* ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®šãªã©æ·±ã„éšå±¤ã®glassã‚«ãƒ¼ãƒ‰ã‚‚å¯¾è±¡ã« */
            .space-y-3 .mobile-compact-card.glass-card {
                margin-bottom: 0 !important;
            }

            .mobile-button {
                padding: 8px 12px;
                font-size: 12px;
            }

            .mobile-button-small {
                padding: 6px 8px;
                font-size: 10px;
            }
        }

        .icon {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            text-align: center;
            font-size: 1rem;
            line-height: 1.25rem;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-card-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .dark-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .dark-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* selectã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã‚’é»’ãã™ã‚‹ */
        .dark-input option {
            background: #1a1a1a;
            color: white;
            border: none;
        }

        .dark-input option:hover {
            background: #2a2a2a;
        }

        .dark-input option:checked {
            background: #3a3a3a;
        }

        /* æ—¢å­˜ã®select.dark-inputã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ã€ä»¥ä¸‹ã«ç½®ãæ›ãˆ */

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ */
        .custom-select-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .custom-select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 40px 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            transition: all 0.3s ease;
        }

        .custom-select:focus {
            outline: none;
            /* ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã ã‘ã¯æ¶ˆã™ */
        }

        /* ã‚«ã‚¹ã‚¿ãƒ çŸ¢å°ãƒœã‚¿ãƒ³ */
        .custom-select-arrow {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .custom-select-arrow::before {
            content: 'â–¼';
            color: rgba(255, 255, 255, 0.5);
            font-size: 10px;
            line-height: 1;
        }

        .custom-select-container:hover .custom-select-arrow::before {
            color: rgba(255, 255, 255, 0.7);
            /* ãƒ›ãƒãƒ¼æ™‚ã¯æ˜ã‚‹ã */
        }

        /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰Šé™¤ */
        /* .custom-select-container:hover .custom-select-arrow::before ã‚’å‰Šé™¤ */
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®çŸ¢å°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ - ä¸è¦ãªã‚‰å‰Šé™¤å¯ï¼‰ */
        /* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .custom-select option {
            background: #1a1a1a;
            color: white;
            padding: 8px;
        }

        .custom-select option:hover {
            background: #2a2a2a;
        }

        .custom-select option:checked {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .gradient-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            transform: translateY(0);
        }

        .gradient-button:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .gradient-green {
            background: linear-gradient(45deg, #11998e, #38ef7d);
        }

        .gradient-green:hover {
            background: linear-gradient(45deg, #38ef7d, #11998e);
        }

        .gradient-red {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .gradient-red:hover {
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }

        .gradient-purple {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #333;
        }

        .gradient-purple:hover {
            background: linear-gradient(45deg, #fed6e3, #a8edea);
        }


        .gradient-orange {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: #333;
        }

        .gradient-orange:hover {
            background: linear-gradient(45deg, #fecfef, #ff9a9e);
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .stat-card {
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0.1),
                    rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .modal-overlay {
            /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            position: fixed;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;

            /* å¼·åˆ¶çš„ã«å…¨ç”»é¢è¡¨ç¤º */
            margin: 0 !important;
            padding: 0 !important;
            transform: none !important;

            /* ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢å¯¾å¿œã¯å†…å´è¦ç´ ã§ */
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            animation: fadeIn 0.3s ease-out;
            overflow: hidden;
            touch-action: none !important;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å®¹ã«ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã‚’é©ç”¨ */
        .modal-content {
            animation: slideUp 0.3s ease-out;
            max-width: calc(90vw - env(safe-area-inset-left) - env(safe-area-inset-right));
            max-height: calc(90vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
            margin: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            overflow-y: auto;
            z-index: 10000;
            touch-action: auto !important;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-open {
            touch-action: none !important;
            -webkit-overflow-scrolling: touch !important;
        }

        .auth-background {
            background: linear-gradient(135deg,
                    #0f0f0f 0%,
                    #1a1a1a 50%,
                    #000000 100%);
        }

        /* æ—¥ä»˜å…¥åŠ›ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ˜ã‚‹ãã™ã‚‹ */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            cursor: pointer;
        }

        /* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã®ç›®ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ˜ã‚‹ãã™ã‚‹ */
        input[type="password"]::-ms-reveal {
            filter: invert(1);
        }

        /* Firefoxç”¨ã®æ—¥ä»˜å…¥åŠ›ã‚¹ã‚¿ã‚¤ãƒ« */
        input[type="date"] {
            color-scheme: dark;
            height: 46px !important;
            min-height: 46px !important;
            box-sizing: border-box;
            text-align: left !important;
            direction: ltr !important;
            -webkit-text-align-last: left !important;
            text-align-last: left !important;
        }

        /* Webkitç³»ãƒ–ãƒ©ã‚¦ã‚¶ã®æ—¥ä»˜å…¥åŠ›å†…éƒ¨ãƒ†ã‚­ã‚¹ãƒˆå·¦è©°ã‚ */
        input[type="date"]::-webkit-datetime-edit,
        input[type="date"]::-webkit-datetime-edit-fields-wrapper,
        input[type="date"]::-webkit-datetime-edit-text {
            text-align: left !important;
            padding-left: 0 !important;
        }

        /* å…¨ã¦ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’å‰Šé™¤ */
        input:focus,
        select:focus,
        textarea:focus,
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none !important;
            box-shadow: none !important;
            border-color: rgba(102, 126, 234, 0.5) !important;
        }

        .creator-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .task-draggable {
            cursor: grab;
            transition: all 0.2s ease;
        }

        .task-draggable:active {
            cursor: grabbing;
        }

        .task-dragging {
            opacity: 0.5;
        }

        .task-drag-over {
            border: 2px solid #667eea !important;
            background: rgba(102, 126, 234, 0.1) !important;
        }

        .drag-handle {
            color: rgba(255, 255, 255, 0.5);
            cursor: grab;
            padding: 4px;
            margin-right: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            user-select: none;
        }

        .drag-handle:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .gantt-container {
            min-width: 1200px;
        }

        .gantt-bar {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .gantt-bar:hover {
            transform: scaleY(1.1);
            z-index: 10;
        }

        .gantt-grid-line {
            border-right: 1px dashed rgba(255, 255, 255, 0.1);
        }

        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        /* ä¿®æ­£å¾Œ */
        .gantt-scroll::-webkit-scrollbar {
            height: 8px;
            /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
            width: 8px;
            /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        }

        .gantt-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .gantt-scroll::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        .gantt-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }

        /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .gantt-scroll-vertical::-webkit-scrollbar {
            width: 8px;
        }

        .gantt-scroll-vertical::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .gantt-scroll-vertical::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        .gantt-scroll-vertical::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®äº¤å·®éƒ¨åˆ†ï¼ˆã‚³ãƒ¼ãƒŠãƒ¼ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .gantt-scroll-vertical::-webkit-scrollbar-corner {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå°‚ç”¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ */
        .timeline-area::-webkit-scrollbar-corner {
            background: rgba(0, 0, 0, 0.3);
        }

        /* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚¨ãƒªã‚¢å°‚ç”¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
        .timeline-area::-webkit-scrollbar {
            height: 8px;
            /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
            width: 8px;
            /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        }

        .timeline-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .timeline-area::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        .timeline-area::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }

        /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼å°‚ç”¨ã®é«˜ã•èª¿æ•´ */
        .timeline-area::-webkit-scrollbar:horizontal {
            height: 8px;
        }

        /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼å°‚ç”¨ã®å¹…èª¿æ•´ */
        .timeline-area::-webkit-scrollbar:vertical {
            width: 8px;
        }

        /* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®å¢ƒç•Œç·šçµ±ä¸€ */
        .gantt-day-cell {
            box-sizing: border-box;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gantt-day-header {
            box-sizing: border-box;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ã‹ã£ã“ã„ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ */
        .user-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }


        /* ã‚«ã‚¹ã‚¿ãƒ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        input[type="checkbox"]:checked {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-color: transparent;
        }

        input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            line-height: 1;
        }

        input[type="checkbox"]:hover {
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ”ãƒ³ãƒœã‚¿ãƒ³ */
        input[type="number"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
            position: relative;
        }

        /* Webkitç³»ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã®ã‚¹ãƒ”ãƒ³ãƒœã‚¿ãƒ³ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
            display: none;
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ”ãƒ³ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .number-input-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .number-input-container input[type="number"] {
            width: 100%;
            padding-right: 40px;
            /* ã‚¹ãƒ”ãƒ³ãƒœã‚¿ãƒ³ç”¨ã®ã‚¹ãƒšãƒ¼ã‚¹ */
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ”ãƒ³ãƒœã‚¿ãƒ³ */
        .custom-spin-buttons {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .spin-button {
            width: 20px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.5);
            font-size: 10px;
            line-height: 1;
            transition: all 0.2s ease;
            user-select: none;
        }

        .spin-button:hover {
            color: rgba(255, 255, 255, 0.7);
        }

        .spin-button:active {
            transform: scale(0.95);
        }

        .spin-button-up::before {
            content: 'â–²';
        }

        .spin-button-down::before {
            content: 'â–¼';
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
        input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* å¼·åˆ¶çš„ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å®‰å®šåŒ– */
            will-change: transform;
            backface-visibility: hidden;
        }

        input[type="radio"]:checked {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-color: transparent;
        }

        /* ç™½ã„ç‚¹ã‚’å¸¸ã«å­˜åœ¨ã•ã›ã€é€æ˜åº¦ã§åˆ¶å¾¡ */
        input[type="radio"]::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.2s ease;
            /* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®‰å®šåŒ– */
            will-change: opacity;
            backface-visibility: hidden;
        }

        input[type="radio"]:checked::after {
            opacity: 1;
        }

        input[type="radio"]:hover {
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .project-tasks-container {
            transition: max-height 0.3s ease, padding 0.5s ease;
        }

        .project-tasks-container.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
        }

        .project-tasks-container.expanded {
            max-height: none;
            padding-top: 7px;
            padding-bottom: 7px;
            overflow: visible;
        }

        /* ä¼šç¤¾è©³ç´°ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .company-details-container {
            transition: max-height 0.3s ease, padding 0.5s ease;
        }

        .company-details-container.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
        }

        .company-details-container.expanded {
            max-height: 2000px;
            padding-top: 7px;
            padding-bottom: 7px;
            overflow: visible;
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme_color" content="#000000">
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // Firebaseè¨­å®šï¼ˆå®Ÿéš›ã®è¨­å®šå€¤ã«å¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyDBBOuz7NC_8qjTKMoolwiN-sQt2-V8Q2U",
            authDomain: "project-management-app-d2c9a.firebaseapp.com",
            projectId: "project-management-app-d2c9a",
            storageBucket: "project-management-app-d2c9a.firebasestorage.app",
            messagingSenderId: "579983603816",
            appId: "1:579983603816:web:e0a868bd27bd5c8068e3dd",
            measurementId: "G-3Q7D9LZ35E"
        };

        // FirebaseåˆæœŸåŒ–
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Unicodeã‚¢ã‚¤ã‚³ãƒ³ã®å®šç¾©
        const icons = {
            plus: 'â•',
            play: 'â–¶ï¸',
            pause: 'â¸ï¸',
            trash: 'ğŸ—‘ï¸',
            folder: 'ğŸ“',
            save: 'ğŸ’¾',
            refresh: 'ğŸ”„',
            clock: 'ğŸ•',
            chart: 'ğŸ“Š',
            check: 'âœ…',
            chevronDown: 'â–¼',
            chevronRight: 'â–¶',
            user: 'ğŸ‘¤',
            logout: 'ğŸšª',
            admin: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        };

        // ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã‚¹ãƒãƒ›å¯¾å¿œç‰ˆï¼‰
        const IconButton = ({ onClick, icon }) => {
            const [isHovered, setIsHovered] = useState(false);

            const handleClick = (e) => {
                setIsHovered(false);
                if (onClick) {
                    onClick(e);
                }
            };

            return (
                <button
                    onClick={handleClick}
                    // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                    onMouseDown={() => setIsHovered(true)}
                    onMouseUp={() => setIsHovered(false)}
                    // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
                    onTouchStart={() => setIsHovered(true)}
                    onTouchEnd={() => setIsHovered(false)}
                    onTouchCancel={() => setIsHovered(false)}
                    style={{
                        color: isHovered ? '#ffffff' : '#9ca3af',
                        transition: 'color 0.2s',
                        background: 'transparent',
                        border: 'none',
                        cursor: 'pointer',
                        padding: '4px',
                        display: 'inline-flex',
                        WebkitTapHighlightColor: 'transparent', // iOS Safari ã®ã‚¿ãƒƒãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç„¡åŠ¹åŒ–
                    }}
                >
                    {icon}
                </button>
            );
        };

        // ç·¨é›†ãƒœã‚¿ãƒ³
        const EditButton = ({ onClick }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                }
            />
        );

        // è©³ç´°ãƒœã‚¿ãƒ³ï¼ˆã‚µã‚¤ã‚ºèª¿æ•´ç‰ˆï¼‰
        const InfoButton = ({ onClick }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 16V12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
                        <circle cx="12" cy="8" r="0.5" fill="currentColor" />
                    </svg>
                }
            />
        );

        // ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³
        const FavoriteButton = ({ onClick, isFavorite }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill={isFavorite ? "#fbbf24" : "none"} stroke={isFavorite ? "#fbbf24" : "currentColor"} strokeWidth="2">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                }
            />
        );

        // å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆâœ•ã‚¢ã‚¤ã‚³ãƒ³ - æ”¹è‰¯ç‰ˆï¼‰
        const DeleteButton = ({ onClick }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round">
                        <line x1="19" y1="5" x2="5" y2="19" />
                        <line x1="5" y1="5" x2="19" y2="19" />
                    </svg>
                }
            />
        );

        // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
        const CopyButton = ({ onClick }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                    </svg>
                }
            />
        );

        // ãƒ¡ãƒ¼ãƒ«ãƒãƒ¼ã‚¯
        const MailButton = ({ onClick }) => (
            <IconButton
                onClick={onClick}
                icon={
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="gray" strokeWidth="2">
                        <rect x="2" y="4" width="20" height="16" rx="2" />
                        <path d="M22 7l-10 5L2 7" />
                    </svg>
                }
            />
        );

        // ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç´°ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
        const TabIcons = {
            // æ¡ˆä»¶ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ - æ”¹è‰¯ç‰ˆï¼‰
            Projects: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 7v11a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7l-2-2H5a2 2 0 0 0-2 2z" />
                </svg>
            ),

            // ä¼šç¤¾ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ“ãƒ«ï¼‰
            Companies: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 21h18" />
                    <path d="M5 21V7l8-4v18" />
                    <path d="M19 21V11l-6-3" />
                    <rect x="9" y="9" width="4" height="4" />
                    <rect x="9" y="14" width="4" height="4" />
                </svg>
            ),

            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆç·šã‚’ä¸Šå¯„ã›ï¼‰
            Gantt: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="3" y="4" width="18" height="16" rx="2" />
                    <rect x="7" y="7" width="8" height="2" />
                    <rect x="9" y="11" width="6" height="2" />
                    <rect x="6" y="15" width="9" height="2" />
                </svg>
            ),

            // åˆ†æã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæ£’ã‚°ãƒ©ãƒ• - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
            Analytics: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <rect x="5" y="13" width="3" height="8" />
                    <rect x="10.5" y="9" width="3" height="12" />
                    <rect x="16" y="5" width="3" height="16" />
                </svg>
            ),

            // ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
            MyPage: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
            ),

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæ‰‰ã‹ã‚‰å‡ºã‚‹ï¼‰
            Logout: ({ size = 20, color = "currentColor" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16,17 21,12 16,7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
            )
        };

        function ProjectManagementApp() {
            // èªè¨¼é–¢é€£ã®çŠ¶æ…‹
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [authMode, setAuthMode] = useState('login'); // 'login' or 'register'
            const [authForm, setAuthForm] = useState({
                email: '',
                password: '',
                name: '',
                confirmPassword: ''
            });
            const [authError, setAuthError] = useState('');
            const [emailVerificationSent, setEmailVerificationSent] = useState(false);
            const [waitingForVerification, setWaitingForVerification] = useState(false);
            const [isRegistering, setIsRegistering] = useState(false); // â† ã“ã®è¡Œã‚’è¿½åŠ 
            const [currentCalendarDate, setCurrentCalendarDate] = useState(new Date());

            // æ—¢å­˜ã®çŠ¶æ…‹
            const [projects, setProjects] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [workSessions, setWorkSessions] = useState([]); // ä½œæ¥­å±¥æ­´ã‚’è¿½åŠ 
            const [activeTab, setActiveTab] = useState('tasks');
            // ä¿®æ­£å¾Œï¼šå®Œå…¨ãªåˆæœŸåŒ–é–¢æ•°
            const resetNewProjectForm = () => {
                setNewProject({
                    name: '',
                    company: '',
                    description: '',
                    startDate: '',
                    deadline: '',
                    amount: '',
                    checklistTemplateId: '',
                    wiringTemplateId: ''
                });
                setSelectedTemplate(null);
                setCompanyInputMode('select');
            };
            const resetNewTaskForm = () => {
                setNewTask({
                    title: '',
                    description: '',
                    estimatedHours: '',
                    projectId: '',
                    actualHours: '',
                    checklistTemplateId: ''
                });
            };
            // â†‘ã“ã®ç›´å¾Œã¾ãŸã¯ç›´å‰ã«ä»¥ä¸‹ã‚’è¿½åŠ 
            const [newProject, setNewProject] = useState({
                name: '',
                company: '',
                description: '',
                startDate: '',
                deadline: '',
                amount: '',
                laborCost: '',
                materialCost: '',
                checklistTemplateId: '',
                wiringTemplateId: ''
            });
            const [newTask, setNewTask] = useState({
                title: '',
                description: '',
                estimatedHours: '',
                projectId: '',
                actualHours: '',
                checklistTemplateId: ''  // è¿½åŠ 
            });
            // ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹
            const [activeTimers, setActiveTimers] = useState({});
            const [showNewProjectForm, setShowNewProjectForm] = useState(false);
            const [showNewTaskForm, setShowNewTaskForm] = useState(false);
            const [lastSaved, setLastSaved] = useState(null);
            const [autoSaveEnabled, setAutoSaveEnabled] = useState(true);
            const [collapsedProjects, setCollapsedProjects] = useState({});
            const [searchQuery, setSearchQuery] = useState('');
            // æ—¢å­˜ã®collapsedProjectsã®å¾Œã«è¿½åŠ 
            const [collapsedCompanies, setCollapsedCompanies] = useState({});
            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ¡ˆä»¶åæ¬„ã®å¹…ç®¡ç†
            const [ganttProjectNameWidth, setGanttProjectNameWidth] = useState({ mobile: 120, desktop: 256 });

            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ¡ˆä»¶åæ¬„ã®ã‚¿ãƒƒãƒãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            const toggleGanttProjectNameWidth = useCallback((isMobile) => {
                setGanttProjectNameWidth(prev => {
                    if (isMobile) {
                        // ãƒ¢ãƒã‚¤ãƒ«: 120px â‡„ 0pxï¼ˆå®Œå…¨ã«éè¡¨ç¤ºï¼‰
                        return {
                            ...prev,
                            mobile: prev.mobile === 120 ? 0 : 120
                        };
                    } else {
                        // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: 256px â‡„ 0pxï¼ˆå®Œå…¨ã«éè¡¨ç¤ºï¼‰
                        return {
                            ...prev,
                            desktop: prev.desktop === 256 ? 0 : 256
                        };
                    }
                });
            }, []);

            // å®Ÿéš›ã®è¡¨ç¤ºå¹…ã‚’è€ƒæ…®ã—ãŸãƒ†ã‚­ã‚¹ãƒˆçœç•¥é–¢æ•°
            const truncateFullWidthText = useCallback((text, maxFullWidthChars = 8) => {
                if (!text) return text;

                let widthCount = 0;
                let result = '';

                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    // å…¨è§’æ–‡å­—ã®åˆ¤å®šï¼ˆã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã€å…¨è§’è¨˜å·ç­‰ï¼‰
                    const isFullWidth = char.match(/[^\x01-\x7E\xA1-\xDF]/);
                    // åŠè§’æ–‡å­—ã¯å…¨è§’æ–‡å­—ã®ç´„0.65å€ã®å¹…ã¨ã—ã¦è¨ˆç®—
                    const charWidth = isFullWidth ? 1 : 0.65;

                    // æ¬¡ã®æ–‡å­—ã‚’è¿½åŠ ã™ã‚‹ã¨åˆ¶é™ã‚’è¶…ãˆã‚‹å ´åˆ
                    if (widthCount + charWidth > maxFullWidthChars) {
                        return result + '...';
                    }

                    widthCount += charWidth;
                    result += char;
                }

                return result;
            }, []);

            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [taskTemplates, setTaskTemplates] = useState([]);
            const [showTemplateForm, setShowTemplateForm] = useState(false);
            const [newTemplate, setNewTemplate] = useState({
                name: '',
                companyId: '',  // â† è¿½åŠ 
                tasks: [{ title: '', estimatedHours: '', description: '' }]
            });

            // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [wiringTemplates, setWiringTemplates] = useState([]);
            const [showWiringForm, setShowWiringForm] = useState(false);
            const [editingWiring, setEditingWiring] = useState(null);
            const [newWiring, setNewWiring] = useState({
                name: '',
                companyId: '',
                specifications: {
                    wire: {
                        power: {
                            standards: [],
                            wiringType: '',
                            phases: {
                                rPhase: '',
                                sPhase: '',
                                tPhase: '',
                                nPhase: '',
                                lPhase: ''
                            },
                            remarks: ''
                        },
                        ground: {
                            caseColor: '',
                            caseDiameter: '',
                            doorColor: '',
                            doorDiameter: '',
                            panelColor: '',
                            panelDiameter: '',
                            remarks: ''
                        },
                        insulationCap: '',
                        insulationCapDiameter: '',
                        insulationCapRemarks: '',
                        controlAC: {
                            standards: '',
                            customStandard: '',
                            commonColor: '',
                            commonDiameter: '',
                            nonCommonColor: '',
                            nonCommonDiameter: '',
                            remarks: ''
                        },
                        controlDC: {
                            standards: '',
                            customStandard: '',
                            pBusColor: '',
                            pBusDiameter: '',
                            nBusColor: '',
                            nBusDiameter: '',
                            otherColor: '',
                            otherDiameter: '',
                            remarks: ''
                        },
                        specialSpec: '',  // â† è¿½åŠ 
                        manufacturerSpecified: false,
                        manufacturer: ''
                    },
                    // â†“ æ–°è¦è¿½åŠ 
                    markTube: {
                        orientation: {
                            up: '',
                            down: '',
                            left: '',
                            right: ''
                        },
                        fontSize: '',
                        customFontSize: '',
                        length: '',
                        customLength: '',
                        printSpec: '',
                        printSpecDetail: '',
                        remarks: ''  // â† ã“ã®è¡Œã‚’è¿½åŠ 
                    },
                    otherConfirm: {
                        tighteningPen: '',
                        tighteningPenDetail: '',
                        matchMark: '',
                        screw: '',
                        screwDetail: '',
                        hookTube: '',
                        spiralTube: '',
                        spiralTubeDetail: '',
                        insulock: '',
                        insulockDetail: '',
                        mountBase: '',
                        mountBaseDetail: '',
                        routeSpecialNote: '',
                        remarks: ''  // â† ã“ã®è¡Œã‚’è¿½åŠ 
                    },
                    terminal: {
                        power: '',
                        controlAC: '',
                        controlDC: '',
                        simultaneousCrimp: '',
                        remarks: '',
                        screwClamp: '',
                        screwlessClamp: '',
                        manufacturerSpecified: false,
                        manufacturer: ''
                    },
                    terminalBlock: {
                        cover: '',
                        namePlate: '',
                        bridge: '',
                        maxWires: '',
                        remarks: '',
                        manufacturerSpecified: false,
                        manufacturer: ''
                    },
                    namePlate: {
                        fontSize: '',
                        customFontSize: '',
                        remarks: ''
                    },
                    deviceSeal: {
                        fontSize: '',
                        customFontSize: '',
                        length: '',
                        customLength: '',
                        positions: [],
                        customPosition: '',
                        remarks: ''
                    }
                }
            });
            const [projectWirings, setProjectWirings] = useState({}); // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®é…ç·šä»•æ§˜
            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé–¢é€£ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [checklistTemplates, setChecklistTemplates] = useState([]);
            const [showChecklistForm, setShowChecklistForm] = useState(false);
            const [editingChecklist, setEditingChecklist] = useState(null);
            const [newChecklist, setNewChecklist] = useState({
                name: '',
                companyId: '',
                checkType: 'double', // 'single' ã¾ãŸã¯ 'double' ã‚’è¿½åŠ 
                categories: [
                    {
                        name: '',
                        items: [{ name: '', description: '' }]
                    }
                ]
            });
            const [showChecklistModal, setShowChecklistModal] = useState(false);
            const [currentProjectChecklist, setCurrentProjectChecklist] = useState(null);
            const [projectChecklists, setProjectChecklists] = useState({});
            const [selectedTemplate, setSelectedTemplate] = useState(null);
            const [editingTemplate, setEditingTemplate] = useState(null);
            const [originalTemplate, setOriginalTemplate] = useState(null);
            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ç”¨çŠ¶æ…‹
            const [draggedTemplateTask, setDraggedTemplateTask] = useState(null);
            const [dragOverTemplateTask, setDragOverTemplateTask] = useState(null);
            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ç”¨çŠ¶æ…‹
            const [draggedChecklistCategory, setDraggedChecklistCategory] = useState(null);
            const [dragOverChecklistCategory, setDragOverChecklistCategory] = useState(null);
            const [draggedChecklistItem, setDraggedChecklistItem] = useState(null);
            const [dragOverChecklistItem, setDragOverChecklistItem] = useState(null);
            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç·¨é›†ç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [editingProjectChecklist, setEditingProjectChecklist] = useState(null);
            const [showEditChecklistModal, setShowEditChecklistModal] = useState(false);

            // å·¥æ•°å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [showHoursInputModal, setShowHoursInputModal] = useState(false);
            const [hoursInputTask, setHoursInputTask] = useState(null);
            const [selectedDate, setSelectedDate] = useState(() => {
                const today = new Date();
                return today.getFullYear() + '-' +
                    String(today.getMonth() + 1).padStart(2, '0') + '-' +
                    String(today.getDate()).padStart(2, '0');
            });
            const [dailyHours, setDailyHours] = useState('');

            // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [sortOption, setSortOption] = useState('created-desc'); // 'created-desc', 'created-asc', 'deadline-asc', 'deadline-desc', 'progress-desc', 'progress-asc'
            const [statusFilter, setStatusFilter] = useState('active'); // 'all', 'active', 'completed'

            // ä¼šç¤¾ç®¡ç†ç”¨ã®çŠ¶æ…‹ã‚’è¿½åŠ 
            const [companies, setCompanies] = useState([]);
            const [showCompanyForm, setShowCompanyForm] = useState(false);
            const [newCompany, setNewCompany] = useState({ name: '', description: '' });
            const [companyInputMode, setCompanyInputMode] = useState('select'); // 'select' or 'manual'
            const [editCompany, setEditCompany] = useState(null);
            const [showEditCompanyForm, setShowEditCompanyForm] = useState(false);

            // å‰Šé™¤ç¢ºèªç”¨ã®çŠ¶æ…‹
            const [deleteConfirm, setDeleteConfirm] = useState({
                show: false,
                type: '', // 'project' ã¾ãŸã¯ 'task'
                id: null,
                name: '',
                inputName: ''
            });

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç¢ºèªç”¨ã®çŠ¶æ…‹
            const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);

            // ç·¨é›†ç”¨ã®çŠ¶æ…‹
            const [editProject, setEditProject] = useState(null);
            const [editTask, setEditTask] = useState(null);
            const [showEditProjectForm, setShowEditProjectForm] = useState(false);
            const [showEditTaskForm, setShowEditTaskForm] = useState(false);

            // ã‚¿ã‚¤ãƒãƒ¼çµŒéæ™‚é–“ç”¨
            const [timerDisplays, setTimerDisplays] = useState({});


            // activeTimersã‚’Firestoreã«ä¿å­˜
            const [isTimerDataLoaded, setIsTimerDataLoaded] = useState(false);

            useEffect(() => {
                console.log('activeTimers changed:', activeTimers, 'user:', user?.uid, 'loaded:', isTimerDataLoaded);
                if (user && Object.keys(activeTimers).length > 0) {
                    console.log('Saving activeTimers to Firestore');
                    const timerData = {
                        userId: user.uid,
                        activeTimers: activeTimers,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    // setã‹addã‹ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ç›´æ¥Firestoreã‚’æ“ä½œ
                    db.collection('activeTimers').doc(user.uid).set(timerData, { merge: true })
                        .then(() => {
                            console.log('activeTimersä¿å­˜æˆåŠŸ');
                        })
                        .catch(error => {
                            console.error('activeTimersä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                        });
                } else if (user && Object.keys(activeTimers).length === 0 && isTimerDataLoaded && typeof activeTimers === 'object' && activeTimers !== null) {
                    // ã‚¿ã‚¤ãƒãƒ¼ãŒå…¨ã¦åœæ­¢ã•ã‚ŒãŸå ´åˆã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ï¼ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†å¾Œã®ã¿ï¼‰
                    console.log('Deleting activeTimers from Firestore - activeTimers:', activeTimers);
                    db.collection('activeTimers').doc(user.uid).delete().catch(error => {
                        console.error('Failed to delete active timers:', error);
                    });
                }
            }, [activeTimers, user, isTimerDataLoaded]);

            // Firestoreã‹ã‚‰ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹ã‚’å¾©å…ƒ
            useEffect(() => {
                console.log('Attempting to restore activeTimers for user:', user?.uid);
                if (user) {
                    db.collection('activeTimers').doc(user.uid).get()
                        .then(doc => {
                            console.log('activeTimers document exists:', doc.exists);
                            if (doc.exists) {
                                const data = doc.data();
                                console.log('activeTimers data from Firestore:', data);
                                if (data.activeTimers) {
                                    console.log('Restoring activeTimers:', data.activeTimers);
                                    setActiveTimers(data.activeTimers);
                                    setIsTimerDataLoaded(true);
                                } else {
                                    console.log('No activeTimers in document');
                                    setIsTimerDataLoaded(true);
                                }
                            } else {
                                console.log('No activeTimers document found');
                                setIsTimerDataLoaded(true);
                            }
                        })
                        .catch(error => {
                            console.error('Failed to load active timers from Firestore:', error);
                        });
                }
            }, [user]);

            // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒãƒ¼ã®è¡¨ç¤ºã‚’å¾©å…ƒ
            useEffect(() => {
                const updateTimerDisplays = () => {
                    setTimerDisplays(prev => {
                        const newDisplays = { ...prev };
                        Object.keys(activeTimers).forEach(taskId => {
                            if (activeTimers[taskId]) {
                                const elapsedSeconds = Math.floor((Date.now() - activeTimers[taskId].startTime) / 1000);
                                const minutes = Math.floor(elapsedSeconds / 60);
                                const seconds = elapsedSeconds % 60;
                                newDisplays[taskId] = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                            }
                        });
                        return newDisplays;
                    });
                };

                // åˆå›å®Ÿè¡Œ
                if (Object.keys(activeTimers).length > 0) {
                    updateTimerDisplays();
                }
            }, [activeTimers]);  // activeTimersãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œ


            // ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ç”¨ã®çŠ¶æ…‹
            const [draggedTask, setDraggedTask] = useState(null);
            const [dragOverTask, setDragOverTask] = useState(null);

            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ã®çŠ¶æ…‹
            const [isDragging, setIsDragging] = useState(false);
            const [startX, setStartX] = useState(0);
            const [scrollLeft, setScrollLeft] = useState(0);
            const ganttScrollRef = useRef(null);
            const scrollPositionRef = useRef(0);

            // å·¥æ•°è©³ç´°è¡¨ç¤ºç”¨ã®çŠ¶æ…‹
            const [showHoursDetail, setShowHoursDetail] = useState(false);
            const [detailTaskId, setDetailTaskId] = useState(null);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°è¡¨ç¤ºç”¨ã®çŠ¶æ…‹
            const [showProjectDetail, setShowProjectDetail] = useState(false);
            const [detailProjectId, setDetailProjectId] = useState(null);

            // é…ç·šä»•æ§˜ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®çŠ¶æ…‹
            const [showWiringModal, setShowWiringModal] = useState(false);
            const [currentProjectWiring, setCurrentProjectWiring] = useState(null);

            // æ—¥åˆ¥å·¥æ•°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®çŠ¶æ…‹
            const [showDailyHoursModal, setShowDailyHoursModal] = useState(false);
            const [selectedDateForModal, setSelectedDateForModal] = useState('');
            const [dailyHoursSessions, setDailyHoursSessions] = useState([]);

            // ä½œæ¥­å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ã®çŠ¶æ…‹
            const [workHistoryFilter, setWorkHistoryFilter] = useState('today'); // 'all', 'today', 'thisweek', 'thismonth', 'lastmonth'

            // ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ç”¨ã®çŠ¶æ…‹
            const [favorites, setFavorites] = useState([]);

            // ç®¡ç†è€…æ¨©é™æ©Ÿèƒ½ç”¨ã®çŠ¶æ…‹
            const [isAdmin, setIsAdmin] = useState(false);
            const [isMasterAdmin, setIsMasterAdmin] = useState(false);
            const [showUserManagementModal, setShowUserManagementModal] = useState(false);
            const [allUsers, setAllUsers] = useState([]);
            const [adminUsers, setAdminUsers] = useState([]);

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³è‰²è¨­å®šç”¨ã®çŠ¶æ…‹
            const [showColorPickerModal, setShowColorPickerModal] = useState(false);
            const [userIconColor, setUserIconColor] = useState('linear-gradient(45deg, #667eea 0%, #764ba2 100%)');
            const [tempIconColor, setTempIconColor] = useState('linear-gradient(45deg, #667eea 0%, #764ba2 100%)');
            const [otherUserColors, setOtherUserColors] = useState({}); // ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‰²è¨­å®š

            // ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®UID
            const MASTER_ADMIN_UID = 'fjczVboagRRuUNvWVJ9tOLszEnd2';

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‰²ã‚’å–å¾—ã™ã‚‹é–¢æ•°
            const getUserIconColor = (userId) => {
                if (userId === user?.uid) {
                    return userIconColor; // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
                }
                return otherUserColors[userId] || 'linear-gradient(45deg, #667eea 0%, #764ba2 100%)'; // ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            };

            // ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‰²è¨­å®šã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
            const loadOtherUserColor = async (userId) => {
                if (userId === user?.uid || otherUserColors[userId]) return; // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯æ—¢ã«èª­ã¿è¾¼ã¿æ¸ˆã¿

                try {
                    const userSettingsRef = db.collection('userSettings').doc(userId);
                    const userSettingsSnapshot = await userSettingsRef.get();

                    if (userSettingsSnapshot.exists) {
                        const settings = userSettingsSnapshot.data();
                        if (settings.iconColor) {
                            setOtherUserColors(prev => ({
                                ...prev,
                                [userId]: settings.iconColor
                            }));
                        }
                    }
                } catch (error) {
                    console.log(`ãƒ¦ãƒ¼ã‚¶ãƒ¼${userId}ã®è‰²è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, error.message);
                }
            };

            // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‰²è¨­å®šã‚’ä¸€æ‹¬èª­ã¿è¾¼ã¿ã™ã‚‹é–¢æ•°
            const loadAllUserColors = async (currentUser) => {
                try {
                    // å…¨userSettingsã‚’å–å¾—
                    const userSettingsSnapshot = await db.collection('userSettings').get();
                    const colors = {};

                    userSettingsSnapshot.docs.forEach(doc => {
                        const userId = doc.id;
                        const data = doc.data();

                        // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä»¥å¤–ã®è‰²è¨­å®šã‚’ä¿å­˜
                        if (userId !== currentUser.uid && data.iconColor) {
                            colors[userId] = data.iconColor;
                        }
                    });

                    setOtherUserColors(colors);
                    console.log('å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼è‰²è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†:', Object.keys(colors).length, 'ä»¶');
                } catch (error) {
                    console.log('å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼è‰²è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error.message);
                }
            };


            const autoSaveTimer = useRef(null);


            // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // ãƒ¡ãƒ¼ãƒ«ç¢ºèªçŠ¶æ…‹ã‚’å†å–å¾—
                        await user.reload();

                        // ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ã®å ´åˆã®ã¿ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã™ã‚‹
                        if (user.emailVerified) {
                            setUser(user);
                            loadSharedData(user);
                        } else {
                            setUser(null);
                            // æ–°è¦ç™»éŒ²ä¸­ã§ãªã„å ´åˆã®ã¿ã€ç¢ºèªå¾…ã¡ç”»é¢ã‚’è¡¨ç¤º
                            if (!isRegistering && !emailVerificationSent) {
                                setWaitingForVerification(true);
                            }
                        }
                    } else {
                        setUser(null);
                        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                        setProjects([]);
                        setTasks([]);
                        setWorkSessions([]);
                        setActiveTimers({});
                        setCompanies([]);
                        setTaskTemplates([]);
                    }
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [isRegistering, emailVerificationSent]); // â† ä¾å­˜é…åˆ—ã«è¿½åŠ 

            // å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆuserIdãƒ•ã‚£ãƒ«ã‚¿ã‚’å‰Šé™¤ï¼‰
            const loadSharedData = async (currentUser) => {  // â¬…ï¸ å¼•æ•°ã‚’è¿½åŠ 
                try {
                    // å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿è¾¼ã¿ï¼ˆuserIdãƒ•ã‚£ãƒ«ã‚¿ãªã—ï¼‰
                    const projectsSnapshot = await db.collection('projects').get();
                    const projectsData = projectsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    projectsData.sort((a, b) => {
                        const aDate = a.createdAt ? a.createdAt.toDate() : new Date(0);
                        const bDate = b.createdAt ? b.createdAt.toDate() : new Date(0);
                        return bDate - aDate;
                    });
                    setProjects(projectsData);

                    // å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸçŠ¶æ…‹ã§é–‰ã˜ã‚‹
                    const initialCollapsed = {};
                    projectsData.forEach(project => {
                        initialCollapsed[project.id] = true;
                    });
                    setCollapsedProjects(initialCollapsed);

                    // å…¨ã‚¿ã‚¹ã‚¯ã®èª­ã¿è¾¼ã¿ï¼ˆuserIdãƒ•ã‚£ãƒ«ã‚¿ãªã—ï¼‰
                    const tasksSnapshot = await db.collection('tasks').get();
                    const tasksData = tasksSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    tasksData.sort((a, b) => {
                        const aDate = a.createdAt ? a.createdAt.toDate() : new Date(0);
                        const bDate = b.createdAt ? b.createdAt.toDate() : new Date(0);
                        return bDate - aDate;
                    });
                    setTasks(tasksData);

                    // å…¨ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿
                    const workSessionsSnapshot = await db.collection('workSessions').get();
                    const workSessionsData = workSessionsSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    workSessionsData.sort((a, b) => {
                        const aDate = a.endTime ? a.endTime.toDate() :
                            a.startTime ? a.startTime.toDate() : new Date(0);
                        const bDate = b.endTime ? b.endTime.toDate() :
                            b.startTime ? b.startTime.toDate() : new Date(0);
                        return bDate - aDate;
                    });
                    setWorkSessions(workSessionsData);

                    // â¬‡ï¸ å…¨ä¼šç¤¾ã®èª­ã¿è¾¼ã¿ï¼ˆä¿®æ­£ï¼‰â¬‡ï¸
                    const companiesSnapshot = await db.collection('companies').get();
                    const companiesData = companiesSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    companiesData.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                    setCompanies(companiesData);
                    console.log('ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', companiesData.length, 'ä»¶');  // ãƒ‡ãƒãƒƒã‚°ç”¨

                    // å…¨ä¼šç¤¾ã‚’åˆæœŸçŠ¶æ…‹ã§é–‰ã˜ã‚‹
                    const initialCollapsedCompanies = {};
                    companiesData.forEach(company => {
                        initialCollapsedCompanies[company.id] = true;
                    });
                    setCollapsedCompanies(initialCollapsedCompanies);

                    // â¬‡ï¸ ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ï¼ˆä¿®æ­£ï¼‰â¬‡ï¸
                    if (currentUser && currentUser.uid) {  // â¬…ï¸ currentUserã‚’ä½¿ç”¨
                        // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±æœ‰ï¼‰
                        const templatesSnapshot = await db.collection('taskTemplates').get();
                        const templatesData = templatesSnapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setTaskTemplates(templatesData);
                        console.log('å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿å®Œäº†:', templatesData.length, 'ä»¶');
                        // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿
                        try {
                            const checklistsSnapshot = await db.collection('checklistTemplates').get();
                            const checklistsData = checklistsSnapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setChecklistTemplates(checklistsData);
                            console.log('æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿å®Œäº†:', checklistsData.length, 'ä»¶');
                        } catch (error) {
                            console.log('æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆåˆå›ã¯æ­£å¸¸ï¼‰:', error.message);
                            setChecklistTemplates([]);
                        }

                        // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿
                        try {
                            const wiringSnapshot = await db.collection('wiringTemplates').get();
                            const wiringData = wiringSnapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setWiringTemplates(wiringData);
                            console.log('é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿å®Œäº†:', wiringData.length, 'ä»¶');
                        } catch (error) {
                            console.log('é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆåˆå›ã¯æ­£å¸¸ï¼‰:', error.message);
                            setWiringTemplates([]);
                        }

                        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é…ç·šä»•æ§˜ã‚’èª­ã¿è¾¼ã¿
                        try {
                            const projectWiringSnapshot = await db.collection('projectWirings').get();
                            const projectWiringData = {};
                            projectWiringSnapshot.docs.forEach(doc => {
                                const data = doc.data();
                                projectWiringData[data.projectId] = {
                                    id: doc.id,
                                    ...data
                                };
                            });
                            setProjectWirings(projectWiringData);
                            console.log('æ¡ˆä»¶é…ç·šä»•æ§˜èª­ã¿è¾¼ã¿å®Œäº†:', Object.keys(projectWiringData).length, 'ä»¶');
                        } catch (error) {
                            console.log('æ¡ˆä»¶é…ç·šä»•æ§˜èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆåˆå›ã¯æ­£å¸¸ï¼‰:', error.message);
                            setProjectWirings({});
                        }

                        /// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆçŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
                        try {
                            const projectChecklistsSnapshot = await db.collection('projectChecklists').get();
                            const projectChecklistsData = {};
                            projectChecklistsSnapshot.docs.forEach(doc => {
                                const data = doc.data();
                                // taskIdã‚’ã‚­ãƒ¼ã¨ã—ã¦ä¿å­˜
                                const checklistKey = `task_${data.taskId}`;
                                projectChecklistsData[checklistKey] = {
                                    id: doc.id,
                                    ...data
                                };
                            });
                            setProjectChecklists(projectChecklistsData);
                            console.log('æ¡ˆä»¶æ¤œæŸ»ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿å®Œäº†:', Object.keys(projectChecklistsData).length, 'ä»¶');
                        } catch (error) {
                            console.log('æ¡ˆä»¶æ¤œæŸ»ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆåˆå›ã¯æ­£å¸¸ï¼‰:', error.message);
                            setProjectChecklists({});
                        }

                        // ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
                        if (currentUser) {
                            try {
                                const favoritesSnapshot = await db.collection('favorites')
                                    .where('userId', '==', currentUser.uid)
                                    .get();
                                const favoritesData = favoritesSnapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }));
                                setFavorites(favoritesData);
                                console.log('ãŠæ°—ã«å…¥ã‚Šèª­ã¿è¾¼ã¿å®Œäº†:', favoritesData.length, 'ä»¶');
                            } catch (error) {
                                console.log('ãŠæ°—ã«å…¥ã‚Šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼ˆåˆå›ã¯æ­£å¸¸ï¼‰:', error.message);
                                setFavorites([]);
                            }

                            // ç®¡ç†è€…æ¨©é™ã®ç¢ºèª
                            await checkAdminRights(currentUser);

                            // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®èª­ã¿è¾¼ã¿ï¼ˆã‚¢ã‚¤ã‚³ãƒ³è‰²ãªã©ï¼‰
                            try {
                                const userSettingsRef = db.collection('userSettings').doc(currentUser.uid);
                                const userSettingsSnapshot = await userSettingsRef.get();

                                if (userSettingsSnapshot.exists) {
                                    const settings = userSettingsSnapshot.data();
                                    if (settings.iconColor) {
                                        setUserIconColor(settings.iconColor);
                                        setTempIconColor(settings.iconColor);
                                    }
                                } else {
                                    // åˆå›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ã‚’è¨­å®š
                                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                                }
                            } catch (error) {
                                console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error.message);
                            }
                        }
                    }

                    // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‰²è¨­å®šã‚’èª­ã¿è¾¼ã¿
                    await loadAllUserColors(currentUser);

                    setLastSaved(new Date());
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            };

            // æ–°è¦ç™»éŒ²
            const handleRegister = async (e) => {
                e.preventDefault();
                setAuthError('');

                if (authForm.password !== authForm.confirmPassword) {
                    setAuthError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“');
                    return;
                }

                if (authForm.password.length < 6) {
                    setAuthError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                try {
                    setIsRegistering(true); // æ–°è¦ç™»éŒ²é–‹å§‹ãƒ•ãƒ©ã‚°ã‚’è¨­å®š

                    const userCredential = await auth.createUserWithEmailAndPassword(
                        authForm.email,
                        authForm.password
                    );

                    // ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’é€ä¿¡
                    const actionCodeSettings = {
                        // æœ¬ç•ªç’°å¢ƒã¨é–‹ç™ºç’°å¢ƒã‚’è‡ªå‹•åˆ¤å®š
                        url: window.location.href.includes('127.0.0.1')
                            ? 'http://127.0.0.1:5500/index.html'
                            : window.location.origin,
                        handleCodeInApp: false
                    };

                    await userCredential.user.sendEmailVerification(actionCodeSettings);

                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®displayNameã‚’è¨­å®š
                    await userCredential.user.updateProfile({
                        displayName: authForm.name
                    });

                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’ä¿å­˜ï¼ˆãƒ¡ãƒ¼ãƒ«æœªç¢ºèªãƒ•ãƒ©ã‚°ä»˜ãï¼‰
                    await db.collection('users').doc(userCredential.user.uid).set({
                        name: authForm.name,
                        email: authForm.email,
                        emailVerified: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                    setEmailVerificationSent(true);
                    setIsRegistering(false); // æ–°è¦ç™»éŒ²å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š

                    // ä¸€æ—¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ¡ãƒ¼ãƒ«ç¢ºèªã¾ã§å¾…æ©Ÿï¼‰
                    await auth.signOut();

                    setAuthForm({ email: '', password: '', name: '', confirmPassword: '' });
                } catch (error) {
                    console.error('æ–°è¦ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
                    setAuthError(getAuthErrorMessage(error.code));
                    setIsRegistering(false); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
                }
            };

            // ãƒ­ã‚°ã‚¤ãƒ³
            const handleLogin = async (e) => {
                e.preventDefault();
                setAuthError('');

                try {
                    const userCredential = await auth.signInWithEmailAndPassword(
                        authForm.email,
                        authForm.password
                    );

                    // ãƒ¡ãƒ¼ãƒ«ç¢ºèªçŠ¶æ…‹ã‚’å†å–å¾—
                    await userCredential.user.reload();

                    // ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
                    if (!userCredential.user.emailVerified) {
                        setWaitingForVerification(true);
                        await auth.signOut();
                        return;
                    }

                    // ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ã®å ´åˆã€Firestoreã®ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°
                    await db.collection('users').doc(userCredential.user.uid).update({
                        emailVerified: true,
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    setAuthForm({ email: '', password: '', name: '', confirmPassword: '' });
                    setWaitingForVerification(false);
                } catch (error) {
                    console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
                    setAuthError(getAuthErrorMessage(error.code));
                }
            };

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç¢ºèªã‚’è¡¨ç¤º
            const handleLogout = () => {
                setShowLogoutConfirm(true);
            };

            // å®Ÿéš›ã®ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
            const confirmLogout = async () => {
                try {
                    await auth.signOut();
                    setShowLogoutConfirm(false);
                } catch (error) {
                    console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                }
            };

            // Firebaseã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ—¥æœ¬èªåŒ–
            const getAuthErrorMessage = (errorCode) => {
                switch (errorCode) {
                    case 'auth/email-already-in-use':
                        return 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™';
                    case 'auth/invalid-email':
                        return 'ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™';
                    case 'auth/weak-password':
                        return 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™';
                    case 'auth/user-not-found':
                        return 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                    case 'auth/wrong-password':
                        return 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™';
                    case 'auth/too-many-requests':
                        return 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„';
                    default:
                        return 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                }
            };

            // Firestoreã¸ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆå…±æœ‰ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½œæˆè€…æƒ…å ±ä»˜ãã§ä¿å­˜ï¼‰
            const saveToFirestore = async (collection, data, docId = null) => {
                console.log('saveToFirestore called:', { collection, data, docId, user: user?.uid });
                if (!user) {
                    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“');
                    return null;
                }

                try {
                    let dataWithUser;

                    if (docId) {
                        // æ›´æ–°æ™‚ã¯ä½œæˆè€…æƒ…å ±ã‚’å¤‰æ›´ã›ãšã€æ›´æ–°è€…æƒ…å ±ã®ã¿è¿½åŠ 
                        dataWithUser = {
                            ...data,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedBy: user.uid,
                            updatedByName: user.displayName || user.email
                        };
                    } else {
                        // æ–°è¦ä½œæˆæ™‚ã¯ä½œæˆè€…æƒ…å ±ã‚’è¨­å®š
                        dataWithUser = {
                            ...data,
                            createdBy: user.uid,
                            createdByName: user.displayName || user.email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                    }

                    console.log('Firestoreä¿å­˜ãƒ‡ãƒ¼ã‚¿:', dataWithUser);

                    if (docId) {
                        await db.collection(collection).doc(docId).update(dataWithUser);
                        console.log(`${collection}æ›´æ–°æˆåŠŸ:`, docId);
                        return docId;
                    } else {
                        const docRef = await db.collection(collection).add(dataWithUser);
                        console.log(`${collection}ä½œæˆæˆåŠŸ:`, docRef.id);
                        return docRef.id;
                    }
                } catch (error) {
                    console.error('Firestoreä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    console.error('ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰:', error.code);
                    console.error('ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', error.message);

                    // å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    if (error.code === 'permission-denied') {
                        alert('ğŸ”’ ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚¨ãƒ©ãƒ¼\n\nFirebase Consoleã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’å…±æœ‰å‹ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚\n\nè©³ç´°ãªæ‰‹é †:\n1. Firebase Console â†’ Firestore Database â†’ ãƒ«ãƒ¼ãƒ«\n2. èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†å¤‰æ›´\n3. ã€Œå…¬é–‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯');
                    } else if (error.code === 'failed-precondition') {
                        alert('ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚Firebase Consoleã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚');
                    } else {
                        alert('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                    }
                    return null;
                }
            };

            // Firestoreã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
            const deleteFromFirestore = async (collection, docId) => {
                try {
                    await db.collection(collection).doc(docId).delete();
                    return true;
                } catch (error) {
                    console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                    return false;
                }
            };

            // ã‚¿ã‚¤ãƒãƒ¼çµŒéæ™‚é–“æ›´æ–°ç”¨
            useEffect(() => {
                const interval = setInterval(() => {
                    setTimerDisplays(prev => {
                        const newDisplays = { ...prev };
                        Object.keys(activeTimers).forEach(taskId => {
                            if (activeTimers[taskId]) {
                                const elapsedSeconds = Math.floor((Date.now() - activeTimers[taskId].startTime) / 1000);
                                const minutes = Math.floor(elapsedSeconds / 60);
                                const seconds = elapsedSeconds % 60;
                                newDisplays[taskId] = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                            }
                        });
                        return newDisplays;
                    });
                }, 1000);

                return () => clearInterval(interval);
            }, [activeTimers]);

            // å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
            const openDeleteConfirm = useCallback((type, id, name) => {
                setDeleteConfirm({
                    show: true,
                    type,
                    id,
                    name,
                    inputName: ''
                });
            }, []);

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯åˆ¥å·¥æ•°ã‚’å–å¾—
            // ç¾åœ¨ã®é–¢æ•°ã‚’ä¿®æ­£
            const getUserTaskHours = useCallback((userId, taskId) => {
                const sessions = workSessions.filter(s => s.userId === userId && s.taskId === taskId);
                return sessions.reduce((sum, session) => sum + (session.hours || session.totalHours || 0), 0);
            }, [workSessions]);

            // ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
            const openEditProject = useCallback((project) => {
                // ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹wiringTemplateIdã‚’ä½¿ç”¨
                setEditProject({
                    ...project,
                    wiringTemplateId: project.wiringTemplateId || ''
                });
                const existingCompany = companies.find(company => company.name === project.company);
                if (existingCompany || !project.company) {
                    setCompanyInputMode('select');
                } else {
                    setCompanyInputMode('manual');
                }
                setSelectedTemplate(null);
                setShowEditProjectForm(true);
            }, [companies]);

            const openEditTask = useCallback((task) => {
                if (!task || !task.id) return;

                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å·¥æ•°ã‚’å–å¾—
                const currentUserHours = getUserTaskHours(user.uid, task.id);

                setEditTask({
                    ...task,
                    estimatedHours: parseFloat(task.estimatedHours) || 0,
                    actualHours: currentUserHours  // è‡ªåˆ†ã®å®Ÿç¸¾å·¥æ•°ã‚’åˆæœŸå€¤ã¨ã—ã¦è¨­å®š
                });
                setShowEditTaskForm(true);
            }, [user, getUserTaskHours]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°
            const updateProject = useCallback(async () => {
                if (editProject && editProject.name.trim()) {
                    const updatedProject = {
                        ...editProject,
                        amount: parseFloat(editProject.amount) || 0,
                        // ä½œæˆè€…æƒ…å ±ã‚’æ˜ç¤ºçš„ã«ä¿æŒ
                        createdBy: editProject.createdBy,
                        createdByName: editProject.createdByName,
                        createdAt: editProject.createdAt
                    };

                    const success = await saveToFirestore('projects', updatedProject, editProject.id);
                    if (success) {
                        // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
                        if (selectedTemplate) {
                            console.log('å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å·¥ç¨‹ä½œæˆé–‹å§‹:', selectedTemplate.name);
                            await createTasksFromTemplate(editProject.id, selectedTemplate);
                            setSelectedTemplate(null);
                            console.log('å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã®å·¥ç¨‹ä½œæˆå®Œäº†');
                        }

                        // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                        if (editProject.wiringTemplateId) {
                            const wiringTemplate = wiringTemplates.find(t => t.id === editProject.wiringTemplateId);
                            if (wiringTemplate) {
                                const existingWiring = projectWirings[editProject.id];

                                const wiringCopy = {
                                    projectId: editProject.id,
                                    templateId: wiringTemplate.id,
                                    templateName: wiringTemplate.name,
                                    specifications: wiringTemplate.specifications
                                };

                                if (existingWiring) {
                                    // æ—¢å­˜ã®é…ç·šä»•æ§˜ã‚’æ›´æ–°
                                    const wiringDocId = await saveToFirestore('projectWirings', wiringCopy, existingWiring.id);
                                    if (wiringDocId) {
                                        setProjectWirings(prev => ({
                                            ...prev,
                                            [editProject.id]: {
                                                id: existingWiring.id,
                                                ...wiringCopy
                                            }
                                        }));
                                    }
                                } else {
                                    // æ–°è¦é…ç·šä»•æ§˜ã‚’ä½œæˆ
                                    const wiringDocId = await saveToFirestore('projectWirings', wiringCopy);
                                    if (wiringDocId) {
                                        setProjectWirings(prev => ({
                                            ...prev,
                                            [editProject.id]: {
                                                id: wiringDocId,
                                                ...wiringCopy
                                            }
                                        }));
                                    }
                                }
                            }
                        }

                        setProjects(prevProjects =>
                            prevProjects.map(p =>
                                p.id === editProject.id ? { ...updatedProject, id: editProject.id } : p
                            )
                        );
                        setShowEditProjectForm(false);
                        setEditProject(null);
                        setCompanyInputMode('select');
                        setLastSaved(new Date());
                    }
                }
            }, [editProject, user, selectedTemplate, wiringTemplates, projectWirings]);

            // ã‚¿ã‚¹ã‚¯æ›´æ–°
            const updateTask = useCallback(async () => {
                if (editTask && editTask.title.trim()) {
                    const updatedTask = {
                        ...editTask,
                        estimatedHours: parseFloat(editTask.estimatedHours) || 0,
                        checklistTemplateId: editTask.checklistTemplateId || null,
                        createdBy: editTask.createdBy,
                        createdByName: editTask.createdByName,
                        createdAt: editTask.createdAt
                    };

                    const success = await saveToFirestore('tasks', updatedTask, editTask.id);
                    if (success) {
                        // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã®å‡¦ç†
                        const oldTemplateId = tasks.find(t => t.id === editTask.id)?.checklistTemplateId;
                        const newTemplateId = editTask.checklistTemplateId;

                        if (oldTemplateId !== newTemplateId) {
                            const checklistKey = `task_${editTask.id}`;

                            // æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚ŒãŸå ´åˆã®ã¿æ—¢å­˜ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’å‰Šé™¤
                            // ã€Œä»»æ„ã€ã‚’é¸æŠã—ãŸå ´åˆï¼ˆnewTemplateIdãŒç©ºæ–‡å­—ï¼‰ã¯å‰Šé™¤ã—ãªã„
                            if (newTemplateId && projectChecklists[checklistKey]) {
                                await deleteFromFirestore('projectChecklists', projectChecklists[checklistKey].id);

                                // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’å³åº§ã«æ›´æ–°
                                setProjectChecklists(prev => {
                                    const newChecklists = { ...prev };
                                    delete newChecklists[checklistKey];
                                    return newChecklists;
                                });
                            }

                            // æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚ŒãŸå ´åˆã€ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                            if (newTemplateId) {
                                const template = checklistTemplates.find(t => t.id === newTemplateId);
                                if (template) {
                                    const checklistCopy = {
                                        taskId: editTask.id,
                                        templateId: template.id,
                                        templateName: template.name,
                                        checkType: template.checkType || 'double',
                                        categories: template.categories.map(cat => ({
                                            ...cat,
                                            items: cat.items.map(item => ({
                                                ...item,
                                                firstCheck: false,
                                                secondCheck: false
                                            }))
                                        }))
                                    };

                                    const checklistDocId = await saveToFirestore('projectChecklists', checklistCopy);
                                    if (checklistDocId) {
                                        setProjectChecklists(prev => ({
                                            ...prev,
                                            [checklistKey]: {
                                                id: checklistDocId,
                                                ...checklistCopy
                                            }
                                        }));
                                    }
                                }
                            }
                        }

                        setTasks(prevTasks =>
                            prevTasks.map(t =>
                                t.id === editTask.id ? { ...updatedTask, id: editTask.id } : t
                            )
                        );
                        setShowEditTaskForm(false);
                        setEditTask(null);
                        setLastSaved(new Date());
                        setTimeout(() => updateProjectStatuses(), 100);
                    }
                }
            }, [editTask, tasks, checklistTemplates, projectChecklists]);

            // ä¼šç¤¾ä½œæˆ
            const createCompany = useCallback(async () => {
                if (!newCompany.name.trim()) {
                    return;
                }

                if (!user) {
                    return;
                }

                try {
                    const company = {
                        ...newCompany,
                        name: newCompany.name.trim()
                    };

                    const docId = await saveToFirestore('companies', company);

                    if (docId) {
                        const newCompanyData = {
                            id: docId,
                            ...company,
                            createdBy: user.uid,
                            createdByName: user.displayName || user.email,
                            createdAt: firebase.firestore.Timestamp.now(),
                            updatedAt: firebase.firestore.Timestamp.now()
                        };
                        setCompanies(prevCompanies => [...prevCompanies, newCompanyData].sort((a, b) => a.name.localeCompare(b.name)));
                        setNewCompany({ name: '', description: '' });
                        setShowCompanyForm(false);
                        setLastSaved(new Date());
                    }
                } catch (error) {
                    console.error('ä¼šç¤¾ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                }
            }, [newCompany, user]);

            // ä¼šç¤¾å‰Šé™¤
            const deleteCompany = useCallback(async (companyId) => {
                const success = await deleteFromFirestore('companies', companyId);
                if (success) {
                    // é–¢é€£ã™ã‚‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤
                    const relatedChecklists = checklistTemplates.filter(c => c.companyId === companyId);
                    for (const checklist of relatedChecklists) {
                        await deleteFromFirestore('checklistTemplates', checklist.id);
                    }

                    // é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤
                    const relatedTemplates = taskTemplates.filter(t => t.companyId === companyId);
                    for (const template of relatedTemplates) {
                        await deleteFromFirestore('taskTemplates', template.id);
                    }

                    // é–¢é€£ã™ã‚‹é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤
                    const relatedWiringTemplates = wiringTemplates.filter(w => w.companyId === companyId);
                    for (const wiringTemplate of relatedWiringTemplates) {
                        await deleteFromFirestore('wiringTemplates', wiringTemplate.id);
                    }

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã‚’æ›´æ–°
                    setCompanies(prevCompanies => prevCompanies.filter(c => c.id !== companyId));
                    setChecklistTemplates(prevChecklists => prevChecklists.filter(c => c.companyId !== companyId));
                    setTaskTemplates(prevTemplates => prevTemplates.filter(t => t.companyId !== companyId));
                    setWiringTemplates(prevWiringTemplates => prevWiringTemplates.filter(w => w.companyId !== companyId));
                    setLastSaved(new Date());
                    return true;
                }
                return false;
            }, [checklistTemplates, taskTemplates, wiringTemplates]);

            // å‰Šé™¤å®Ÿè¡Œ
            const handleDelete = useCallback(async () => {
                let success = false;

                if (deleteConfirm.type === 'project') {
                    success = await deleteProject(deleteConfirm.id);
                } else if (deleteConfirm.type === 'task') {
                    success = await deleteTask(deleteConfirm.id);
                } else if (deleteConfirm.type === 'company') {
                    success = await deleteCompany(deleteConfirm.id);
                } else if (deleteConfirm.type === 'template') {
                    success = await deleteTemplate(deleteConfirm.id);
                } else if (deleteConfirm.type === 'checklist') {
                    success = await deleteChecklistTemplate(deleteConfirm.id);
                } else if (deleteConfirm.type === 'projectChecklist') {
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’å‰Šé™¤
                    success = await deleteFromFirestore('projectChecklists', deleteConfirm.id);
                    if (success) {
                        // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ­£ã—ãæ›´æ–°
                        setProjectChecklists(prev => {
                            const newChecklists = { ...prev };
                            // IDã§è©²å½“ã™ã‚‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ¢ã—ã¦å‰Šé™¤
                            Object.keys(newChecklists).forEach(key => {
                                if (newChecklists[key].id === deleteConfirm.id) {
                                    // å¯¾å¿œã™ã‚‹ã‚¿ã‚¹ã‚¯ã®checklistTemplateIdã‚‚ã‚¯ãƒªã‚¢
                                    const taskIdMatch = key.match(/task_(.+)/);
                                    if (taskIdMatch) {
                                        const taskId = taskIdMatch[1];
                                        setTasks(prevTasks =>
                                            prevTasks.map(task =>
                                                task.id === taskId
                                                    ? { ...task, checklistTemplateId: null }
                                                    : task
                                            )
                                        );
                                    }
                                    delete newChecklists[key];
                                }
                            });
                            return newChecklists;
                        });
                    }
                } else if (deleteConfirm.type === 'wiring') {
                    success = await deleteWiringTemplate(deleteConfirm.id);
                } else if (deleteConfirm.type === 'projectWiring') {
                    success = await deleteFromFirestore('projectWirings', deleteConfirm.id);
                    if (success) {
                        // projectWiringsã®çŠ¶æ…‹ã‚’æ›´æ–°
                        setProjectWirings(prev => {
                            const newWirings = { ...prev };
                            let deletedProjectId = null;
                            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã§è©²å½“ã™ã‚‹é…ç·šä»•æ§˜ã‚’æ¢ã—ã¦å‰Šé™¤
                            Object.keys(newWirings).forEach(key => {
                                if (newWirings[key].id === deleteConfirm.id) {
                                    deletedProjectId = key;
                                    delete newWirings[key];
                                }
                            });
                            return newWirings;
                        });

                        // editProjectã®wiringTemplateIdã‚‚ãƒªã‚»ãƒƒãƒˆ
                        if (editProject) {
                            setEditProject(prev => ({
                                ...prev,
                                wiringTemplateId: ''
                            }));
                        }
                    }
                }

                if (success) {
                    setDeleteConfirm({ show: false, type: '', id: null, name: '', inputName: '' });
                }
            }, [deleteConfirm, deleteProject, deleteTask, deleteCompany, deleteTemplate, deleteChecklistTemplate, deleteWiringTemplate]);

            // ä¼šç¤¾ç·¨é›†ã‚’é–‹ã
            const openEditCompany = useCallback((company) => {
                setEditCompany({ ...company });
                setShowEditCompanyForm(true);
            }, []);

            // ä¼šç¤¾æ›´æ–°
            const updateCompany = useCallback(async () => {
                if (editCompany && editCompany.name.trim()) {
                    const updatedCompany = {
                        ...editCompany,
                        createdBy: editCompany.createdBy,
                        createdByName: editCompany.createdByName,
                        createdAt: editCompany.createdAt
                    };

                    const success = await saveToFirestore('companies', updatedCompany, editCompany.id);
                    if (success) {
                        setCompanies(prevCompanies =>
                            prevCompanies.map(c =>
                                c.id === editCompany.id ? { ...updatedCompany, id: editCompany.id } : c
                            ).sort((a, b) => a.name.localeCompare(b.name))
                        );
                        setShowEditCompanyForm(false);
                        setEditCompany(null);
                        setLastSaved(new Date());
                    }
                }
            }, [editCompany, user]);

            // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæ—©æœŸå®šç¾©ï¼‰
            const filteredProjects = useMemo(() => {
                if (!projects || !Array.isArray(projects)) return [];
                if (!searchQuery.trim()) return projects;
                return projects.filter(project =>
                    (project.name || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (project.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (project.description || '').toLowerCase().includes(searchQuery.toLowerCase())
                );
            }, [projects, searchQuery]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ˜ã‚ŠãŸãŸã¿ç®¡ç†
            const toggleProjectCollapse = useCallback((projectId) => {
                setCollapsedProjects(prev => ({
                    ...prev,
                    [projectId]: !prev[projectId]
                }));
            }, []);

            // ä¼šç¤¾æŠ˜ã‚ŠãŸãŸã¿ç®¡ç†
            const toggleCompanyCollapse = useCallback((companyId) => {
                setCollapsedCompanies(prev => ({
                    ...prev,
                    [companyId]: !prev[companyId]
                }));
            }, []);

            const resetAllForms = () => {
                // æ–°è¦æ¡ˆä»¶ãƒ•ã‚©ãƒ¼ãƒ 
                setNewProject({
                    name: '', company: '', description: '', startDate: '',
                    deadline: '', amount: '', checklistTemplateId: '', wiringTemplateId: ''
                });
                setSelectedTemplate(null);

                // æ–°è¦å·¥ç¨‹ãƒ•ã‚©ãƒ¼ãƒ 
                setNewTask({
                    title: '', description: '', estimatedHours: '',
                    projectId: '', actualHours: '', checklistTemplateId: ''
                });

                // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
                setEditProject(null);
                setEditTask(null);
                setEditCompany(null);

                // ãã®ä»–ã®ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹
                setCompanyInputMode('select');
                setNewCompany({ name: '', description: '' });
                setEditingTemplate(null);
                setNewTemplate({ name: '', companyId: '', tasks: [{ title: '', estimatedHours: '', description: '' }] });

                // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé–¢é€£ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
                setEditingChecklist(null);
                setNewChecklist({
                    name: '',
                    companyId: '',
                    checkType: 'single',
                    categories: [{ name: '', items: [{ name: '', description: '' }] }]
                });

                setEditingWiring(null);
                setHoursInputTask(null);
                setSelectedDate(new Date().toISOString().split('T')[0]);
                setDailyHours('');

                // ç·¨é›†ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚‚å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
                setEditingProjectChecklist(null);
            };

            // ä¿®æ­£å¾Œã®useEffect
            useEffect(() => {
                const handleEscKey = (event) => {
                    if (event.key === 'Escape') {
                        // å…¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
                        resetAllForms();

                        // å…¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                        setShowNewProjectForm(false);
                        setShowNewTaskForm(false);
                        setDeleteConfirm({ show: false, type: '', id: null, name: '', inputName: '' });
                        setShowEditProjectForm(false);
                        setShowEditTaskForm(false);
                        setShowEditCompanyForm(false);
                        setShowCompanyForm(false);
                        setShowHoursDetail(false);
                        setShowProjectDetail(false);
                        setShowTemplateForm(false);
                        setShowChecklistForm(false);
                        setShowChecklistModal(false);
                        setShowWiringForm(false);
                        setShowHoursInputModal(false);
                        setShowEditChecklistModal(false);
                        setShowLogoutConfirm(false);
                        setShowWiringModal(false); // è¿½åŠ 
                        setShowDailyHoursModal(false); // è¿½åŠ 
                        setEditingProjectChecklist(null); // è¿½åŠ 
                    }
                };

                document.addEventListener('keydown', handleEscKey);
                return () => {
                    document.removeEventListener('keydown', handleEscKey);
                };
            }, []);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆuseEffectã«ã‚ˆã‚‹è£œå®Œï¼‰
            const updateProjectStatuses = useCallback(() => {
                setProjects(prevProjects => {
                    let hasChanged = false;
                    const updatedProjects = prevProjects.map(project => {
                        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§çµ±è¨ˆã‚’è¨ˆç®—
                        const projectTasks = tasks.filter(task => String(task.projectId) === String(project.id));
                        const completedTasks = projectTasks.filter(task => task.status === 'å®Œäº†').length;
                        const progress = projectTasks.length > 0 ? (completedTasks / projectTasks.length) * 100 : 0;

                        const newStatus = progress >= 100 ? 'å®Œäº†' : 'é€²è¡Œä¸­';
                        if (project.status !== newStatus) {
                            hasChanged = true;
                            const updatedProject = { ...project, status: newStatus };
                            // Firestoreã«ã‚‚ä¿å­˜
                            saveToFirestore('projects', updatedProject, project.id);
                            return updatedProject;
                        }
                        return project;
                    });

                    return hasChanged ? updatedProjects : prevProjects;
                });
            }, [tasks, user]);

            // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã®bodyã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡
            // showHoursInputModalã‚’è¿½åŠ 
            useEffect(() => {
                const isModalOpen = showNewProjectForm || showNewTaskForm || deleteConfirm.show ||
                    showEditProjectForm || showEditTaskForm || showCompanyForm ||
                    showEditCompanyForm || showHoursDetail || showProjectDetail ||
                    showTemplateForm || showChecklistForm || showChecklistModal ||
                    showEditChecklistModal || showHoursInputModal || showLogoutConfirm ||
                    showWiringModal || showDailyHoursModal || showUserManagementModal || showColorPickerModal;

                if (isModalOpen) {
                    // ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
                    scrollPositionRef.current = window.pageYOffset || document.documentElement.scrollTop;
                    document.body.style.position = 'fixed';
                    document.body.style.top = `-${scrollPositionRef.current}px`;
                    document.body.style.width = '100%';
                    document.body.classList.add('modal-open');
                } else {
                    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒ
                    document.body.style.position = '';
                    document.body.style.top = '';
                    document.body.style.width = '';
                    document.body.classList.remove('modal-open');
                    // å°‘ã—é…å»¶ã•ã›ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒ
                    requestAnimationFrame(() => {
                        window.scrollTo(0, scrollPositionRef.current);
                    });
                }

                return () => {
                    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    document.body.style.position = '';
                    document.body.style.top = '';
                    document.body.style.width = '';
                    document.body.classList.remove('modal-open');
                };
            }, [showNewProjectForm, showNewTaskForm, deleteConfirm.show,
                showEditProjectForm, showEditTaskForm, showCompanyForm,
                showEditCompanyForm, showHoursDetail, showProjectDetail,
                showTemplateForm, showChecklistForm, showChecklistModal,
                showEditChecklistModal, showHoursInputModal, showLogoutConfirm,
                showWiringModal, showDailyHoursModal, showUserManagementModal, showColorPickerModal]);

            useEffect(() => {
                if (projects.length > 0 && tasks.length > 0) {
                    // å°‘ã—é…å»¶ã•ã›ã¦é‡è¤‡å®Ÿè¡Œã‚’é¿ã‘ã‚‹
                    const timer = setTimeout(() => {
                        updateProjectStatuses();
                    }, 100);

                    return () => clearTimeout(timer);
                }
            }, [tasks.map(t => t.status).join(','), projects.length, updateProjectStatuses]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
            const createProject = useCallback(async () => {
                if (!newProject.name.trim()) {
                    return;
                }

                if (!user) {
                    return;
                }

                try {
                    const project = {
                        ...newProject,
                        amount: parseFloat(newProject.amount) || 0,
                        status: 'é€²è¡Œä¸­'
                    };

                    console.log('æ¡ˆä»¶ä½œæˆé–‹å§‹:', project);
                    const docId = await saveToFirestore('projects', project);
                    console.log('Firestoreä¿å­˜å®Œäº†:', docId);

                    if (docId) {
                        const newProjectData = {
                            id: docId,
                            ...project,
                            createdBy: user.uid,
                            createdByName: user.displayName || user.email,
                            createdAt: firebase.firestore.Timestamp.now(),
                            updatedAt: firebase.firestore.Timestamp.now()
                        };
                        setProjects(prevProjects => [newProjectData, ...prevProjects]);

                        // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
                        if (selectedTemplate) {
                            console.log('å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å·¥ç¨‹ä½œæˆé–‹å§‹:', selectedTemplate.name);
                            await createTasksFromTemplate(docId, selectedTemplate);
                            setSelectedTemplate(null);
                            console.log('å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã®å·¥ç¨‹ä½œæˆå®Œäº†');
                        }

                        // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                        if (newProject.wiringTemplateId) {
                            const wiringTemplate = wiringTemplates.find(t => t.id === newProject.wiringTemplateId);
                            if (wiringTemplate) {
                                const wiringCopy = {
                                    projectId: docId,
                                    templateId: wiringTemplate.id,
                                    templateName: wiringTemplate.name,
                                    specifications: wiringTemplate.specifications
                                };

                                const wiringDocId = await saveToFirestore('projectWirings', wiringCopy);
                                if (wiringDocId) {
                                    setProjectWirings(prev => ({
                                        ...prev,
                                        [docId]: {
                                            id: wiringDocId,
                                            ...wiringCopy
                                        }
                                    }));
                                }
                            }
                        }

                        // ä¿®æ­£ï¼šã“ã®éƒ¨åˆ†ã‚’ä»¥ä¸‹ã«ç½®ãæ›ãˆ
                        setNewProject({
                            name: '',
                            company: '',
                            description: '',
                            startDate: '',
                            deadline: '',
                            amount: '',
                            checklistTemplateId: '',
                            wiringTemplateId: ''
                        });
                        setSelectedTemplate(null);
                        setCompanyInputMode('select');
                        setShowNewProjectForm(false);
                        setLastSaved(new Date());
                        console.log('æ¡ˆä»¶ä½œæˆæˆåŠŸ');
                    } else {
                        throw new Error('æ¡ˆä»¶ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    console.error('æ¡ˆä»¶ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                }
            }, [newProject, user, selectedTemplate, wiringTemplates]);
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
            const deleteProject = useCallback(async (projectId) => {
                const success = await deleteFromFirestore('projects', projectId);
                if (success) {
                    // é–¢é€£ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤
                    const relatedTasks = tasks.filter(t => String(t.projectId) === String(projectId));
                    for (const task of relatedTasks) {
                        await deleteFromFirestore('tasks', task.id);

                        // ã‚¿ã‚¹ã‚¯ã«é–¢é€£ã™ã‚‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚‚å‰Šé™¤
                        const checklistKey = `task_${task.id}`;
                        if (projectChecklists[checklistKey]) {
                            const checklistId = projectChecklists[checklistKey].id;
                            if (checklistId) {
                                await deleteFromFirestore('projectChecklists', checklistId);
                            }
                        }
                    }

                    // é–¢é€£ã™ã‚‹workSessionsã‚‚å‰Šé™¤
                    const relatedSessions = workSessions.filter(s => String(s.projectId) === String(projectId));
                    for (const session of relatedSessions) {
                        await deleteFromFirestore('workSessions', session.id);
                    }

                    // é–¢é€£ã™ã‚‹projectWiringsã‚‚å‰Šé™¤
                    if (projectWirings[projectId]) {
                        const wiringId = projectWirings[projectId].id;
                        if (wiringId) {
                            await deleteFromFirestore('projectWirings', wiringId);
                        }
                    }

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã‚’æ›´æ–°
                    setProjects(prevProjects => prevProjects.filter(p => p.id !== projectId));
                    setTasks(prevTasks => prevTasks.filter(t => String(t.projectId) !== String(projectId)));
                    setWorkSessions(prevSessions => prevSessions.filter(s => String(s.projectId) !== String(projectId)));

                    // é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚‚å‰Šé™¤
                    setProjectChecklists(prev => {
                        const newChecklists = { ...prev };
                        relatedTasks.forEach(task => {
                            delete newChecklists[`task_${task.id}`];
                        });
                        return newChecklists;
                    });

                    // é–¢é€£ã™ã‚‹projectWiringsã‚‚ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰å‰Šé™¤
                    setProjectWirings(prev => {
                        const newWirings = { ...prev };
                        delete newWirings[projectId];
                        return newWirings;
                    });

                    // ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰ã‚‚å‰Šé™¤
                    const relatedFavorites = favorites.filter(fav => String(fav.projectId) === String(projectId));
                    for (const favorite of relatedFavorites) {
                        await deleteFromFirestore('favorites', favorite.id);
                    }
                    setFavorites(prev => prev.filter(fav => String(fav.projectId) !== String(projectId)));

                    setLastSaved(new Date());
                    return true;
                }
                return false;
            }, [tasks, workSessions, projectChecklists, projectWirings, favorites]);

            const createTask = async () => {
                if (!newTask.title.trim()) {
                    return;
                }

                if (!newTask.projectId) {
                    return;
                }

                if (!user) {
                    return;
                }

                try {
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®æœ€å¤§orderå€¤ã‚’å–å¾—
                    const projectTasks = tasks.filter(task => String(task.projectId) === String(newTask.projectId));
                    const maxOrder = projectTasks.length > 0 ? Math.max(...projectTasks.map(task => task.order || 0)) : -1;

                    const task = {
                        title: newTask.title,
                        description: newTask.description,
                        projectId: String(newTask.projectId),
                        estimatedHours: parseFloat(newTask.estimatedHours) || 0,
                        status: 'é€²è¡Œä¸­',
                        order: maxOrder + 1,
                        checklistTemplateId: newTask.checklistTemplateId || null
                    };

                    console.log('å·¥ç¨‹ä½œæˆé–‹å§‹:', task);
                    const docId = await saveToFirestore('tasks', task);
                    console.log('Firestoreä¿å­˜å®Œäº†:', docId);

                    if (docId) {
                        const newTaskData = {
                            id: docId,
                            ...task,
                            createdBy: user.uid,
                            createdByName: user.displayName || user.email,
                            createdAt: firebase.firestore.Timestamp.now(),
                            updatedAt: firebase.firestore.Timestamp.now()
                        };
                        setTasks(prevTasks => [...prevTasks, newTaskData]);

                        // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ã€ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                        if (newTask.checklistTemplateId) {
                            const template = checklistTemplates.find(t => t.id === newTask.checklistTemplateId);
                            if (template) {
                                const checklistCopy = {
                                    taskId: docId,
                                    templateId: template.id,
                                    templateName: template.name,
                                    checkType: template.checkType || 'double',
                                    categories: template.categories.map(cat => ({
                                        ...cat,
                                        items: cat.items.map(item => ({
                                            ...item,
                                            firstCheck: false,
                                            secondCheck: false
                                        }))
                                    }))
                                };

                                const checklistKey = `task_${docId}`;
                                const checklistDocId = await saveToFirestore('projectChecklists', checklistCopy);
                                if (checklistDocId) {
                                    setProjectChecklists(prev => ({
                                        ...prev,
                                        [checklistKey]: {
                                            id: checklistDocId,
                                            ...checklistCopy
                                        }
                                    }));
                                }
                            }
                        }

                        // ä¿®æ­£ï¼šã“ã®éƒ¨åˆ†ã‚’ä»¥ä¸‹ã«ç½®ãæ›ãˆ
                        setNewTask({
                            title: '',
                            description: '',
                            estimatedHours: '',
                            projectId: '',
                            actualHours: '',
                            checklistTemplateId: ''
                        });
                        setShowNewTaskForm(false);
                        setLastSaved(new Date());
                        setTimeout(() => updateProjectStatuses(), 100);
                        console.log('å·¥ç¨‹ä½œæˆæˆåŠŸ');
                    } else {
                        throw new Error('å·¥ç¨‹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    console.error('å·¥ç¨‹ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                }
            };

            // ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            const updateTaskStatus = async (taskId, status) => {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    const updatedTask = {
                        ...task,
                        status,
                        createdBy: task.createdBy,
                        createdByName: task.createdByName,
                        createdAt: task.createdAt
                    };

                    // ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã«ãªã£ãŸå ´åˆã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
                    // ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã«ãªã£ãŸå ´åˆã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢ã®éƒ¨åˆ†ã‚’ä¿®æ­£
                    if (status === 'å®Œäº†' && activeTimers[taskId]) {
                        const startTime = activeTimers[taskId].startTime;
                        const endTime = Date.now();
                        const duration = (endTime - startTime) / (1000 * 60 * 60);

                        const project = projects.find(p => String(p.id) === String(task.projectId));

                        if (duration > 0) {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);

                            // ä»Šæ—¥ã®æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¢ã™
                            const existingSession = workSessions.find(s =>
                                s.userId === user.uid &&
                                s.taskId === taskId &&
                                s.date &&
                                s.date.toDate().toDateString() === today.toDateString()
                            );

                            if (existingSession) {
                                // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ™‚é–“ã‚’è¿½åŠ 
                                const updatedSession = {
                                    ...existingSession,
                                    hours: (existingSession.hours || 0) + duration,
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                };

                                saveToFirestore('workSessions', updatedSession, existingSession.id).then(() => {
                                    setWorkSessions(prevSessions =>
                                        prevSessions.map(s =>
                                            s.id === existingSession.id
                                                ? { ...s, hours: updatedSession.hours }
                                                : s
                                        )
                                    );
                                });
                            } else {
                                // æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                                const workSession = {
                                    taskId: taskId,
                                    taskName: task.title,
                                    projectId: task.projectId,
                                    projectName: project?.name || 'Unknown Project',
                                    userId: user.uid,
                                    userName: user.displayName || user.email,
                                    date: firebase.firestore.Timestamp.fromDate(today),
                                    hours: duration,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                };

                                saveToFirestore('workSessions', workSession).then(docId => {
                                    if (docId) {
                                        const newWorkSession = {
                                            id: docId,
                                            ...workSession
                                        };
                                        setWorkSessions(prevSessions => [newWorkSession, ...prevSessions]);
                                    }
                                });
                            }
                        }

                        setActiveTimers(prev => {
                            const newTimers = { ...prev };
                            delete newTimers[taskId];
                            return newTimers;
                        });

                        setTimerDisplays(prevDisplays => {
                            const newDisplays = { ...prevDisplays };
                            delete newDisplays[taskId];
                            return newDisplays;
                        });
                    }

                    const success = await saveToFirestore('tasks', updatedTask, taskId);
                    if (success) {
                        setTasks(tasks.map(task =>
                            task.id === taskId ? updatedTask : task
                        ));
                        setLastSaved(new Date());
                        setTimeout(() => updateProjectStatuses(), 100);
                    }
                }
            };

            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹/åœæ­¢
            const toggleTimer = async (taskId) => {
                console.log('toggleTimer called for taskId:', taskId);
                setActiveTimers(prev => {
                    const newTimers = { ...prev };
                    if (newTimers[taskId]) {
                        const startTime = newTimers[taskId].startTime;
                        const endTime = Date.now();
                        const additionalHours = (endTime - startTime) / (1000 * 60 * 60);

                        const task = tasks.find(t => t.id === taskId);
                        const project = projects.find(p => String(p.id) === String(task?.projectId));

                        if (task && additionalHours > 0 && user) {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);

                            // ä»Šæ—¥ã®æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¢ã™
                            const existingSession = workSessions.find(s =>
                                s.userId === user.uid &&
                                s.taskId === taskId &&
                                s.date &&
                                s.date.toDate().toDateString() === today.toDateString()
                            );

                            if (existingSession) {
                                // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ™‚é–“ã‚’è¿½åŠ 
                                const updatedSession = {
                                    ...existingSession,
                                    hours: (existingSession.hours || 0) + additionalHours,
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                };

                                saveToFirestore('workSessions', updatedSession, existingSession.id).then(() => {
                                    setWorkSessions(prevSessions =>
                                        prevSessions.map(s =>
                                            s.id === existingSession.id
                                                ? { ...s, hours: updatedSession.hours, updatedAt: new Date() }
                                                : s
                                        )
                                    );
                                });
                            } else {
                                // æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                                const newSession = {
                                    userId: user.uid,
                                    userName: user.displayName || user.email,
                                    taskId: taskId,
                                    taskName: task.title,
                                    projectId: task.projectId,
                                    projectName: project?.name || 'Unknown Project',
                                    date: firebase.firestore.Timestamp.fromDate(today),
                                    hours: additionalHours,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                };

                                saveToFirestore('workSessions', newSession).then(docId => {
                                    if (docId) {
                                        setWorkSessions(prevSessions => [
                                            ...prevSessions,
                                            {
                                                ...newSession,
                                                id: docId,
                                                createdAt: new Date(),
                                                updatedAt: new Date()
                                            }
                                        ]);
                                    }
                                });
                            }
                        }

                        delete newTimers[taskId];
                        setTimerDisplays(prevDisplays => {
                            const newDisplays = { ...prevDisplays };
                            delete newDisplays[taskId];
                            return newDisplays;
                        });
                    } else {
                        // æ–°ã—ã„ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ä»–ã®ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
                        Object.keys(newTimers).forEach(activeTaskId => {
                            if (activeTaskId !== taskId && newTimers[activeTaskId]) {
                                const startTime = newTimers[activeTaskId].startTime;
                                const endTime = Date.now();
                                const additionalHours = (endTime - startTime) / (1000 * 60 * 60);

                                const activeTask = tasks.find(t => t.id === activeTaskId);
                                const activeProject = projects.find(p => String(p.id) === String(activeTask?.projectId));

                                if (activeTask && additionalHours > 0 && user) {
                                    const today = new Date();
                                    today.setHours(0, 0, 0, 0);

                                    // ä»Šæ—¥ã®æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¢ã™
                                    const existingSession = workSessions.find(s =>
                                        s.userId === user.uid &&
                                        s.taskId === activeTaskId &&
                                        s.date &&
                                        s.date.toDate().toDateString() === today.toDateString()
                                    );

                                    if (existingSession) {
                                        // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ™‚é–“ã‚’è¿½åŠ 
                                        const updatedSession = {
                                            ...existingSession,
                                            hours: (existingSession.hours || 0) + additionalHours,
                                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        };

                                        saveToFirestore('workSessions', updatedSession, existingSession.id).then(() => {
                                            setWorkSessions(prevSessions =>
                                                prevSessions.map(s =>
                                                    s.id === existingSession.id
                                                        ? { ...s, hours: updatedSession.hours, updatedAt: new Date() }
                                                        : s
                                                )
                                            );
                                        });
                                    } else {
                                        // æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                                        const newSession = {
                                            userId: user.uid,
                                            userName: user.displayName || user.email,
                                            taskId: activeTaskId,
                                            taskName: activeTask.title,
                                            projectId: activeTask.projectId,
                                            projectName: activeProject?.name || 'Unknown Project',
                                            date: firebase.firestore.Timestamp.fromDate(today),
                                            hours: additionalHours,
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                        };

                                        saveToFirestore('workSessions', newSession).then(docId => {
                                            if (docId) {
                                                setWorkSessions(prevSessions => [
                                                    ...prevSessions,
                                                    {
                                                        ...newSession,
                                                        id: docId,
                                                        createdAt: new Date(),
                                                        updatedAt: new Date()
                                                    }
                                                ]);
                                            }
                                        });
                                    }
                                }

                                delete newTimers[activeTaskId];
                            }
                        });

                        // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚‚ã‚¯ãƒªã‚¢
                        setTimerDisplays(prevDisplays => {
                            const newDisplays = { ...prevDisplays };
                            Object.keys(newTimers).forEach(activeTaskId => {
                                if (activeTaskId !== taskId) {
                                    delete newDisplays[activeTaskId];
                                }
                            });
                            return {
                                ...newDisplays,
                                [taskId]: '00:00'
                            };
                        });

                        newTimers[taskId] = { startTime: Date.now() };
                    }
                    console.log('toggleTimer newTimers:', newTimers);
                    return newTimers;
                });
            };

            // ã‚¿ã‚¹ã‚¯å‰Šé™¤
            const deleteTask = useCallback(async (taskId) => {
                const success = await deleteFromFirestore('tasks', taskId);
                if (success) {
                    // é–¢é€£ã™ã‚‹workSessionsã‚‚å‰Šé™¤
                    const relatedSessions = workSessions.filter(s => s.taskId === taskId);
                    for (const session of relatedSessions) {
                        await deleteFromFirestore('workSessions', session.id);
                    }

                    // é–¢é€£ã™ã‚‹projectChecklistsã‚‚å‰Šé™¤
                    const checklistKey = `task_${taskId}`;
                    if (projectChecklists[checklistKey]) {
                        const checklistId = projectChecklists[checklistKey].id;
                        if (checklistId) {
                            await deleteFromFirestore('projectChecklists', checklistId);
                        }
                    }

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã‚’æ›´æ–°
                    setTasks(prevTasks => prevTasks.filter(t => t.id !== taskId));
                    setWorkSessions(prevSessions => prevSessions.filter(s => s.taskId !== taskId));
                    setProjectChecklists(prev => {
                        const newChecklists = { ...prev };
                        delete newChecklists[checklistKey];
                        return newChecklists;
                    });
                    setActiveTimers(prev => {
                        const newTimers = { ...prev };
                        delete newTimers[taskId];
                        return newTimers;
                    });
                    setLastSaved(new Date());
                    setTimeout(() => updateProjectStatuses(), 100);
                    return true;
                }
                return false;
            }, [workSessions, projectChecklists]);

            // å·¥æ•°è©³ç´°ã‚’é–‹ã
            const openHoursDetail = useCallback((taskId) => {
                setDetailTaskId(taskId);
                setShowHoursDetail(true);
            }, []);

            // å·¥æ•°å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãé–¢æ•°
            const openHoursInputModal = useCallback((task) => {
                setHoursInputTask(task);
                const today = new Date();
                const todayStr = today.getFullYear() + '-' +
                    String(today.getMonth() + 1).padStart(2, '0') + '-' +
                    String(today.getDate()).padStart(2, '0');
                setSelectedDate(todayStr);

                // é¸æŠã—ãŸæ—¥ä»˜ã®æ—¢å­˜å·¥æ•°ã‚’å–å¾—
                const existingSession = workSessions.find(s =>
                    s.userId === user.uid &&
                    s.taskId === task.id &&
                    s.date &&
                    s.date.toDate().toDateString() === new Date(selectedDate).toDateString()
                );

                setDailyHours(existingSession ? parseFloat(existingSession.hours).toFixed(1) : '');
                setShowHoursInputModal(true);
            }, [workSessions, user]);

            // æ—¥åˆ¥å·¥æ•°ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
            const saveDailyHours = useCallback(async () => {
                if (!hoursInputTask || !selectedDate) return;

                const hours = parseFloat(dailyHours) || 0;
                const dateObj = new Date(selectedDate);

                // æ—¢å­˜ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¢ã™
                const existingSession = workSessions.find(s =>
                    s.userId === user.uid &&
                    s.taskId === hoursInputTask.id &&
                    s.date &&
                    s.date.toDate().toDateString() === dateObj.toDateString()
                );

                const project = projects.find(p => String(p.id) === String(hoursInputTask.projectId));

                if (existingSession) {
                    // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
                    if (hours === 0) {
                        // å·¥æ•°ãŒ0ã®å ´åˆã¯å‰Šé™¤
                        await deleteFromFirestore('workSessions', existingSession.id);
                        setWorkSessions(prev => prev.filter(s => s.id !== existingSession.id));
                    } else {
                        // å·¥æ•°ã‚’æ›´æ–°
                        const updatedSession = {
                            ...existingSession,
                            hours: hours,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        await saveToFirestore('workSessions', updatedSession, existingSession.id);
                        setWorkSessions(prev => prev.map(s =>
                            s.id === existingSession.id ? { ...s, hours: hours, updatedAt: new Date() } : s
                        ));
                    }
                } else if (hours > 0) {
                    // æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                    const newSession = {
                        userId: user.uid,
                        userName: user.displayName || user.email,
                        taskId: hoursInputTask.id,
                        taskName: hoursInputTask.title,
                        projectId: hoursInputTask.projectId,
                        projectName: project?.name || 'Unknown Project',
                        date: firebase.firestore.Timestamp.fromDate(dateObj),
                        hours: hours,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const sessionId = await saveToFirestore('workSessions', newSession);
                    if (sessionId) {
                        setWorkSessions(prev => [...prev, {
                            ...newSession,
                            id: sessionId,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                    }
                }

                setShowHoursInputModal(false);
                setHoursInputTask(null);
                setDailyHours('');
            }, [hoursInputTask, selectedDate, dailyHours, workSessions, user, projects]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°ã‚’é–‹ã
            const openProjectDetail = useCallback((projectId) => {
                setDetailProjectId(projectId);
                setShowProjectDetail(true);
            }, []);

            // é…ç·šä»•æ§˜ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            const openWiringModal = useCallback((projectId) => {
                const wiring = projectWirings[projectId];
                if (wiring) {
                    setCurrentProjectWiring(wiring);
                    setShowWiringModal(true);
                }
            }, [projectWirings]);

            // æ—¥åˆ¥å·¥æ•°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            const openDailyHoursModal = useCallback((dateStr) => {
                const targetDate = new Date(dateStr);
                const sessionsForDate = workSessions.filter(session => {
                    if (session.userId !== user.uid || !session.date) return false;

                    // Firestore Timestampã‚’æ—¥ä»˜ã«å¤‰æ›ã—ã¦æ¯”è¼ƒ
                    const sessionDate = session.date.toDate();
                    return sessionDate.toDateString() === targetDate.toDateString();
                });

                setSelectedDateForModal(dateStr);
                setDailyHoursSessions(sessionsForDate);
                setShowDailyHoursModal(true);
            }, [workSessions, user]);

            // ç®¡ç†è€…æ¨©é™ç¢ºèª
            const checkAdminRights = useCallback(async (currentUser) => {
                if (!currentUser) {
                    setIsAdmin(false);
                    setIsMasterAdmin(false);
                    return;
                }

                // ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç¢ºèª
                const isMaster = currentUser.uid === MASTER_ADMIN_UID;
                setIsMasterAdmin(isMaster);

                try {
                    // usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ç®¡ç†è€…æ¨©é™ã‚’ç¢ºèªï¼ˆæ¨©é™ã‚¨ãƒ©ãƒ¼ã‚’é¿ã‘ã‚‹ãŸã‚ï¼‰
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    const userData = userDoc.exists ? userDoc.data() : {};
                    const hasAdminRights = isMaster || (userData.isAdmin === true);
                    setIsAdmin(hasAdminRights);

                    console.log('æ¨©é™ç¢ºèªå®Œäº†:', {
                        uid: currentUser.uid,
                        isAdmin: hasAdminRights,
                        isMaster,
                        userData: userData
                    });
                } catch (error) {
                    console.error('ç®¡ç†è€…æ¨©é™ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                    setIsAdmin(isMaster); // ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                }
            }, [MASTER_ADMIN_UID]);

            // ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½
            const toggleFavorite = useCallback(async (projectId) => {
                if (!user) return;

                const existingFavorite = favorites.find(fav => fav.projectId === projectId && fav.userId === user.uid);

                try {
                    if (existingFavorite) {
                        // ãŠæ°—ã«å…¥ã‚Šè§£é™¤
                        await deleteFromFirestore('favorites', existingFavorite.id);
                        setFavorites(prev => prev.filter(fav => fav.id !== existingFavorite.id));
                    } else {
                        // ãŠæ°—ã«å…¥ã‚Šè¿½åŠ 
                        const favoriteData = {
                            userId: user.uid,
                            projectId: projectId,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        const docId = await saveToFirestore('favorites', favoriteData);
                        if (docId) {
                            setFavorites(prev => [...prev, { id: docId, ...favoriteData }]);
                        }
                    }
                } catch (error) {
                    console.error('ãŠæ°—ã«å…¥ã‚Šæ“ä½œã‚¨ãƒ©ãƒ¼:', error);
                }
            }, [user, favorites, saveToFirestore, deleteFromFirestore]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãŠæ°—ã«å…¥ã‚Šã‹ã©ã†ã‹ã‚’åˆ¤å®š
            const isFavorite = useCallback((projectId) => {
                return favorites.some(fav => fav.projectId === projectId && fav.userId === user?.uid);
            }, [favorites, user]);

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½
            const loadAllUsers = useCallback(async () => {
                if (!isMasterAdmin) return;

                try {
                    // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª­ã¿è¾¼ã¿
                    const usersSnapshot = await db.collection('users').get();
                    const users = usersSnapshot.docs.map(doc => {
                        const userData = doc.data();
                        return {
                            id: doc.id,
                            email: userData.email,
                            displayName: userData.displayName || userData.name || null,
                            ...userData
                        };
                    });
                    setAllUsers(users);

                    // usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ç®¡ç†è€…æ¨©é™ã‚’èª­ã¿è¾¼ã¿
                    const adminUserIds = users.filter(user => user.isAdmin === true).map(user => user.id);
                    setAdminUsers(adminUserIds);

                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', { users: users.length, admins: adminUserIds.length });
                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°:', users);
                    console.log('ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼:', adminUserIds);
                } catch (error) {
                    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            }, [isMasterAdmin]);

            const updateAdminStatus = useCallback(async (userId, isAdmin) => {
                if (!isMasterAdmin || userId === MASTER_ADMIN_UID) return;

                try {
                    // usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§isAdminãƒ•ãƒ©ã‚°ã‚’ç®¡ç†
                    const userRef = db.collection('users').doc(userId);

                    if (isAdmin) {
                        await userRef.set({ isAdmin: true }, { merge: true });
                        setAdminUsers(prev => [...prev.filter(id => id !== userId), userId]);
                    } else {
                        await userRef.set({ isAdmin: false }, { merge: true });
                        setAdminUsers(prev => prev.filter(id => id !== userId));
                    }

                    console.log('ç®¡ç†è€…æ¨©é™æ›´æ–°å®Œäº†:', { userId, isAdmin });

                    // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€æ¨©é™ã‚’å†ç¢ºèª
                    if (userId === user?.uid) {
                        await checkAdminRights(user);
                    }
                } catch (error) {
                    console.error('ç®¡ç†è€…æ¨©é™æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }, [isMasterAdmin, MASTER_ADMIN_UID, user, checkAdminRights]);

            const openWiringEditModal = useCallback((projectId) => {
                const wiring = projectWirings[projectId];
                if (wiring) {
                    setEditingWiring(wiring);
                    setNewWiring({
                        name: wiring.templateName || wiring.name || '',
                        companyId: wiring.companyId || '',
                        specifications: wiring.specifications || {
                            wire: {
                                power: {
                                    standards: [],
                                    wiringType: '',
                                    phases: {},
                                    remarks: ''
                                },
                                ground: {
                                    caseColor: '',
                                    caseDiameter: '',
                                    doorColor: '',
                                    doorDiameter: '',
                                    panelColor: '',
                                    panelDiameter: '',
                                    remarks: ''
                                },
                                insulationCap: '',
                                insulationCapDiameter: '',
                                insulationCapRemarks: '',
                                controlAC: {
                                    standards: [],
                                    commonColor: '',
                                    commonDiameter: '',
                                    nonCommonColor: '',
                                    nonCommonDiameter: '',
                                    remarks: ''
                                },
                                controlDC: {
                                    standards: [],
                                    pBusColor: '',
                                    pBusDiameter: '',
                                    nBusColor: '',
                                    nBusDiameter: '',
                                    otherColor: '',
                                    otherDiameter: '',
                                    remarks: ''
                                },
                                specialSpec: '',
                                manufacturerSpecified: false,
                                manufacturer: ''
                            },
                            markTube: {
                                orientation: { up: '', down: '', left: '', right: '' },
                                fontSize: '',
                                customFontSize: '',
                                length: '',
                                customLength: '',
                                printSpec: '',
                                printSpecDetail: '',
                                remarks: ''
                            },
                            otherConfirm: {
                                tighteningPen: '',
                                tighteningPenDetail: '',
                                matchMark: '',
                                screw: '',
                                screwDetail: '',
                                hookTube: '',
                                spiralTube: '',
                                spiralTubeDetail: '',
                                insulock: '',
                                insulockDetail: '',
                                mountBase: '',
                                mountBaseDetail: '',
                                routeSpecialNote: '',
                                remarks: ''
                            },
                            terminal: {
                                power: '',
                                controlAC: '',
                                controlDC: '',
                                simultaneousCrimp: '',
                                screwClamp: '',
                                screwlessClamp: '',
                                remarks: '',
                                manufacturerSpecified: false,
                                manufacturer: ''
                            },
                            terminalBlock: {
                                cover: '',
                                namePlate: '',
                                bridge: '',
                                maxWires: '',
                                remarks: '',
                                manufacturerSpecified: false,
                                manufacturer: ''
                            },
                            namePlate: {
                                fontSize: '',
                                customFontSize: '',
                                remarks: ''
                            },
                            deviceSeal: {
                                fontSize: '',
                                customFontSize: '',
                                length: '',
                                customLength: '',
                                positions: [],
                                customPosition: '',
                                remarks: ''
                            }
                        }
                    });
                    setShowWiringForm(true);
                }
            }, [projectWirings]);

            // ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            const handleDragStart = (e, task) => {
                setDraggedTask(task);
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', e.target.outerHTML);
                e.target.style.opacity = '0.5';
            };

            const handleDragEnd = (e) => {
                e.target.style.opacity = '1';
                // ç¢ºå®Ÿã«ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
                setDraggedTask(null);
                setDragOverTask(null);

                // å°‘ã—é…å»¶ã—ã¦ã‚‚ã†ä¸€åº¦ã‚¯ãƒªã‚¢ï¼ˆä¿é™ºï¼‰
                setTimeout(() => {
                    setDragOverTask(null);
                }, 50);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼ä¸­ã¯å¸¸ã«ã‚¿ã‚¹ã‚¯ã‚’è¨­å®šï¼ˆåˆ¤å®šã‚¨ãƒªã‚¢ã‚’åºƒã’ã‚‹ï¼‰
                const taskElement = e.currentTarget.closest('.task-draggable');
                if (taskElement && draggedTask) {
                    const taskId = taskElement.getAttribute('data-task-id');
                    if (taskId) {
                        const task = tasks.find(t => t.id === taskId);
                        if (task && task.id !== draggedTask.id) {
                            setDragOverTask(task);
                        }
                    }
                }
            };

            const handleDragEnter = (e, task) => {
                e.preventDefault();
                if (draggedTask && task.id !== draggedTask.id) {
                    setDragOverTask(task);
                }
            };

            const handleDragLeave = (e) => {
                // relatedTargetã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€æœ¬å½“ã«è¦ç´ ã‹ã‚‰é›¢ã‚ŒãŸã‹åˆ¤å®š
                const relatedTarget = e.relatedTarget;
                const currentTarget = e.currentTarget;

                // å­è¦ç´ ã¸ã®ç§»å‹•ã§ãªã„å ´åˆã€ã¾ãŸã¯å®Œå…¨ã«å¤–ã«å‡ºãŸå ´åˆã®ã¿ã‚¯ãƒªã‚¢
                if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                    setDragOverTask(null);
                }
            };

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†ã®ç›£è¦–
            useEffect(() => {
                const handleGlobalDragEnd = () => {
                    setDraggedTask(null);
                    setDragOverTask(null);
                };

                // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã§ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†ã‚’ã‚­ãƒ£ãƒƒãƒ
                document.addEventListener('dragend', handleGlobalDragEnd);
                document.addEventListener('drop', handleGlobalDragEnd);

                return () => {
                    document.removeEventListener('dragend', handleGlobalDragEnd);
                    document.removeEventListener('drop', handleGlobalDragEnd);
                };
            }, []);

            const handleDrop = async (e, targetTask) => {
                e.preventDefault();

                // ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã¯å¿…ãšã‚¯ãƒªã‚¢
                setDragOverTask(null);

                if (!draggedTask || draggedTask.id === targetTask.id) {
                    return;
                }

                // åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ã®ã¿ãƒ‰ãƒ­ãƒƒãƒ—ã‚’è¨±å¯
                if (draggedTask.projectId !== targetTask.projectId) {
                    return;
                }

                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’å–å¾—
                const projectTasks = tasks
                    .filter(task => String(task.projectId) === String(draggedTask.projectId))
                    .sort((a, b) => (a.order || 0) - (b.order || 0));

                // æ–°ã—ã„é †åºã‚’è¨ˆç®—
                const draggedIndex = projectTasks.findIndex(task => task.id === draggedTask.id);
                const targetIndex = projectTasks.findIndex(task => task.id === targetTask.id);

                if (draggedIndex === -1 || targetIndex === -1) return;

                // ã‚¿ã‚¹ã‚¯ã‚’ç§»å‹•
                const newProjectTasks = [...projectTasks];
                const [movedTask] = newProjectTasks.splice(draggedIndex, 1);
                newProjectTasks.splice(targetIndex, 0, movedTask);

                // æ–°ã—ã„é †åºã‚’è¨­å®š
                const updatedTasks = newProjectTasks.map((task, index) => ({
                    ...task,
                    order: index
                }));

                // Firestoreã«é †åºã‚’ä¿å­˜
                try {
                    const updatePromises = updatedTasks.map(task =>
                        saveToFirestore('tasks', { ...task, order: task.order }, task.id)
                    );
                    await Promise.all(updatePromises);

                    // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
                    setTasks(prevTasks => {
                        const otherTasks = prevTasks.filter(task => String(task.projectId) !== String(draggedTask.projectId));
                        return [...otherTasks, ...updatedTasks].sort((a, b) => {
                            const aDate = a.createdAt ? a.createdAt.toDate() : new Date(0);
                            const bDate = b.createdAt ? b.createdAt.toDate() : new Date(0);
                            return bDate - aDate;
                        });
                    });

                    setLastSaved(new Date());
                } catch (error) {
                    console.error('å·¥ç¨‹é †åºã®æ›´æ–°ã«å¤±æ•—:', error);
                }

                setDraggedTask(null);
                setDragOverTask(null);
            };

            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            const handleGanttMouseDown = (e) => {
                if (e.target.closest('.gantt-bar')) return; // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ç„¡è¦–

                // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆå³ä¸‹ï¼‰ã‚’å–å¾—
                const timelineArea = document.querySelector('.timeline-area');
                if (!timelineArea) return;

                setIsDragging(true);
                setStartX(e.pageX - timelineArea.offsetLeft);
                setScrollLeft(timelineArea.scrollLeft);
                timelineArea.style.cursor = 'grabbing';
                timelineArea.style.userSelect = 'none';
            };

            const handleGanttMouseMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();

                // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆå³ä¸‹ï¼‰ã‚’å–å¾—
                const timelineArea = document.querySelector('.timeline-area');
                if (!timelineArea) return;

                const x = e.pageX - timelineArea.offsetLeft;
                const walk = (x - startX) * 2; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦èª¿æ•´
                timelineArea.scrollLeft = scrollLeft - walk;
            };

            const handleGanttMouseUp = () => {
                setIsDragging(false);
                const timelineArea = document.querySelector('.timeline-area');
                if (timelineArea) {
                    timelineArea.style.cursor = 'grab';
                    timelineArea.style.userSelect = 'auto';
                }
            };

            const handleGanttMouseLeave = () => {
                if (isDragging) {
                    setIsDragging(false);
                    const timelineArea = document.querySelector('.timeline-area');
                    if (timelineArea) {
                        timelineArea.style.cursor = 'grab';
                        timelineArea.style.userSelect = 'auto';
                    }
                }
            };


            // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            useEffect(() => {
                const ganttElement = ganttScrollRef.current;
                if (!ganttElement) return;

                const handleMouseMove = (e) => handleGanttMouseMove(e);
                const handleMouseUp = () => handleGanttMouseUp();

                if (isDragging) {
                    document.addEventListener('mousemove', handleMouseMove);
                    document.addEventListener('mouseup', handleMouseUp);
                }

                return () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                };
            }, [isDragging, startX, scrollLeft]);




            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
            const saveTemplate = async () => {
                if (!newTemplate.name.trim() || newTemplate.tasks.length === 0) return;

                const template = {
                    ...newTemplate,
                    createdAt: editingTemplate ? editingTemplate.createdAt : firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (editingTemplate) {
                    await db.collection('taskTemplates').doc(editingTemplate.id).update(template);
                    setTaskTemplates(prev => prev.map(t =>
                        t.id === editingTemplate.id ? {
                            ...template,
                            id: editingTemplate.id,
                            createdAt: editingTemplate.createdAt,
                            updatedAt: new Date()
                        } : t
                    ));
                } else {
                    const docRef = await db.collection('taskTemplates').add(template);
                    setTaskTemplates(prev => [...prev, {
                        ...template,
                        id: docRef.id,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }]);
                }

                setShowTemplateForm(false);
                setEditingTemplate(null);
                setOriginalTemplate(null);
                setNewTemplate({ name: '', companyId: '', tasks: [{ title: '', estimatedHours: '', description: '' }] });
            };

            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ã‚’çµ±ä¸€
            const cancelTemplateEdit = () => {
                // ç·¨é›†æ™‚ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°æˆ»ã™ã€ãªã‘ã‚Œã°åˆæœŸå€¤
                if (editingTemplate && originalTemplate) {
                    setNewTemplate({ ...originalTemplate });
                } else {
                    setNewTemplate({ name: '', companyId: '', tasks: [{ title: '', estimatedHours: '', description: '' }] });
                }
                setShowTemplateForm(false);
                setEditingTemplate(null);
                setOriginalTemplate(null);
            };

            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤ï¼ˆç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½¿ç”¨ï¼‰
            const deleteTemplate = useCallback(async (templateId) => {
                const success = await deleteFromFirestore('taskTemplates', templateId);
                if (success) {
                    setTaskTemplates(prev => prev.filter(t => t.id !== templateId));
                    setLastSaved(new Date());
                    return true;
                }
                return false;
            }, []);

            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ”ãƒ¼
            const copyTemplate = useCallback(async (template) => {
                try {
                    const copiedTemplate = {
                        name: template.name + ' ã®ã‚³ãƒ”ãƒ¼',
                        companyId: template.companyId,
                        tasks: template.tasks.map(task => ({
                            title: task.title,
                            estimatedHours: task.estimatedHours,
                            description: task.description
                        })),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const docRef = await db.collection('taskTemplates').add(copiedTemplate);
                    if (docRef && docRef.id) {
                        setTaskTemplates(prev => [...prev, {
                            ...copiedTemplate,
                            id: docRef.id,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                        setLastSaved(new Date());
                        return true;
                    }
                } catch (error) {
                    console.error('Error copying task template:', error);
                }
                return false;
            }, []);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
            const saveChecklistTemplate = useCallback(async () => {
                if (!newChecklist.name.trim()) return;

                const template = {
                    ...newChecklist,
                    createdAt: editingChecklist ? editingChecklist.createdAt : firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (editingChecklist) {
                    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
                    const success = await saveToFirestore('checklistTemplates', template, editingChecklist.id);
                    if (success) {
                        setChecklistTemplates(prev => prev.map(t =>
                            t.id === editingChecklist.id ? {
                                ...template,
                                id: editingChecklist.id,
                                createdAt: editingChecklist.createdAt,
                                updatedAt: new Date()
                            } : t
                        ));
                        setShowChecklistForm(false);
                        setEditingChecklist(null);
                        setNewChecklist({
                            name: '',
                            companyId: '',
                            checkType: 'single',
                            categories: [{ name: '', items: [{ name: '', description: '' }] }]
                        });
                    }
                } else {
                    // æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰
                    const docId = await saveToFirestore('checklistTemplates', template);
                    if (docId) {
                        setChecklistTemplates(prev => [...prev, {
                            ...template,
                            id: docId,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                        setShowChecklistForm(false);
                        setNewChecklist({
                            name: '',
                            companyId: '',
                            checkType: 'single',
                            categories: [{ name: '', items: [{ name: '', description: '' }] }]
                        });
                    }
                }
            }, [newChecklist, editingChecklist]);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå‰Šé™¤
            const deleteChecklistTemplate = useCallback(async (templateId) => {
                const success = await deleteFromFirestore('checklistTemplates', templateId);
                if (success) {
                    setChecklistTemplates(prev => prev.filter(t => t.id !== templateId));
                    return true;
                }
                return false;
            }, []);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ”ãƒ¼
            const copyChecklistTemplate = useCallback(async (template) => {
                try {
                    const copiedTemplate = {
                        name: template.name + ' ã®ã‚³ãƒ”ãƒ¼',
                        companyId: template.companyId,
                        checkType: template.checkType || 'single',
                        categories: template.categories.map(category => ({
                            name: category.name,
                            items: category.items.map(item => ({
                                name: item.name,
                                description: item.description
                            }))
                        })),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const docRef = await db.collection('checklistTemplates').add(copiedTemplate);
                    if (docRef && docRef.id) {
                        setChecklistTemplates(prev => [...prev, {
                            ...copiedTemplate,
                            id: docRef.id,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                        return true;
                    }
                } catch (error) {
                    console.error('Error copying checklist template:', error);
                }
                return false;
            }, []);

            // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
            const saveWiringTemplate = useCallback(async () => {
                if (!newWiring.name.trim()) return;

                const template = {
                    ...newWiring,
                    createdAt: editingWiring ? editingWiring.createdAt : firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (editingWiring) {
                    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
                    if (editingWiring.projectId) {
                        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é…ç·šä»•æ§˜ã‚’ç·¨é›†
                        const success = await saveToFirestore('projectWirings', template, editingWiring.id);
                        if (success) {
                            setProjectWirings(prev => ({
                                ...prev,
                                [editingWiring.projectId]: {
                                    ...prev[editingWiring.projectId],
                                    ...template,
                                    templateName: template.name
                                }
                            }));
                            setShowWiringForm(false);
                            setEditingWiring(null);
                            resetWiringForm();
                        }
                    } else {
                        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†
                        const success = await saveToFirestore('wiringTemplates', template, editingWiring.id);
                        if (success) {
                            setWiringTemplates(prev => prev.map(t =>
                                t.id === editingWiring.id ? {
                                    ...template,
                                    id: editingWiring.id,
                                    createdAt: editingWiring.createdAt,
                                    updatedAt: new Date()
                                } : t
                            ));
                            setShowWiringForm(false);
                            setEditingWiring(null);
                            resetWiringForm();
                        }
                    }
                } else {
                    // æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ï¼ˆæ—¢å­˜ã®å‡¦ç†ï¼‰
                    const docId = await saveToFirestore('wiringTemplates', template);
                    if (docId) {
                        setWiringTemplates(prev => [...prev, {
                            ...template,
                            id: docId,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                        setShowWiringForm(false);
                        resetWiringForm();
                    }
                }
            }, [newWiring, editingWiring]);

            // é…ç·šä»•æ§˜ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            const resetWiringForm = () => {
                setNewWiring({
                    name: '',
                    companyId: '',
                    specifications: {
                        wire: {
                            power: {
                                standards: [],
                                wiringType: '',
                                phases: {
                                    rPhase: '',
                                    sPhase: '',
                                    tPhase: '',
                                    nPhase: '',
                                    lPhase: ''
                                },
                                remarks: ''
                            },
                            ground: {
                                caseColor: '',
                                caseDiameter: '',
                                doorColor: '',
                                doorDiameter: '',
                                panelColor: '',
                                panelDiameter: '',
                                remarks: ''
                            },
                            insulationCap: '',
                            insulationCapDiameter: '',
                            insulationCapRemarks: '',
                            controlAC: {
                                standards: '',
                                customStandard: '',
                                commonColor: '',
                                commonDiameter: '',
                                nonCommonColor: '',
                                nonCommonDiameter: '',
                                remarks: ''
                            },
                            controlDC: {
                                standards: '',
                                customStandard: '',
                                pBusColor: '',
                                pBusDiameter: '',
                                nBusColor: '',
                                nBusDiameter: '',
                                otherColor: '',
                                otherDiameter: '',
                                remarks: ''
                            },
                            specialSpec: '',  // â† è¿½åŠ 
                            manufacturerSpecified: false,
                            manufacturer: ''
                        },
                        markTube: {
                            orientation: {
                                up: '',
                                down: '',
                                left: '',
                                right: ''
                            },
                            fontSize: '',
                            customFontSize: '',
                            length: '',
                            customLength: '',
                            printSpec: '',
                            printSpecDetail: '',
                            remarks: ''  // â† ã“ã®è¡Œã‚’è¿½åŠ 
                        },
                        otherConfirm: {
                            tighteningPen: '',
                            tighteningPenDetail: '',
                            matchMark: '',
                            screw: '',
                            screwDetail: '',
                            hookTube: '',
                            spiralTube: '',
                            spiralTubeDetail: '',
                            insulock: '',
                            insulockDetail: '',
                            mountBase: '',
                            mountBaseDetail: '',
                            routeSpecialNote: '',
                            remarks: ''  // â† ã“ã®è¡Œã‚’è¿½åŠ 
                        },
                        terminal: {
                            power: '',
                            controlAC: '',
                            controlDC: '',
                            simultaneousCrimp: '',
                            screwClamp: '',
                            screwlessClamp: '',
                            remarks: '',
                            manufacturerSpecified: false,
                            manufacturer: ''
                        },
                        terminalBlock: {
                            cover: '',
                            namePlate: '',
                            bridge: '',
                            maxWires: '',
                            remarks: '',
                            manufacturerSpecified: false,
                            manufacturer: ''
                        },
                        namePlate: {
                            fontSize: '',
                            customFontSize: '',
                            remarks: ''
                        },
                        deviceSeal: {
                            fontSize: '',
                            customFontSize: '',
                            length: '',
                            customLength: '',
                            positions: [],
                            customPosition: '',
                            remarks: ''
                        }
                    }
                });
            };

            // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤
            const deleteWiringTemplate = useCallback(async (templateId) => {
                const success = await deleteFromFirestore('wiringTemplates', templateId);
                if (success) {
                    setWiringTemplates(prev => prev.filter(t => t.id !== templateId));
                    return true;
                }
                return false;
            }, []);

            // é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ”ãƒ¼
            const copyWiringTemplate = useCallback(async (template) => {
                try {
                    // æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                    const copiedTemplate = {
                        name: template.name + ' ã®ã‚³ãƒ”ãƒ¼',
                        companyId: template.companyId,
                        specifications: JSON.parse(JSON.stringify(template.specifications || {})),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const docRef = await db.collection('wiringTemplates').add(copiedTemplate);
                    if (docRef && docRef.id) {
                        setWiringTemplates(prev => [...prev, {
                            ...copiedTemplate,
                            id: docRef.id,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }]);
                        return true;
                    }
                } catch (error) {
                    console.error('Error copying wiring template:', error);
                }
                return false;
            }, []);

            /// æ¤œæŸ»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            const openChecklistModal = useCallback(async (entityId, entityType = 'task') => {
                const checklistKey = `task_${entityId}`;

                if (projectChecklists[checklistKey]) {
                    const checklist = projectChecklists[checklistKey];
                    // ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ…‹ã‚’ç¢ºèª
                    const task = tasks.find(t => t.id === entityId);
                    const isTaskCompleted = task?.status === 'å®Œäº†';

                    setCurrentProjectChecklist({
                        ...checklist,
                        isTaskCompleted: isTaskCompleted
                    });
                } else {
                    // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
                    return;
                }
                setShowChecklistModal(true);
            }, [projectChecklists, tasks]);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            const openEditChecklistModal = useCallback((taskId) => {
                const checklistKey = `task_${taskId}`;
                const checklist = projectChecklists[checklistKey];

                if (checklist) {
                    // æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆã—ã¦å…ƒãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿ã‚’é˜²ã
                    setEditingProjectChecklist({
                        ...checklist,
                        taskId: taskId,
                        checkType: checklist.checkType || 'double',
                        name: checklist.templateName || checklist.name || '',
                        templateName: checklist.templateName || checklist.name || '',
                        // categoriesã‚‚æ·±ã„ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                        categories: JSON.parse(JSON.stringify(checklist.categories || []))
                    });
                    setShowEditChecklistModal(true);
                }
            }, [projectChecklists]);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä¿å­˜
            const saveEditedChecklist = useCallback(async () => {
                if (!editingProjectChecklist) return;

                const checklistKey = `task_${editingProjectChecklist.taskId}`;
                const docId = projectChecklists[checklistKey]?.id;

                // ä¿å­˜ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ï¼ˆåå‰ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’ä¸¡æ–¹æ›´æ–°ï¼‰
                const updatedChecklist = {
                    ...editingProjectChecklist,
                    templateName: editingProjectChecklist.templateName || editingProjectChecklist.name,
                    name: editingProjectChecklist.name || editingProjectChecklist.templateName
                };

                const savedId = await saveToFirestore('projectChecklists', updatedChecklist, docId);
                if (savedId) {
                    setProjectChecklists(prev => ({
                        ...prev,
                        [checklistKey]: {
                            id: docId || savedId,
                            ...updatedChecklist
                        }
                    }));
                    setShowEditChecklistModal(false);
                    setEditingProjectChecklist(null);
                }
            }, [editingProjectChecklist, projectChecklists]);

            // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®æ›´æ–°ï¼ˆè‡ªå‹•ä¿å­˜ï¼‰
            const updateChecklistItem = useCallback(async (catIndex, itemIndex, checkType, value) => {
                setCurrentProjectChecklist(prev => {
                    const updated = { ...prev };
                    const item = updated.categories[catIndex].items[itemIndex];

                    // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’æ›´æ–°
                    item[checkType] = value;

                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨æ™‚åˆ»ã‚’è¨˜éŒ²
                    if (value) {
                        // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆ
                        item[`${checkType}By`] = user.uid;
                        item[`${checkType}ByName`] = user.displayName || user.email;
                        item[`${checkType}At`] = new Date().toISOString();
                    } else {
                        // ãƒã‚§ãƒƒã‚¯ãŒå¤–ã•ã‚ŒãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
                        delete item[`${checkType}By`];
                        delete item[`${checkType}ByName`];
                        delete item[`${checkType}At`];
                    }

                    // è‡ªå‹•ä¿å­˜
                    const checklistKey = `task_${updated.taskId}`;
                    const docId = projectChecklists[checklistKey]?.id;
                    saveToFirestore('projectChecklists', updated, docId).then(savedId => {
                        if (savedId) {
                            setProjectChecklists(prevChecklists => ({
                                ...prevChecklists,
                                [checklistKey]: {
                                    id: docId || savedId,
                                    ...updated
                                }
                            }));
                        }
                    });

                    return updated;
                });
            }, [projectChecklists, user]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä¿å­˜
            const saveProjectChecklist = useCallback(async () => {
                const checklistKey = `task_${currentProjectChecklist.taskId}`;
                const docId = projectChecklists[checklistKey]?.id;
                const savedId = await saveToFirestore('projectChecklists', currentProjectChecklist, docId);

                if (savedId) {
                    setProjectChecklists(prev => ({
                        ...prev,
                        [checklistKey]: {
                            id: docId || savedId,
                            ...currentProjectChecklist
                        }
                    }));
                    setShowChecklistModal(false);
                }
            }, [currentProjectChecklist, projectChecklists]);

            // ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã‚¿ã‚¹ã‚¯ä½œæˆ
            const createTasksFromTemplate = async (projectId, template) => {
                for (const taskData of template.tasks) {
                    const task = {
                        title: taskData.title,
                        description: taskData.description,
                        projectId: String(projectId),
                        estimatedHours: parseFloat(taskData.estimatedHours) || 0,
                        status: 'é€²è¡Œä¸­',
                        order: 0
                    };
                    const docId = await saveToFirestore('tasks', task);
                    if (docId) {
                        const newTaskData = {
                            id: docId,
                            ...task,
                            createdBy: user.uid,
                            createdByName: user.displayName || user.email,
                            createdAt: firebase.firestore.Timestamp.now(),
                            updatedAt: firebase.firestore.Timestamp.now()
                        };
                        setTasks(prevTasks => [...prevTasks, newTaskData]);
                    }
                }
            };

            // ã‚¿ã‚¹ã‚¯ã®ç·å·¥æ•°ã‚’å–å¾—ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆè¨ˆï¼‰
            // ç¾åœ¨ã®é–¢æ•°ã‚’ä¿®æ­£
            const getTaskTotalHours = useCallback((taskId) => {
                const taskSessions = workSessions.filter(s => s.taskId === taskId);
                return taskSessions.reduce((sum, session) => sum + (session.hours || session.totalHours || 0), 0);
            }, [workSessions]);

            // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°
            const filterSessionsByPeriod = useCallback((sessions, period) => {
                const now = new Date();
                const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                switch (period) {
                    case 'thisMonth':
                        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                        return sessions.filter(s => {
                            const date = s.lastUpdated?.toDate ? s.lastUpdated.toDate() :
                                s.date?.toDate ? s.date.toDate() :
                                    s.endTime?.toDate ? s.endTime.toDate() : new Date();
                            return date >= startOfMonth;
                        });

                    case 'lastMonth':
                        const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                        const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0);
                        return sessions.filter(s => {
                            const date = s.lastUpdated?.toDate ? s.lastUpdated.toDate() :
                                s.date?.toDate ? s.date.toDate() :
                                    s.endTime?.toDate ? s.endTime.toDate() : new Date();
                            return date >= startOfLastMonth && date <= endOfLastMonth;
                        });

                    case 'last3Months':
                        const threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
                        return sessions.filter(s => {
                            const date = s.lastUpdated?.toDate ? s.lastUpdated.toDate() :
                                s.date?.toDate ? s.date.toDate() :
                                    s.endTime?.toDate ? s.endTime.toDate() : new Date();
                            return date >= threeMonthsAgo;
                        });

                    case 'last6Months':
                        const sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 6, now.getDate());
                        return sessions.filter(s => {
                            const date = s.lastUpdated?.toDate ? s.lastUpdated.toDate() :
                                s.date?.toDate ? s.date.toDate() :
                                    s.endTime?.toDate ? s.endTime.toDate() : new Date();
                            return date >= sixMonthsAgo;
                        });

                    case 'thisYear':
                        const startOfYear = new Date(now.getFullYear(), 0, 1);
                        return sessions.filter(s => {
                            const date = s.lastUpdated?.toDate ? s.lastUpdated.toDate() :
                                s.date?.toDate ? s.date.toDate() :
                                    s.endTime?.toDate ? s.endTime.toDate() : new Date();
                            return date >= startOfYear;
                        });

                    default:
                        return sessions;
                }
            }, []);

            // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å„ã‚¿ã‚¹ã‚¯å·¥æ•°ãƒãƒƒãƒ—
            const userTaskHoursMap = useMemo(() => {
                const map = {};
                if (!user || !tasks) return map;

                tasks.forEach(task => {
                    if (task && task.id) {
                        map[task.id] = getUserTaskHours(user.uid, task.id);
                    }
                });
                return map;
            }, [tasks, user, getUserTaskHours]);

            // å…¨ã‚¿ã‚¹ã‚¯ã®ç·å·¥æ•°ãƒãƒƒãƒ—
            const taskTotalHoursMap = useMemo(() => {
                const map = {};
                if (!tasks) return map;

                tasks.forEach(task => {
                    if (task && task.id) {
                        map[task.id] = getTaskTotalHours(task.id);
                    }
                });
                return map;
            }, [tasks, getTaskTotalHours]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆã‚’ãƒ¡ãƒ¢åŒ–ï¼ˆå®‰å…¨æ€§å‘ä¸Šï¼‰
            const projectStatsCache = useMemo(() => {
                const cache = {};
                if (!projects || !Array.isArray(projects) || !tasks || !Array.isArray(tasks)) {
                    return cache;
                }

                projects.forEach(project => {
                    if (!project || !project.id) return;

                    const projectTasks = tasks.filter(task =>
                        task && task.projectId && String(task.projectId) === String(project.id)
                    );

                    const totalEstimated = projectTasks.reduce((sum, task) =>
                        sum + (task.estimatedHours || 0), 0
                    );

                    const totalActual = projectTasks.reduce((sum, task) => {
                        if (!task || !task.id) return sum;
                        return sum + (taskTotalHoursMap[task.id] || 0);
                    }, 0);

                    const completedTasks = projectTasks.filter(task =>
                        task.status === 'å®Œäº†'
                    ).length;

                    const progress = projectTasks.length > 0 ?
                        (completedTasks / projectTasks.length) * 100 : 0;

                    const amount = parseFloat(project.amount) || 0;
                    const laborCost = parseFloat(project.laborCost) || 0;
                    const materialCost = parseFloat(project.materialCost) || 0;
                    const hourlyRate = totalActual > 0 ? laborCost / totalActual : 0;

                    cache[project.id] = {
                        totalEstimated,
                        totalActual,
                        completedTasks,
                        totalTasks: projectTasks.length,
                        progress,
                        amount,
                        laborCost,
                        materialCost,
                        hourlyRate
                    };
                });
                return cache;
            }, [projects, tasks, taskTotalHoursMap]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆå–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ï¼‰
            const getProjectStats = useCallback((projectId) => {
                return projectStatsCache[projectId] || {
                    totalEstimated: 0,
                    totalActual: 0,
                    completedTasks: 0,
                    totalTasks: 0,
                    progress: 0,
                    amount: 0,
                    laborCost: 0,
                    materialCost: 0,
                    hourlyRate: 0
                };
            }, [projectStatsCache]);

            // ã‚½ãƒ¼ãƒˆé–¢æ•°ï¼ˆgetProjectStatsã®å¾Œã«é…ç½®ï¼‰
            const sortProjects = useCallback((projectsToSort) => {
                return [...projectsToSort].sort((a, b) => {
                    switch (sortOption) {
                        case 'created-desc':
                            const aDate = a.createdAt ? a.createdAt.toDate() : new Date(0);
                            const bDate = b.createdAt ? b.createdAt.toDate() : new Date(0);
                            return bDate - aDate;

                        case 'created-asc':
                            const aDateAsc = a.createdAt ? a.createdAt.toDate() : new Date(0);
                            const bDateAsc = b.createdAt ? b.createdAt.toDate() : new Date(0);
                            return aDateAsc - bDateAsc;

                        case 'deadline-asc':
                            if (!a.deadline && !b.deadline) return 0;
                            if (!a.deadline) return 1;
                            if (!b.deadline) return -1;
                            return new Date(a.deadline) - new Date(b.deadline);

                        case 'deadline-desc':
                            if (!a.deadline && !b.deadline) return 0;
                            if (!a.deadline) return 1;
                            if (!b.deadline) return -1;
                            return new Date(b.deadline) - new Date(a.deadline);

                        case 'progress-desc':
                            const aProgress = getProjectStats(a.id).progress;
                            const bProgress = getProjectStats(b.id).progress;
                            return bProgress - aProgress;

                        case 'progress-asc':
                            const aProgressAsc = getProjectStats(a.id).progress;
                            const bProgressAsc = getProjectStats(b.id).progress;
                            return aProgressAsc - bProgressAsc;

                        default:
                            return 0;
                    }
                });
            }, [sortOption, getProjectStats]);

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚½ãƒ¼ãƒˆï¼ˆãƒ¡ãƒ¢åŒ–ï¼‰- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ï¼ˆsortProjectsã®å¾Œã«é…ç½®ï¼‰
            const sortedProjects = useMemo(() => {
                let filtered = filteredProjects;

                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
                if (statusFilter === 'active') {
                    filtered = filtered.filter(p => p.status === 'é€²è¡Œä¸­');
                } else if (statusFilter === 'completed') {
                    filtered = filtered.filter(p => p.status === 'å®Œäº†');
                } else if (statusFilter === 'favorite') {
                    filtered = filtered.filter(p => isFavorite(p.id));
                }

                return sortProjects(filtered);
            }, [filteredProjects, sortProjects, statusFilter, isFavorite]);

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center auth-background px-4">
                        <div
                            className="glass-card mobile-compact-card rounded-2xl text-center w-full max-w-md mx-4"
                            style={{
                                paddingTop: '40px',
                                paddingBottom: '50px',
                                paddingLeft: '24px',
                                paddingRight: '24px'
                            }}
                        >
                            <div className="text-white mobile-text-base md:text-xl mb-4">èª­ã¿è¾¼ã¿ä¸­...</div>
                            <div
                                className="mx-auto"
                                style={{
                                    width: '32px',
                                    height: '32px',
                                    border: '2px solid white',
                                    borderTop: '2px solid transparent',
                                    borderRadius: '50%',
                                    animation: 'spin 1s linear infinite',
                                    WebkitAnimation: 'spin 1s linear infinite'
                                }}
                            ></div>
                        </div>
                    </div>
                );
            }

            // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®èªè¨¼ç”»é¢
            if (!user) {
                // ãƒ¡ãƒ¼ãƒ«ç¢ºèªé€ä¿¡å®Œäº†ç”»é¢
                if (emailVerificationSent) {
                    return (
                        <div className="min-h-screen flex items-center justify-center auth-background px-4">
                            <div className="glass-card mobile-compact-card p-6 md:p-8 rounded-2xl w-full max-w-md mx-4">
                                <div className="text-center">
                                    <div className="flex justify-center mb-4 mt-2">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="gray" strokeWidth="1.5">
                                            <rect x="2" y="4" width="20" height="16" rx="2" />
                                            <path d="M22 7l-10 5L2 7" />
                                        </svg>
                                    </div>
                                    <h2 className="text-sm md:text-2xl font-bold text-white mb-4">
                                        ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ
                                    </h2>
                                    <p className="text-gray-300 mb-4 mobile-text-sm">
                                        ç™»éŒ²ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚
                                        ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèªã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚
                                    </p>
                                    <p className="mobile-text-xs text-gray-400 mb-6">
                                        ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
                                    </p>
                                    <button
                                        onClick={() => {
                                            setEmailVerificationSent(false);
                                            setWaitingForVerification(false);
                                            setAuthMode('login');
                                        }}
                                        className="gradient-button text-white px-6 py-3 rounded-xl font-bold w-full text-sm mb-1.5"
                                    >
                                        ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                // ãƒ¡ãƒ¼ãƒ«æœªç¢ºèªã®è­¦å‘Šç”»é¢
                if (waitingForVerification) {
                    return (
                        <div className="min-h-screen flex items-center justify-center auth-background px-4">
                            <div className="glass-card mobile-compact-card p-6 md:p-8 rounded-2xl w-full max-w-md mx-4">
                                <div className="text-center">
                                    <div className="flex justify-center mb-4 mt-2">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="gray" strokeWidth="1.5">
                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                            <line x1="12" y1="9" x2="12" y2="13" />
                                            <circle cx="12" cy="17" r="0.5" fill="white" />
                                        </svg>
                                    </div>
                                    <h2 className="text-sm md:text-2xl font-bold text-white mb-4">
                                        ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèªãŒå¿…è¦ã§ã™
                                    </h2>
                                    <p className="text-gray-300 mb-6 mobile-text-sm">
                                        ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèªãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ã€‚
                                        é€ä¿¡ã•ã‚ŒãŸç¢ºèªãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰ã€
                                        å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚
                                    </p>
                                    <button
                                        onClick={() => {
                                            setWaitingForVerification(false);
                                            setAuthForm({ email: '', password: '', name: '', confirmPassword: '' });
                                        }}
                                        className="gradient-button text-white px-6 py-3 rounded-xl font-bold w-full text-sm mb-1.5"
                                    >
                                        ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }
                return (
                    <div className="min-h-screen flex items-center justify-center auth-background px-4">
                        <div className="glass-card mobile-compact-card p-6 md:p-8 rounded-2xl w-full max-w-md mx-4">
                            <div className="text-center mb-6 mt-6">
                                <h1 className="text-base md:text-2xl font-bold text-white mb-2 neon-text">
                                    å·¥ç¨‹ãƒ»å·¥æ•°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
                                </h1>
                            </div>

                            {authError && (
                                <div className="bg-red-500 bg-opacity-20 border border-red-500 text-red-300 p-3 rounded-lg mb-4 mobile-text-xs">
                                    {authError}
                                </div>
                            )}

                            <form onSubmit={authMode === 'login' ? handleLogin : handleRegister} noValidate>
                                {authMode === 'register' && (
                                    <div className="mb-4">
                                        <input
                                            type="text"
                                            placeholder="åå‰"
                                            value={authForm.name}
                                            onChange={(e) => setAuthForm({ ...authForm, name: e.target.value })}
                                            className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                            required
                                        />
                                    </div>
                                )}

                                <div className="mb-4">
                                    <input
                                        type="email"
                                        placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                                        value={authForm.email}
                                        onChange={(e) => setAuthForm({ ...authForm, email: e.target.value })}
                                        className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                        inputMode="email"
                                        autoComplete="email"
                                        spellCheck="false"
                                        autoCorrect="off"
                                        required
                                    />
                                </div>

                                <div className="mb-4">
                                    <input
                                        type="password"
                                        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                                        value={authForm.password}
                                        onChange={(e) => setAuthForm({ ...authForm, password: e.target.value })}
                                        className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                        autoComplete="current-password"
                                        required
                                    />
                                </div>

                                {authMode === 'register' && (
                                    <div className="mb-6">
                                        <input
                                            type="password"
                                            placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª"
                                            value={authForm.confirmPassword}
                                            onChange={(e) => setAuthForm({ ...authForm, confirmPassword: e.target.value })}
                                            className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                            autoComplete="new-password"
                                            required
                                        />
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full gradient-button text-white py-3 rounded-xl font-bold mb-4 hover:shadow-lg transition-all duration-300 text-sm"
                                >
                                    {authMode === 'login' ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'æ–°è¦ç™»éŒ²'}
                                </button>
                            </form>

                            <div className="text-center mb-2">
                                <button
                                    onClick={() => {
                                        setAuthMode(authMode === 'login' ? 'register' : 'login');
                                        setAuthError('');
                                        setAuthForm({ email: '', password: '', name: '', confirmPassword: '' });
                                    }}
                                    className="text-gray-300 hover:text-white transition-colors duration-200 text-sm"
                                >
                                    {authMode === 'login' ? 'æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰' : 'ãƒ­ã‚°ã‚¤ãƒ³ã¯ã“ã¡ã‚‰'}
                                </button>
                            </div>

                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen mobile-container" style={{ background: 'linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #000000 100%)' }}>
                    <div className="max-w-7xl mx-auto">
                        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                        <header className="mb-6 md:mb-8">
                            {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ä¿å­˜çŠ¶æ…‹è¡¨ç¤º */}
                            <div className="glass-card mobile-header rounded-2xl flex flex-row sm:flex-row justify-between items-center text-white gap-3 sm:gap-4 relative">
                                <div className="flex items-center gap-3 sm:gap-4">
                                    <div className="flex items-center gap-2">
                                        <div
                                            className="user-icon user-icon-small cursor-pointer hover:opacity-80 transition-opacity duration-200"
                                            onClick={() => {
                                                setTempIconColor(userIconColor);
                                                setShowColorPickerModal(true);
                                            }}
                                            style={{ background: userIconColor }}
                                        >
                                            {(user.displayName || user.email || 'U').charAt(0).toUpperCase()}
                                        </div>
                                        {/* ã‚¿ã‚¤ãƒãƒ¼å®Ÿè¡Œä¸­ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’éè¡¨ç¤º */}
                                        {Object.keys(activeTimers).length === 0 && (
                                            <span className="font-medium text-sm sm:text-base">
                                                <span className="hidden sm:inline">ã‚ˆã†ã“ãã€</span>
                                                {user.displayName || user.email}
                                                <span className="hidden sm:inline">ã•ã‚“</span>
                                            </span>
                                        )}
                                    </div>
                                    {Object.keys(activeTimers).length === 0 && lastSaved && (
                                        <span className="text-xs text-gray-300 pulse-animation hidden sm:block">
                                            æœ€çµ‚åŒæœŸ: {lastSaved.toLocaleString('ja-JP')}
                                        </span>
                                    )}
                                </div>


                                <div className="flex items-center gap-0.5 ml-6">
                                    {/* ã‚¿ã‚¤ãƒãƒ¼å®Ÿè¡Œä¸­ã®è¡¨ç¤º */}
                                    {(() => {
                                        const activeTimerEntries = Object.entries(activeTimers);
                                        if (activeTimerEntries.length === 0) return null;

                                        const [taskId, timer] = activeTimerEntries[0]; // æœ€åˆã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ã‚¤ãƒãƒ¼
                                        const task = tasks.find(t => t.id === taskId);
                                        const project = projects.find(p => p.id === task?.projectId);
                                        const duration = Date.now() - timer.startTime;
                                        const minutes = Math.floor(duration / 60000);
                                        const seconds = Math.floor((duration % 60000) / 1000);

                                        return (
                                            <div className="flex items-center gap-1 mr-2">
                                                <span className="text-white text-xs whitespace-nowrap">
                                                    {project && (
                                                        <>
                                                            <span className="text-gray-300 font-bold">
                                                                {project.name.length > 5
                                                                    ? project.name.substring(0, 5)
                                                                    : project.name}

                                                            </span>
                                                            <span className="mx-1"> </span>
                                                        </>
                                                    )}
                                                    <span className="text-red-300 font-bold mr-1">
                                                        {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                                                    </span>
                                                </span>
                                                <button
                                                    onClick={() => toggleTimer(taskId)}
                                                    className="flex items-center justify-center text-white font-normal transition-all duration-300 gradient-red hover:shadow-lg pulse-animation w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                    title="ã‚¿ã‚¤ãƒãƒ¼åœæ­¢"
                                                >
                                                    <span style={{ transform: 'translateX(0.2px)' }}>
                                                        â– 
                                                    </span>
                                                </button>
                                            </div>
                                        );
                                    })()}

                                    {/* ç®¡ç†ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ï¼ˆãƒã‚¹ã‚¿ãƒ¼ç®¡ç†è€…ã®ã¿è¡¨ç¤ºï¼‰ */}
                                    {isMasterAdmin && (
                                        <button
                                            onClick={async () => {
                                                await loadAllUsers();
                                                setShowUserManagementModal(true);
                                            }}
                                            className="p-2 text-gray-400 hover:text-white transition-colors duration-200 flex items-center justify-center"
                                            title="ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†"
                                            style={{
                                                background: 'transparent',
                                                border: 'none',
                                                cursor: 'pointer',
                                                WebkitTapHighlightColor: 'transparent',
                                                minWidth: '40px',
                                                minHeight: '40px'
                                            }}
                                        >
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
                                                <circle cx="12" cy="12" r="3"></circle>
                                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                            </svg>
                                        </button>
                                    )}

                                    {/* ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ */}
                                    <button
                                        onClick={() => {
                                            // çœŸã£æš—ãªç”»é¢ã‚’è¡¨ç¤º
                                            const loadingOverlay = document.createElement('div');
                                            loadingOverlay.style.cssText = `
                                                position: fixed;
                                                top: 0;
                                                left: 0;
                                                width: 100%;
                                                height: 100%;
                                                background: #000000;
                                                z-index: 9999;
                                                pointer-events: all;
                                                overflow: hidden;
                                            `;

                                            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
                                            document.body.style.overflow = 'hidden';
                                            document.documentElement.style.overflow = 'hidden';

                                            document.body.appendChild(loadingOverlay);

                                            // å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’ç¢ºå®Ÿã«è¡¨ç¤ºï¼‰
                                            setTimeout(() => {
                                                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡è¦–ã—ã¦å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰
                                                window.location.href = window.location.href + '?t=' + new Date().getTime();
                                            }, 100);
                                        }}
                                        className="p-2 text-gray-400 hover:text-white transition-colors duration-200 flex items-center justify-center"
                                        title="ãƒªãƒ­ãƒ¼ãƒ‰"
                                        style={{
                                            background: 'transparent',
                                            border: 'none',
                                            cursor: 'pointer',
                                            WebkitTapHighlightColor: 'transparent',
                                            minWidth: '40px',
                                            minHeight: '40px'
                                        }}
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                                            <polyline points="23 4 23 10 17 10"></polyline>
                                            <polyline points="1 20 1 14 7 14"></polyline>
                                            <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                        </svg>
                                    </button>

                                    <button
                                        onClick={handleLogout}
                                        className="p-2 text-gray-400 hover:text-white transition-colors duration-200 flex items-center justify-center"
                                        title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"
                                        style={{
                                            background: 'transparent',
                                            border: 'none',
                                            cursor: 'pointer',
                                            WebkitTapHighlightColor: 'transparent',
                                            minWidth: '40px',
                                            minHeight: '40px'
                                        }}
                                    >
                                        <TabIcons.Logout size={20} />
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div className="fixed bottom-0 left-0 right-0 z-50 bg-gray-900 bg-opacity-95 backdrop-filter blur-sm border-t border-gray-600 rounded-t-2xl" style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}>
                            <div className="flex px-2 py-1.5 pb-5">
                                <button
                                    onClick={() => setActiveTab('tasks')}
                                    className={`flex-1 py-3 px-2 text-center font-medium transition-all duration-300 rounded-xl mx-1 ${activeTab === 'tasks'
                                        ? 'gradient-button active text-white shadow-lg'
                                        : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                >
                                    <div className="flex flex-col items-center gap-1">
                                        <TabIcons.Projects size={20} />
                                        <span style={{ fontSize: '10px' }}>æ¡ˆä»¶ç®¡ç†</span>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setActiveTab('companies')}
                                    className={`flex-1 py-3 px-2 text-center font-medium transition-all duration-300 rounded-xl mx-1 ${activeTab === 'companies'
                                        ? 'gradient-button active text-white shadow-lg'
                                        : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                >
                                    <div className="flex flex-col items-center gap-1">
                                        <TabIcons.Companies size={20} />
                                        <span style={{ fontSize: '10px' }}>ä¼šç¤¾ç®¡ç†</span>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setActiveTab('gantt')}
                                    className={`flex-1 py-3 px-2 text-center font-medium transition-all duration-300 rounded-xl mx-1 ${activeTab === 'gantt'
                                        ? 'gradient-button active text-white shadow-lg'
                                        : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                >
                                    <div className="flex flex-col items-center gap-1">
                                        <TabIcons.Gantt size={20} />
                                        <span style={{ fontSize: '10px' }}>å·¥ç¨‹è¡¨</span>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setActiveTab('analytics')}
                                    className={`flex-1 py-3 px-2 text-center font-medium transition-all duration-300 rounded-xl mx-1 ${activeTab === 'analytics'
                                        ? 'gradient-button active text-white shadow-lg'
                                        : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                >
                                    <div className="flex flex-col items-center gap-1">
                                        <TabIcons.Analytics size={20} />
                                        <span style={{ fontSize: '10px' }}>åˆ†æ</span>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setActiveTab('mypage')}
                                    className={`flex-1 py-3 px-2 text-center font-medium transition-all duration-300 rounded-xl mx-1 ${activeTab === 'mypage'
                                        ? 'gradient-button active text-white shadow-lg'
                                        : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                >
                                    <div className="flex flex-col items-center gap-1">
                                        <TabIcons.MyPage size={20} />
                                        <span style={{ fontSize: '10px' }}>ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        {/* ä¼šç¤¾ç®¡ç†ã‚¿ãƒ– */}
                        {activeTab === 'companies' && (
                            <div className="space-y-6 md:space-y-8" style={{ minHeight: '100vh' }}>
                                <div className="flex flex-row justify-between items-center gap-3 sm:gap-0">
                                    <h2 className="text-lg md:text-2xl font-bold text-white neon-text" style={{ margin: '1px 0' }}>
                                        ä¼šç¤¾ç®¡ç†
                                    </h2>
                                    {isAdmin && (
                                        <button
                                            onClick={() => setShowCompanyForm(true)}
                                            className="flex items-center justify-center text-white font-normal transition-all duration-300 gradient-button hover:shadow-lg w-7 h-7 rounded-full flex-shrink-0"
                                        >
                                            ï¼‹
                                        </button>
                                    )}
                                </div>

                                {/* æ¤œç´¢ãƒ»ã‚½ãƒ¼ãƒˆãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’1è¡Œã«ã¾ã¨ã‚ã‚‹ */}
                                <div className="glass-card mobile-compact-card rounded-2xl">
                                    <div className="space-y-2">
                                        {/* æ¤œç´¢ãƒãƒ¼ */}
                                        <div className="w-full">
                                            <input
                                                type="text"
                                                placeholder="ä¼šç¤¾åã§æ¤œç´¢..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-xs"
                                            />
                                        </div>

                                        {/* ä¸¦ã³æ›¿ãˆã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæ¨ªä¸¦ã³ï¼‰ */}
                                        <div className="flex gap-2">
                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={sortOption}
                                                        onChange={(e) => setSortOption(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="created-desc">ä½œæˆé †ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                                                        <option value="created-asc">ä½œæˆé †ï¼ˆå¤ã„é †ï¼‰</option>
                                                        <option value="project-count-desc">æ¡ˆä»¶é †ï¼ˆå¤šã„é †ï¼‰</option>
                                                        <option value="project-count-asc">æ¡ˆä»¶é †ï¼ˆå°‘ãªã„é †ï¼‰</option>
                                                        <option value="name-asc">åå‰é †ï¼ˆA-Zï¼‰</option>
                                                        <option value="name-desc">åå‰é †ï¼ˆZ-Aï¼‰</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={statusFilter}
                                                        onChange={(e) => setStatusFilter(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="all">å…¨ã¦ ({filteredProjects.length})</option>
                                                        <option value="active">é€²è¡Œä¸­ ({filteredProjects.filter(p => p.status === 'é€²è¡Œä¸­').length})</option>
                                                        <option value="completed">å®Œäº† ({filteredProjects.filter(p => p.status === 'å®Œäº†').length})</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* ä¼šç¤¾ä¸€è¦§ï¼ˆã‚«ãƒ¼ãƒ‰å‰Šé™¤ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */}
                                <div className="space-y-4 md:space-y-6">
                                    {(() => {
                                        // å„ä¼šç¤¾ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’è¨ˆç®—
                                        const companiesWithProjectInfo = companies.map(company => {
                                            const companyProjects = projects.filter(p => p.company === company.name);
                                            const activeProjects = companyProjects.filter(p => p.status === 'é€²è¡Œä¸­');
                                            const completedProjects = companyProjects.filter(p => p.status === 'å®Œäº†');

                                            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«å¿œã˜ã¦è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°ã‚’æ±ºå®š
                                            let displayProjectCount;
                                            if (statusFilter === 'active') {
                                                displayProjectCount = activeProjects.length;
                                            } else if (statusFilter === 'completed') {
                                                displayProjectCount = completedProjects.length;
                                            } else {
                                                displayProjectCount = companyProjects.length; // å…¨ã¦
                                            }

                                            return {
                                                ...company,
                                                totalProjects: companyProjects.length,
                                                activeProjects: activeProjects.length,
                                                completedProjects: completedProjects.length,
                                                displayProjectCount: displayProjectCount
                                            };
                                        });

                                        // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã¿é©ç”¨
                                        let filteredCompanies = companiesWithProjectInfo.filter(company =>
                                            (company.name || '').toLowerCase().includes(searchQuery.toLowerCase())
                                        );

                                        // ã‚½ãƒ¼ãƒˆå‡¦ç†
                                        filteredCompanies.sort((a, b) => {
                                            switch (sortOption) {
                                                case 'name-asc':
                                                    return (a.name || '').localeCompare(b.name || '');
                                                case 'name-desc':
                                                    return (b.name || '').localeCompare(a.name || '');
                                                case 'project-count-desc':
                                                    return b.displayProjectCount - a.displayProjectCount;
                                                case 'project-count-asc':
                                                    return a.displayProjectCount - b.displayProjectCount;
                                                case 'created-desc':
                                                    const aDate = a.createdAt ? a.createdAt.toDate() : new Date(0);
                                                    const bDate = b.createdAt ? b.createdAt.toDate() : new Date(0);
                                                    return bDate - aDate;
                                                case 'created-asc':
                                                    const aDateAsc = a.createdAt ? a.createdAt.toDate() : new Date(0);
                                                    const bDateAsc = b.createdAt ? b.createdAt.toDate() : new Date(0);
                                                    return aDateAsc - bDateAsc;
                                                default:
                                                    return 0;
                                            }
                                        });

                                        return filteredCompanies.length > 0 ? (
                                            filteredCompanies.map(company => {
                                                const isCollapsed = collapsedCompanies[company.id];

                                                return (
                                                    <div key={company.id} className="glass-card rounded-2xl overflow-hidden">
                                                        {/* ä¼šç¤¾ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼é¢¨ï¼‰ */}
                                                        <div className="bg-gray-800 bg-opacity-50 mobile-compact-card border-b border-gray-600 border-opacity-30 relative">
                                                            <div className="flex justify-between items-start mb-3">
                                                                <div
                                                                    className="flex items-start gap-3 cursor-pointer flex-1"
                                                                    onClick={() => toggleCompanyCollapse(company.id)}
                                                                >
                                                                    <span className="text-white text-sm flex-shrink-0 w-5 flex justify-center" style={{ marginTop: '43px' }}>
                                                                        {isCollapsed ? icons.chevronRight : icons.chevronDown}
                                                                    </span>
                                                                    <div className="flex-1 min-w-0">
                                                                        <div className="flex flex-col mb-2 mt-10">
                                                                            <h3 className="text-base md:text-lg font-bold text-white truncate">{company.name}</h3>
                                                                            <div className="flex flex-wrap gap-2 mt-1">
                                                                                {company.createdByName && (
                                                                                    <span
                                                                                        className="mobile-text-xs text-white font-bold px-2 py-1 rounded-full"
                                                                                        style={{ background: getUserIconColor(company.createdBy) }}
                                                                                    >
                                                                                        {company.createdByName}
                                                                                    </span>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                        {company.description && (
                                                                            <p className="text-gray-300 mobile-text-sm line-clamp-2">{company.description}</p>
                                                                        )}
                                                                    </div>
                                                                </div>

                                                                {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦å´ï¼‰ */}
                                                                {isAdmin && (
                                                                    <div className="absolute top-2 left-3 flex gap-2 z-10">
                                                                        <DeleteButton
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                openDeleteConfirm('company', company.id, company.name);
                                                                            }}
                                                                        />
                                                                        <EditButton
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                openEditCompany(company);
                                                                            }}
                                                                        />
                                                                    </div>
                                                                )}

                                                                {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                <div className="absolute left-0 right-0 border-t border-gray-600" style={{ top: '38px' }}></div>
                                                            </div>

                                                            {/* ä¼šç¤¾çµ±è¨ˆ */}
                                                            <div className="grid grid-cols-3 gap-2 mobile-text-xs text-center">
                                                                <div>
                                                                    <div className="text-gray-400">
                                                                        {statusFilter === 'active' ? 'é€²è¡Œä¸­' :
                                                                            statusFilter === 'completed' ? 'å®Œäº†' :
                                                                                'ç·æ¡ˆä»¶'}
                                                                    </div>
                                                                    <div className="text-white font-bold">
                                                                        {company.displayProjectCount}
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-400">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</div>
                                                                    <div className="text-white font-bold">
                                                                        {taskTemplates.filter(t => t.companyId === company.id).length +
                                                                            checklistTemplates.filter(c => c.companyId === company.id).length +
                                                                            wiringTemplates.filter(w => w.companyId === company.id).length}
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-400">çŠ¶æ…‹</div>
                                                                    <div className="text-white font-bold">
                                                                        {company.totalProjects > 0 ? 'ä½¿ç”¨ä¸­' : 'æœªä½¿ç”¨'}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {/* è©³ç´°å†…å®¹ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ */}
                                                        <div className={`company-details-container mobile-compact-card space-y-3 ${!isCollapsed ? 'expanded' : 'collapsed'}`}>

                                                            {/* ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                                            <div className="border-t border-gray-600 pt-4">
                                                                <div className="flex justify-between items-center mb-3">
                                                                    <h5 className="mobile-text-sm font-bold text-white">å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h5>
                                                                    {isAdmin && (
                                                                        <button
                                                                            onClick={() => {
                                                                                setNewTemplate({
                                                                                    name: '',
                                                                                    companyId: company.id,
                                                                                    tasks: [{ title: '', estimatedHours: '', description: '' }]
                                                                                });
                                                                                setEditingTemplate(null);
                                                                                setShowTemplateForm(true);
                                                                            }}
                                                                            className="flex items-center justify-center text-white font-medium transition-all duration-300 gradient-button hover:shadow-lg w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                                            disabled={taskTemplates.filter(t => t.companyId === company.id).length >= 10}
                                                                        >
                                                                            <span style={{ transform: 'translateY(0.3px) translateX(0.2px)' }}>ï¼‹</span>
                                                                        </button>
                                                                    )}
                                                                </div>

                                                                {taskTemplates.filter(t => t.companyId === company.id).length > 0 ? (
                                                                    <div className="grid grid-cols-1 gap-3">
                                                                        {taskTemplates.filter(t => t.companyId === company.id).map(template => (
                                                                            <div key={template.id} className="glass-card-dark px-3 pt-3 pb-2 rounded-lg">
                                                                                {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ç«¯ï¼‰ */}
                                                                                <div className="flex gap-2 mb-1 -mt-2" style={{ minHeight: '22px' }}>
                                                                                    {isAdmin && (
                                                                                        <>
                                                                                            <DeleteButton
                                                                                                onClick={() => openDeleteConfirm('template', template.id, template.name)} />
                                                                                            <EditButton
                                                                                                onClick={() => {
                                                                                                    setEditingTemplate(template);
                                                                                                    // ç·¨é›†å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ·±ã„ã‚³ãƒ”ãƒ¼ã§ä¿å­˜
                                                                                                    const originalData = {
                                                                                                        name: template.name,
                                                                                                        companyId: template.companyId,
                                                                                                        tasks: (template.tasks || []).map(task => ({
                                                                                                            title: task.title || '',
                                                                                                            estimatedHours: task.estimatedHours || '',
                                                                                                            description: task.description || ''
                                                                                                        }))
                                                                                                    };
                                                                                                    setOriginalTemplate(originalData);
                                                                                                    setNewTemplate({ ...originalData });
                                                                                                    setShowTemplateForm(true);
                                                                                                }} />
                                                                                            <CopyButton
                                                                                                onClick={() => copyTemplate(template)} />
                                                                                        </>
                                                                                    )}
                                                                                </div>
                                                                                {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                                <div className="mb-2 -mx-3" style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>
                                                                                <div className="space-y-1">
                                                                                    <div className="font-bold text-white mobile-text-xs mt-1">
                                                                                        {template.name}
                                                                                    </div>
                                                                                    <div className="flex justify-between items-center -mb-1">
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            å·¥ç¨‹æ•°: {template.tasks?.length || 0} /
                                                                                            ç·å·¥æ•°: {template.tasks?.reduce((sum, t) =>
                                                                                                sum + (parseFloat(t.estimatedHours) || 0), 0
                                                                                            )}h
                                                                                        </div>
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            æœ€çµ‚æ›´æ–°: {(() => {
                                                                                                if (!template.updatedAt) return 'æ™‚åˆ»ä¸æ˜';
                                                                                                try {
                                                                                                    const date = template.updatedAt.toDate ?
                                                                                                        new Date(template.updatedAt.toDate()) :
                                                                                                        new Date(template.updatedAt);
                                                                                                    return isNaN(date.getTime()) ? 'æ™‚åˆ»ä¸æ˜' : date.toLocaleDateString('ja-JP');
                                                                                                } catch {
                                                                                                    return 'æ™‚åˆ»ä¸æ˜';
                                                                                                }
                                                                                            })()}
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                ) : (
                                                                    <p className="text-gray-500 mobile-text-sm text-center py-4">
                                                                        å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“
                                                                    </p>
                                                                )}
                                                                <p className="mobile-text-xs text-gray-500 text-right mt-2">
                                                                    {taskTemplates.filter(t => t.companyId === company.id).length}/10 ä½œæˆæ¸ˆã¿
                                                                </p>
                                                            </div>

                                                            {/* é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                                            <div className="border-t border-gray-600 pt-4">
                                                                <div className="flex justify-between items-center mb-3">
                                                                    <h5 className="mobile-text-sm font-bold text-white">é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h5>
                                                                    {isAdmin && (
                                                                        <button
                                                                            onClick={() => {
                                                                                setNewWiring({
                                                                                    ...newWiring,
                                                                                    name: '',
                                                                                    companyId: company.id
                                                                                });
                                                                                setEditingWiring(null);
                                                                                setShowWiringForm(true);
                                                                            }}
                                                                            className="flex items-center justify-center text-white font-medium transition-all duration-300 gradient-button hover:shadow-lg w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                                            disabled={wiringTemplates.filter(w => w.companyId === company.id).length >= 10}
                                                                        >
                                                                            <span style={{ transform: 'translateY(0.3px) translateX(0.2px)' }}>ï¼‹</span>
                                                                        </button>
                                                                    )}
                                                                </div>

                                                                {wiringTemplates.filter(w => w.companyId === company.id).length > 0 ? (
                                                                    <div className="grid grid-cols-1 gap-3">
                                                                        {wiringTemplates.filter(w => w.companyId === company.id).map(wiring => (
                                                                            <div key={wiring.id} className="glass-card-dark px-3 pt-3 pb-2 rounded-lg">
                                                                                {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ç«¯ï¼‰ */}
                                                                                <div className="flex gap-2 mb-1 -mt-2" style={{ minHeight: '22px' }}>
                                                                                    {isAdmin && (
                                                                                        <>
                                                                                            <DeleteButton
                                                                                                onClick={() => openDeleteConfirm('wiring', wiring.id, wiring.name)} />
                                                                                            <EditButton
                                                                                                onClick={() => {
                                                                                                    setEditingWiring(wiring);
                                                                                                    setNewWiring(wiring);
                                                                                                    setShowWiringForm(true);
                                                                                                }} />
                                                                                            <CopyButton
                                                                                                onClick={() => copyWiringTemplate(wiring)} />
                                                                                        </>
                                                                                    )}
                                                                                </div>
                                                                                {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                                <div className="mb-2 -mx-3" style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>
                                                                                <div className="space-y-1">
                                                                                    <div className="font-bold text-white mobile-text-xs mt-1">
                                                                                        {wiring.name}
                                                                                    </div>
                                                                                    <div className="flex justify-between items-center -mb-1">
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°: {(() => {
                                                                                                if (!wiring.specifications) return 0;
                                                                                                let count = 0;
                                                                                                const specs = wiring.specifications;

                                                                                                // å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                                                                                                if (specs.wire && (
                                                                                                    specs.wire.power?.standards?.length > 0 ||
                                                                                                    specs.wire.power?.remarks ||
                                                                                                    specs.wire.ground?.caseColor ||
                                                                                                    specs.wire.ground?.remarks ||
                                                                                                    specs.wire.controlAC?.standards ||
                                                                                                    specs.wire.controlAC?.remarks ||
                                                                                                    specs.wire.controlDC?.standards ||
                                                                                                    specs.wire.controlDC?.remarks ||
                                                                                                    specs.wire.insulationCapRemarks ||
                                                                                                    specs.wire.specialSpec
                                                                                                )) count++;
                                                                                                if (specs.terminal && (
                                                                                                    specs.terminal.power ||
                                                                                                    specs.terminal.controlAC ||
                                                                                                    specs.terminal.controlDC ||
                                                                                                    specs.terminal.remarks
                                                                                                )) count++;
                                                                                                if (specs.terminalBlock && (
                                                                                                    specs.terminalBlock.cover ||
                                                                                                    specs.terminalBlock.namePlate ||
                                                                                                    specs.terminalBlock.bridge ||
                                                                                                    specs.terminalBlock.remarks
                                                                                                )) count++;
                                                                                                if (specs.namePlate && (
                                                                                                    specs.namePlate.fontSize ||
                                                                                                    specs.namePlate.remarks
                                                                                                )) count++;
                                                                                                if (specs.deviceSeal && (
                                                                                                    specs.deviceSeal.fontSize ||
                                                                                                    specs.deviceSeal.length ||
                                                                                                    specs.deviceSeal.positions?.length > 0 ||
                                                                                                    specs.deviceSeal.remarks
                                                                                                )) count++;
                                                                                                if (specs.markTube && (
                                                                                                    specs.markTube.fontSize ||
                                                                                                    specs.markTube.length ||
                                                                                                    specs.markTube.printSpec ||
                                                                                                    specs.markTube.orientation?.up ||
                                                                                                    specs.markTube.orientation?.down ||
                                                                                                    specs.markTube.orientation?.left ||
                                                                                                    specs.markTube.orientation?.right ||
                                                                                                    specs.markTube.remarks
                                                                                                )) count++;
                                                                                                if (specs.otherConfirm && (
                                                                                                    specs.otherConfirm.tighteningPen ||
                                                                                                    specs.otherConfirm.matchMark ||
                                                                                                    specs.otherConfirm.screw ||
                                                                                                    specs.otherConfirm.hookTube ||
                                                                                                    specs.otherConfirm.spiralTube ||
                                                                                                    specs.otherConfirm.insulock ||
                                                                                                    specs.otherConfirm.mountBase ||
                                                                                                    specs.otherConfirm.routeSpecialNote ||
                                                                                                    specs.otherConfirm.remarks
                                                                                                )) count++;

                                                                                                return count;
                                                                                            })()}
                                                                                        </div>
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            æœ€çµ‚æ›´æ–°: {(() => {
                                                                                                if (!wiring.updatedAt) return 'æ™‚åˆ»ä¸æ˜';
                                                                                                try {
                                                                                                    const date = wiring.updatedAt.toDate ?
                                                                                                        new Date(wiring.updatedAt.toDate()) :
                                                                                                        new Date(wiring.updatedAt);
                                                                                                    return isNaN(date.getTime()) ? 'æ™‚åˆ»ä¸æ˜' : date.toLocaleDateString('ja-JP');
                                                                                                } catch {
                                                                                                    return 'æ™‚åˆ»ä¸æ˜';
                                                                                                }
                                                                                            })()}
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                ) : (
                                                                    <p className="text-gray-500 mobile-text-sm text-center py-4">
                                                                        é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“
                                                                    </p>
                                                                )}

                                                                <p className="mobile-text-xs text-gray-500 text-right mt-2">
                                                                    {wiringTemplates.filter(w => w.companyId === company.id).length}/10 ä½œæˆæ¸ˆã¿
                                                                </p>
                                                            </div>

                                                            {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                                            <div className="border-t border-gray-600 pt-4">
                                                                <div className="flex justify-between items-center mb-3">
                                                                    <h5 className="mobile-text-sm font-bold text-white">æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h5>
                                                                    {isAdmin && (
                                                                        <button
                                                                            onClick={() => {
                                                                                setNewChecklist({
                                                                                    name: '',
                                                                                    companyId: company.id,
                                                                                    checkType: 'single',
                                                                                    categories: [
                                                                                        {
                                                                                            name: '',
                                                                                            items: [{ name: '', description: '' }]
                                                                                        }
                                                                                    ]
                                                                                });
                                                                                setEditingChecklist(null);
                                                                                setShowChecklistForm(true);
                                                                            }}
                                                                            className="flex items-center justify-center text-white font-medium transition-all duration-300 gradient-button hover:shadow-lg w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                                            disabled={checklistTemplates.filter(c => c.companyId === company.id).length >= 10}
                                                                        >
                                                                            <span style={{ transform: 'translateY(0.3px) translateX(0.2px)' }}>ï¼‹</span>
                                                                        </button>
                                                                    )}
                                                                </div>

                                                                {checklistTemplates.filter(c => c.companyId === company.id).length > 0 ? (
                                                                    <div className="grid grid-cols-1 gap-3">
                                                                        {checklistTemplates.filter(c => c.companyId === company.id).map(checklist => (
                                                                            <div key={checklist.id} className="glass-card-dark px-3 pt-3 pb-2 rounded-lg">
                                                                                {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ç«¯ï¼‰ */}
                                                                                <div className="flex gap-2 mb-1 -mt-2" style={{ minHeight: '22px' }}>
                                                                                    {isAdmin && (
                                                                                        <>
                                                                                            <DeleteButton
                                                                                                onClick={() => openDeleteConfirm('checklist', checklist.id, checklist.name)} />
                                                                                            <EditButton
                                                                                                onClick={() => {
                                                                                                    setEditingChecklist(checklist);
                                                                                                    setNewChecklist({
                                                                                                        name: checklist.name,
                                                                                                        companyId: checklist.companyId,
                                                                                                        checkType: checklist.checkType || 'single',
                                                                                                        categories: JSON.parse(JSON.stringify(checklist.categories || []))
                                                                                                    });
                                                                                                    setShowChecklistForm(true);
                                                                                                }} />
                                                                                            <CopyButton
                                                                                                onClick={() => copyChecklistTemplate(checklist)} />
                                                                                        </>
                                                                                    )}
                                                                                </div>
                                                                                {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                                <div className="mb-2 -mx-3" style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>
                                                                                <div className="space-y-1">
                                                                                    <div className="font-bold text-white mobile-text-xs mt-1">
                                                                                        {checklist.name}
                                                                                    </div>
                                                                                    <div className="flex justify-between items-center -mb-1">
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            ã‚«ãƒ†ã‚´ãƒªæ•°: {checklist.categories?.length || 0} /
                                                                                            é …ç›®æ•°: {checklist.categories?.reduce((sum, cat) => sum + (cat.items?.length || 0), 0) || 0}
                                                                                        </div>
                                                                                        <div className="text-gray-400 mobile-text-xs">
                                                                                            æœ€çµ‚æ›´æ–°: {(() => {
                                                                                                if (!checklist.updatedAt) return 'æ™‚åˆ»ä¸æ˜';
                                                                                                try {
                                                                                                    const date = checklist.updatedAt.toDate ?
                                                                                                        new Date(checklist.updatedAt.toDate()) :
                                                                                                        new Date(checklist.updatedAt);
                                                                                                    return isNaN(date.getTime()) ? 'æ™‚åˆ»ä¸æ˜' : date.toLocaleDateString('ja-JP');
                                                                                                } catch {
                                                                                                    return 'æ™‚åˆ»ä¸æ˜';
                                                                                                }
                                                                                            })()}
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                ) : (
                                                                    <p className="text-gray-500 mobile-text-sm text-center py-4">
                                                                        æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“
                                                                    </p>
                                                                )}

                                                                <p className="mobile-text-xs text-gray-500 text-right mt-2">
                                                                    {checklistTemplates.filter(c => c.companyId === company.id).length}/10 ä½œæˆæ¸ˆã¿
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        ) : (
                                            <div className="text-center text-gray-400 py-8">
                                                <p className="text-base md:text-lg mb-2">
                                                    {searchQuery ? 'æ¤œç´¢ã«ä¸€è‡´ã™ã‚‹ä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“' : 'ç™»éŒ²æ¸ˆã¿ä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“'}
                                                </p>
                                                <p className="mobile-text-sm">
                                                    {searchQuery ? 'æ¤œç´¢æ¡ä»¶ã‚’å¤‰æ›´ã™ã‚‹ã‹ã€' : ''}æ–°è¦ä¼šç¤¾ç™»éŒ²ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„
                                                </p>
                                            </div>
                                        );
                                    })()}
                                </div>

                                {/* æ–°è¦ä¼šç¤¾ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  */}
                                {showCompanyForm && (
                                    <div className="modal-overlay" onClick={() => setShowCompanyForm(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">æ–°è¦ä¼šç¤¾ç™»éŒ²</h3>
                                            </div>
                                            <div className="space-y-3 mb-4">
                                                <input
                                                    type="text"
                                                    placeholder="ä¼šç¤¾å"
                                                    value={newCompany.name}
                                                    onChange={(e) => setNewCompany({ ...newCompany, name: e.target.value })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                />
                                                <textarea
                                                    placeholder="ä¼šç¤¾èª¬æ˜ï¼ˆä»»æ„ï¼‰"
                                                    value={newCompany.description}
                                                    onChange={(e) => setNewCompany({ ...newCompany, description: e.target.value })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                    rows={3}
                                                />
                                            </div>
                                            <div className="flex flex-col gap-2 mb-1.5">
                                                <button
                                                    onClick={createCompany}
                                                    className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                                >
                                                    ç™»éŒ²
                                                </button>
                                                <button
                                                    onClick={() => setShowCompanyForm(false)}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ä¼šç¤¾ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  */}
                        {showEditCompanyForm && editCompany && (
                            <div className="modal-overlay" onClick={() => setShowEditCompanyForm(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-xl mx-4" onClick={(e) => e.stopPropagation()}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">ä¼šç¤¾æƒ…å ±ç·¨é›†</h3>
                                    </div>
                                    <div className="space-y-3 mb-4">
                                        <input
                                            type="text"
                                            placeholder="ä¼šç¤¾å"
                                            value={editCompany.name}
                                            onChange={(e) => setEditCompany({ ...editCompany, name: e.target.value })}
                                            className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                        />
                                        <textarea
                                            placeholder="ä¼šç¤¾èª¬æ˜ï¼ˆä»»æ„ï¼‰"
                                            value={editCompany.description || ''}
                                            onChange={(e) => setEditCompany({ ...editCompany, description: e.target.value })}
                                            className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                            rows={3}
                                        />
                                    </div>
                                    <div className="flex flex-col gap-2 mb-1.5">
                                        <button
                                            onClick={updateCompany}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            æ›´æ–°
                                        </button>
                                        <button
                                            onClick={() => setShowEditCompanyForm(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ•ã‚©ãƒ¼ãƒ  */}
                        {showChecklistForm && (
                            <div className="modal-overlay" onClick={() => {
                                setShowChecklistForm(false);
                                setEditingChecklist(null);
                                setNewChecklist({
                                    name: '',
                                    companyId: '',
                                    checkType: 'single',
                                    categories: [{ name: '', items: [{ name: '', description: '' }] }]
                                });
                            }}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            {editingChecklist ? 'æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†' : 'æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ'}
                                        </h3>
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå"
                                        value={newChecklist.name}
                                        onChange={(e) => setNewChecklist({ ...newChecklist, name: e.target.value })}
                                        className="w-full dark-input rounded-xl px-4 py-3 mb-3 text-sm focus:outline-none"
                                    />

                                    {/* ãƒã‚§ãƒƒã‚¯ã‚¿ã‚¤ãƒ—é¸æŠ */}
                                    <div className="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 mb-4">
                                        <span className="text-white font-medium mobile-text-sm">ãƒã‚§ãƒƒã‚¯é …ç›®æ•°:</span>
                                        <div className="flex gap-4">
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="checkType"
                                                    value="single"
                                                    checked={newChecklist.checkType === 'single'}
                                                    onChange={(e) => setNewChecklist({ ...newChecklist, checkType: e.target.value })}
                                                />
                                                <span className="text-gray-300 mobile-text-sm">1æ¬¡ã®ã¿</span>
                                            </label>
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="checkType"
                                                    value="double"
                                                    checked={newChecklist.checkType === 'double' || !newChecklist.checkType}
                                                    onChange={(e) => setNewChecklist({ ...newChecklist, checkType: e.target.value })}
                                                />
                                                <span className="text-gray-300 mobile-text-sm">1æ¬¡ãƒ»2æ¬¡</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        {newChecklist.categories.map((category, catIndex) => {
                                            const isCategoryDragging = draggedChecklistCategory && draggedChecklistCategory.index === catIndex;
                                            const isCategoryDragOver = dragOverChecklistCategory && dragOverChecklistCategory.index === catIndex;

                                            return (
                                                <div key={catIndex}
                                                    data-category-index={catIndex}
                                                    className={`glass-card-dark mobile-compact-card rounded-xl task-draggable ${isCategoryDragging ? 'task-dragging' : ''} ${isCategoryDragOver ? 'task-drag-over' : ''}`}
                                                    style={{
                                                        boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                                                        marginBottom: '12px',
                                                        paddingBottom: '6px'
                                                    }}
                                                    draggable="true"
                                                    onDragStart={(e) => {
                                                        setDraggedChecklistCategory({ index: catIndex, category });
                                                        e.dataTransfer.effectAllowed = 'move';
                                                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                                                        e.target.style.opacity = '0.5';
                                                    }}
                                                    onDragEnd={(e) => {
                                                        e.target.style.opacity = '1';
                                                        setDraggedChecklistCategory(null);
                                                        setDragOverChecklistCategory(null);
                                                        setTimeout(() => {
                                                            setDragOverChecklistCategory(null);
                                                        }, 50);
                                                    }}
                                                    onDragOver={(e) => {
                                                        e.preventDefault();
                                                        e.dataTransfer.dropEffect = 'move';
                                                        const categoryElement = e.currentTarget.closest('.task-draggable');
                                                        if (categoryElement && draggedChecklistCategory) {
                                                            const categoryIndex = parseInt(categoryElement.getAttribute('data-category-index'));
                                                            if (categoryIndex !== draggedChecklistCategory.index) {
                                                                setDragOverChecklistCategory({ index: categoryIndex, category: newChecklist.categories[categoryIndex] });
                                                            }
                                                        }
                                                    }}
                                                    onDragEnter={(e) => {
                                                        e.preventDefault();
                                                        if (draggedChecklistCategory && catIndex !== draggedChecklistCategory.index) {
                                                            setDragOverChecklistCategory({ index: catIndex, category });
                                                        }
                                                    }}
                                                    onDragLeave={(e) => {
                                                        const relatedTarget = e.relatedTarget;
                                                        const currentTarget = e.currentTarget;
                                                        if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                                                            setDragOverChecklistCategory(null);
                                                        }
                                                    }}
                                                    onDrop={(e) => {
                                                        e.preventDefault();
                                                        setDragOverChecklistCategory(null);

                                                        if (!draggedChecklistCategory || draggedChecklistCategory.index === catIndex) {
                                                            return;
                                                        }

                                                        const dragIndex = draggedChecklistCategory.index;
                                                        const dropIndex = catIndex;
                                                        const updatedCategories = [...newChecklist.categories];
                                                        const draggedItem = updatedCategories[dragIndex];
                                                        updatedCategories.splice(dragIndex, 1);
                                                        updatedCategories.splice(dropIndex, 0, draggedItem);
                                                        setNewChecklist({ ...newChecklist, categories: updatedCategories });
                                                    }}>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <input
                                                            type="text"
                                                            placeholder="ã‚«ãƒ†ã‚´ãƒªåï¼ˆä¾‹ï¼šå¤–è¦³æ¤œæŸ»ï¼‰"
                                                            value={category.name}
                                                            onChange={(e) => {
                                                                const updated = [...newChecklist.categories];
                                                                updated[catIndex].name = e.target.value;
                                                                setNewChecklist({ ...newChecklist, categories: updated });
                                                            }}
                                                            className={`flex-1 dark-input rounded-xl px-3 py-3 text-xs focus:outline-none ${newChecklist.categories.length > 1 ? 'mr-2' : ''}`}
                                                        />
                                                        {newChecklist.categories.length > 1 && (
                                                            <button
                                                                onClick={() => {
                                                                    const updated = newChecklist.categories.filter((_, i) => i !== catIndex);
                                                                    setNewChecklist({ ...newChecklist, categories: updated });
                                                                }}
                                                                className="text-gray-400 hover:text-white text-xl flex-shrink-0"
                                                            >
                                                                âœ•
                                                            </button>
                                                        )}
                                                    </div>

                                                    <div className="space-y-2 ml-2 sm:ml-4">
                                                        {category.items.map((item, itemIndex) => {
                                                            const isItemDragging = draggedChecklistItem && draggedChecklistItem.catIndex === catIndex && draggedChecklistItem.itemIndex === itemIndex;
                                                            const isItemDragOver = dragOverChecklistItem && dragOverChecklistItem.catIndex === catIndex && dragOverChecklistItem.itemIndex === itemIndex;

                                                            return (
                                                                <div key={itemIndex}
                                                                    data-category-index={catIndex}
                                                                    data-item-index={itemIndex}
                                                                    className={`space-y-2 task-draggable ${isItemDragging ? 'task-dragging' : ''} ${isItemDragOver ? 'task-drag-over' : ''}`}
                                                                    draggable="true"
                                                                    onDragStart={(e) => {
                                                                        setDraggedChecklistItem({ catIndex, itemIndex, item });
                                                                        e.dataTransfer.effectAllowed = 'move';
                                                                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                                                                        e.target.style.opacity = '0.5';
                                                                    }}
                                                                    onDragEnd={(e) => {
                                                                        e.target.style.opacity = '1';
                                                                        setDraggedChecklistItem(null);
                                                                        setDragOverChecklistItem(null);
                                                                        setTimeout(() => {
                                                                            setDragOverChecklistItem(null);
                                                                        }, 50);
                                                                    }}
                                                                    onDragOver={(e) => {
                                                                        e.preventDefault();
                                                                        e.dataTransfer.dropEffect = 'move';
                                                                        if (draggedChecklistItem) {
                                                                            if (draggedChecklistItem.catIndex === catIndex &&
                                                                                draggedChecklistItem.itemIndex !== itemIndex) {
                                                                                setDragOverChecklistItem({ catIndex, itemIndex, item });
                                                                            }
                                                                        }
                                                                    }}
                                                                    onDragEnter={(e) => {
                                                                        e.preventDefault();
                                                                        if (draggedChecklistItem &&
                                                                            draggedChecklistItem.catIndex === catIndex &&
                                                                            draggedChecklistItem.itemIndex !== itemIndex) {
                                                                            setDragOverChecklistItem({ catIndex, itemIndex, item });
                                                                        }
                                                                    }}
                                                                    onDragLeave={(e) => {
                                                                        const relatedTarget = e.relatedTarget;
                                                                        const currentTarget = e.currentTarget;
                                                                        if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                                                                            setDragOverChecklistItem(null);
                                                                        }
                                                                    }}
                                                                    onDrop={(e) => {
                                                                        e.preventDefault();
                                                                        setDragOverChecklistItem(null);

                                                                        if (!draggedChecklistItem ||
                                                                            draggedChecklistItem.catIndex !== catIndex ||
                                                                            draggedChecklistItem.itemIndex === itemIndex) {
                                                                            return;
                                                                        }

                                                                        const dragIndex = draggedChecklistItem.itemIndex;
                                                                        const dropIndex = itemIndex;
                                                                        const updated = [...newChecklist.categories];
                                                                        const draggedItem = updated[catIndex].items[dragIndex];
                                                                        updated[catIndex].items.splice(dragIndex, 1);
                                                                        updated[catIndex].items.splice(dropIndex, 0, draggedItem);
                                                                        setNewChecklist({ ...newChecklist, categories: updated });
                                                                    }}>
                                                                    <div className="flex gap-2">
                                                                        <input
                                                                            type="text"
                                                                            placeholder="æ¤œæŸ»é …ç›®"
                                                                            value={item.name}
                                                                            onChange={(e) => {
                                                                                const updated = [...newChecklist.categories];
                                                                                updated[catIndex].items[itemIndex].name = e.target.value;
                                                                                setNewChecklist({ ...newChecklist, categories: updated });
                                                                            }}
                                                                            className="flex-1 dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                                        />
                                                                        {category.items.length > 1 && (
                                                                            <button
                                                                                onClick={() => {
                                                                                    const updated = [...newChecklist.categories];
                                                                                    updated[catIndex].items = updated[catIndex].items.filter((_, i) => i !== itemIndex);
                                                                                    setNewChecklist({ ...newChecklist, categories: updated });
                                                                                }}
                                                                                className="text-gray-400 hover:text-white text-xl flex-shrink-0"
                                                                            >
                                                                                âœ•
                                                                            </button>
                                                                        )}
                                                                    </div>
                                                                    <input
                                                                        type="text"
                                                                        placeholder="å‚™è€ƒï¼ˆä»»æ„ï¼‰"
                                                                        value={item.description}
                                                                        onChange={(e) => {
                                                                            const updated = [...newChecklist.categories];
                                                                            updated[catIndex].items[itemIndex].description = e.target.value;
                                                                            setNewChecklist({ ...newChecklist, categories: updated });
                                                                        }}
                                                                        className="w-full dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                                    />
                                                                </div>
                                                            );
                                                        })}
                                                        <button
                                                            onClick={() => {
                                                                const updated = [...newChecklist.categories];
                                                                updated[catIndex].items.push({ name: '', description: '' });
                                                                setNewChecklist({ ...newChecklist, categories: updated });
                                                            }}
                                                            className="mobile-text-xs text-gray-400 hover:text-white"
                                                        >
                                                            + é …ç›®ã‚’è¿½åŠ 
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}

                                        <button
                                            onClick={() => {
                                                setNewChecklist({
                                                    ...newChecklist,
                                                    categories: [...newChecklist.categories, { name: '', items: [{ name: '', description: '' }] }]
                                                });
                                            }}
                                            className="w-full glass-card-dark text-white py-2 rounded-lg mobile-text-sm"
                                        >
                                            + ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ 
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-1 gap-2 mb-1.5">
                                        <button
                                            onClick={saveChecklistTemplate}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            {editingChecklist ? 'æ›´æ–°' : 'ä¿å­˜'}
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowChecklistForm(false);
                                                setEditingChecklist(null);
                                                setNewChecklist({
                                                    name: '',
                                                    companyId: '',
                                                    checkType: 'single',
                                                    categories: [{ name: '', items: [{ name: '', description: '' }] }]
                                                });
                                            }}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ•ã‚©ãƒ¼ãƒ  */}
                        {showTemplateForm && (
                            <div className="modal-overlay" onClick={cancelTemplateEdit}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            {editingTemplate ? 'å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†' : 'å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ'}
                                        </h3>
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå"
                                        value={newTemplate.name}
                                        onChange={(e) => setNewTemplate({ ...newTemplate, name: e.target.value })}
                                        className="w-full dark-input rounded-xl px-4 py-3 mb-3 text-sm focus:outline-none"
                                    />

                                    <div className="space-y-3 mb-3">
                                        {newTemplate.tasks.map((task, index) => {
                                            const isDragging = draggedTemplateTask && draggedTemplateTask.index === index;
                                            const isDragOver = dragOverTemplateTask && dragOverTemplateTask.index === index;

                                            return (
                                                <div key={index}
                                                    data-task-index={index}
                                                    className={`glass-card-dark mobile-compact-card rounded-xl task-draggable ${isDragging ? 'task-dragging' : ''} ${isDragOver ? 'task-drag-over' : ''}`}
                                                    style={{
                                                        boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                                                        paddingBottom: '2px'
                                                    }}
                                                    draggable="true"
                                                    onDragStart={(e) => {
                                                        setDraggedTemplateTask({ index, task });
                                                        e.dataTransfer.effectAllowed = 'move';
                                                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                                                        e.target.style.opacity = '0.5';
                                                    }}
                                                    onDragEnd={(e) => {
                                                        e.target.style.opacity = '1';
                                                        setDraggedTemplateTask(null);
                                                        setDragOverTemplateTask(null);
                                                        setTimeout(() => {
                                                            setDragOverTemplateTask(null);
                                                        }, 50);
                                                    }}
                                                    onDragOver={(e) => {
                                                        e.preventDefault();
                                                        e.dataTransfer.dropEffect = 'move';
                                                        const taskElement = e.currentTarget.closest('.task-draggable');
                                                        if (taskElement && draggedTemplateTask) {
                                                            const taskIndex = parseInt(taskElement.getAttribute('data-task-index'));
                                                            if (taskIndex !== draggedTemplateTask.index) {
                                                                setDragOverTemplateTask({ index: taskIndex, task: newTemplate.tasks[taskIndex] });
                                                            }
                                                        }
                                                    }}
                                                    onDragEnter={(e) => {
                                                        e.preventDefault();
                                                        if (draggedTemplateTask && index !== draggedTemplateTask.index) {
                                                            setDragOverTemplateTask({ index, task });
                                                        }
                                                    }}
                                                    onDragLeave={(e) => {
                                                        const relatedTarget = e.relatedTarget;
                                                        const currentTarget = e.currentTarget;
                                                        if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                                                            setDragOverTemplateTask(null);
                                                        }
                                                    }}
                                                    onDrop={(e) => {
                                                        e.preventDefault();
                                                        setDragOverTemplateTask(null);

                                                        if (!draggedTemplateTask || draggedTemplateTask.index === index) {
                                                            return;
                                                        }

                                                        const dragIndex = draggedTemplateTask.index;
                                                        const dropIndex = index;
                                                        const updatedTasks = [...newTemplate.tasks];
                                                        const draggedItem = updatedTasks[dragIndex];
                                                        updatedTasks.splice(dragIndex, 1);
                                                        updatedTasks.splice(dropIndex, 0, draggedItem);
                                                        setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                    }}
                                                >
                                                    <div className="space-y-2">
                                                        {/* å·¥ç¨‹åã¨å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã« */}
                                                        <div className="flex justify-between items-center mb-2">
                                                            <input
                                                                type="text"
                                                                placeholder="å·¥ç¨‹å"
                                                                value={task.title}
                                                                onChange={(e) => {
                                                                    const updatedTasks = [...newTemplate.tasks];
                                                                    updatedTasks[index].title = e.target.value;
                                                                    setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                                }}
                                                                className={`flex-1 dark-input rounded-xl px-3 py-3 text-xs focus:outline-none ${newTemplate.tasks.length > 1 ? 'mr-2' : ''}`}
                                                            />
                                                            {newTemplate.tasks.length > 1 && (
                                                                <button
                                                                    onClick={() => {
                                                                        const updatedTasks = newTemplate.tasks.filter((_, i) => i !== index);
                                                                        setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                                    }}
                                                                    className="text-gray-400 hover:text-white text-xl flex-shrink-0"
                                                                    title="å·¥ç¨‹ã‚’å‰Šé™¤"
                                                                >
                                                                    âœ•
                                                                </button>
                                                            )}
                                                        </div>

                                                        <div className="flex gap-2 items-center">
                                                            <div className="number-input-container flex-1">
                                                                <input
                                                                    type="number"
                                                                    inputMode="decimal"
                                                                    pattern="[0-9]*[.,]?[0-9]*"
                                                                    placeholder="äºˆæƒ³å·¥æ•°ï¼ˆæ™‚é–“ï¼‰"
                                                                    value={task.estimatedHours}
                                                                    onChange={(e) => {
                                                                        const updatedTasks = [...newTemplate.tasks];
                                                                        updatedTasks[index].estimatedHours = e.target.value;
                                                                        setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                                    }}
                                                                    className="w-full dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                                    step="0.5"
                                                                />
                                                                <div className="custom-spin-buttons">
                                                                    <button
                                                                        type="button"
                                                                        className="spin-button spin-button-up"
                                                                        onClick={() => {
                                                                            const updatedTasks = [...newTemplate.tasks];
                                                                            const currentValue = parseFloat(updatedTasks[index].estimatedHours) || 0;
                                                                            updatedTasks[index].estimatedHours = (currentValue + 0.5).toString();
                                                                            setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                                        }}
                                                                    />
                                                                    <button
                                                                        type="button"
                                                                        className="spin-button spin-button-down"
                                                                        onClick={() => {
                                                                            const updatedTasks = [...newTemplate.tasks];
                                                                            const currentValue = parseFloat(updatedTasks[index].estimatedHours) || 0;
                                                                            updatedTasks[index].estimatedHours = Math.max(0, currentValue - 0.5).toString();
                                                                            setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                                        }}
                                                                    />
                                                                </div>
                                                            </div>

                                                        </div>

                                                        <textarea
                                                            placeholder="èª¬æ˜ï¼ˆä»»æ„ï¼‰"
                                                            value={task.description}
                                                            onChange={(e) => {
                                                                const updatedTasks = [...newTemplate.tasks];
                                                                updatedTasks[index].description = e.target.value;
                                                                setNewTemplate({ ...newTemplate, tasks: updatedTasks });
                                                            }}
                                                            className="w-full dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                            rows={2}
                                                        />
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <button
                                        onClick={() => {
                                            setNewTemplate({
                                                ...newTemplate,
                                                tasks: [...newTemplate.tasks, { title: '', estimatedHours: '', description: '' }]
                                            });
                                        }}
                                        className="w-full glass-card-dark text-white py-2 rounded-lg mb-3 mobile-text-sm"
                                    >
                                        + å·¥ç¨‹ã‚’è¿½åŠ 
                                    </button>

                                    <div className="grid grid-cols-1 gap-2 mb-1.5 mt-3">
                                        <button
                                            onClick={() => saveTemplate()}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            {editingTemplate ? 'æ›´æ–°' : 'ä½œæˆ'}
                                        </button>
                                        <button
                                            onClick={cancelTemplateEdit}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ•ã‚©ãƒ¼ãƒ  */}
                        {showWiringForm && (
                            <div className="modal-overlay" onClick={() => {
                                setShowWiringForm(false);
                                setEditingWiring(null);
                                resetWiringForm();
                            }}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            {editingWiring
                                                ? (editingWiring.projectId ? 'é…ç·šä»•æ§˜ç·¨é›†' : 'é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†')
                                                : 'é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ'}
                                        </h3>
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå"
                                        value={newWiring.name}
                                        onChange={(e) => setNewWiring({ ...newWiring, name: e.target.value })}
                                        className="w-full dark-input rounded-xl px-4 py-3 mb-3 text-sm focus:outline-none"
                                    />

                                    {/* ä½¿ç”¨é›»ç·šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3"
                                        style={{
                                            boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                                            paddingBottom: '4px'
                                        }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-2">é›»ç·š</h4>

                                        {/* å‹•åŠ› */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">å‹•åŠ›</h5>



                                            {/* è¦æ ¼ï¼ˆè¤‡æ•°é¸æŠï¼‰ */}
                                            <div className="mb-2">

                                                {[0, 1, 2, 3, 4].map(index => (
                                                    (index === 0 || newWiring.specifications.wire.power.standards[index - 1]) && (
                                                        <div key={index} className="mb-2">
                                                            <div className="flex gap-2 items-center">
                                                                <div className="custom-select-container flex-1">
                                                                    <select
                                                                        value={newWiring.specifications.wire.power.standards[index] || ''}
                                                                        onChange={(e) => {
                                                                            const newStandards = [...(newWiring.specifications.wire.power.standards || [])];
                                                                            newStandards[index] = e.target.value;
                                                                            setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            standards: newStandards.filter(s => s) // ç©ºã®è¦ç´ ã‚’é™¤å»
                                                                                        }
                                                                                    }
                                                                                }
                                                                            });
                                                                        }}
                                                                        className="custom-select text-xs"
                                                                    >
                                                                        <option value="">è¦æ ¼ï¼ˆæœ€å¤§5å€‹ã¾ã§ï¼‰</option>
                                                                        <option value="IV">IV</option>
                                                                        <option value="KV">KV</option>
                                                                        <option value="KIV">KIV</option>
                                                                        <option value="HIV">HIV</option>
                                                                        <option value="UL1007">UL1007</option>
                                                                        <option value="UL1015">UL1015</option>
                                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                                    </select>
                                                                    <div className="custom-select-arrow"></div>
                                                                </div>
                                                                {newWiring.specifications.wire.power.standards[index] === 'ãã®ä»–' && (
                                                                    <input
                                                                        type="text"
                                                                        placeholder="è¦æ ¼ã‚’å…¥åŠ›"
                                                                        value={newWiring.specifications.wire.power[`customStandard${index}`] || ''}
                                                                        onChange={(e) => setNewWiring({
                                                                            ...newWiring,
                                                                            specifications: {
                                                                                ...newWiring.specifications,
                                                                                wire: {
                                                                                    ...newWiring.specifications.wire,
                                                                                    power: {
                                                                                        ...newWiring.specifications.wire.power,
                                                                                        [`customStandard${index}`]: e.target.value
                                                                                    }
                                                                                }
                                                                            }
                                                                        })}
                                                                        className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                    />
                                                                )}
                                                            </div>
                                                        </div>
                                                    )
                                                ))}
                                            </div>

                                            {/* é…ç·šæ–¹å¼é¸æŠ */}
                                            <div className="mb-2">

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.wire.power.wiringType}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                wire: {
                                                                    ...newWiring.specifications.wire,
                                                                    power: {
                                                                        ...newWiring.specifications.wire.power,
                                                                        wiringType: e.target.value,
                                                                        phases: {} // ãƒªã‚»ãƒƒãƒˆ
                                                                    }
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">é…ç·šæ–¹å¼</option>
                                                        <option value="three-phase-4">ä¸‰ç›¸4ç·š</option>
                                                        <option value="three-phase-3">ä¸‰ç›¸3ç·š</option>
                                                        <option value="single-phase-3">å˜ç›¸3ç·š</option>
                                                        <option value="single-phase-2">å˜ç›¸2ç·š</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            {/* ç›¸ç·šè‰²ï¼ˆé…ç·šæ–¹å¼ã«å¿œã˜ã¦è¡¨ç¤ºï¼‰ */}
                                            {newWiring.specifications.wire.power.wiringType && (
                                                <div className="mb-2">


                                                    {/* ä¸‰ç›¸4ç·š */}
                                                    {newWiring.specifications.wire.power.wiringType === 'three-phase-4' && (
                                                        <div className="space-y-2">
                                                            {[
                                                                { key: 'rPhase', label: 'Rç›¸' },
                                                                { key: 'sPhase', label: 'Sç›¸' },
                                                                { key: 'tPhase', label: 'Tç›¸' },
                                                                { key: 'nPhase', label: 'Nç›¸' }
                                                            ].map(phase => (
                                                                <div key={phase.key}>
                                                                    <div className="custom-select-container">
                                                                        <select
                                                                            value={newWiring.specifications.wire.power.phases[phase.key] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            phases: {
                                                                                                ...newWiring.specifications.wire.power.phases,
                                                                                                [phase.key]: e.target.value
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="custom-select text-xs"
                                                                        >
                                                                            <option value="">ç·šè‰²:{phase.label}</option>
                                                                            <option value="é»’">é»’</option>
                                                                            <option value="ç™½">ç™½</option>
                                                                            <option value="èµ¤">èµ¤</option>
                                                                            <option value="ç·‘">ç·‘</option>
                                                                            <option value="é»„">é»„</option>
                                                                            <option value="èŒ¶">èŒ¶</option>
                                                                            <option value="é’">é’</option>
                                                                            <option value="ç°">ç°</option>
                                                                            <option value="æ©™">æ©™</option>
                                                                            <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                            <option value="æ¡ƒ">æ¡ƒ</option>
                                                                            <option value="è‹¥è‰">è‹¥è‰</option>
                                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                                        </select>
                                                                        <div className="custom-select-arrow"></div>
                                                                    </div>
                                                                    {newWiring.specifications.wire.power.phases[phase.key] === 'ãã®ä»–' && (
                                                                        <input
                                                                            type="text"
                                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                                            value={newWiring.specifications.wire.power[`${phase.key}Custom`] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            [`${phase.key}Custom`]: e.target.value
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                        />
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}

                                                    {/* ä¸‰ç›¸3ç·š */}
                                                    {newWiring.specifications.wire.power.wiringType === 'three-phase-3' && (
                                                        <div className="space-y-2">
                                                            {[
                                                                { key: 'rPhase', label: 'Rç›¸' },
                                                                { key: 'sPhase', label: 'Sç›¸' },
                                                                { key: 'tPhase', label: 'Tç›¸' }
                                                            ].map(phase => (
                                                                <div key={phase.key}>
                                                                    <div className="custom-select-container">
                                                                        <select
                                                                            value={newWiring.specifications.wire.power.phases[phase.key] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            phases: {
                                                                                                ...newWiring.specifications.wire.power.phases,
                                                                                                [phase.key]: e.target.value
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="custom-select text-xs"
                                                                        >
                                                                            <option value="">ç·šè‰²:{phase.label}</option>
                                                                            <option value="é»’">é»’</option>
                                                                            <option value="ç™½">ç™½</option>
                                                                            <option value="èµ¤">èµ¤</option>
                                                                            <option value="ç·‘">ç·‘</option>
                                                                            <option value="é»„">é»„</option>
                                                                            <option value="èŒ¶">èŒ¶</option>
                                                                            <option value="é’">é’</option>
                                                                            <option value="ç°">ç°</option>
                                                                            <option value="æ©™">æ©™</option>
                                                                            <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                            <option value="æ¡ƒ">æ¡ƒ</option>
                                                                            <option value="è‹¥è‰">è‹¥è‰</option>
                                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                                        </select>
                                                                        <div className="custom-select-arrow"></div>
                                                                    </div>
                                                                    {newWiring.specifications.wire.power.phases[phase.key] === 'ãã®ä»–' && (
                                                                        <input
                                                                            type="text"
                                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                                            value={newWiring.specifications.wire.power[`${phase.key}Custom`] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            [`${phase.key}Custom`]: e.target.value
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                        />
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}

                                                    {/* å˜ç›¸3ç·š */}
                                                    {newWiring.specifications.wire.power.wiringType === 'single-phase-3' && (
                                                        <div className="space-y-2">
                                                            {[
                                                                { key: 'rPhase', label: 'Rç›¸' },
                                                                { key: 'nPhase', label: 'Nç›¸' },
                                                                { key: 'tPhase', label: 'Tç›¸' }
                                                            ].map(phase => (
                                                                <div key={phase.key}>
                                                                    <div className="custom-select-container">
                                                                        <select
                                                                            value={newWiring.specifications.wire.power.phases[phase.key] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            phases: {
                                                                                                ...newWiring.specifications.wire.power.phases,
                                                                                                [phase.key]: e.target.value
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="custom-select text-xs"
                                                                        >
                                                                            <option value="">ç·šè‰²:{phase.label}</option>
                                                                            <option value="é»’">é»’</option>
                                                                            <option value="ç™½">ç™½</option>
                                                                            <option value="èµ¤">èµ¤</option>
                                                                            <option value="ç·‘">ç·‘</option>
                                                                            <option value="é»„">é»„</option>
                                                                            <option value="èŒ¶">èŒ¶</option>
                                                                            <option value="é’">é’</option>
                                                                            <option value="ç°">ç°</option>
                                                                            <option value="æ©™">æ©™</option>
                                                                            <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                            <option value="æ¡ƒ">æ¡ƒ</option>
                                                                            <option value="è‹¥è‰">è‹¥è‰</option>
                                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                                        </select>
                                                                        <div className="custom-select-arrow"></div>
                                                                    </div>
                                                                    {newWiring.specifications.wire.power.phases[phase.key] === 'ãã®ä»–' && (
                                                                        <input
                                                                            type="text"
                                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                                            value={newWiring.specifications.wire.power[`${phase.key}Custom`] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            [`${phase.key}Custom`]: e.target.value
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                        />
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}

                                                    {/* å˜ç›¸2ç·š */}
                                                    {newWiring.specifications.wire.power.wiringType === 'single-phase-2' && (
                                                        <div className="space-y-2">
                                                            {[
                                                                { key: 'lPhase', label: 'Lç›¸' },
                                                                { key: 'nPhase', label: 'Nç›¸' }
                                                            ].map(phase => (
                                                                <div key={phase.key}>
                                                                    <div className="custom-select-container">
                                                                        <select
                                                                            value={newWiring.specifications.wire.power.phases[phase.key] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            phases: {
                                                                                                ...newWiring.specifications.wire.power.phases,
                                                                                                [phase.key]: e.target.value
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="custom-select text-xs"
                                                                        >
                                                                            <option value="">ç·šè‰²:{phase.label}</option>
                                                                            <option value="é»’">é»’</option>
                                                                            <option value="ç™½">ç™½</option>
                                                                            <option value="èµ¤">èµ¤</option>
                                                                            <option value="ç·‘">ç·‘</option>
                                                                            <option value="é»„">é»„</option>
                                                                            <option value="èŒ¶">èŒ¶</option>
                                                                            <option value="é’">é’</option>
                                                                            <option value="ç°">ç°</option>
                                                                            <option value="æ©™">æ©™</option>
                                                                            <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                            <option value="æ¡ƒ">æ¡ƒ</option>
                                                                            <option value="è‹¥è‰">è‹¥è‰</option>
                                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                                        </select>
                                                                        <div className="custom-select-arrow"></div>
                                                                    </div>
                                                                    {newWiring.specifications.wire.power.phases[phase.key] === 'ãã®ä»–' && (
                                                                        <input
                                                                            type="text"
                                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                                            value={newWiring.specifications.wire.power[`${phase.key}Custom`] || ''}
                                                                            onChange={(e) => setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        power: {
                                                                                            ...newWiring.specifications.wire.power,
                                                                                            [`${phase.key}Custom`]: e.target.value
                                                                                        }
                                                                                    }
                                                                                }
                                                                            })}
                                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                        />
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {/* å‚™è€ƒ */}
                                            <div>

                                                <textarea
                                                    value={newWiring.specifications.wire.power.remarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                power: {
                                                                    ...newWiring.specifications.wire.power,
                                                                    remarks: e.target.value
                                                                }
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>

                                        {/* æ¥åœ° */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">æ¥åœ°</h5>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                                                <div>

                                                    <div className="flex gap-2">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.ground.caseColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                caseColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:ç­ä½“</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="ç·‘/é»„">ç·‘/é»„</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.ground.caseDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                caseDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                                <option value="3.5">3.5</option>
                                                                <option value="5.5">5.5</option>
                                                                <option value="8">8</option>
                                                                <option value="14">14</option>
                                                                <option value="22">22</option>
                                                                <option value="38">38</option>
                                                                <option value="60">60</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>

                                                    <div className="flex gap-2">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.ground.doorColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                doorColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:æ‰‰</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="ç·‘/é»„">ç·‘/é»„</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.ground.doorDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                doorDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                                <option value="3.5">3.5</option>
                                                                <option value="5.5">5.5</option>
                                                                <option value="8">8</option>
                                                                <option value="14">14</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>

                                                    <div className="flex gap-2">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.ground.panelColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                panelColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:ç›¤é–“</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="ç·‘/é»„">ç·‘/é»„</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.ground.panelDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            ground: {
                                                                                ...newWiring.specifications.wire.ground,
                                                                                panelDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                                <option value="3.5">3.5</option>
                                                                <option value="5.5">5.5</option>
                                                                <option value="8">8</option>
                                                                <option value="14">14</option>
                                                                <option value="22">22</option>
                                                                <option value="38">38</option>
                                                                <option value="60">60</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {/* å‚™è€ƒ */}
                                            <div className="mt-2">

                                                <textarea
                                                    value={newWiring.specifications.wire.ground.remarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                ground: {
                                                                    ...newWiring.specifications.wire.ground,
                                                                    remarks: e.target.value
                                                                }
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>

                                        {/* çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ— */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ—</h5>
                                            <div className="flex gap-2">
                                                <div className="custom-select-container flex-1">
                                                    <select
                                                        value={newWiring.specifications.wire.insulationCap}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                wire: {
                                                                    ...newWiring.specifications.wire,
                                                                    insulationCap: e.target.value,
                                                                    insulationCapDiameter: e.target.value !== 'å¤ªç·šã®ã¿å¿…è¦' ? '' : newWiring.specifications.wire.insulationCapDiameter,
                                                                    insulationCapRemarks: newWiring.specifications.wire.insulationCapRemarks // â† ã“ã®è¡Œã‚’è¿½åŠ 
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">ä»•æ§˜</option>
                                                        <option value="å…¨ã¦å¿…è¦">å…¨ã¦å¿…è¦</option>
                                                        <option value="ä¸è¦">ä¸è¦</option>
                                                        <option value="å¤ªç·šã®ã¿å¿…è¦">å¤ªç·šã®ã¿å¿…è¦</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                                {newWiring.specifications.wire.insulationCap === 'å¤ªç·šã®ã¿å¿…è¦' && (
                                                    <div className="custom-select-container" style={{ width: '150px' }}>
                                                        <select
                                                            value={newWiring.specifications.wire.insulationCapDiameter}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    wire: {
                                                                        ...newWiring.specifications.wire,
                                                                        insulationCapDiameter: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">sqä»¥ä¸Š</option>
                                                            <option value="2">2sqä»¥ä¸Š</option>
                                                            <option value="3.5">3.5sqä»¥ä¸Š</option>
                                                            <option value="5.5">5.5sqä»¥ä¸Š</option>
                                                            <option value="8">8sqä»¥ä¸Š</option>
                                                            <option value="14">14sqä»¥ä¸Š</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                )}
                                            </div>
                                            {/* å‚™è€ƒ */}
                                            <div className="mt-2">

                                                <textarea
                                                    value={newWiring.specifications.wire.insulationCapRemarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                insulationCap: newWiring.specifications.wire.insulationCap, // â† ã“ã®è¡Œã‚’è¿½åŠ 
                                                                insulationCapDiameter: newWiring.specifications.wire.insulationCapDiameter, // â† ã“ã®è¡Œã‚’è¿½åŠ 
                                                                insulationCapRemarks: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>

                                        {/* åˆ¶å¾¡AC */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">åˆ¶å¾¡AC</h5>

                                            {/* è¦æ ¼ï¼ˆè¤‡æ•°é¸æŠï¼‰ */}
                                            <div className="mb-2">

                                                {[0, 1, 2, 3, 4].map(index => (
                                                    (index === 0 || newWiring.specifications.wire.controlAC.standards[index - 1]) && (
                                                        <div key={index} className="mb-2">
                                                            <div className="flex gap-2 items-center">
                                                                <div className="custom-select-container flex-1">
                                                                    <select
                                                                        value={newWiring.specifications.wire.controlAC.standards[index] || ''}
                                                                        onChange={(e) => {
                                                                            const newStandards = [...(newWiring.specifications.wire.controlAC.standards || [])];
                                                                            newStandards[index] = e.target.value;
                                                                            setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        controlAC: {
                                                                                            ...newWiring.specifications.wire.controlAC,
                                                                                            standards: newStandards.filter(s => s)
                                                                                        }
                                                                                    }
                                                                                }
                                                                            });
                                                                        }}
                                                                        className="custom-select text-xs"
                                                                    >
                                                                        <option value="">è¦æ ¼ï¼ˆæœ€å¤§5å€‹ã¾ã§ï¼‰</option>
                                                                        <option value="IV">IV</option>
                                                                        <option value="KV">KV</option>
                                                                        <option value="KIV">KIV</option>
                                                                        <option value="HIV">HIV</option>
                                                                        <option value="UL1007">UL1007</option>
                                                                        <option value="UL1015">UL1015</option>
                                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                                    </select>
                                                                    <div className="custom-select-arrow"></div>
                                                                </div>
                                                                {newWiring.specifications.wire.controlAC.standards[index] === 'ãã®ä»–' && (
                                                                    <input
                                                                        type="text"
                                                                        placeholder="è¦æ ¼ã‚’å…¥åŠ›"
                                                                        value={newWiring.specifications.wire.controlAC[`customStandard${index}`] || ''}
                                                                        onChange={(e) => setNewWiring({
                                                                            ...newWiring,
                                                                            specifications: {
                                                                                ...newWiring.specifications,
                                                                                wire: {
                                                                                    ...newWiring.specifications.wire,
                                                                                    controlAC: {
                                                                                        ...newWiring.specifications.wire.controlAC,
                                                                                        [`customStandard${index}`]: e.target.value
                                                                                    }
                                                                                }
                                                                            }
                                                                        })}
                                                                        className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                    />
                                                                )}
                                                            </div>
                                                        </div>
                                                    )
                                                ))}
                                            </div>

                                            {/* ã‚³ãƒ¢ãƒ³ãƒ»éã‚³ãƒ¢ãƒ³è¨­å®šï¼ˆè¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */}
                                            <div className="space-y-2">
                                                <div>

                                                    <div className="flex gap-2 items-center">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.controlAC.commonColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                commonColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:ã‚³ãƒ¢ãƒ³</option>
                                                                <option value="é»’">é»’</option>
                                                                <option value="ç™½">ç™½</option>
                                                                <option value="èµ¤">èµ¤</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="é»„">é»„</option>
                                                                <option value="èŒ¶">èŒ¶</option>
                                                                <option value="é’">é’</option>
                                                                <option value="ç°">ç°</option>
                                                                <option value="æ©™">æ©™</option>
                                                                <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                <option value="æ¡ƒ">æ¡ƒ</option>
                                                                <option value="è‹¥è‰">è‹¥è‰</option>
                                                                <option value="ãã®ä»–">ãã®ä»–</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        {newWiring.specifications.wire.controlAC.commonColor === 'ãã®ä»–' && (
                                                            <input
                                                                type="text"
                                                                placeholder="è‰²ã‚’å…¥åŠ›"
                                                                value={newWiring.specifications.wire.controlAC.commonColorCustom || ''}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                commonColorCustom: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                            />
                                                        )}
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.controlAC.commonDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                commonDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.5">0.5</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>

                                                    <div className="flex gap-2 items-center">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.controlAC.nonCommonColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                nonCommonColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:ã‚³ãƒ¢ãƒ³ä»¥å¤–</option>
                                                                <option value="é»’">é»’</option>
                                                                <option value="ç™½">ç™½</option>
                                                                <option value="èµ¤">èµ¤</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="é»„">é»„</option>
                                                                <option value="èŒ¶">èŒ¶</option>
                                                                <option value="é’">é’</option>
                                                                <option value="ç°">ç°</option>
                                                                <option value="æ©™">æ©™</option>
                                                                <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                <option value="æ¡ƒ">æ¡ƒ</option>
                                                                <option value="è‹¥è‰">è‹¥è‰</option>
                                                                <option value="ãã®ä»–">ãã®ä»–</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        {newWiring.specifications.wire.controlAC.nonCommonColor === 'ãã®ä»–' && (
                                                            <input
                                                                type="text"
                                                                placeholder="è‰²ã‚’å…¥åŠ›"
                                                                value={newWiring.specifications.wire.controlAC.nonCommonColorCustom || ''}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                nonCommonColorCustom: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                            />
                                                        )}
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.controlAC.nonCommonDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlAC: {
                                                                                ...newWiring.specifications.wire.controlAC,
                                                                                nonCommonDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.5">0.5</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                            {/* å‚™è€ƒ */}
                                            <div className="mt-2">

                                                <textarea
                                                    value={newWiring.specifications.wire.controlAC.remarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                controlAC: {
                                                                    ...newWiring.specifications.wire.controlAC,
                                                                    remarks: e.target.value
                                                                }
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>

                                        {/* åˆ¶å¾¡DC */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">åˆ¶å¾¡DC</h5>

                                            {/* è¦æ ¼ï¼ˆè¤‡æ•°é¸æŠï¼‰ */}
                                            <div className="mb-2">

                                                {[0, 1, 2, 3, 4].map(index => (
                                                    (index === 0 || newWiring.specifications.wire.controlDC.standards[index - 1]) && (
                                                        <div key={index} className="mb-2">
                                                            <div className="flex gap-2 items-center">
                                                                <div className="custom-select-container flex-1">
                                                                    <select
                                                                        value={newWiring.specifications.wire.controlDC.standards[index] || ''}
                                                                        onChange={(e) => {
                                                                            const newStandards = [...(newWiring.specifications.wire.controlDC.standards || [])];
                                                                            newStandards[index] = e.target.value;
                                                                            setNewWiring({
                                                                                ...newWiring,
                                                                                specifications: {
                                                                                    ...newWiring.specifications,
                                                                                    wire: {
                                                                                        ...newWiring.specifications.wire,
                                                                                        controlDC: {
                                                                                            ...newWiring.specifications.wire.controlDC,
                                                                                            standards: newStandards.filter(s => s)
                                                                                        }
                                                                                    }
                                                                                }
                                                                            });
                                                                        }}
                                                                        className="custom-select text-xs"
                                                                    >
                                                                        <option value="">è¦æ ¼ï¼ˆæœ€å¤§5å€‹ã¾ã§ï¼‰</option>
                                                                        <option value="IV">IV</option>
                                                                        <option value="KV">KV</option>
                                                                        <option value="KIV">KIV</option>
                                                                        <option value="HIV">HIV</option>
                                                                        <option value="UL1007">UL1007</option>
                                                                        <option value="UL1015">UL1015</option>
                                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                                    </select>
                                                                    <div className="custom-select-arrow"></div>
                                                                </div>
                                                                {newWiring.specifications.wire.controlDC.standards[index] === 'ãã®ä»–' && (
                                                                    <input
                                                                        type="text"
                                                                        placeholder="è¦æ ¼ã‚’å…¥åŠ›"
                                                                        value={newWiring.specifications.wire.controlDC[`customStandard${index}`] || ''}
                                                                        onChange={(e) => setNewWiring({
                                                                            ...newWiring,
                                                                            specifications: {
                                                                                ...newWiring.specifications,
                                                                                wire: {
                                                                                    ...newWiring.specifications.wire,
                                                                                    controlDC: {
                                                                                        ...newWiring.specifications.wire.controlDC,
                                                                                        [`customStandard${index}`]: e.target.value
                                                                                    }
                                                                                }
                                                                            }
                                                                        })}
                                                                        className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                                    />
                                                                )}
                                                            </div>
                                                        </div>
                                                    )
                                                ))}
                                            </div>

                                            {/* Pæ¯ç·šãƒ»Næ¯ç·šãƒ»ãã®ä»–è¨­å®šï¼ˆè¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */}
                                            <div className="space-y-2">
                                                <div>

                                                    <div className="flex gap-2 items-center">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.pBusColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                pBusColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:Pæ¯ç·š</option>
                                                                <option value="é»’">é»’</option>
                                                                <option value="ç™½">ç™½</option>
                                                                <option value="èµ¤">èµ¤</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="é»„">é»„</option>
                                                                <option value="èŒ¶">èŒ¶</option>
                                                                <option value="é’">é’</option>
                                                                <option value="ç°">ç°</option>
                                                                <option value="æ©™">æ©™</option>
                                                                <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                <option value="æ¡ƒ">æ¡ƒ</option>
                                                                <option value="è‹¥è‰">è‹¥è‰</option>
                                                                <option value="ãã®ä»–">ãã®ä»–</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        {newWiring.specifications.wire.controlDC.pBusColor === 'ãã®ä»–' && (
                                                            <input
                                                                type="text"
                                                                placeholder="è‰²ã‚’å…¥åŠ›"
                                                                value={newWiring.specifications.wire.controlDC.pBusColorCustom || ''}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                pBusColorCustom: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                            />
                                                        )}
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.pBusDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                pBusDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.5">0.5</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>

                                                    <div className="flex gap-2 items-center">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.nBusColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                nBusColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:Næ¯ç·š</option>
                                                                <option value="é»’">é»’</option>
                                                                <option value="ç™½">ç™½</option>
                                                                <option value="èµ¤">èµ¤</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="é»„">é»„</option>
                                                                <option value="èŒ¶">èŒ¶</option>
                                                                <option value="é’">é’</option>
                                                                <option value="ç°">ç°</option>
                                                                <option value="æ©™">æ©™</option>
                                                                <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                <option value="æ¡ƒ">æ¡ƒ</option>
                                                                <option value="è‹¥è‰">è‹¥è‰</option>
                                                                <option value="ãã®ä»–">ãã®ä»–</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        {newWiring.specifications.wire.controlDC.nBusColor === 'ãã®ä»–' && (
                                                            <input
                                                                type="text"
                                                                placeholder="è‰²ã‚’å…¥åŠ›"
                                                                value={newWiring.specifications.wire.controlDC.nBusColorCustom || ''}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                nBusColorCustom: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                            />
                                                        )}
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.nBusDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                nBusDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.5">0.5</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>

                                                    <div className="flex gap-2 items-center">
                                                        <div className="custom-select-container flex-1">
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.otherColor}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                otherColor: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">ç·šè‰²:æ¯ç·šä»¥å¤–</option>
                                                                <option value="é»’">é»’</option>
                                                                <option value="ç™½">ç™½</option>
                                                                <option value="èµ¤">èµ¤</option>
                                                                <option value="ç·‘">ç·‘</option>
                                                                <option value="é»„">é»„</option>
                                                                <option value="èŒ¶">èŒ¶</option>
                                                                <option value="é’">é’</option>
                                                                <option value="ç°">ç°</option>
                                                                <option value="æ©™">æ©™</option>
                                                                <option value="ç©ºè‰²">ç©ºè‰²</option>
                                                                <option value="æ¡ƒ">æ¡ƒ</option>
                                                                <option value="è‹¥è‰">è‹¥è‰</option>
                                                                <option value="ãã®ä»–">ãã®ä»–</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                        {newWiring.specifications.wire.controlDC.otherColor === 'ãã®ä»–' && (
                                                            <input
                                                                type="text"
                                                                placeholder="è‰²ã‚’å…¥åŠ›"
                                                                value={newWiring.specifications.wire.controlDC.otherColorCustom || ''}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                otherColorCustom: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                            />
                                                        )}
                                                        <div className="custom-select-container" style={{ width: '100px' }}>
                                                            <select
                                                                value={newWiring.specifications.wire.controlDC.otherDiameter}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        wire: {
                                                                            ...newWiring.specifications.wire,
                                                                            controlDC: {
                                                                                ...newWiring.specifications.wire.controlDC,
                                                                                otherDiameter: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">sq</option>
                                                                <option value="0.5">0.5</option>
                                                                <option value="0.75">0.75</option>
                                                                <option value="1.25">1.25</option>
                                                                <option value="2">2</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* å‚™è€ƒ */}
                                            <div className="mt-2">

                                                <textarea
                                                    value={newWiring.specifications.wire.controlDC.remarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                controlDC: {
                                                                    ...newWiring.specifications.wire.controlDC,
                                                                    remarks: e.target.value
                                                                }
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>

                                        {/* ç‰¹æ®Šä»•æ§˜ */}
                                        <div className="mb-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">ç‰¹æ®Šä»•æ§˜</h5>
                                            <textarea
                                                value={newWiring.specifications.wire.specialSpec || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        wire: {
                                                            ...newWiring.specifications.wire,
                                                            specialSpec: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="ç‰¹æ®Šä»•æ§˜ã‚’å…¥åŠ›"
                                            />
                                        </div>

                                        {/* ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®šï¼ˆé›»ç·šï¼‰ */}
                                        <div>
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                            <div className="flex items-center gap-6 mb-2">
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="wireManufacturer"
                                                        checked={!newWiring.specifications.wire.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                wire: {
                                                                    ...newWiring.specifications.wire,
                                                                    manufacturerSpecified: false,
                                                                    manufacturer: ''
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">ç„¡ã—</span>
                                                </label>
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="wireManufacturer"
                                                        checked={newWiring.specifications.wire.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                wire: {
                                                                    ...newWiring.specifications.wire,
                                                                    manufacturerSpecified: true
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">æœ‰ã‚Š</span>
                                                </label>
                                            </div>
                                            {newWiring.specifications.wire.manufacturerSpecified && (
                                                <input
                                                    type="text"
                                                    placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼åã‚’å…¥åŠ›"
                                                    value={newWiring.specifications.wire.manufacturer}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            wire: {
                                                                ...newWiring.specifications.wire,
                                                                manufacturer: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs mb-1.5"
                                                />
                                            )}
                                        </div>
                                    </div>

                                    {/* åœ§ç€ç«¯å­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">åœ§ç€ç«¯å­</h4>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.power}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    power: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">å‹•åŠ›</option>
                                                        <option value="ä¸¸ç«¯å­">ä¸¸ç«¯å­</option>
                                                        <option value="Yç«¯å­">Yç«¯å­</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.controlAC}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    controlAC: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">åˆ¶å¾¡AC</option>
                                                        <option value="ä¸¸ç«¯å­">ä¸¸ç«¯å­</option>
                                                        <option value="Yç«¯å­">Yç«¯å­</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.controlDC}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    controlDC: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">åˆ¶å¾¡DC</option>
                                                        <option value="ä¸¸ç«¯å­">ä¸¸ç«¯å­</option>
                                                        <option value="Yç«¯å­">Yç«¯å­</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.simultaneousCrimp}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    simultaneousCrimp: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">åŒæ™‚åœ§ç€</option>
                                                        <option value="å¯ï¼ˆå…¨ã¦ï¼‰">å¯ï¼ˆå…¨ã¦ï¼‰</option>
                                                        <option value="å¯ï¼ˆå‹•åŠ›ã®ã¿ï¼‰">å¯ï¼ˆå‹•åŠ›ã®ã¿ï¼‰</option>
                                                        <option value="å¯ï¼ˆã‚¢ãƒ¼ã‚¹ã®ã¿ï¼‰">å¯ï¼ˆã‚¢ãƒ¼ã‚¹ã®ã¿ï¼‰</option>
                                                        <option value="ä¸å¯">ä¸å¯</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.screwClamp}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    screwClamp: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">ã­ã˜å¼ã‚¯ãƒ©ãƒ³ãƒ—ç«¯å­å°ã¸ã®é…ç·š</option>
                                                        <option value="ãƒ–ãƒ¬ãƒ¼ãƒ‰">ãƒ–ãƒ¬ãƒ¼ãƒ‰</option>
                                                        <option value="æ£’">æ£’</option>
                                                        <option value="ãƒ•ã‚§ãƒ«ãƒ¼ãƒ«">ãƒ•ã‚§ãƒ«ãƒ¼ãƒ«</option>
                                                        <option value="è£¸é…ç·šå¯èƒ½">è£¸é…ç·šå¯èƒ½</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminal.screwlessClamp}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    screwlessClamp: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">ã‚¹ã‚¯ãƒªãƒ¥ãƒ¼ãƒ¬ã‚¹ç«¯å­å°ã¸ã®é…ç·š</option>
                                                        <option value="ãƒ–ãƒ¬ãƒ¼ãƒ‰">ãƒ–ãƒ¬ãƒ¼ãƒ‰</option>
                                                        <option value="æ£’">æ£’</option>
                                                        <option value="ãƒ•ã‚§ãƒ«ãƒ¼ãƒ«">ãƒ•ã‚§ãƒ«ãƒ¼ãƒ«</option>
                                                        <option value="è£¸é…ç·šå¯èƒ½">è£¸é…ç·šå¯èƒ½</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* å‚™è€ƒ */}
                                        <div className="mb-1.5">

                                            <textarea
                                                value={newWiring.specifications.terminal.remarks || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        terminal: {
                                                            ...newWiring.specifications.terminal,
                                                            remarks: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                            />
                                        </div>

                                        {/* ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®šï¼ˆç«¯å­ï¼‰ */}
                                        <div className="mt-1.5">
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                            <div className="flex items-center gap-6 mb-2">
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="terminalManufacturer"
                                                        checked={!newWiring.specifications.terminal.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    manufacturerSpecified: false,
                                                                    manufacturer: ''
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">ç„¡ã—</span>
                                                </label>
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="terminalManufacturer"
                                                        checked={newWiring.specifications.terminal.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminal: {
                                                                    ...newWiring.specifications.terminal,
                                                                    manufacturerSpecified: true
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">æœ‰ã‚Š</span>
                                                </label>
                                            </div>
                                            {newWiring.specifications.terminal.manufacturerSpecified && (
                                                <input
                                                    type="text"
                                                    placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼åã‚’å…¥åŠ›"
                                                    value={newWiring.specifications.terminal.manufacturer}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            terminal: {
                                                                ...newWiring.specifications.terminal,
                                                                manufacturer: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs mb-1.5"
                                                />
                                            )}
                                        </div>
                                    </div>

                                    {/* ç«¯å­å°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">ç«¯å­å°</h4>

                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-2">
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminalBlock.namePlate}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminalBlock: {
                                                                    ...newWiring.specifications.terminalBlock,
                                                                    namePlate: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">è¨˜åæ¿</option>
                                                        <option value="æœ‰ã‚Š">æœ‰ã‚Š</option>
                                                        <option value="ç„¡ã—">ç„¡ã—</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminalBlock.cover}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminalBlock: {
                                                                    ...newWiring.specifications.terminalBlock,
                                                                    cover: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">ã‚«ãƒãƒ¼</option>
                                                        <option value="æœ‰ã‚Š">æœ‰ã‚Š</option>
                                                        <option value="ç„¡ã—">ç„¡ã—</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.terminalBlock.bridge}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    terminalBlock: {
                                                                        ...newWiring.specifications.terminalBlock,
                                                                        bridge: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">æ¸¡ã‚Šé‡‘å…·</option>
                                                            <option value="ä½¿ç”¨å¯ï¼ˆæŒ‡å®šç„¡ã—ï¼‰">ä½¿ç”¨å¯ï¼ˆæŒ‡å®šç„¡ã—ï¼‰</option>
                                                            <option value="ä½¿ç”¨å¯ï¼ˆæŒ‡å®šæœ‰ã‚Šï¼‰">ä½¿ç”¨å¯ï¼ˆæŒ‡å®šæœ‰ã‚Šï¼‰</option>
                                                            <option value="ä½¿ç”¨ä¸å¯">ä½¿ç”¨ä¸å¯</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.terminalBlock.bridge === 'ä½¿ç”¨å¯ï¼ˆæŒ‡å®šæœ‰ã‚Šï¼‰' && (
                                                        <input
                                                            type="text"
                                                            placeholder="æ¸¡ã‚Šé‡‘å…·ã®ä»•æ§˜ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.terminalBlock.bridgeSpec || ''}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    terminalBlock: {
                                                                        ...newWiring.specifications.terminalBlock,
                                                                        bridgeSpec: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>
                                            <div>

                                                <div className="custom-select-container">
                                                    <select
                                                        value={newWiring.specifications.terminalBlock.maxWires}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminalBlock: {
                                                                    ...newWiring.specifications.terminalBlock,
                                                                    maxWires: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">é…ç·šå¯èƒ½æ•°</option>
                                                        <option value="1æœ¬ã¾ã§">1æœ¬ã¾ã§</option>
                                                        <option value="2æœ¬ã¾ã§">2æœ¬ã¾ã§</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* å‚™è€ƒ */}
                                        <div className="mb-1.5">
                                            <textarea
                                                value={newWiring.specifications.terminalBlock.remarks || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        terminalBlock: {
                                                            ...newWiring.specifications.terminalBlock,
                                                            remarks: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                            />
                                        </div>

                                        {/* ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š */}
                                        <div>
                                            <h5 className="mobile-text-sm font-bold text-white mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                            <div className="flex items-center gap-6 mb-2">
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="terminalBlockManufacturer"
                                                        checked={!newWiring.specifications.terminalBlock.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminalBlock: {
                                                                    ...newWiring.specifications.terminalBlock,
                                                                    manufacturerSpecified: false,
                                                                    manufacturer: ''
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">ç„¡ã—</span>
                                                </label>
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="terminalBlockManufacturer"
                                                        checked={newWiring.specifications.terminalBlock.manufacturerSpecified}
                                                        onChange={() => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                terminalBlock: {
                                                                    ...newWiring.specifications.terminalBlock,
                                                                    manufacturerSpecified: true
                                                                }
                                                            }
                                                        })}
                                                    />
                                                    <span className="text-gray-300 mobile-text-sm">æœ‰ã‚Š</span>
                                                </label>
                                            </div>
                                            {newWiring.specifications.terminalBlock.manufacturerSpecified && (
                                                <input
                                                    type="text"
                                                    placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼åã‚’å…¥åŠ›"
                                                    value={newWiring.specifications.terminalBlock.manufacturer}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            terminalBlock: {
                                                                ...newWiring.specifications.terminalBlock,
                                                                manufacturer: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs mb-1.5"
                                                />
                                            )}
                                        </div>
                                    </div>

                                    {/* è¨˜åæ¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">è¨˜åæ¿</h4>
                                        <div>

                                            <div className="flex gap-2 items-center">
                                                <div className="custom-select-container flex-1">
                                                    <select
                                                        value={newWiring.specifications.namePlate.fontSize}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                namePlate: {
                                                                    ...newWiring.specifications.namePlate,
                                                                    fontSize: e.target.value,
                                                                    customFontSize: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.namePlate.customFontSize
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">æ–‡å­—ã‚µã‚¤ã‚º</option>
                                                        <option value="2mmåŠ">2mmåŠ</option>
                                                        <option value="2mmå…¨">2mmå…¨</option>
                                                        <option value="3mmåŠ">3mmåŠ</option>
                                                        <option value="3mmå…¨">3mmå…¨</option>
                                                        <option value="4mmåŠ">4mmåŠ</option>
                                                        <option value="4mmå…¨">4mmå…¨</option>
                                                        <option value="5mmåŠ">5mmåŠ</option>
                                                        <option value="5mmå…¨">5mmå…¨</option>
                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                                {newWiring.specifications.namePlate.fontSize === 'ãã®ä»–' && (
                                                    <input
                                                        type="text"
                                                        placeholder="ã‚µã‚¤ã‚ºã‚’å…¥åŠ›"
                                                        value={newWiring.specifications.namePlate.customFontSize}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                namePlate: {
                                                                    ...newWiring.specifications.namePlate,
                                                                    customFontSize: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                    />
                                                )}
                                            </div>

                                        </div>
                                        {/* å‚™è€ƒ */}
                                        <div className="mt-2">

                                            <textarea
                                                value={newWiring.specifications.namePlate.remarks || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        namePlate: {
                                                            ...newWiring.specifications.namePlate,
                                                            remarks: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                            />
                                        </div>
                                    </div>

                                    {/* ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«</h4>

                                        <div className="space-y-2">
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.deviceSeal.fontSize}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    deviceSeal: {
                                                                        ...newWiring.specifications.deviceSeal,
                                                                        fontSize: e.target.value,
                                                                        customFontSize: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.deviceSeal.customFontSize
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">æ–‡å­—ã‚µã‚¤ã‚º</option>
                                                            <option value="2mmåŠ">2mmåŠ</option>
                                                            <option value="2mmå…¨">2mmå…¨</option>
                                                            <option value="3mmåŠ">3mmåŠ</option>
                                                            <option value="3mmå…¨">3mmå…¨</option>
                                                            <option value="4mmåŠ">4mmåŠ</option>
                                                            <option value="4mmå…¨">4mmå…¨</option>
                                                            <option value="5mmåŠ">5mmåŠ</option>
                                                            <option value="5mmå…¨">5mmå…¨</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.deviceSeal.fontSize === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="ã‚µã‚¤ã‚ºã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.deviceSeal.customFontSize}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    deviceSeal: {
                                                                        ...newWiring.specifications.deviceSeal,
                                                                        customFontSize: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.deviceSeal.length}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    deviceSeal: {
                                                                        ...newWiring.specifications.deviceSeal,
                                                                        length: e.target.value,
                                                                        customLength: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.deviceSeal.customLength
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">é•·ã•</option>
                                                            <option value="è‡ªå‹•">è‡ªå‹•</option>
                                                            <option value="10mm">10mm</option>
                                                            <option value="15mm">15mm</option>
                                                            <option value="20mm">20mm</option>
                                                            <option value="25mm">25mm</option>
                                                            <option value="30mm">30mm</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.deviceSeal.length === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="é•·ã•ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.deviceSeal.customLength}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    deviceSeal: {
                                                                        ...newWiring.specifications.deviceSeal,
                                                                        customLength: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            <div>

                                                <div className="flex flex-wrap gap-4 mb-2 text-xs">
                                                    {['æ¿é‡‘', 'ãƒ€ã‚¯ãƒˆè“‹', 'éƒ¨å“'].map(position => (
                                                        <label key={position} className="flex items-center gap-2 cursor-pointer">
                                                            <input
                                                                type="checkbox"
                                                                checked={newWiring.specifications.deviceSeal.positions.includes(position)}
                                                                onChange={(e) => {
                                                                    const positions = e.target.checked
                                                                        ? [...newWiring.specifications.deviceSeal.positions, position]
                                                                        : newWiring.specifications.deviceSeal.positions.filter(p => p !== position);
                                                                    setNewWiring({
                                                                        ...newWiring,
                                                                        specifications: {
                                                                            ...newWiring.specifications,
                                                                            deviceSeal: {
                                                                                ...newWiring.specifications.deviceSeal,
                                                                                positions
                                                                            }
                                                                        }
                                                                    });
                                                                }}
                                                            />
                                                            <span className="text-gray-300">{position}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                                <input
                                                    type="text"
                                                    placeholder="ãã®ä»–ã®ä½ç½®ï¼ˆä»»æ„ï¼‰"
                                                    value={newWiring.specifications.deviceSeal.customPosition}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            deviceSeal: {
                                                                ...newWiring.specifications.deviceSeal,
                                                                customPosition: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs"
                                                />
                                            </div>
                                            {/* å‚™è€ƒ */}
                                            <div className="mt-2">

                                                <textarea
                                                    value={newWiring.specifications.deviceSeal.remarks || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            deviceSeal: {
                                                                ...newWiring.specifications.deviceSeal,
                                                                remarks: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ–</h4>

                                        {/* å‘ã */}
                                        <div className="mb-2">

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                                {[
                                                    { key: 'up', label: 'ä¸Š' },
                                                    { key: 'down', label: 'ä¸‹' },
                                                    { key: 'left', label: 'å·¦' },
                                                    { key: 'right', label: 'å³' }
                                                ].map(direction => (
                                                    <div key={direction.key}>

                                                        <div className="custom-select-container">
                                                            <select
                                                                value={newWiring.specifications.markTube.orientation[direction.key]}
                                                                onChange={(e) => setNewWiring({
                                                                    ...newWiring,
                                                                    specifications: {
                                                                        ...newWiring.specifications,
                                                                        markTube: {
                                                                            ...newWiring.specifications.markTube,
                                                                            orientation: {
                                                                                ...newWiring.specifications.markTube.orientation,
                                                                                [direction.key]: e.target.value
                                                                            }
                                                                        }
                                                                    }
                                                                })}
                                                                className="custom-select text-xs"
                                                            >
                                                                <option value="">å‘ã:{direction.label}</option>
                                                                <option value="æ­£å‘ã">æ­£å‘ã</option>
                                                                <option value="é€†å‘ã">é€†å‘ã</option>
                                                            </select>
                                                            <div className="custom-select-arrow"></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* æ–‡å­—ã‚µã‚¤ã‚º */}
                                        <div className="mb-2">

                                            <div className="flex gap-2 items-center">
                                                <div className="custom-select-container flex-1">
                                                    <select
                                                        value={newWiring.specifications.markTube.fontSize}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    fontSize: e.target.value,
                                                                    customFontSize: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.markTube.customFontSize
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">æ–‡å­—ã‚µã‚¤ã‚º</option>
                                                        <option value="2mmåŠ">2mmåŠ</option>
                                                        <option value="2mmå…¨">2mmå…¨</option>
                                                        <option value="3mmåŠ">3mmåŠ</option>
                                                        <option value="3mmå…¨">3mmå…¨</option>
                                                        <option value="4mmåŠ">4mmåŠ</option>
                                                        <option value="4mmå…¨">4mmå…¨</option>
                                                        <option value="5mmåŠ">5mmåŠ</option>
                                                        <option value="5mmå…¨">5mmå…¨</option>
                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                                {newWiring.specifications.markTube.fontSize === 'ãã®ä»–' && (
                                                    <input
                                                        type="text"
                                                        placeholder="ã‚µã‚¤ã‚ºã‚’å…¥åŠ›"
                                                        value={newWiring.specifications.markTube.customFontSize}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    customFontSize: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="w-40 md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs"
                                                    />
                                                )}
                                            </div>
                                        </div>

                                        {/* é•·ã• */}
                                        <div className="mb-2">

                                            <div className="flex gap-2 items-center">
                                                <div className="custom-select-container flex-1">
                                                    <select
                                                        value={newWiring.specifications.markTube.length}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    length: e.target.value,
                                                                    customLength: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.markTube.customLength
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">é•·ã•</option>
                                                        <option value="è‡ªå‹•">è‡ªå‹•</option>
                                                        <option value="10mm">10mm</option>
                                                        <option value="15mm">15mm</option>
                                                        <option value="20mm">20mm</option>
                                                        <option value="25mm">25mm</option>
                                                        <option value="30mm">30mm</option>
                                                        <option value="ãã®ä»–">ãã®ä»–</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                                {newWiring.specifications.markTube.length === 'ãã®ä»–' && (
                                                    <input
                                                        type="text"
                                                        placeholder="é•·ã•ã‚’å…¥åŠ›"
                                                        value={newWiring.specifications.markTube.customLength}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    customLength: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="w-40 md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs"
                                                    />
                                                )}
                                            </div>
                                        </div>

                                        {/* å°å­—ä»•æ§˜ */}
                                        <div>

                                            <div className="flex gap-2 items-center">
                                                <div className="custom-select-container flex-1">
                                                    <select
                                                        value={newWiring.specifications.markTube.printSpec}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    printSpec: e.target.value,
                                                                    printSpecDetail: e.target.value !== 'æœ‰ã‚Š' ? '' : newWiring.specifications.markTube.printSpecDetail
                                                                }
                                                            }
                                                        })}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="">å°å­—ä»•æ§˜</option>
                                                        <option value="ç„¡ã—">ç„¡ã—</option>
                                                        <option value="æœ‰ã‚Š">æœ‰ã‚Š</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                                {newWiring.specifications.markTube.printSpec === 'æœ‰ã‚Š' && (
                                                    <input
                                                        type="text"
                                                        placeholder="å°å­—ä»•æ§˜ã‚’å…¥åŠ›"
                                                        value={newWiring.specifications.markTube.printSpecDetail}
                                                        onChange={(e) => setNewWiring({
                                                            ...newWiring,
                                                            specifications: {
                                                                ...newWiring.specifications,
                                                                markTube: {
                                                                    ...newWiring.specifications.markTube,
                                                                    printSpecDetail: e.target.value
                                                                }
                                                            }
                                                        })}
                                                        className="w-40 md:w-1/2 dark-input rounded-xl px-4 py-3 text-xs"
                                                    />
                                                )}
                                            </div>
                                        </div>
                                        {/* å‚™è€ƒ */}
                                        <div className="mt-2">

                                            <textarea
                                                value={newWiring.specifications.markTube.remarks || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        markTube: {
                                                            ...newWiring.specifications.markTube,
                                                            remarks: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                            />
                                        </div>
                                    </div>

                                    {/* ãã®ä»–ç¢ºèªäº‹é …ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                    <div className="glass-card-dark p-3 rounded-xl mb-3" style={{ paddingBottom: '4px' }}>
                                        <h4 className="mobile-text-sm font-bold text-white mb-3">ãã®ä»–ç¢ºèªäº‹é …</h4>

                                        <div className="space-y-2">
                                            {/* å¢—ã—ç· ã‚ãƒšãƒ³ */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.tighteningPen}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        tighteningPen: e.target.value,
                                                                        tighteningPenDetail: e.target.value !== 'æœ‰ã‚Š' ? '' : newWiring.specifications.otherConfirm.tighteningPenDetail
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">å¢—ã—ç· ã‚ãƒšãƒ³</option>
                                                            <option value="æœ‰ã‚Š">æœ‰ã‚Š</option>
                                                            <option value="ç„¡ã—">ç„¡ã—</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.tighteningPen === 'æœ‰ã‚Š' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è©³ç´°ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.tighteningPenDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        tighteningPenDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* åˆãƒãƒ¼ã‚¯ */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.matchMark}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        matchMark: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">åˆãƒãƒ¼ã‚¯</option>
                                                            <option value="æ•°å­—">æ•°å­—</option>
                                                            <option value="ãƒ­ãƒ¼ãƒå­—">ãƒ­ãƒ¼ãƒå­—</option>
                                                            <option value="ç„¡ã—">ç„¡ã—</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>  // â† è¿½åŠ 
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.matchMark === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è©³ç´°ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.matchMarkDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        matchMarkDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* ãƒã‚¸ */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.screw}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        screw: e.target.value,
                                                                        screwDetail: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.otherConfirm.screwDetail
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">ãƒã‚¸</option>
                                                            <option value="ä¸‰ä¾¡ãƒ›ãƒ¯ã‚¤ãƒˆ">ä¸‰ä¾¡ãƒ›ãƒ¯ã‚¤ãƒˆ</option>
                                                            <option value="ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹">ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.screw === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="ãƒã‚¸ã®ç¨®é¡ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.screwDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        screwDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* ãƒ›ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒ– */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.hookTube}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        hookTube: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">ãƒ›ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒ–</option>
                                                            <option value="ã‚°ãƒ¬ãƒ¼">ã‚°ãƒ¬ãƒ¼</option>
                                                            <option value="é»’">é»’</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>  // â† è¿½åŠ 
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.hookTube === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.hookTubeDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        hookTubeDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒãƒ¥ãƒ¼ãƒ– */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.spiralTube}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        spiralTube: e.target.value,
                                                                        spiralTubeDetail: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.otherConfirm.spiralTubeDetail
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒãƒ¥ãƒ¼ãƒ–</option>
                                                            <option value="ç™½">ç™½</option>
                                                            <option value="é»’">é»’</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.spiralTube === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.spiralTubeDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        spiralTubeDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* ã‚¤ãƒ³ã‚·ãƒ¥ãƒ­ãƒƒã‚¯ */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.insulock}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        insulock: e.target.value,
                                                                        insulockDetail: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.otherConfirm.insulockDetail
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">ã‚¤ãƒ³ã‚·ãƒ¥ãƒ­ãƒƒã‚¯</option>
                                                            <option value="ç™½">ç™½</option>
                                                            <option value="é»’">é»’</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.insulock === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.insulockDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        insulockDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* ãƒã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ */}
                                            <div>

                                                <div className="flex gap-2 items-center">
                                                    <div className="custom-select-container flex-1">
                                                        <select
                                                            value={newWiring.specifications.otherConfirm.mountBase}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        mountBase: e.target.value,
                                                                        mountBaseDetail: e.target.value !== 'ãã®ä»–' ? '' : newWiring.specifications.otherConfirm.mountBaseDetail
                                                                    }
                                                                }
                                                            })}
                                                            className="custom-select text-xs"
                                                        >
                                                            <option value="">ãƒã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹</option>
                                                            <option value="ç™½">ç™½</option>
                                                            <option value="é»’">é»’</option>
                                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                    {newWiring.specifications.otherConfirm.mountBase === 'ãã®ä»–' && (
                                                        <input
                                                            type="text"
                                                            placeholder="è‰²ã‚’å…¥åŠ›"
                                                            value={newWiring.specifications.otherConfirm.mountBaseDetail}
                                                            onChange={(e) => setNewWiring({
                                                                ...newWiring,
                                                                specifications: {
                                                                    ...newWiring.specifications,
                                                                    otherConfirm: {
                                                                        ...newWiring.specifications.otherConfirm,
                                                                        mountBaseDetail: e.target.value
                                                                    }
                                                                }
                                                            })}
                                                            className="w-40 dark-input rounded-xl px-4 py-3 text-xs"
                                                        />
                                                    )}
                                                </div>
                                            </div>

                                            {/* é…ç·šãƒ«ãƒ¼ãƒˆã«é–¢ã—ã¦ã®ç‰¹è¨˜äº‹é … */}
                                            <div>

                                                <textarea
                                                    value={newWiring.specifications.otherConfirm.routeSpecialNote || ''}
                                                    onChange={(e) => setNewWiring({
                                                        ...newWiring,
                                                        specifications: {
                                                            ...newWiring.specifications,
                                                            otherConfirm: {
                                                                ...newWiring.specifications.otherConfirm,
                                                                routeSpecialNote: e.target.value
                                                            }
                                                        }
                                                    })}
                                                    className="w-full dark-input rounded-xl px-4 py-3 text-xs focus:outline-none"
                                                    rows={2}
                                                    placeholder="é…ç·šãƒ«ãƒ¼ãƒˆã«é–¢ã™ã‚‹ç‰¹è¨˜äº‹é …ã‚’å…¥åŠ›"
                                                />
                                            </div>
                                        </div>
                                        {/* å‚™è€ƒ */}
                                        <div className="mt-0.5">

                                            <textarea
                                                value={newWiring.specifications.otherConfirm.remarks || ''}
                                                onChange={(e) => setNewWiring({
                                                    ...newWiring,
                                                    specifications: {
                                                        ...newWiring.specifications,
                                                        otherConfirm: {
                                                            ...newWiring.specifications.otherConfirm,
                                                            remarks: e.target.value
                                                        }
                                                    }
                                                })}
                                                className="w-full dark-input rounded-xl px-4 py-3 text-xs"
                                                rows={2}
                                                placeholder="å‚™è€ƒã‚’å…¥åŠ›"
                                            />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 gap-2 mb-1.5 mt-6">
                                        <button
                                            onClick={saveWiringTemplate}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            {editingWiring ? 'æ›´æ–°' : 'ä¿å­˜'}
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowWiringForm(false);
                                                setEditingWiring(null);
                                                resetWiringForm();
                                            }}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚¿ãƒ– */}
                        {activeTab === 'tasks' && (
                            <div className="space-y-6 md:space-y-8">
                                <div className="flex flex-row justify-between items-center gap-3 sm:gap-0">
                                    <h2 className="text-lg md:text-2xl font-bold text-white neon-text" style={{ margin: '1px 0' }}>
                                        æ¡ˆä»¶ç®¡ç†
                                    </h2>
                                    {isAdmin && (
                                        <button
                                            onClick={() => setShowNewProjectForm(true)}
                                            className="flex items-center justify-center text-white font-normal transition-all duration-300 gradient-button hover:shadow-lg w-7 h-7 rounded-full flex-shrink-0"
                                        >
                                            ï¼‹
                                        </button>
                                    )}
                                </div>

                                <div className="glass-card mobile-compact-card rounded-2xl">
                                    <div className="space-y-2">
                                        {/* æ¤œç´¢ãƒãƒ¼ */}
                                        <div className="w-full">
                                            <input
                                                type="text"
                                                placeholder="æ¡ˆä»¶åãƒ»ä¼šç¤¾åã§æ¤œç´¢..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-xs"
                                            />
                                        </div>

                                        {/* ä¸¦ã³æ›¿ãˆã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæ¨ªä¸¦ã³ï¼‰ */}
                                        <div className="flex gap-2">
                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={sortOption}
                                                        onChange={(e) => setSortOption(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="created-desc">ä½œæˆé †ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                                                        <option value="created-asc">ä½œæˆé †ï¼ˆå¤ã„é †ï¼‰</option>
                                                        <option value="deadline-asc">ç· åˆ‡é †ï¼ˆè¿‘ã„é †ï¼‰</option>
                                                        <option value="deadline-desc">ç· åˆ‡é †ï¼ˆé ã„é †ï¼‰</option>
                                                        <option value="progress-desc">é€²æ—é †ï¼ˆé«˜ã„é †ï¼‰</option>
                                                        <option value="progress-asc">é€²æ—é †ï¼ˆä½ã„é †ï¼‰</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={statusFilter}
                                                        onChange={(e) => setStatusFilter(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="all">å…¨ã¦ ({filteredProjects.length})</option>
                                                        <option value="active">é€²è¡Œä¸­ ({filteredProjects.filter(p => p.status === 'é€²è¡Œä¸­').length})</option>
                                                        <option value="completed">å®Œäº† ({filteredProjects.filter(p => p.status === 'å®Œäº†').length})</option>
                                                        <option value="favorite">ãŠæ°—ã«å…¥ã‚Š ({filteredProjects.filter(p => isFavorite(p.id)).length})</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ¼ãƒ  */}
                                {showNewProjectForm && (
                                    <div className="modal-overlay" onClick={() => {
                                        resetNewProjectForm();
                                        setShowNewProjectForm(false);
                                    }}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-2xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">æ–°è¦æ¡ˆä»¶ä½œæˆ</h3>
                                            </div>

                                            <div className="grid grid-cols-1 gap-3 mb-3">
                                                <input
                                                    type="text"
                                                    placeholder="æ¡ˆä»¶å"
                                                    value={newProject.name}
                                                    onChange={(e) => setNewProject({ ...newProject, name: e.target.value })}
                                                    className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                />
                                                {companyInputMode === 'select' ? (
                                                    <div className="custom-select-container">
                                                        <select
                                                            value={newProject.company}
                                                            onChange={(e) => {
                                                                if (e.target.value === '__manual__') {
                                                                    setCompanyInputMode('manual');
                                                                    setNewProject({ ...newProject, company: '' });
                                                                } else {
                                                                    setNewProject({ ...newProject, company: e.target.value });
                                                                }
                                                            }}
                                                            className="custom-select text-sm"
                                                        >
                                                            <option value="">ä¼šç¤¾ã‚’é¸æŠ...</option>
                                                            {companies.map(company => (
                                                                <option key={company.id} value={company.name}>
                                                                    {company.name}
                                                                </option>
                                                            ))}
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                ) : (
                                                    <input
                                                        type="text"
                                                        placeholder="ä¼šç¤¾åã‚’å…¥åŠ›"
                                                        value={newProject.company}
                                                        onChange={(e) => {
                                                            setNewProject({ ...newProject, company: e.target.value });
                                                            if (e.target.value === '') {
                                                                setCompanyInputMode('select');
                                                            }
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                    />
                                                )}
                                            </div>

                                            {/* æ—¥ä»˜ã¨é‡‘é¡ã®å…¥åŠ›æ¬„ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œç‰ˆ */}
                                            <div className="grid grid-cols-1 gap-3 mb-3">
                                                {/* é–‹å§‹æ—¥ */}
                                                <div className="relative w-full">
                                                    <input
                                                        type="date"
                                                        value={newProject.startDate}
                                                        onChange={(e) =>
                                                            setNewProject({ ...newProject, startDate: e.target.value })
                                                        }
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        style={{
                                                            WebkitAppearance: 'none',
                                                            MozAppearance: 'none',
                                                            appearance: 'none',
                                                            minHeight: '44px'
                                                        }}
                                                    />
                                                    {!newProject.startDate && (
                                                        <span
                                                            className="absolute inset-y-0 left-4 flex items-center text-sm pointer-events-none"
                                                            style={{ color: 'rgba(255, 255, 255, 0.5)' }}
                                                        >
                                                            é–‹å§‹æ—¥
                                                        </span>
                                                    )}
                                                    {newProject.startDate && (
                                                        <button
                                                            type="button"
                                                            onClick={() => setNewProject({ ...newProject, startDate: '' })}
                                                            className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white text-lg"
                                                            title="æ—¥ä»˜ã‚’ã‚¯ãƒªã‚¢"
                                                        >
                                                            âœ•
                                                        </button>
                                                    )}
                                                </div>

                                                {/* ç· åˆ‡æ—¥ */}
                                                <div className="relative w-full">
                                                    <input
                                                        type="date"
                                                        value={newProject.deadline}
                                                        onChange={(e) =>
                                                            setNewProject({ ...newProject, deadline: e.target.value })
                                                        }
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        style={{
                                                            WebkitAppearance: 'none',
                                                            MozAppearance: 'none',
                                                            appearance: 'none',
                                                            minHeight: '44px'
                                                        }}
                                                    />
                                                    {!newProject.deadline && (
                                                        <span
                                                            className="absolute inset-y-0 left-4 flex items-center text-sm pointer-events-none"
                                                            style={{ color: 'rgba(255, 255, 255, 0.5)' }}
                                                        >
                                                            ç· åˆ‡æ—¥
                                                        </span>

                                                    )}
                                                    {newProject.deadline && (
                                                        <button
                                                            type="button"
                                                            onClick={() => setNewProject({ ...newProject, deadline: '' })}
                                                            className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white text-lg"
                                                            title="æ—¥ä»˜ã‚’ã‚¯ãƒªã‚¢"
                                                        >
                                                            âœ•
                                                        </button>
                                                    )}
                                                </div>

                                                {/* åŠ´å‹™è²» */}
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="numeric"
                                                        pattern="[0-9]*"
                                                        placeholder="åŠ´å‹™è²»ï¼ˆå††ï¼‰"
                                                        value={newProject.laborCost || ''}
                                                        onChange={(e) => {
                                                            const laborCost = e.target.value;
                                                            const materialCost = parseFloat(newProject.materialCost) || 0;
                                                            const totalAmount = (parseFloat(laborCost) || 0) + materialCost;
                                                            setNewProject({
                                                                ...newProject,
                                                                laborCost: laborCost,
                                                                amount: totalAmount.toString()
                                                            });
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        step="1000"
                                                        style={{ minHeight: '44px' }}
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newProject.laborCost) || 0;
                                                                const materialCost = parseFloat(newProject.materialCost) || 0;
                                                                const newLaborCost = currentValue + 1000;
                                                                const totalAmount = newLaborCost + materialCost;
                                                                setNewProject({
                                                                    ...newProject,
                                                                    laborCost: newLaborCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newProject.laborCost) || 0;
                                                                const materialCost = parseFloat(newProject.materialCost) || 0;
                                                                const newLaborCost = Math.max(0, currentValue - 1000);
                                                                const totalAmount = newLaborCost + materialCost;
                                                                setNewProject({
                                                                    ...newProject,
                                                                    laborCost: newLaborCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                    </div>
                                                </div>

                                                {/* è³‡æè²» */}
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="numeric"
                                                        pattern="[0-9]*"
                                                        placeholder="è³‡æè²»ï¼ˆå††ï¼‰"
                                                        value={newProject.materialCost || ''}
                                                        onChange={(e) => {
                                                            const materialCost = e.target.value;
                                                            const laborCost = parseFloat(newProject.laborCost) || 0;
                                                            const totalAmount = laborCost + (parseFloat(materialCost) || 0);
                                                            setNewProject({
                                                                ...newProject,
                                                                materialCost: materialCost,
                                                                amount: totalAmount.toString()
                                                            });
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        step="1000"
                                                        style={{ minHeight: '44px' }}
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newProject.materialCost) || 0;
                                                                const laborCost = parseFloat(newProject.laborCost) || 0;
                                                                const newMaterialCost = currentValue + 1000;
                                                                const totalAmount = laborCost + newMaterialCost;
                                                                setNewProject({
                                                                    ...newProject,
                                                                    materialCost: newMaterialCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newProject.materialCost) || 0;
                                                                const laborCost = parseFloat(newProject.laborCost) || 0;
                                                                const newMaterialCost = Math.max(0, currentValue - 1000);
                                                                const totalAmount = laborCost + newMaterialCost;
                                                                setNewProject({
                                                                    ...newProject,
                                                                    materialCost: newMaterialCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={selectedTemplate ? selectedTemplate.id : ''}
                                                        onChange={(e) => {
                                                            const template = taskTemplates.find(t => t.id === e.target.value);
                                                            setSelectedTemplate(template || null);
                                                        }}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            if (!newProject.company) {
                                                                return <option disabled>ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„</option>;
                                                            }

                                                            const company = companies.find(c => c.name === newProject.company);
                                                            if (!company) {
                                                                return <option disabled>é¸æŠã•ã‚ŒãŸä¼šç¤¾ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const availableTemplates = taskTemplates.filter(template => template.companyId === company.id);

                                                            if (availableTemplates.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            return availableTemplates.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name} ï¼ˆ{template.tasks.length}å·¥ç¨‹ / {
                                                                        template.tasks.reduce((sum, t) => sum + (parseFloat(t.estimatedHours) || 0), 0)
                                                                    }æ™‚é–“ï¼‰
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            {/* é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={newProject.wiringTemplateId || ''}
                                                        onChange={(e) => setNewProject({ ...newProject, wiringTemplateId: e.target.value })}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            if (!newProject.company) {
                                                                return <option disabled>ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„</option>;
                                                            }

                                                            const company = companies.find(c => c.name === newProject.company);
                                                            if (!company) {
                                                                return <option disabled>é¸æŠã•ã‚ŒãŸä¼šç¤¾ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const availableWirings = wiringTemplates.filter(template => template.companyId === company.id);

                                                            if (availableWirings.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            return availableWirings.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name}
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <textarea
                                                placeholder="æ¡ˆä»¶èª¬æ˜"
                                                value={newProject.description}
                                                onChange={(e) => setNewProject({ ...newProject, description: e.target.value })}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none mb-2 text-sm"
                                                rows={3}
                                            />

                                            <div className="grid grid-cols-1 gap-2 mb-1.5 mt-2.5">
                                                <button
                                                    onClick={createProject}
                                                    className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                                >
                                                    ä½œæˆ
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        resetNewProjectForm(); // è¿½åŠ 
                                                        setShowNewProjectForm(false);
                                                    }}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* æ–°è¦ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒ  */}
                                {showNewTaskForm && (
                                    <div className="modal-overlay" onClick={() => setShowNewTaskForm(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">æ–°è¦å·¥ç¨‹ä½œæˆ</h3>
                                            </div>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                                                <input
                                                    type="text"
                                                    placeholder="å·¥ç¨‹å"
                                                    value={newTask.title}
                                                    onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}
                                                    className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                />
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="decimal"
                                                        pattern="[0-9]*[.,]?[0-9]*"
                                                        placeholder="äºˆæƒ³å·¥æ•°ï¼ˆæ™‚é–“ï¼‰"
                                                        value={newTask.estimatedHours}
                                                        onChange={(e) => setNewTask({ ...newTask, estimatedHours: e.target.value })}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                        step="0.5"
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newTask.estimatedHours) || 0;
                                                                setNewTask({ ...newTask, estimatedHours: (currentValue + 0.5).toString() });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(newTask.estimatedHours) || 0;
                                                                setNewTask({ ...newTask, estimatedHours: Math.max(0, currentValue - 0.5).toString() });
                                                            }}
                                                        />
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={newTask.checklistTemplateId || ''}
                                                        onChange={(e) => setNewTask({ ...newTask, checklistTemplateId: e.target.value })}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            if (!newTask.projectId) {
                                                                return <option disabled>æ¡ˆä»¶ã‚’é¸æŠã—ã¦ãã ã•ã„</option>;
                                                            }

                                                            const project = projects.find(p => String(p.id) === String(newTask.projectId));
                                                            if (!project) {
                                                                return <option disabled>æ¡ˆä»¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const company = companies.find(c => c.name === project.company);
                                                            if (!company) {
                                                                return <option disabled>ä¼šç¤¾æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const availableChecklists = checklistTemplates.filter(t => t.companyId === company.id);

                                                            if (availableChecklists.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            return availableChecklists.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name}
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <textarea
                                                placeholder="å·¥ç¨‹èª¬æ˜"
                                                value={newTask.description}
                                                onChange={(e) => setNewTask({ ...newTask, description: e.target.value })}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none mb-2 text-sm"
                                                rows={3}
                                            />
                                            <div className="grid grid-cols-1 gap-2 mb-1.5 mt-2.5">
                                                <button
                                                    onClick={createTask}
                                                    className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                                >
                                                    ä½œæˆ
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        resetNewTaskForm(); // è¿½åŠ 
                                                        setShowNewTaskForm(false);
                                                    }}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  */}
                                {showEditProjectForm && editProject && (
                                    <div className="modal-overlay" onClick={() => setShowEditProjectForm(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-2xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">æ¡ˆä»¶ç·¨é›†</h3>
                                            </div>

                                            {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ä¼šç¤¾å */}
                                            <div className="grid grid-cols-1 gap-3 mb-3">
                                                <input
                                                    type="text"
                                                    placeholder="æ¡ˆä»¶å"
                                                    value={editProject.name}
                                                    onChange={(e) => setEditProject({ ...editProject, name: e.target.value })}
                                                    className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                />
                                                {companyInputMode === 'select' ? (
                                                    <div className="custom-select-container">
                                                        <select
                                                            value={editProject.company || ''}
                                                            onChange={(e) => {
                                                                if (e.target.value === '__manual__') {
                                                                    setCompanyInputMode('manual');
                                                                } else {
                                                                    setEditProject({ ...editProject, company: e.target.value });
                                                                }
                                                            }}
                                                            className="custom-select text-sm"
                                                        >
                                                            <option value="">ä¼šç¤¾ã‚’é¸æŠ...</option>
                                                            {companies.map(company => (
                                                                <option key={company.id} value={company.name}>
                                                                    {company.name}
                                                                </option>
                                                            ))}
                                                        </select>
                                                        <div className="custom-select-arrow"></div>
                                                    </div>
                                                ) : (
                                                    <input
                                                        type="text"
                                                        placeholder="ä¼šç¤¾åã‚’å…¥åŠ›"
                                                        value={editProject.company || ''}
                                                        onChange={(e) => {
                                                            setEditProject({ ...editProject, company: e.target.value });
                                                            if (e.target.value === '') {
                                                                setCompanyInputMode('select');
                                                            }
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                    />
                                                )}
                                            </div>

                                            {/* æ—¥ä»˜ã¨é‡‘é¡ã®å…¥åŠ›æ¬„ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œç‰ˆ */}
                                            <div className="grid grid-cols-1 gap-3 mb-3">
                                                {/* é–‹å§‹æ—¥ */}
                                                <div className="relative w-full">
                                                    <input
                                                        type="date"
                                                        value={editProject.startDate}
                                                        onChange={(e) =>
                                                            setEditProject({ ...editProject, startDate: e.target.value })
                                                        }
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        style={{
                                                            WebkitAppearance: 'none',
                                                            MozAppearance: 'none',
                                                            appearance: 'none',
                                                            minHeight: '44px'
                                                        }}
                                                    />
                                                    {!editProject.startDate && (
                                                        <span
                                                            className="absolute inset-y-0 left-4 flex items-center text-sm pointer-events-none"
                                                            style={{ color: 'rgba(255, 255, 255, 0.5)' }}
                                                        >
                                                            é–‹å§‹æ—¥
                                                        </span>

                                                    )}
                                                    {editProject.startDate && (
                                                        <button
                                                            type="button"
                                                            onClick={() => setEditProject({ ...editProject, startDate: '' })}
                                                            className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white text-lg"
                                                            title="æ—¥ä»˜ã‚’ã‚¯ãƒªã‚¢"
                                                        >
                                                            âœ•
                                                        </button>
                                                    )}
                                                </div>

                                                {/* ç· åˆ‡æ—¥ */}
                                                <div className="relative w-full">
                                                    <input
                                                        type="date"
                                                        value={editProject.deadline}
                                                        onChange={(e) =>
                                                            setEditProject({ ...editProject, deadline: e.target.value })
                                                        }
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        style={{
                                                            WebkitAppearance: 'none',
                                                            MozAppearance: 'none',
                                                            appearance: 'none',
                                                            minHeight: '44px'
                                                        }}
                                                    />
                                                    {!editProject.deadline && (
                                                        <span
                                                            className="absolute inset-y-0 left-4 flex items-center text-sm pointer-events-none"
                                                            style={{ color: 'rgba(255, 255, 255, 0.5)' }}
                                                        >
                                                            ç· åˆ‡æ—¥
                                                        </span>

                                                    )}
                                                    {editProject.deadline && (
                                                        <button
                                                            type="button"
                                                            onClick={() => setEditProject({ ...editProject, deadline: '' })}
                                                            className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white text-lg"
                                                            title="æ—¥ä»˜ã‚’ã‚¯ãƒªã‚¢"
                                                        >
                                                            âœ•
                                                        </button>
                                                    )}
                                                </div>

                                                {/* åŠ´å‹™è²» */}
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="numeric"
                                                        pattern="[0-9]*"
                                                        placeholder="åŠ´å‹™è²»ï¼ˆå††ï¼‰"
                                                        value={editProject.laborCost || ''}
                                                        onChange={(e) => {
                                                            const laborCost = e.target.value;
                                                            const materialCost = parseFloat(editProject.materialCost) || 0;
                                                            const totalAmount = (parseFloat(laborCost) || 0) + materialCost;
                                                            setEditProject({
                                                                ...editProject,
                                                                laborCost: laborCost,
                                                                amount: totalAmount.toString()
                                                            });
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        step="1000"
                                                        style={{ minHeight: '44px' }}
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editProject.laborCost) || 0;
                                                                const materialCost = parseFloat(editProject.materialCost) || 0;
                                                                const newLaborCost = currentValue + 1000;
                                                                const totalAmount = newLaborCost + materialCost;
                                                                setEditProject({
                                                                    ...editProject,
                                                                    laborCost: newLaborCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editProject.laborCost) || 0;
                                                                const materialCost = parseFloat(editProject.materialCost) || 0;
                                                                const newLaborCost = Math.max(0, currentValue - 1000);
                                                                const totalAmount = newLaborCost + materialCost;
                                                                setEditProject({
                                                                    ...editProject,
                                                                    laborCost: newLaborCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                    </div>
                                                </div>

                                                {/* è³‡æè²» */}
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="numeric"
                                                        pattern="[0-9]*"
                                                        placeholder="è³‡æè²»ï¼ˆå††ï¼‰"
                                                        value={editProject.materialCost || ''}
                                                        onChange={(e) => {
                                                            const materialCost = e.target.value;
                                                            const laborCost = parseFloat(editProject.laborCost) || 0;
                                                            const totalAmount = laborCost + (parseFloat(materialCost) || 0);
                                                            setEditProject({
                                                                ...editProject,
                                                                materialCost: materialCost,
                                                                amount: totalAmount.toString()
                                                            });
                                                        }}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm w-full"
                                                        step="1000"
                                                        style={{ minHeight: '44px' }}
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editProject.materialCost) || 0;
                                                                const laborCost = parseFloat(editProject.laborCost) || 0;
                                                                const newMaterialCost = currentValue + 1000;
                                                                const totalAmount = laborCost + newMaterialCost;
                                                                setEditProject({
                                                                    ...editProject,
                                                                    materialCost: newMaterialCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editProject.materialCost) || 0;
                                                                const laborCost = parseFloat(editProject.laborCost) || 0;
                                                                const newMaterialCost = Math.max(0, currentValue - 1000);
                                                                const totalAmount = laborCost + newMaterialCost;
                                                                setEditProject({
                                                                    ...editProject,
                                                                    materialCost: newMaterialCost.toString(),
                                                                    amount: totalAmount.toString()
                                                                });
                                                            }}
                                                        />
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ã‚¿ã‚¹ã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={selectedTemplate ? selectedTemplate.id : ''}
                                                        onChange={(e) => {
                                                            const template = taskTemplates.find(t => t.id === e.target.value);
                                                            setSelectedTemplate(template || null);
                                                        }}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            if (!editProject.company) {
                                                                return <option disabled>ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„</option>;
                                                            }
                                                            const company = companies.find(c => c.name === editProject.company);
                                                            if (!company) {
                                                                return <option disabled>é¸æŠã•ã‚ŒãŸä¼šç¤¾ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }
                                                            const availableTemplates = taskTemplates.filter(template => template.companyId === company.id);
                                                            if (availableTemplates.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }
                                                            return availableTemplates.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name} ï¼ˆ{template.tasks.length}å·¥ç¨‹ / {
                                                                        template.tasks.reduce((sum, t) => sum + (parseFloat(t.estimatedHours) || 0), 0)
                                                                    }æ™‚é–“ï¼‰
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            {/* é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={editProject.wiringTemplateId || ''}
                                                        onChange={(e) => setEditProject({ ...editProject, wiringTemplateId: e.target.value })}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            if (!editProject.company) {
                                                                return <option disabled>ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„</option>;
                                                            }
                                                            const company = companies.find(c => c.name === editProject.company);
                                                            if (!company) {
                                                                return <option disabled>é¸æŠã•ã‚ŒãŸä¼šç¤¾ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }
                                                            const availableWirings = wiringTemplates.filter(template => template.companyId === company.id);
                                                            if (availableWirings.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }
                                                            return availableWirings.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name}
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <textarea
                                                placeholder="æ¡ˆä»¶èª¬æ˜"
                                                value={editProject.description}
                                                onChange={(e) => setEditProject({ ...editProject, description: e.target.value })}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none mb-2 text-sm"
                                                rows={3}
                                            />

                                            <div className="grid grid-cols-1 gap-2 mb-1.5 mt-2.5">
                                                <button
                                                    onClick={updateProject}
                                                    className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                                >
                                                    æ›´æ–°
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setShowEditProjectForm(false);
                                                        setCompanyInputMode('select');
                                                    }}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ã‚¿ã‚¹ã‚¯ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  */}
                                {showEditTaskForm && editTask && (
                                    <div className="modal-overlay" onClick={() => setShowEditTaskForm(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">å·¥ç¨‹ç·¨é›†</h3>
                                            </div>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                                                <input
                                                    type="text"
                                                    placeholder="å·¥ç¨‹å"
                                                    value={editTask.title}
                                                    onChange={(e) => setEditTask({ ...editTask, title: e.target.value })}
                                                    className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                />
                                                <div className="number-input-container">
                                                    <input
                                                        type="number"
                                                        inputMode="decimal"
                                                        pattern="[0-9]*[.,]?[0-9]*"
                                                        placeholder="äºˆæƒ³å·¥æ•°ï¼ˆæ™‚é–“ï¼‰"
                                                        value={editTask.estimatedHours}
                                                        onChange={(e) => setEditTask({ ...editTask, estimatedHours: e.target.value })}
                                                        className="dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                        step="0.5"
                                                    />
                                                    <div className="custom-spin-buttons">
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-up"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editTask.estimatedHours) || 0;
                                                                setEditTask({ ...editTask, estimatedHours: (currentValue + 0.5).toString() });
                                                            }}
                                                        />
                                                        <button
                                                            type="button"
                                                            className="spin-button spin-button-down"
                                                            onClick={() => {
                                                                const currentValue = parseFloat(editTask.estimatedHours) || 0;
                                                                setEditTask({ ...editTask, estimatedHours: Math.max(0, currentValue - 0.5).toString() });
                                                            }}
                                                        />
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ */}
                                            <div className="mb-3">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={editTask.checklistTemplateId || ''}
                                                        onChange={(e) => setEditTask({ ...editTask, checklistTemplateId: e.target.value })}
                                                        className="custom-select text-sm"
                                                    >
                                                        <option value="">æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰...</option>
                                                        {(() => {
                                                            const project = projects.find(p => String(p.id) === String(editTask.projectId));
                                                            if (!project) {
                                                                return <option disabled>æ¡ˆä»¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const company = companies.find(c => c.name === project.company);
                                                            if (!company) {
                                                                return <option disabled>ä¼šç¤¾æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            const availableChecklists = checklistTemplates.filter(t => t.companyId === company.id);

                                                            if (availableChecklists.length === 0) {
                                                                return <option disabled>ã“ã®ä¼šç¤¾ã®æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</option>;
                                                            }

                                                            return availableChecklists.map(template => (
                                                                <option key={template.id} value={template.id}>
                                                                    {template.name}
                                                                </option>
                                                            ));
                                                        })()}
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>

                                            <textarea
                                                placeholder="å·¥ç¨‹èª¬æ˜"
                                                value={editTask.description}
                                                onChange={(e) => setEditTask({ ...editTask, description: e.target.value })}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none mb-2 text-sm"
                                                rows={3}
                                            />
                                            <div className="grid grid-cols-1 gap-2 mb-1.5 mt-2.5">
                                                <button
                                                    onClick={updateTask}
                                                    className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                                >
                                                    æ›´æ–°
                                                </button>
                                                <button
                                                    onClick={() => setShowEditTaskForm(false)}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* å·¥æ•°è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                                {showHoursDetail && detailTaskId && (
                                    <div className="modal-overlay" onClick={() => setShowHoursDetail(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-3xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">å·¥ç¨‹è©³ç´°</h3>
                                            </div>
                                            {(() => {
                                                const task = tasks.find(t => t.id === detailTaskId);
                                                const taskSessions = workSessions.filter(s => s.taskId === detailTaskId);

                                                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«å·¥æ•°ã‚’é›†è¨ˆ
                                                const userHoursMap = {};
                                                taskSessions.forEach(session => {
                                                    const userId = session.userId;
                                                    if (!userHoursMap[userId]) {
                                                        userHoursMap[userId] = {
                                                            userId: userId,
                                                            userName: session.userName,
                                                            totalHours: 0,
                                                            sessions: []
                                                        };
                                                    }
                                                    userHoursMap[userId].totalHours += (session.hours || session.totalHours || 0);
                                                    userHoursMap[userId].sessions.push(session);
                                                });

                                                // ãƒ¦ãƒ¼ã‚¶ãƒ¼é…åˆ—ã«å¤‰æ›ã—ã€å·¥æ•°ã®å¤šã„é †ã«ã‚½ãƒ¼ãƒˆ
                                                const userHoursList = Object.values(userHoursMap).sort((a, b) => b.totalHours - a.totalHours);
                                                const totalHours = userHoursList.reduce((sum, user) => sum + user.totalHours, 0);

                                                return (
                                                    <div>
                                                        <div className="mb-4">
                                                            <h4 className="mobile-text-sm font-bold text-white mb-2">{task?.title}</h4>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">ç·å®Ÿç¸¾å·¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{totalHours.toFixed(1)}h</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">äºˆæƒ³å·¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{task?.estimatedHours || 0}h</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">å‚åŠ è€…æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{userHoursList.length}äºº</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">ä½œæ¥­æ—¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">
                                                                        {new Set(taskSessions.map(s => s.date ? s.date.toDate().toDateString() : '')).size}æ—¥
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div className="space-y-3">
                                                            <h5 className="font-bold text-white mobile-text-sm">ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å·¥æ•°</h5>
                                                            {userHoursList.length > 0 ? (
                                                                userHoursList.map((userItem, index) => (
                                                                    <div key={userItem.userId} className="glass-card-dark mobile-compact-card rounded-xl">
                                                                        <div className="flex justify-between items-start mb-3">
                                                                            <div className="flex items-center gap-2">
                                                                                <div
                                                                                    className="user-icon user-icon-small"
                                                                                    style={{ background: getUserIconColor(userItem.userId) }}
                                                                                >
                                                                                    {(userItem.userName || 'U').charAt(0).toUpperCase()}
                                                                                </div>
                                                                                <div>
                                                                                    <p className="font-bold text-white mobile-text-sm">{userItem.userName}</p>
                                                                                    <p className="text-gray-400 mobile-text-xs">
                                                                                        {userItem.sessions.length}æ—¥é–“ã§ä½œæ¥­
                                                                                        {userItem.userId === user?.uid && (
                                                                                            <span className="text-blue-300 ml-1">ï¼ˆè‡ªåˆ†ï¼‰</span>
                                                                                        )}
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                            <div className="text-right">
                                                                                <p className="font-bold text-white mobile-text-sm">{userItem.totalHours.toFixed(1)}h</p>
                                                                                <p className="text-gray-400 mobile-text-xs">
                                                                                    å…¨ä½“ã®{totalHours > 0 ? ((userItem.totalHours / totalHours) * 100).toFixed(1) : '0'}%
                                                                                </p>
                                                                            </div>
                                                                        </div>

                                                                        {/* æ—¥åˆ¥ã®è©³ç´°ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ */}
                                                                        <details className="mt-3">
                                                                            <summary className="text-gray-400 mobile-text-xs cursor-pointer hover:text-gray-300 transition-colors">
                                                                                æ—¥åˆ¥ã®è©³ç´°ã‚’è¡¨ç¤º
                                                                            </summary>
                                                                            <div className="mt-2 space-y-1 pl-4">
                                                                                {(userItem.sessions || [])
                                                                                    .sort((a, b) => {
                                                                                        const dateA = a.date ? a.date.toDate() : new Date(0);
                                                                                        const dateB = b.date ? b.date.toDate() : new Date(0);
                                                                                        return dateB - dateA; // æ–°ã—ã„æ—¥ä»˜é †
                                                                                    })
                                                                                    .map((session, sessionIndex) => (
                                                                                        <div key={sessionIndex} className="flex justify-between items-center mobile-text-xs">
                                                                                            <span className="text-gray-300">
                                                                                                {session.date
                                                                                                    ? session.date.toDate().toLocaleDateString('ja-JP')
                                                                                                    : 'æ—¥ä»˜ä¸æ˜'}
                                                                                            </span>
                                                                                            <span className="text-white font-medium">
                                                                                                {(session.hours || session.totalHours || 0).toFixed(1)}h
                                                                                            </span>
                                                                                        </div>
                                                                                    ))
                                                                                }
                                                                            </div>
                                                                        </details>
                                                                    </div>
                                                                ))
                                                            ) : (
                                                                <div className="text-center text-gray-400 py-6">
                                                                    <p className="mobile-text-sm">ã¾ã å·¥æ•°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })()}

                                            {/* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */}
                                            <div className="mt-6 mb-1.5">
                                                <button
                                                    onClick={() => setShowHoursDetail(false)}
                                                    className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                >
                                                    é–‰ã˜ã‚‹
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                                {showProjectDetail && detailProjectId && (
                                    <div className="modal-overlay" onClick={() => setShowProjectDetail(false)}>
                                        <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-3xl mx-4" onClick={(e) => e.stopPropagation()}>
                                            <div className="mb-4">
                                                <h3 className="text-base font-bold text-white pt-2">æ¡ˆä»¶è©³ç´°</h3>
                                            </div>
                                            {(() => {
                                                const project = projects.find(p => p.id === detailProjectId);
                                                const projectTasks = tasks.filter(t => String(t.projectId) === String(detailProjectId));
                                                const stats = getProjectStats(detailProjectId);

                                                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®å·¥æ•°ã‚’é›†è¨ˆï¼ˆæ—¥ä»˜åˆ¥workSessionsã‹ã‚‰ï¼‰
                                                const userHours = {};
                                                workSessions
                                                    .filter(s => String(s.projectId) === String(detailProjectId))
                                                    .forEach(session => {
                                                        const userId = session.userId;
                                                        const userName = session.userName;
                                                        if (!userHours[userId]) {
                                                            userHours[userId] = {
                                                                userName: userName,
                                                                totalHours: 0,
                                                                taskCount: new Set(),
                                                                tasks: {},
                                                                sessions: []
                                                            };
                                                        }
                                                        userHours[userId].totalHours += (session.hours || session.totalHours || 0);
                                                        userHours[userId].taskCount.add(session.taskId);
                                                        userHours[userId].sessions.push(session);

                                                        // ã‚¿ã‚¹ã‚¯ã”ã¨ã®å·¥æ•°ã‚‚è¨˜éŒ²
                                                        if (!userHours[userId].tasks[session.taskId]) {
                                                            userHours[userId].tasks[session.taskId] = {
                                                                taskName: session.taskName,
                                                                hours: 0
                                                            };
                                                        }
                                                        userHours[userId].tasks[session.taskId].hours += (session.hours || session.totalHours || 0);
                                                    });

                                                const userHoursArray = Object.entries(userHours)
                                                    .map(([userId, data]) => ({
                                                        userId,
                                                        ...data,
                                                        taskCount: data.taskCount.size
                                                    }))
                                                    .sort((a, b) => b.totalHours - a.totalHours);

                                                return (
                                                    <div>
                                                        <div className="mb-4">
                                                            <h4 className="mobile-text-sm font-bold text-white mb-2">{project?.name}</h4>
                                                            {project?.company && (
                                                                <div className="mobile-text-xs text-purple-300 font-medium">
                                                                    {project.company}
                                                                </div>
                                                            )}
                                                            <div className="grid grid-cols-2 gap-2 mt-3">
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">ç·å·¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.totalActual.toFixed(1)}h</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">å·¥ç¨‹æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.totalTasks}</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">é€²æ—ç‡</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.progress.toFixed(1)}%</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">ä½œæ¥­è€…æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{userHoursArray.length}äºº</div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div className="space-y-3">
                                                            <h5 className="font-bold text-white mobile-text-sm">ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å·¥æ•°</h5>
                                                            {userHoursArray.length > 0 ? (
                                                                userHoursArray.map((userItem, index) => (
                                                                    <div key={userItem.userId} className="glass-card-dark mobile-compact-card rounded-xl">
                                                                        <div className="flex justify-between items-start mb-3">
                                                                            <div className="flex items-center gap-2">
                                                                                <div
                                                                                    className="user-icon user-icon-small"
                                                                                    style={{ background: getUserIconColor(userItem.userId) }}
                                                                                >
                                                                                    {(userItem.userName || 'U').charAt(0).toUpperCase()}
                                                                                </div>
                                                                                <div>
                                                                                    <p className="font-bold text-white mobile-text-sm">{userItem.userName}</p>
                                                                                    <p className="text-gray-400 mobile-text-xs">
                                                                                        {userItem.taskCount}å€‹ã®å·¥ç¨‹ã§ä½œæ¥­
                                                                                        {userItem.userId === user?.uid && (
                                                                                            <span className="text-blue-300 ml-1">ï¼ˆè‡ªåˆ†ï¼‰</span>
                                                                                        )}
                                                                                    </p>
                                                                                    <p className="text-gray-400 mobile-text-xs">
                                                                                        {userItem.sessions.length}æ—¥é–“ã§ä½œæ¥­
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                            <div className="text-right">
                                                                                <p className="font-bold text-white mobile-text-sm">{userItem.totalHours.toFixed(1)}h</p>
                                                                                <p className="text-gray-400 mobile-text-xs">
                                                                                    {stats.totalActual > 0 ? ((userItem.totalHours / stats.totalActual) * 100).toFixed(1) : '0'}%
                                                                                </p>
                                                                            </div>
                                                                        </div>

                                                                        {/* ã‚¿ã‚¹ã‚¯ã”ã¨ã®å†…è¨³ */}
                                                                        <div className="space-y-1 mt-3 pl-8">
                                                                            <h6 className="text-gray-300 mobile-text-xs font-medium">å·¥ç¨‹åˆ¥å†…è¨³</h6>
                                                                            {Object.entries(userItem.tasks || {})
                                                                                .sort((a, b) => b[1].hours - a[1].hours)
                                                                                .map(([taskId, taskData]) => (
                                                                                    <div key={taskId} className="flex justify-between items-center mobile-text-xs">
                                                                                        <span className="text-gray-300">{taskData.taskName}</span>
                                                                                        <span className="text-white font-medium">{taskData.hours.toFixed(1)}h</span>
                                                                                    </div>
                                                                                ))
                                                                            }
                                                                        </div>

                                                                        {/* æ—¥åˆ¥ã®è©³ç´°ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ */}
                                                                        <details className="mt-3 pl-8">
                                                                            <summary className="text-gray-400 mobile-text-xs cursor-pointer hover:text-gray-300 transition-colors">
                                                                                æ—¥åˆ¥ã®è©³ç´°ã‚’è¡¨ç¤º
                                                                            </summary>
                                                                            <div className="mt-2 space-y-1">
                                                                                {(userItem.sessions || [])
                                                                                    .sort((a, b) => {
                                                                                        const dateA = a.date ? a.date.toDate() : new Date(0);
                                                                                        const dateB = b.date ? b.date.toDate() : new Date(0);
                                                                                        return dateB - dateA; // æ–°ã—ã„æ—¥ä»˜é †
                                                                                    })
                                                                                    .map((session, sessionIndex) => (
                                                                                        <div key={sessionIndex} className="flex justify-between items-center mobile-text-xs">
                                                                                            <span className="text-gray-300">
                                                                                                {session.date
                                                                                                    ? session.date.toDate().toLocaleDateString('ja-JP')
                                                                                                    : 'æ—¥ä»˜ä¸æ˜'}
                                                                                                - {session.taskName}
                                                                                            </span>
                                                                                            <span className="text-white font-medium">
                                                                                                {(session.hours || session.totalHours || 0).toFixed(1)}h
                                                                                            </span>
                                                                                        </div>
                                                                                    ))
                                                                                }
                                                                            </div>
                                                                        </details>
                                                                    </div>
                                                                ))
                                                            ) : (
                                                                <div className="text-center text-gray-400 py-6">
                                                                    <p className="mobile-text-sm">ã¾ã å·¥æ•°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                                                                </div>
                                                            )}
                                                        </div>

                                                        {/* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */}
                                                        <div className="mt-6 mb-1.5">
                                                            <button
                                                                onClick={() => setShowProjectDetail(false)}
                                                                className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                                            >
                                                                é–‰ã˜ã‚‹
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                )}

                                {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ */}
                                <div className="space-y-4 md:space-y-6">
                                    {sortedProjects.length > 0 ? (
                                        sortedProjects.map(project => {
                                            const projectTasks = tasks.filter(task => String(task.projectId) === String(project.id));
                                            const stats = getProjectStats(project.id);
                                            const isCollapsed = collapsedProjects[project.id];
                                            return (
                                                <div key={project.id} className={`glass-card rounded-2xl overflow-hidden ${project.status === 'å®Œäº†' ? 'opacity-75' : ''}`}>
                                                    {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ï¼‰ */}
                                                    <div className="bg-gray-800 bg-opacity-50 mobile-compact-card border-b border-gray-600 border-opacity-30 relative">
                                                        <div className="flex justify-between items-start mb-3">
                                                            <div
                                                                className="flex items-start gap-3 cursor-pointer flex-1"
                                                                onClick={() => toggleProjectCollapse(project.id)}
                                                            >
                                                                <span className="text-white text-sm flex-shrink-0 w-5 flex justify-center" style={{ marginTop: '43px' }}>
                                                                    {isCollapsed ? icons.chevronRight : icons.chevronDown}
                                                                </span>
                                                                <div className="flex-1 min-w-0">
                                                                    <div className="flex flex-col mb-2 mt-10">
                                                                        <h3 className="text-base md:text-lg font-bold text-white truncate">{project.name}</h3>
                                                                        {project.company && (
                                                                            <div className="text-purple-300 truncate mobile-text-sm">
                                                                                {project.company}
                                                                            </div>
                                                                        )}
                                                                        <div className="flex flex-wrap gap-2 mt-1">
                                                                            <span className={`mobile-text-xs text-white px-2 py-1 rounded-full font-bold ${project.status === 'å®Œäº†'
                                                                                ? 'bg-green-600 bg-opacity-60'
                                                                                : 'bg-blue-600 bg-opacity-60'
                                                                                }`}>
                                                                                {project.status}
                                                                            </span>
                                                                            {project.deadline && (
                                                                                <span className={`mobile-text-xs text-white px-2 py-1 rounded-full font-bold ${project.status === 'å®Œäº†'
                                                                                    ? 'bg-green-600 bg-opacity-60'
                                                                                    : 'bg-blue-600 bg-opacity-60'
                                                                                    }`}>
                                                                                    ç· åˆ‡: {(() => {
                                                                                        try {
                                                                                            const date = new Date(project.deadline);
                                                                                            return isNaN(date.getTime()) ? 'æ—¥ä»˜ä¸æ˜' : date.toLocaleDateString('ja-JP');
                                                                                        } catch (error) {
                                                                                            return 'æ—¥ä»˜ä¸æ˜';
                                                                                        }
                                                                                    })()}
                                                                                </span>
                                                                            )}
                                                                            {project.createdByName && (
                                                                                <span
                                                                                    className="mobile-text-xs text-white font-bold px-2 py-1 rounded-full"
                                                                                    style={{ background: getUserIconColor(project.createdBy) }}
                                                                                >
                                                                                    {project.createdByName}
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    {project.description && (
                                                                        <p className="text-gray-300 mobile-text-sm mb-1 line-clamp-2">{project.description}</p>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦å´ï¼šå‰Šé™¤ã€ç·¨é›†ã€è©³ç´°ã€ãŠæ°—ã«å…¥ã‚Šï¼‰ */}
                                                            <div className="absolute top-2 left-3 flex gap-2 z-10">
                                                                {isAdmin && (
                                                                    <DeleteButton
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            openDeleteConfirm('project', project.id, project.name);
                                                                        }}
                                                                    />
                                                                )}
                                                                {project.status === 'é€²è¡Œä¸­' && isAdmin && (
                                                                    <EditButton
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            openEditProject(project);
                                                                        }}
                                                                    />
                                                                )}
                                                                <InfoButton
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        openProjectDetail(project.id);
                                                                    }}
                                                                />
                                                                <FavoriteButton
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        toggleFavorite(project.id);
                                                                    }}
                                                                    isFavorite={isFavorite(project.id)}
                                                                />
                                                            </div>

                                                            {/* æ–°è¦å·¥ç¨‹ãƒœã‚¿ãƒ³ï¼ˆå³å´ï¼‰ */}
                                                            {isAdmin && (
                                                                <div className="absolute top-2 right-3 z-10">
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            resetNewTaskForm();
                                                                            setNewTask(prev => ({ ...prev, projectId: String(project.id) }));
                                                                            setShowNewTaskForm(true);
                                                                        }}
                                                                        className="flex items-center justify-center text-white font-medium transition-all duration-300 gradient-button hover:shadow-lg w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                                    >
                                                                        <span style={{ transform: 'translateY(0.3px) translateX(0.2px)' }}>ï¼‹</span>
                                                                    </button>
                                                                </div>
                                                            )}

                                                            {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                            <div className="absolute left-0 right-0 border-t border-gray-600" style={{ top: '38px' }}></div>
                                                        </div>



                                                        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */}
                                                        <div className="flex items-start justify-between mb-3">
                                                            <div className="grid grid-cols-3 gap-2 mobile-text-xs text-center flex-1">
                                                                <div>
                                                                    <div className="text-gray-400">é€²æ—</div>
                                                                    <div className={`font-bold ${project.status === 'å®Œäº†' ? 'text-green-400' : 'text-white'}`}>
                                                                        {stats.progress.toFixed(1)}%
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-400">å·¥ç¨‹</div>
                                                                    <div className="text-white font-bold">{stats.completedTasks}/{stats.totalTasks}</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-400">å·¥æ•°</div>
                                                                    <div className="text-white font-bold">{stats.totalActual.toFixed(1)}h/{stats.totalEstimated}h</div>
                                                                </div>
                                                            </div>

                                                        </div>

                                                        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ãƒãƒ¼ */}
                                                        <div className="w-full bg-gray-600 bg-opacity-30 rounded-full h-1.5 mb-4">
                                                            <div
                                                                className={`h-1.5 rounded-full transition-all duration-500 ${project.status === 'å®Œäº†' ? 'bg-green-500' : 'progress-bar'
                                                                    }`}
                                                                style={{ width: `${stats.progress}%` }}
                                                            ></div>
                                                        </div>

                                                        {/* é…ç·šä»•æ§˜è¡¨ç¤ºï¼ˆé€²æ—ãƒãƒ¼ã®ä¸‹ï¼‰ */}
                                                        {projectWirings[project.id] && (
                                                            <div
                                                                className="mb-2 glass-card px-3 pt-3 pb-2 rounded-lg cursor-pointer hover:bg-gray-700 hover:bg-opacity-20 transition-all duration-200"
                                                                style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    openWiringModal(project.id);
                                                                }}>
                                                                {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ç«¯ï¼‰ */}
                                                                <div className="flex gap-2 mb-1 -mt-2" style={{ minHeight: '22px' }}>
                                                                    {project.status === 'é€²è¡Œä¸­' && isAdmin && (
                                                                        <>
                                                                            <DeleteButton
                                                                                onClick={(e) => {
                                                                                    e.stopPropagation();
                                                                                    const wiring = projectWirings[project.id];
                                                                                    if (wiring) {
                                                                                        openDeleteConfirm('projectWiring', wiring.id, wiring.templateName || 'é…ç·šä»•æ§˜');
                                                                                    }
                                                                                }} />
                                                                            <EditButton onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                openWiringEditModal(project.id);
                                                                            }} />
                                                                        </>
                                                                    )}
                                                                </div>
                                                                {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                <div className="mb-2 -mx-3" style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>
                                                                <div className="flex justify-between items-center mobile-text-sm mt-1">
                                                                    <div className={`font-bold ${project.status === 'å®Œäº†' ? 'text-gray-400' : 'text-white'}`}>
                                                                        é…ç·šä»•æ§˜: {projectWirings[project.id].templateName}
                                                                    </div>
                                                                    <div className="text-gray-400 mobile-text-xs">
                                                                        {(() => {
                                                                            const wiring = projectWirings[project.id];
                                                                            if (!wiring?.specifications) return 0;
                                                                            let count = 0;
                                                                            const specs = wiring.specifications;

                                                                            // å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                                                                            if (specs.wire && (
                                                                                specs.wire.power?.standards?.length > 0 ||
                                                                                specs.wire.power?.remarks ||
                                                                                specs.wire.ground?.caseColor ||
                                                                                specs.wire.ground?.remarks ||
                                                                                specs.wire.controlAC?.standards ||
                                                                                specs.wire.controlAC?.remarks ||
                                                                                specs.wire.controlDC?.standards ||
                                                                                specs.wire.controlDC?.remarks ||
                                                                                specs.wire.insulationCapRemarks ||
                                                                                specs.wire.specialSpec
                                                                            )) count++;
                                                                            if (specs.terminal && (
                                                                                specs.terminal.power ||
                                                                                specs.terminal.controlAC ||
                                                                                specs.terminal.controlDC ||
                                                                                specs.terminal.remarks
                                                                            )) count++;
                                                                            if (specs.terminalBlock && (
                                                                                specs.terminalBlock.cover ||
                                                                                specs.terminalBlock.namePlate ||
                                                                                specs.terminalBlock.bridge ||
                                                                                specs.terminalBlock.remarks
                                                                            )) count++;
                                                                            if (specs.namePlate && (
                                                                                specs.namePlate.fontSize ||
                                                                                specs.namePlate.remarks
                                                                            )) count++;
                                                                            if (specs.deviceSeal && (
                                                                                specs.deviceSeal.fontSize ||
                                                                                specs.deviceSeal.length ||
                                                                                specs.deviceSeal.positions?.length > 0 ||
                                                                                specs.deviceSeal.remarks
                                                                            )) count++;
                                                                            if (specs.markTube && (
                                                                                specs.markTube.fontSize ||
                                                                                specs.markTube.length ||
                                                                                specs.markTube.printSpec ||
                                                                                specs.markTube.orientation?.up ||
                                                                                specs.markTube.orientation?.down ||
                                                                                specs.markTube.orientation?.left ||
                                                                                specs.markTube.orientation?.right ||
                                                                                specs.markTube.remarks
                                                                            )) count++;
                                                                            if (specs.otherConfirm && (
                                                                                specs.otherConfirm.tighteningPen ||
                                                                                specs.otherConfirm.matchMark ||
                                                                                specs.otherConfirm.screw ||
                                                                                specs.otherConfirm.hookTube ||
                                                                                specs.otherConfirm.spiralTube ||
                                                                                specs.otherConfirm.insulock ||
                                                                                specs.otherConfirm.mountBase ||
                                                                                specs.otherConfirm.routeSpecialNote ||
                                                                                specs.otherConfirm.remarks
                                                                            )) count++;

                                                                            return count;
                                                                        })()} ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}

                                                    </div>


                                                    {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ï¼‰ */}
                                                    <div className={`project-tasks-container mobile-compact-card space-y-3 ${!isCollapsed ? 'expanded' : 'collapsed'
                                                        }`}>
                                                        {projectTasks.length > 0 ? (
                                                            projectTasks
                                                                .sort((a, b) => (a.order || 0) - (b.order || 0))
                                                                .map(task => {
                                                                    const isTimerActive = activeTimers[task.id];
                                                                    const isDragging = draggedTask && draggedTask.id === task.id;
                                                                    const isDragOver = dragOverTask && dragOverTask.id === task.id;
                                                                    const isCompleted = task.status === 'å®Œäº†';

                                                                    return (
                                                                        <div
                                                                            key={task.id}
                                                                            data-task-id={task.id}
                                                                            className={`glass-card-dark p-3 rounded-xl transition-all duration-300 hover:shadow-lg border-l-4 relative ${isCompleted ? 'border-green-500' : 'border-gray-500'
                                                                                } task-draggable ${isDragging ? 'task-dragging' : ''} ${isDragOver ? 'task-drag-over' : ''}`}
                                                                            draggable={!isCompleted && project.status === 'é€²è¡Œä¸­'}
                                                                            onDragStart={(e) => !isCompleted && project.status === 'é€²è¡Œä¸­' && handleDragStart(e, task)}
                                                                            onDragEnd={handleDragEnd}
                                                                            onDragOver={handleDragOver}
                                                                            onDragEnter={(e) => handleDragEnter(e, task)}
                                                                            onDragLeave={handleDragLeave}
                                                                            onDrop={(e) => handleDrop(e, task)}
                                                                        >
                                                                            <div className="flex items-start justify-between mb-2 mt-10">
                                                                                <div className="flex items-start gap-2 flex-1 min-w-0">
                                                                                    <input
                                                                                        type="checkbox"
                                                                                        checked={isCompleted}
                                                                                        onChange={(e) => updateTaskStatus(task.id, e.target.checked ? 'å®Œäº†' : 'é€²è¡Œä¸­')}
                                                                                        className="w-4 h-4 -mt-0.5"
                                                                                    />
                                                                                    <div className="flex-1 min-w-0 ml-1">
                                                                                        <div className="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-1">
                                                                                            <h4 className="font-bold text-white mobile-text-sm truncate leading-tight">{task.title}</h4>
                                                                                            <div className="text-gray-400 mobile-text-xs -mt-0.5">
                                                                                                {project.name}
                                                                                            </div>
                                                                                            <div className="flex flex-wrap gap-1">
                                                                                                <span className={`px-2 py-1 rounded-full mobile-text-xs font-bold ${isCompleted ? 'bg-green-600 bg-opacity-60 text-white' : 'bg-blue-600 bg-opacity-60 text-white'
                                                                                                    }`}>
                                                                                                    {task.status}
                                                                                                </span>
                                                                                                {task.createdByName && (
                                                                                                    <span
                                                                                                        className="mobile-text-xs text-white font-bold px-2 py-1 rounded-full"
                                                                                                        style={{ background: getUserIconColor(task.createdBy) }}
                                                                                                    >
                                                                                                        {task.createdByName}
                                                                                                    </span>
                                                                                                )}
                                                                                            </div>
                                                                                        </div>
                                                                                        {task.description && (
                                                                                            <p className="text-gray-300 mobile-text-xs line-clamp-2">{task.description}</p>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦å´ï¼šå‰Šé™¤ã€ç·¨é›†ã€è©³ç´°ï¼‰ */}
                                                                            <div className="absolute top-2 left-2 flex gap-2 z-10 ml-1">
                                                                                {!isCompleted && isAdmin && (
                                                                                    <DeleteButton onClick={() => openDeleteConfirm('task', task.id, task.title)} />
                                                                                )}
                                                                                {!isCompleted && isAdmin && (
                                                                                    <EditButton onClick={() => openEditTask(task)} />
                                                                                )}
                                                                                <InfoButton onClick={() => openHoursDetail(task.id)} />
                                                                            </div>

                                                                            {/* ã‚¿ã‚¤ãƒãƒ¼ãƒ»å·¥æ•°ãƒœã‚¿ãƒ³ï¼ˆå³å´ï¼‰ */}
                                                                            {!isCompleted && (
                                                                                <div className="absolute top-2 right-2 flex items-center gap-2 z-10 mr-1">
                                                                                    {/* ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒãƒ¼ãƒœã‚¿ãƒ³ã®å·¦ï¼‰ */}
                                                                                    {isTimerActive && timerDisplays[task.id] && (
                                                                                        <span className="text-red-300 font-bold text-xs whitespace-nowrap">
                                                                                            {timerDisplays[task.id]}
                                                                                        </span>
                                                                                    )}
                                                                                    <button
                                                                                        onClick={() => toggleTimer(task.id)}
                                                                                        className={`flex items-center justify-center text-white font-normal transition-all duration-300 w-5 h-5 rounded-full flex-shrink-0 text-xs ${isTimerActive
                                                                                            ? 'gradient-red hover:shadow-lg pulse-animation'
                                                                                            : 'gradient-button hover:shadow-lg'
                                                                                            }`}
                                                                                    >
                                                                                        <span style={{ transform: isTimerActive ? 'translateX(0.2px)' : 'translate(0.5px, 0.3px)' }}>
                                                                                            {isTimerActive ? 'â– ' : 'â–¶'}
                                                                                        </span>
                                                                                    </button>
                                                                                    <button
                                                                                        onClick={() => openHoursInputModal(task)}
                                                                                        className="flex items-center justify-center text-white font-normal transition-all duration-300 gradient-button hover:shadow-lg w-5 h-5 rounded-full flex-shrink-0 text-xs"
                                                                                    >
                                                                                        <svg
                                                                                            width="10"
                                                                                            height="10"
                                                                                            viewBox="0 0 10 10"
                                                                                            fill="none"
                                                                                            xmlns="http://www.w3.org/2000/svg"
                                                                                        >
                                                                                            <line x1="2" y1="3" x2="8" y2="3" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" />
                                                                                            <line x1="2" y1="7" x2="8" y2="7" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" />
                                                                                            <line x1="3.5" y1="1" x2="3.5" y2="9" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" />
                                                                                            <line x1="6.5" y1="1" x2="6.5" y2="9" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" />
                                                                                        </svg>
                                                                                    </button>
                                                                                </div>
                                                                            )}

                                                                            {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                            <div className="absolute left-0 right-0" style={{ top: '38px', borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>

                                                                            {/* ã‚¿ã‚¹ã‚¯çµ±è¨ˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */}
                                                                            <div className="grid grid-cols-3 gap-2 mobile-text-xs text-center mb-2">
                                                                                <div>
                                                                                    <div className="text-gray-400">äºˆæƒ³</div>
                                                                                    <div className="text-white font-bold">{task.estimatedHours}h</div>
                                                                                </div>
                                                                                <div>
                                                                                    <div className="text-gray-400">è‡ªåˆ†</div>
                                                                                    <div className="text-blue-300 font-bold">{(userTaskHoursMap[task.id] || 0).toFixed(1)}h</div>
                                                                                </div>
                                                                                <div>
                                                                                    <div className="text-gray-400">ç·å®Ÿç¸¾</div>
                                                                                    <div className="text-white font-bold">{(taskTotalHoursMap[task.id] || 0).toFixed(1)}h</div>
                                                                                </div>
                                                                            </div>

                                                                            {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                            <div className="relative mb-3">
                                                                                <div className="absolute inset-0 flex items-center">
                                                                                    <div className="w-full border-t border-gray-600"></div>
                                                                                </div>
                                                                                <div className="relative flex justify-center text-sm"></div>
                                                                            </div>

                                                                            {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤ºï¼ˆãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ï¼‰ */}
                                                                            {(() => {
                                                                                const checklistKey = `task_${task.id}`;
                                                                                const hasChecklist = projectChecklists[checklistKey];

                                                                                if (!hasChecklist) return null;

                                                                                const checklist = projectChecklists[checklistKey];
                                                                                const totalItems = checklist.categories?.reduce((sum, cat) =>
                                                                                    sum + (cat.items?.length || 0), 0) || 0;
                                                                                const firstCheckCount = checklist.categories?.reduce((sum, cat) =>
                                                                                    sum + cat.items.filter(item => item.firstCheck).length, 0) || 0;
                                                                                const secondCheckCount = checklist.categories?.reduce((sum, cat) =>
                                                                                    sum + cat.items.filter(item => item.secondCheck).length, 0) || 0;

                                                                                return (
                                                                                    <div
                                                                                        className={`mt-3 px-3 pt-3 pb-2 glass-card rounded-lg border transition-all duration-200 ${isCompleted
                                                                                            ? 'border-gray-500 border-opacity-30 cursor-pointer hover:bg-gray-700 hover:bg-opacity-20'
                                                                                            : 'border-purple-500 border-opacity-30 cursor-pointer hover:bg-gray-700 hover:bg-opacity-20'
                                                                                            }`}
                                                                                        style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}
                                                                                        onClick={() => {
                                                                                            openChecklistModal(task.id, 'task');
                                                                                        }}>
                                                                                        {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå·¦ç«¯ï¼‰ */}
                                                                                        <div className="flex gap-2 mb-1 -mt-2" style={{ minHeight: '22px' }}>
                                                                                            {!isCompleted && isAdmin && (
                                                                                                <>
                                                                                                    <DeleteButton
                                                                                                        onClick={(e) => {
                                                                                                            e.stopPropagation();
                                                                                                            const checklistKey = `task_${task.id}`;
                                                                                                            const checklist = projectChecklists[checklistKey];
                                                                                                            if (checklist) {
                                                                                                                openDeleteConfirm('projectChecklist', checklist.id, checklist.templateName || 'ã‚«ã‚¹ã‚¿ãƒ æ¤œæŸ»ãƒªã‚¹ãƒˆ');
                                                                                                            }
                                                                                                        }} />
                                                                                                    <EditButton onClick={(e) => {
                                                                                                        e.stopPropagation();
                                                                                                        openEditChecklistModal(task.id);
                                                                                                    }} />
                                                                                                </>
                                                                                            )}
                                                                                        </div>
                                                                                        {/* åŒºåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ */}
                                                                                        <div className="mb-2 -mx-3" style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}></div>
                                                                                        <div className={`flex justify-between items-center mobile-text-sm mt-1`}>
                                                                                            <div className={`font-bold ${isCompleted ? 'text-gray-400' : 'text-white'}`}>
                                                                                                æ¤œæŸ»ãƒªã‚¹ãƒˆ: {checklist.templateName || 'ã‚«ã‚¹ã‚¿ãƒ '}
                                                                                            </div>
                                                                                            <div className={`flex ${checklist.checkType === 'single' ? '' : 'gap-4'} mobile-text-xs`}>
                                                                                                <div className={isCompleted ? 'text-gray-500' : 'text-gray-300'}>
                                                                                                    1æ¬¡: <span className={`font-bold ${isCompleted ? 'text-gray-400' : 'text-white'}`}>{firstCheckCount}/{totalItems}</span>
                                                                                                </div>
                                                                                                {checklist.checkType !== 'single' && (
                                                                                                    <div className={isCompleted ? 'text-gray-500' : 'text-gray-300'}>
                                                                                                        2æ¬¡: <span className={`font-bold ${isCompleted ? 'text-gray-400' : 'text-white'}`}>{secondCheckCount}/{totalItems}</span>
                                                                                                    </div>
                                                                                                )}
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                );
                                                                            })()}


                                                                        </div>
                                                                    );
                                                                })
                                                        ) : (
                                                            <div className="text-center text-gray-400 py-6">
                                                                <p className="mobile-text-sm">ã“ã®æ¡ˆä»¶ã«ã¯ã¾ã å·¥ç¨‹ãŒã‚ã‚Šã¾ã›ã‚“</p>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div className="text-center text-gray-400 py-8">
                                            <p className="text-base md:text-lg mb-2">
                                                {searchQuery ? 'æ¤œç´¢ã«ä¸€è‡´ã™ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                    statusFilter === 'active' ? 'é€²è¡Œä¸­ã®æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                        statusFilter === 'completed' ? 'å®Œäº†ã—ãŸæ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                            'æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'}
                                            </p>
                                            <p className="mobile-text-sm">
                                                {statusFilter !== 'all' ? 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹ã‹ã€' : ''}æ–°è¦æ¡ˆä»¶ã‚’ä½œæˆã—ã¦ãã ã•ã„
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚¿ãƒ– */}
                        {activeTab === 'gantt' && (
                            <div className="space-y-6 md:space-y-8">
                                <div className="flex flex-row justify-between items-center gap-3 sm:gap-0">
                                    <h2 className="text-lg md:text-2xl font-bold text-white neon-text" style={{ margin: '1px 0' }}>
                                        å·¥ç¨‹è¡¨
                                    </h2>
                                </div>

                                <div className="glass-card mobile-compact-card rounded-2xl">
                                    <div className="space-y-2">
                                        {/* æ¤œç´¢ãƒãƒ¼ */}
                                        <div className="w-full">
                                            <input
                                                type="text"
                                                placeholder="æ¡ˆä»¶åãƒ»ä¼šç¤¾åã§æ¤œç´¢..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-xs"
                                            />
                                        </div>

                                        {/* ä¸¦ã³æ›¿ãˆã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæ¨ªä¸¦ã³ï¼‰ */}
                                        <div className="flex gap-2">
                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={sortOption}
                                                        onChange={(e) => setSortOption(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="created-desc">ä½œæˆé †ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                                                        <option value="created-asc">ä½œæˆé †ï¼ˆå¤ã„é †ï¼‰</option>
                                                        <option value="deadline-asc">ç· åˆ‡é †ï¼ˆè¿‘ã„é †ï¼‰</option>
                                                        <option value="deadline-desc">ç· åˆ‡é †ï¼ˆé ã„é †ï¼‰</option>
                                                        <option value="progress-desc">é€²æ—é †ï¼ˆé«˜ã„é †ï¼‰</option>
                                                        <option value="progress-asc">é€²æ—é †ï¼ˆä½ã„é †ï¼‰</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                            <div className="flex-1">
                                                <div className="custom-select-container">
                                                    <select
                                                        value={statusFilter}
                                                        onChange={(e) => setStatusFilter(e.target.value)}
                                                        className="custom-select text-xs"
                                                    >
                                                        <option value="all">å…¨ã¦ ({filteredProjects.length})</option>
                                                        <option value="active">é€²è¡Œä¸­ ({filteredProjects.filter(p => p.status === 'é€²è¡Œä¸­').length})</option>
                                                        <option value="completed">å®Œäº† ({filteredProjects.filter(p => p.status === 'å®Œäº†').length})</option>
                                                        <option value="favorite">ãŠæ°—ã«å…¥ã‚Š ({filteredProjects.filter(p => isFavorite(p.id)).length})</option>
                                                    </select>
                                                    <div className="custom-select-arrow"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {(() => {
                                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒã‚ã‚‹ã‚‚ã®ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
                                    let projectsForGantt = filteredProjects.filter(p => p.startDate && p.deadline);

                                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
                                    if (statusFilter === 'active') {
                                        projectsForGantt = projectsForGantt.filter(p => p.status === 'é€²è¡Œä¸­');
                                    } else if (statusFilter === 'completed') {
                                        projectsForGantt = projectsForGantt.filter(p => p.status === 'å®Œäº†');
                                    } else if (statusFilter === 'favorite') {
                                        projectsForGantt = projectsForGantt.filter(p => isFavorite(p.id));
                                    }

                                    const activeProjects = sortProjects(projectsForGantt);

                                    if (activeProjects.length === 0) {
                                        return (
                                            <div className="glass-card p-12 rounded-2xl text-center">
                                                <p className="text-gray-400 text-lg">
                                                    {searchQuery
                                                        ? 'æ¤œç´¢ã«ä¸€è‡´ã™ã‚‹ã€é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'
                                                        : statusFilter === 'active'
                                                            ? 'é€²è¡Œä¸­ã§é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'
                                                            : statusFilter === 'completed'
                                                                ? 'å®Œäº†ã§é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'
                                                                : statusFilter === 'favorite'
                                                                    ? 'ãŠæ°—ã«å…¥ã‚Šã§é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'
                                                                    : 'é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'
                                                    }
                                                </p>
                                            </div>
                                        );
                                    }

                                    // æ—¥ä»˜ç¯„å›²ã®è¨ˆç®—
                                    const allDates = [];
                                    activeProjects.forEach(p => {
                                        allDates.push(new Date(p.startDate));
                                        allDates.push(new Date(p.deadline));
                                    });

                                    const minDate = new Date(Math.min(...allDates));
                                    const maxDate = new Date(Math.max(...allDates));

                                    // æœˆåˆã¨æœˆæœ«ã«èª¿æ•´
                                    minDate.setDate(1);
                                    maxDate.setMonth(maxDate.getMonth() + 1, 0);

                                    // ç°¡æ˜“çš„ãªæ—¥æœ¬ã®ç¥æ—¥åˆ¤å®šï¼ˆ2024-2025å¹´ã®ä¸»è¦ãªç¥æ—¥ï¼‰
                                    const isHoliday = (date) => {
                                        const year = date.getFullYear();
                                        const month = date.getMonth() + 1;
                                        const day = date.getDate();
                                        const holidays = {
                                            2024: {
                                                '1-1': true, '1-8': true, '2-11': true, '2-12': true, '2-23': true,
                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                '7-15': true, '8-11': true, '8-12': true, '9-16': true, '9-22': true, '9-23': true,
                                                '10-14': true, '11-3': true, '11-4': true, '11-23': true
                                            },
                                            2025: {
                                                '1-1': true, '1-13': true, '2-11': true, '2-23': true, '2-24': true,
                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                '7-21': true, '8-11': true, '9-15': true, '9-23': true,
                                                '10-13': true, '11-3': true, '11-23': true, '11-24': true
                                            },
                                            2026: {
                                                '1-1': true, '1-12': true, '2-11': true, '2-23': true,
                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                '7-20': true, '8-11': true, '9-21': true, '9-22': true, '9-23': true,
                                                '10-12': true, '11-3': true, '11-23': true
                                            }
                                        };
                                        return holidays[year] && holidays[year][`${month}-${day}`];
                                    };

                                    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ï¼ˆãƒ«ãƒ¼ãƒ—ã®å¤–ã§ä¸€åº¦ã ã‘ï¼‰
                                    const today = new Date();
                                    today.setHours(0, 0, 0, 0);

                                    // å…¨ã¦ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
                                    const allDays = [];
                                    const dayWidth = 25; // 1æ—¥ã‚ãŸã‚Šã®å¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
                                    let currentDay = new Date(minDate);
                                    while (currentDay <= maxDate) {
                                        const dayOfWeek = currentDay.getDay();
                                        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                                        const isHol = isHoliday(currentDay);

                                        // ä»Šæ—¥ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆæ—¥ä»˜ã®æ–‡å­—åˆ—æ¯”è¼ƒã§ç¢ºå®Ÿã«ï¼‰
                                        const currentDayStr = currentDay.toDateString();
                                        const todayStr = today.toDateString();
                                        const isToday = currentDayStr === todayStr;

                                        allDays.push({
                                            date: new Date(currentDay),
                                            day: currentDay.getDate(),
                                            dayOfWeek: dayOfWeek,
                                            isWeekend: isWeekend,
                                            isHoliday: isHol,
                                            isSunday: dayOfWeek === 0,
                                            isSaturday: dayOfWeek === 6,
                                            isToday: isToday
                                        });

                                        currentDay.setDate(currentDay.getDate() + 1);
                                    }

                                    // æœˆã”ã¨ã®æ—¥æ•°ã‚’è¨ˆç®—
                                    const monthsWithDays = [];
                                    let currentMonth = null;
                                    let daysInMonth = 0;

                                    allDays.forEach(day => {
                                        const monthKey = `${day.date.getFullYear()}-${day.date.getMonth()}`;
                                        if (currentMonth !== monthKey) {
                                            if (currentMonth !== null) {
                                                monthsWithDays[monthsWithDays.length - 1].days = daysInMonth;
                                            }
                                            currentMonth = monthKey;
                                            daysInMonth = 1;
                                            monthsWithDays.push({
                                                year: day.date.getFullYear(),
                                                month: day.date.getMonth(),
                                                name: day.date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'short' }),
                                                days: 0
                                            });
                                        } else {
                                            daysInMonth++;
                                        }
                                    });
                                    if (monthsWithDays.length > 0) {
                                        monthsWithDays[monthsWithDays.length - 1].days = daysInMonth;
                                    }

                                    // å…¨æœŸé–“ã®æ—¥æ•°ã‚’è¨ˆç®—
                                    const totalDays = allDays.length;

                                    // å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½ç½®ã¨å¹…ã‚’è¨ˆç®—
                                    const projectBars = activeProjects.map(project => {
                                        const projectStart = new Date(project.startDate);
                                        const projectEnd = new Date(project.deadline);
                                        const startOffset = Math.floor((projectStart - minDate) / (1000 * 60 * 60 * 24));
                                        const duration = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24)) + 1;

                                        const stats = getProjectStats(project.id);

                                        return {
                                            ...project,
                                            startOffset,
                                            duration,
                                            progress: stats.progress
                                        };
                                    });

                                    return (
                                        <div className="glass-card rounded-2xl overflow-hidden">
                                            {/* ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ: 4åˆ†å‰²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */}
                                            <div className="block relative" style={{ minHeight: '80vh', height: 'auto', maxHeight: '90vh' }}>

                                                {/* å·¦ä¸Šï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå®Œå…¨å›ºå®šï¼‰ */}
                                                <div
                                                    className="absolute top-0 left-0 z-30 bg-gray-900 bg-opacity-95 backdrop-blur-sm border-r border-b border-gray-600"
                                                    style={{ padding: ganttProjectNameWidth.mobile > 0 ? '20px 12px' : '0', width: `${ganttProjectNameWidth.mobile}px`, height: '90px', transition: 'width 0.3s ease, padding 0.3s ease' }}
                                                >
                                                    {ganttProjectNameWidth.mobile > 0 && (
                                                        <div className="font-bold text-white text-base flex items-center h-full whitespace-nowrap overflow-hidden">
                                                            æ¡ˆä»¶å
                                                        </div>
                                                    )}
                                                </div>

                                                {/* å³ä¸Šï¼šæ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ç¸¦å›ºå®šï¼‰- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */}
                                                <div
                                                    className="absolute top-0 z-20 bg-gray-900 bg-opacity-95 backdrop-blur-sm border-b border-gray-600"
                                                    style={{
                                                        left: `${ganttProjectNameWidth.mobile}px`,
                                                        right: '0',
                                                        height: '90px',
                                                        overflow: 'hidden',
                                                        transition: 'left 0.3s ease',
                                                        paddingRight: '17px'
                                                    }}
                                                    id="mobileGanttHeader"
                                                >
                                                    <div className="min-w-max flex flex-col justify-end h-full" style={{ width: `${totalDays * 22}px`, padding: '4px 0 2px 0', transform: 'translateZ(0)', willChange: 'transform' }} id="mobileHeaderContent">
                                                        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœˆè¡¨ç¤ºï¼‰ */}
                                                        <div className="flex mb-4">
                                                            {monthsWithDays.map((month, index) => (
                                                                <div
                                                                    key={index}
                                                                    className="text-center font-bold text-white px-1"
                                                                    style={{ width: `${month.days * 22}px`, fontSize: '11px', lineHeight: '18px' }}
                                                                >
                                                                    {month.name.replace('å¹´', '/').replace('æœˆ', '')}
                                                                </div>
                                                            ))}
                                                        </div>


                                                        {/* æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                                        <div className="flex">
                                                            {allDays.map((day, index) => (
                                                                <div
                                                                    key={index}
                                                                    className={`gantt-day-header text-center ${day.isToday ? 'bg-purple-900 bg-opacity-25 text-purple-200' :
                                                                        day.isHoliday || day.isSunday ? 'bg-red-900 bg-opacity-20 text-red-300' :
                                                                            day.isSaturday ? 'bg-blue-900 bg-opacity-20 text-blue-300' :
                                                                                'text-gray-400'
                                                                        }`}
                                                                    style={{ width: '22px', fontSize: '9px', lineHeight: '16px', minHeight: '16px' }}
                                                                >
                                                                    <div className="font-bold">{(day.day === 1 || day.day % 10 === 0 || day.isToday) ? day.day : ''}</div>
                                                                    {(day.day === 1 || day.day % 10 === 0 || day.isToday) && (
                                                                        <div style={{ fontSize: '7px' }}>
                                                                            {['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][day.dayOfWeek]}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* å·¦ä¸‹ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆååˆ—ï¼ˆç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€æ¨ªå›ºå®šï¼‰- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */}
                                                <div
                                                    className="absolute left-0 z-10 bg-gray-800 bg-opacity-30 border-r border-gray-600"
                                                    style={{
                                                        top: '90px',
                                                        width: `${ganttProjectNameWidth.mobile}px`,
                                                        height: 'calc(80vh - 90px)',
                                                        overflow: 'hidden',
                                                        transition: 'width 0.3s ease'
                                                    }}
                                                >
                                                    <div className="space-y-4" style={{
                                                        padding: '20px 12px',
                                                        height: `${projectBars.length * 64 + 120}px`,
                                                        minHeight: '900px',
                                                        transform: 'translateZ(0)',
                                                        willChange: 'transform'
                                                    }}>
                                                        {projectBars.map((project, index) => (
                                                            <div key={project.id} className="flex items-center gap-2" style={{ height: '64px' }}>
                                                                <div className="flex flex-col gap-0 w-full overflow-hidden">
                                                                    <div className="text-white font-medium text-xs whitespace-nowrap overflow-hidden" title={project.name}>
                                                                        {project.name}
                                                                    </div>
                                                                    {project.company && (
                                                                        <div className="text-purple-300 mt-0.5 whitespace-nowrap overflow-hidden" title={project.company} style={{ fontSize: '9px' }}>
                                                                            {project.company}
                                                                        </div>
                                                                    )}
                                                                    {project.createdByName && (
                                                                        <span
                                                                            className="mt-1 whitespace-nowrap overflow-hidden text-white font-bold px-2 py-1 rounded-full"
                                                                            style={{
                                                                                fontSize: '8px',
                                                                                display: 'inline-block',
                                                                                width: 'auto',
                                                                                maxWidth: 'fit-content',
                                                                                background: getUserIconColor(project.createdBy)
                                                                            }}
                                                                        >
                                                                            {project.createdByName}
                                                                        </span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* å³ä¸‹ï¼šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆä¸¡æ–¹å‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰- ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */}
                                                <div
                                                    className="absolute timeline-area overflow-auto gantt-scroll-vertical"
                                                    style={{
                                                        top: '90px',
                                                        left: `${ganttProjectNameWidth.mobile}px`,
                                                        right: '0',
                                                        height: 'calc(80vh - 90px)',
                                                        cursor: isDragging ? 'grabbing' : 'grab',
                                                        transition: 'left 0.3s ease'
                                                    }}
                                                    onMouseDown={handleGanttMouseDown}
                                                    onMouseLeave={handleGanttMouseLeave}
                                                    onClick={() => {
                                                        // ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå†…ã‚’ã‚¿ãƒƒãƒã—ã¦æ¡ˆä»¶åˆ—ã®å¹…ã‚’åˆ‡ã‚Šæ›¿ãˆ
                                                        toggleGanttProjectNameWidth(true);
                                                    }}
                                                    onScroll={(e) => {
                                                        // ã‚ˆã‚Šé«˜é€Ÿãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸ
                                                        requestAnimationFrame(() => {
                                                            const scrollLeft = e.target.scrollLeft;
                                                            const scrollTop = e.target.scrollTop;

                                                            // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆï¼šæ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã¨æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åŒæœŸ
                                                            const mobileHeaderContent = document.getElementById('mobileHeaderContent');
                                                            if (mobileHeaderContent) {
                                                                mobileHeaderContent.style.transform = `translateX(-${scrollLeft}px)`;
                                                                mobileHeaderContent.style.willChange = 'transform';
                                                            }

                                                            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆååˆ—ã¨ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åŒæœŸ
                                                            const projectNameArea = e.target.parentElement.querySelector('.absolute.left-0.z-10 > div');
                                                            if (projectNameArea) {
                                                                projectNameArea.style.transform = `translateY(-${scrollTop}px)`;
                                                                projectNameArea.style.willChange = 'transform';
                                                            }
                                                        });
                                                    }}
                                                >
                                                    <div className="min-w-max relative" style={{
                                                        width: `${totalDays * 22}px`,
                                                        height: `${projectBars.length * 64 + 120}px`,
                                                        minHeight: '900px',
                                                        padding: '20px 0'
                                                    }}>
                                                        {/* å…¨ä½“ã®èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰ */}
                                                        <div className="absolute" style={{ top: '0', left: '0', right: '0', bottom: '0', minHeight: '100%' }}>
                                                            {allDays.map((day, dayIndex) => (
                                                                <div
                                                                    key={dayIndex}
                                                                    className="absolute top-0 bottom-0"
                                                                    style={{
                                                                        left: `${dayIndex * 22}px`,
                                                                        width: '22px',
                                                                        borderLeft: '1px solid rgba(255, 255, 255, 0.05)',
                                                                        background: day.isToday ? 'linear-gradient(180deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15))' :
                                                                            day.isHoliday || day.isSunday ? 'rgba(239, 68, 68, 0.05)' :
                                                                                day.isSaturday ? 'rgba(59, 130, 246, 0.05)' :
                                                                                    'transparent'
                                                                    }}
                                                                ></div>
                                                            ))}
                                                        </div>

                                                        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ */}
                                                        <div className="relative space-y-4">
                                                            {projectBars.map((project, index) => (
                                                                <div key={project.id} className="relative" style={{ height: '64px' }}>
                                                                    {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ */}
                                                                    <div
                                                                        className="absolute top-1/2 transform -translate-y-1/2 h-7 rounded-md overflow-hidden shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl bg-gray-500 bg-opacity-30"
                                                                        style={{
                                                                            left: `${project.startOffset * 22}px`,
                                                                            width: `${project.duration * 22}px`,
                                                                            zIndex: 10,
                                                                            minWidth: '22px'
                                                                        }}
                                                                    >
                                                                        {/* é€²æ—ãƒãƒ¼ */}
                                                                        <div
                                                                            className={`h-full ${project.status === 'å®Œäº†' ? 'bg-green-600' : 'progress-bar'}`}
                                                                            style={{ width: `${project.progress}%` }}
                                                                        ></div>

                                                                        {/* é€²æ—ãƒ†ã‚­ã‚¹ãƒˆ */}
                                                                        {project.duration * 22 >= 44 && (
                                                                            <div className="absolute inset-0 flex items-center justify-center text-white font-bold drop-shadow-lg" style={{ fontSize: '9px' }}>
                                                                                {project.progress.toFixed(0)}%
                                                                            </div>
                                                                        )}
                                                                    </div>

                                                                    {/* é–‹å§‹æ—¥ã¨ç· åˆ‡æ—¥ã®è¡¨ç¤º */}
                                                                    <div
                                                                        className="absolute top-1/2 transform -translate-y-1/2 mt-6 text-gray-400"
                                                                        style={{ left: `${project.startOffset * 22}px`, fontSize: '9px' }}
                                                                    >
                                                                        {new Date(project.startDate).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' })}
                                                                    </div>
                                                                    <div
                                                                        className="absolute top-1/2 transform -translate-y-1/2 mt-6 text-gray-400 text-right"
                                                                        style={{
                                                                            left: `${(project.startOffset + project.duration) * 22}px`,
                                                                            transform: 'translateX(-100%) translateY(-50%)',
                                                                            fontSize: '9px'
                                                                        }}
                                                                    >
                                                                        {new Date(project.deadline).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' })}
                                                                    </div>

                                                                    {/* é€²æ—è¡¨ç¤ºï¼ˆå°ã•ãªãƒãƒ¼ç”¨ï¼‰ */}
                                                                    {project.duration * 22 < 44 && (
                                                                        <div
                                                                            className="absolute top-1/2 transform -translate-y-1/2 text-white font-bold bg-gray-800 bg-opacity-80 px-1 rounded"
                                                                            style={{
                                                                                left: `${(project.startOffset + project.duration) * 22 + 8}px`,
                                                                                fontSize: '9px'
                                                                            }}
                                                                        >
                                                                            {project.progress.toFixed(0)}%
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>



                                        </div>
                                    );
                                })()}
                            </div>
                        )}



                        {/* åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ– */}
                        {activeTab === 'analytics' && (
                            <div className="space-y-6 md:space-y-8">
                                <div className="flex flex-row justify-between items-center gap-3 sm:gap-0">
                                    <h2 className="text-lg md:text-2xl font-bold text-white neon-text" style={{ margin: '1px 0' }}>
                                        åˆ†æ
                                    </h2>
                                </div>

                                <div className="glass-card mobile-compact-card rounded-2xl">
                                    <div className="space-y-2">
                                        {/* æ¤œç´¢ãƒãƒ¼ */}
                                        <div className="w-full">
                                            <input
                                                type="text"
                                                placeholder="æ¡ˆä»¶åãƒ»ä¼šç¤¾åã§æ¤œç´¢..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-xs"
                                            />
                                        </div>

                                        {/* ä¸¦ã³æ›¿ãˆã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæ¨ªä¸¦ã³ï¼‰ */}
                                        <div className="flex gap-2">
                                            <div className="custom-select-container flex-1">
                                                <select
                                                    value={sortOption}
                                                    onChange={(e) => setSortOption(e.target.value)}
                                                    className="custom-select w-full text-xs"
                                                >
                                                    <option value="created-desc">ä½œæˆé †ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                                                    <option value="created-asc">ä½œæˆé †ï¼ˆå¤ã„é †ï¼‰</option>
                                                    <option value="deadline-asc">ç· åˆ‡é †ï¼ˆè¿‘ã„é †ï¼‰</option>
                                                    <option value="deadline-desc">ç· åˆ‡é †ï¼ˆé ã„é †ï¼‰</option>
                                                    <option value="progress-desc">é€²æ—é †ï¼ˆé«˜ã„é †ï¼‰</option>
                                                    <option value="progress-asc">é€²æ—é †ï¼ˆä½ã„é †ï¼‰</option>
                                                </select>
                                                <div className="custom-select-arrow"></div>
                                            </div>
                                            <div className="custom-select-container flex-1">
                                                <select
                                                    value={statusFilter}
                                                    onChange={(e) => setStatusFilter(e.target.value)}
                                                    className="custom-select w-full text-xs"
                                                >
                                                    <option value="all">å…¨ã¦ ({filteredProjects.length})</option>
                                                    <option value="active">é€²è¡Œä¸­ ({filteredProjects.filter(p => p.status === 'é€²è¡Œä¸­').length})</option>
                                                    <option value="completed">å®Œäº† ({filteredProjects.filter(p => p.status === 'å®Œäº†').length})</option>
                                                    <option value="favorite">ãŠæ°—ã«å…¥ã‚Š ({filteredProjects.filter(p => isFavorite(p.id)).length})</option>
                                                </select>
                                                <div className="custom-select-arrow"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* å…¨ä½“çµ±è¨ˆã¨æ¡ˆä»¶åˆ¥å·¥æ•°åˆ†æ */}
                                <div className="space-y-4">
                                    {/* å…¨ä½“çµ±è¨ˆ */}
                                    <div className="grid grid-cols-2 gap-2">
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">{sortedProjects.length}</div>
                                            <div className="text-gray-400 mobile-text-xs">ç·æ¡ˆä»¶æ•°</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                {tasks.filter(task => sortedProjects.some(p => String(p.id) === String(task.projectId))).length}
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·å·¥ç¨‹æ•°</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                {tasks.filter(task =>
                                                    sortedProjects.some(p => String(p.id) === String(task.projectId))
                                                ).reduce((sum, task) => sum + (task.estimatedHours || 0), 0).toFixed(1)}h
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·äºˆæƒ³å·¥æ•°</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                {tasks.filter(task =>
                                                    sortedProjects.some(p => String(p.id) === String(task.projectId))
                                                ).reduce((sum, task) => sum + (taskTotalHoursMap[task.id] || 0), 0).toFixed(1)}h
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·å®Ÿç¸¾å·¥æ•°</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                Â¥{sortedProjects.reduce((sum, project) => sum + (parseFloat(project.laborCost) || 0), 0).toLocaleString()}
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·åŠ´å‹™è²»</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                Â¥{sortedProjects.reduce((sum, project) => sum + (parseFloat(project.materialCost) || 0), 0).toLocaleString()}
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·è³‡æè²»</div>
                                        </div>
                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                Â¥{sortedProjects.reduce((sum, project) => sum + (project.amount || 0), 0).toLocaleString()}
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">ç·æ¡ˆä»¶é‡‘é¡</div>
                                        </div>


                                        <div className="glass-card p-3 rounded-2xl text-center">
                                            <div className="font-bold text-white text-base mb-1">
                                                {(() => {
                                                    const totalLaborCost = sortedProjects.reduce((sum, project) => sum + (parseFloat(project.laborCost) || 0), 0);
                                                    const totalActual = tasks.filter(task =>
                                                        sortedProjects.some(p => String(p.id) === String(task.projectId))
                                                    ).reduce((sum, task) => sum + (taskTotalHoursMap[task.id] || 0), 0);
                                                    const avgHourlyRate = totalActual > 0 ? totalLaborCost / totalActual : 0;
                                                    return `Â¥${Math.round(avgHourlyRate).toLocaleString()}/h`;
                                                })()}
                                            </div>
                                            <div className="text-gray-400 mobile-text-xs">å¹³å‡æ™‚é–“å˜ä¾¡</div>
                                        </div>
                                    </div>

                                    {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥è©³ç´° */}
                                    <div className="glass-card p-3 rounded-2xl">
                                        <h3 className="text-base font-bold mb-3 text-white">æ¡ˆä»¶åˆ¥å·¥æ•°åˆ†æ</h3>
                                        {sortedProjects.length > 0 ? (
                                            <div className="space-y-3">
                                                {sortedProjects.map(project => {
                                                    const stats = getProjectStats(project.id);

                                                    return (
                                                        <div key={project.id} className="glass-card-dark p-3 rounded-lg">
                                                            <div className="flex flex-col gap-2 mb-2">
                                                                <div className="w-full">
                                                                    <h4 className="font-bold text-white mobile-text-sm">{project.name}</h4>
                                                                    {project.company && (
                                                                        <div className="mobile-text-xs text-purple-300 font-medium">
                                                                            {project.company}
                                                                        </div>
                                                                    )}
                                                                    {project.createdByName && (
                                                                        <div>
                                                                            <span
                                                                                className="text-white font-bold px-2 py-1 rounded-full"
                                                                                style={{
                                                                                    fontSize: '8px',
                                                                                    display: 'inline-block',
                                                                                    width: 'auto',
                                                                                    maxWidth: 'fit-content',
                                                                                    background: getUserIconColor(project.createdBy)
                                                                                }}
                                                                            >
                                                                                {project.createdByName}
                                                                            </span>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                            <div className="grid grid-cols-2 gap-2 mobile-text-xs">
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">é€²æ—</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.progress.toFixed(1)}%</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">å·¥ç¨‹æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.totalTasks}</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">äºˆæƒ³å·¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.totalEstimated}h</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">å®Ÿç¸¾å·¥æ•°</div>
                                                                    <div className="font-bold text-white mobile-text-sm">{stats.totalActual.toFixed(1)}h</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">åŠ´å‹™è²»</div>
                                                                    <div className="font-bold text-gray-200 mobile-text-sm">Â¥{stats.laborCost.toLocaleString()}</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">è³‡æè²»</div>
                                                                    <div className="font-bold text-gray-200 mobile-text-sm">Â¥{stats.materialCost.toLocaleString()}</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">æ¡ˆä»¶é‡‘é¡</div>
                                                                    <div className="font-bold text-gray-200 mobile-text-sm">Â¥{stats.amount.toLocaleString()}</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-gray-400 mobile-text-xs">æ™‚é–“å˜ä¾¡</div>
                                                                    <div className="font-bold text-gray-200 mobile-text-sm">
                                                                        {stats.hourlyRate > 0 ? `Â¥${Math.round(stats.hourlyRate).toLocaleString()}/h` : '-'}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        ) : (
                                            <div className="text-center text-gray-400 py-4">
                                                <p className="mobile-text-sm mb-1">
                                                    {searchQuery ? 'æ¤œç´¢ã«ä¸€è‡´ã™ã‚‹æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                        statusFilter === 'active' ? 'é€²è¡Œä¸­ã®æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                            statusFilter === 'completed' ? 'å®Œäº†ã—ãŸæ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                                'æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“'}
                                                </p>
                                                <p className="mobile-text-xs">
                                                    {statusFilter !== 'all' ? 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹ã‹ã€' : ''}æ–°è¦æ¡ˆä»¶ã‚’ä½œæˆã—ã¦ãã ã•ã„
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚¿ãƒ– */}
                        {activeTab === 'mypage' && (
                            <div className="space-y-6 md:space-y-8">
                                <div className="flex flex-row justify-between items-center gap-3 sm:gap-0">
                                    <h2 className="text-lg md:text-2xl font-bold text-white neon-text" style={{ margin: '1px 0' }}>
                                        ãƒ¦ãƒ¼ã‚¶ãƒ¼
                                    </h2>
                                </div>

                                {/* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
                                <div className="glass-card mobile-compact-card rounded-2xl">
                                    <div className="space-y-2">
                                        {/* æ¤œç´¢ãƒãƒ¼ */}
                                        <div className="w-full">
                                            <input
                                                type="text"
                                                placeholder="æ¡ˆä»¶åãƒ»å·¥ç¨‹åã§æ¤œç´¢..."
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-xs"
                                            />
                                        </div>

                                        {/* ä¸¦ã³æ›¿ãˆã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæ¨ªä¸¦ã³ï¼‰ */}
                                        <div className="flex gap-2">
                                            <div className="custom-select-container flex-1">
                                                <select
                                                    value={sortOption}
                                                    onChange={(e) => setSortOption(e.target.value)}
                                                    className="custom-select w-full text-xs"
                                                >
                                                    <option value="date-desc">ä½œæ¥­æ—¥é †ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                                                    <option value="date-asc">ä½œæ¥­æ—¥é †ï¼ˆå¤ã„é †ï¼‰</option>
                                                    <option value="hours-desc">å·¥æ•°é †ï¼ˆå¤šã„é †ï¼‰</option>
                                                    <option value="hours-asc">å·¥æ•°é †ï¼ˆå°‘ãªã„é †ï¼‰</option>
                                                </select>
                                                <div className="custom-select-arrow"></div>
                                            </div>
                                            <div className="custom-select-container flex-1">
                                                <select
                                                    value={workHistoryFilter}
                                                    onChange={(e) => setWorkHistoryFilter(e.target.value)}
                                                    className="custom-select w-full text-xs"
                                                >
                                                    <option value="all">å…¨ã¦</option>
                                                    <option value="today">ä»Šæ—¥</option>
                                                    <option value="thisweek">ä»Šé€±</option>
                                                    <option value="thismonth">ä»Šæœˆ</option>
                                                    <option value="lastmonth">å…ˆæœˆ</option>
                                                </select>
                                                <div className="custom-select-arrow"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* å·¥æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã‚µãƒãƒªãƒ¼ */}
                                <div className="space-y-4">
                                    {/* å·¥æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */}
                                    <div className="glass-card p-3 rounded-2xl">
                                        <h3 className="text-base font-bold text-white mb-3">å·¥æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>

                                        {/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                        <div className="flex justify-between items-center mb-3">
                                            <button
                                                onClick={() => {
                                                    const prevMonth = new Date(currentCalendarDate);
                                                    prevMonth.setMonth(prevMonth.getMonth() - 1);
                                                    setCurrentCalendarDate(prevMonth);
                                                }}
                                                className="text-white mobile-text-sm p-2 hover:bg-white hover:bg-opacity-10 rounded"
                                            >
                                                â†
                                            </button>
                                            <h4 className="mobile-text-sm font-bold text-white">
                                                {currentCalendarDate.getFullYear()}å¹´{currentCalendarDate.getMonth() + 1}æœˆ
                                            </h4>
                                            <button
                                                onClick={() => {
                                                    const nextMonth = new Date(currentCalendarDate);
                                                    nextMonth.setMonth(nextMonth.getMonth() + 1);
                                                    setCurrentCalendarDate(nextMonth);
                                                }}
                                                className="text-white mobile-text-sm p-2 hover:bg-white hover:bg-opacity-10 rounded"
                                            >
                                                â†’
                                            </button>
                                        </div>

                                        {/* æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                        <div className="grid grid-cols-7 gap-1 mb-2">
                                            {['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'].map(day => (
                                                <div key={day} className="text-center mobile-text-xs text-gray-400 font-bold p-1">
                                                    {day}
                                                </div>
                                            ))}
                                        </div>

                                        {/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */}
                                        <div className="grid grid-cols-7 gap-1">
                                            {(() => {
                                                const year = currentCalendarDate.getFullYear();
                                                const month = currentCalendarDate.getMonth();
                                                const firstDay = new Date(year, month, 1);
                                                const lastDay = new Date(year, month + 1, 0);
                                                const startDate = new Date(firstDay);
                                                startDate.setDate(startDate.getDate() - firstDay.getDay());

                                                const days = [];
                                                const current = new Date(startDate);

                                                for (let i = 0; i < 42; i++) {
                                                    // æ—¥æœ¬æ™‚é–“ã§ã®æ—¥ä»˜æ–‡å­—åˆ—ã‚’ç”Ÿæˆï¼ˆUTCã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è€ƒæ…®ï¼‰
                                                    const year = current.getFullYear();
                                                    const month = String(current.getMonth() + 1).padStart(2, '0');
                                                    const day = String(current.getDate()).padStart(2, '0');
                                                    const dateStr = `${year}-${month}-${day}`;

                                                    const dayHours = workSessions
                                                        .filter(s => s.userId === user.uid)
                                                        .filter(s => {
                                                            if (s.date && s.date.toDate) {
                                                                const sessionDate = s.date.toDate();
                                                                const sessionYear = sessionDate.getFullYear();
                                                                const sessionMonth = String(sessionDate.getMonth() + 1).padStart(2, '0');
                                                                const sessionDay = String(sessionDate.getDate()).padStart(2, '0');
                                                                const sessionDateStr = `${sessionYear}-${sessionMonth}-${sessionDay}`;
                                                                return sessionDateStr === dateStr;
                                                            }
                                                            if (s.date && typeof s.date === 'string') {
                                                                return s.date === dateStr;
                                                            }
                                                            if (s.startTime && s.startTime.toDate) {
                                                                const sessionDate = s.startTime.toDate();
                                                                const sessionYear = sessionDate.getFullYear();
                                                                const sessionMonth = String(sessionDate.getMonth() + 1).padStart(2, '0');
                                                                const sessionDay = String(sessionDate.getDate()).padStart(2, '0');
                                                                const sessionDateStr = `${sessionYear}-${sessionMonth}-${sessionDay}`;
                                                                return sessionDateStr === dateStr;
                                                            }
                                                            return false;
                                                        })
                                                        .reduce((sum, s) => sum + (s.hours || 0), 0);

                                                    const isCurrentMonth = current.getMonth() === month;
                                                    const isToday = current.toDateString() === new Date().toDateString();
                                                    const dayOfWeek = current.getDay(); // 0:æ—¥æ›œ, 6:åœŸæ›œ
                                                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                                                    // æ—¥æœ¬ã®ç¥æ—¥åˆ¤å®šï¼ˆå®Œå…¨ç‰ˆï¼‰
                                                    const isHoliday = (() => {
                                                        const currentYear = current.getFullYear();
                                                        const currentMonth = current.getMonth() + 1;
                                                        const currentDate = current.getDate();

                                                        const holidays = {
                                                            2024: {
                                                                '1-1': true, '1-8': true, '2-11': true, '2-12': true, '2-23': true,
                                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                                '7-15': true, '8-11': true, '8-12': true, '9-16': true, '9-22': true, '9-23': true,
                                                                '10-14': true, '11-3': true, '11-4': true, '11-23': true
                                                            },
                                                            2025: {
                                                                '1-1': true, '1-13': true, '2-11': true, '2-23': true, '2-24': true,
                                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                                '7-21': true, '8-11': true, '9-15': true, '9-23': true,
                                                                '10-13': true, '11-3': true, '11-23': true, '11-24': true
                                                            },
                                                            2026: {
                                                                '1-1': true, '1-12': true, '2-11': true, '2-23': true,
                                                                '3-20': true, '4-29': true, '5-3': true, '5-4': true, '5-5': true, '5-6': true,
                                                                '7-20': true, '8-11': true, '9-21': true, '9-22': true, '9-23': true,
                                                                '10-12': true, '11-3': true, '11-23': true
                                                            }
                                                        };

                                                        return holidays[currentYear] && holidays[currentYear][`${currentMonth}-${currentDate}`];
                                                    })();

                                                    days.push(
                                                        <div
                                                            key={dateStr}
                                                            className={`
                                                            text-center p-1 rounded mobile-text-xs min-h-10 flex flex-col justify-center cursor-pointer hover:bg-white hover:bg-opacity-10 transition-all duration-200
                                                            ${isCurrentMonth ? 'text-white' : 'text-gray-600'}
                                                            ${isToday ? 'gradient-button' : ''}
                                                        `}
                                                            onClick={() => {
                                                                if (dayHours > 0) {
                                                                    openDailyHoursModal(dateStr);
                                                                }
                                                            }}
                                                        >
                                                            <div className={`font-bold ${!isToday ? (dayOfWeek === 0 || isHoliday ? 'text-red-300' : dayOfWeek === 6 ? 'text-blue-300' : 'text-white') : 'text-white'}`}>
                                                                {current.getDate()}
                                                            </div>
                                                            <div className={`mobile-text-xs h-4 ${isToday ? 'text-white' : 'text-gray-300'}`}>
                                                                {dayHours > 0 ? `${dayHours.toFixed(1)}h` : ''}
                                                            </div>
                                                        </div>
                                                    );
                                                    current.setDate(current.getDate() + 1);
                                                }
                                                return days;
                                            })()}
                                        </div>
                                    </div>

                                    {/* è‡ªåˆ†ã®å·¥æ•°ã‚µãƒãƒªãƒ¼ */}
                                    <div className="glass-card p-3 rounded-2xl">
                                        <h3 className="text-base font-bold text-white mb-2">è‡ªåˆ†ã®å·¥æ•°ã‚µãƒãƒªãƒ¼</h3>
                                        <div className="grid grid-cols-3 gap-2 mb-3">
                                            <div className="text-center">
                                                <div className="font-bold text-white mobile-text-sm">
                                                    {workSessions.filter(s => s.userId === user.uid)
                                                        .reduce((sum, s) => sum + (s.hours || 0), 0).toFixed(1)}h
                                                </div>
                                                <div className="text-gray-400 mobile-text-xs">ç·å·¥æ•°</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-white mobile-text-sm">
                                                    {new Set(workSessions.filter(s => s.userId === user.uid)
                                                        .map(s => s.projectId)).size}
                                                </div>
                                                <div className="text-gray-400 mobile-text-xs">å‚åŠ æ¡ˆä»¶æ•°</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-white mobile-text-sm">
                                                    {new Set(workSessions.filter(s => s.userId === user.uid)
                                                        .map(s => s.taskId)).size}
                                                </div>
                                                <div className="text-gray-400 mobile-text-xs">ä½œæ¥­å·¥ç¨‹æ•°</div>
                                            </div>
                                        </div>

                                        {/* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥å·¥æ•° */}
                                        <div className="space-y-3">
                                            {projects.filter(p =>
                                                workSessions.some(s => s.userId === user.uid && s.projectId === p.id)
                                            ).map(project => {
                                                const projectHours = workSessions
                                                    .filter(s => s.userId === user.uid && s.projectId === project.id)
                                                    .reduce((sum, s) => sum + (s.hours || 0), 0);

                                                return (
                                                    <div key={project.id} className="glass-card-dark p-3 rounded-lg">
                                                        <div className="flex justify-between items-center">
                                                            <div className="flex-1 min-w-0">
                                                                <h4 className="font-bold text-white mobile-text-sm truncate">{project.name}</h4>
                                                                {project.company && (
                                                                    <div className="text-purple-300 mobile-text-xs truncate">{project.company}</div>
                                                                )}
                                                            </div>
                                                            <div className="text-right ml-2">
                                                                <span className="font-bold text-white mobile-text-sm">
                                                                    {projectHours.toFixed(1)}h
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {/* è‡ªåˆ†ã®ä½œæ¥­å±¥æ­´ */}
                                    <div className="glass-card p-3 rounded-2xl">
                                        <h3 className="text-base font-bold text-white mb-3">ä½œæ¥­å±¥æ­´</h3>

                                        {(() => {
                                            // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                                            const userWorkSessions = workSessions.filter(s => s.userId === user.uid);

                                            if (userWorkSessions.length === 0) {
                                                return (
                                                    <div className="text-center text-gray-400 py-4">
                                                        <p className="mobile-text-sm">ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                                                    </div>
                                                );
                                            }

                                            // æ—¥ä»˜ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                                            let filteredSessions = userWorkSessions;
                                            if (workHistoryFilter !== 'all') {
                                                const now = new Date();
                                                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                                                // ä»Šé€±ã®é–‹å§‹æ—¥ï¼ˆæ—¥æ›œæ—¥ï¼‰ã¨çµ‚äº†æ—¥ï¼ˆåœŸæ›œæ—¥ï¼‰
                                                const thisWeekStart = new Date(today);
                                                thisWeekStart.setDate(today.getDate() - today.getDay());
                                                const thisWeekEnd = new Date(thisWeekStart);
                                                thisWeekEnd.setDate(thisWeekStart.getDate() + 6);
                                                thisWeekEnd.setHours(23, 59, 59, 999);

                                                const thisMonthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                                                const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                                                const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);
                                                lastMonthEnd.setHours(23, 59, 59, 999);

                                                filteredSessions = userWorkSessions.filter(session => {
                                                    if (!session.date) return false;

                                                    let sessionDate;
                                                    if (session.date.toDate) {
                                                        sessionDate = session.date.toDate();
                                                    } else {
                                                        sessionDate = new Date(session.date);
                                                    }

                                                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ—¥ä»˜ã‚’æ—¥ä»˜ã®ã¿ã§æ¯”è¼ƒï¼ˆæ™‚é–“ã‚’0æ™‚0åˆ†0ç§’ã«è¨­å®šï¼‰
                                                    const sessionDateOnly = new Date(sessionDate.getFullYear(), sessionDate.getMonth(), sessionDate.getDate());

                                                    switch (workHistoryFilter) {
                                                        case 'today':
                                                            return sessionDateOnly.getTime() === today.getTime();
                                                        case 'thisweek':
                                                            return sessionDateOnly >= thisWeekStart && sessionDateOnly <= thisWeekEnd;
                                                        case 'thismonth':
                                                            return sessionDateOnly >= thisMonthStart;
                                                        case 'lastmonth':
                                                            return sessionDateOnly >= lastMonthStart && sessionDateOnly <= lastMonthEnd;
                                                        default:
                                                            return true;
                                                    }
                                                });
                                            }

                                            // æ¤œç´¢ã‚¯ã‚¨ãƒªã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                                            if (searchQuery.trim()) {
                                                filteredSessions = filteredSessions.filter(session =>
                                                    (session.taskName || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
                                                    (session.projectName || '').toLowerCase().includes(searchQuery.toLowerCase())
                                                );
                                            }

                                            // ã‚½ãƒ¼ãƒˆ
                                            filteredSessions.sort((a, b) => {
                                                switch (sortOption) {
                                                    case 'date-asc':
                                                        // æ—¥ä»˜ãŒãªã„å ´åˆã¯æœ€å¾Œã«é…ç½®
                                                        if (!a.date && !b.date) return 0;
                                                        if (!a.date) return 1;
                                                        if (!b.date) return -1;

                                                        const dateA = a.date.toDate ? a.date.toDate() : new Date(a.date);
                                                        const dateB = b.date.toDate ? b.date.toDate() : new Date(b.date);
                                                        const timeDiff = dateA.getTime() - dateB.getTime();

                                                        // æ—¥ä»˜ãŒåŒã˜å ´åˆã¯ä½œæˆé †ï¼ˆIDé †ï¼‰ã§ã‚½ãƒ¼ãƒˆ
                                                        if (timeDiff === 0) {
                                                            return (a.id || '').localeCompare(b.id || '');
                                                        }
                                                        return timeDiff;

                                                    case 'date-desc':
                                                    default:
                                                        // æ—¥ä»˜ãŒãªã„å ´åˆã¯æœ€å¾Œã«é…ç½®
                                                        if (!a.date && !b.date) return 0;
                                                        if (!a.date) return 1;
                                                        if (!b.date) return -1;

                                                        const dateA2 = a.date.toDate ? a.date.toDate() : new Date(a.date);
                                                        const dateB2 = b.date.toDate ? b.date.toDate() : new Date(b.date);
                                                        const timeDiff2 = dateB2.getTime() - dateA2.getTime();

                                                        // æ—¥ä»˜ãŒåŒã˜å ´åˆã¯ä½œæˆé †ï¼ˆIDé †ï¼‰ã§ã‚½ãƒ¼ãƒˆ
                                                        if (timeDiff2 === 0) {
                                                            return (b.id || '').localeCompare(a.id || '');
                                                        }
                                                        return timeDiff2;

                                                    case 'hours-asc':
                                                        const hoursDiff1 = (a.hours || 0) - (b.hours || 0);
                                                        // å·¥æ•°ãŒåŒã˜å ´åˆã¯æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆ
                                                        if (hoursDiff1 === 0) {
                                                            if (!a.date && !b.date) return 0;
                                                            if (!a.date) return 1;
                                                            if (!b.date) return -1;
                                                            const dateA3 = a.date.toDate ? a.date.toDate() : new Date(a.date);
                                                            const dateB3 = b.date.toDate ? b.date.toDate() : new Date(b.date);
                                                            return dateB3.getTime() - dateA3.getTime();
                                                        }
                                                        return hoursDiff1;

                                                    case 'hours-desc':
                                                        const hoursDiff2 = (b.hours || 0) - (a.hours || 0);
                                                        // å·¥æ•°ãŒåŒã˜å ´åˆã¯æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆ
                                                        if (hoursDiff2 === 0) {
                                                            if (!a.date && !b.date) return 0;
                                                            if (!a.date) return 1;
                                                            if (!b.date) return -1;
                                                            const dateA4 = a.date.toDate ? a.date.toDate() : new Date(a.date);
                                                            const dateB4 = b.date.toDate ? b.date.toDate() : new Date(b.date);
                                                            return dateB4.getTime() - dateA4.getTime();
                                                        }
                                                        return hoursDiff2;
                                                }
                                            });

                                            if (filteredSessions.length === 0) {
                                                return (
                                                    <div className="text-center text-gray-400 py-4">
                                                        <p className="mobile-text-sm">
                                                            {searchQuery ? 'æ¤œç´¢ã«ä¸€è‡´ã™ã‚‹ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                                workHistoryFilter === 'today' ? 'ä»Šæ—¥ã®ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                                    workHistoryFilter === 'thisweek' ? 'ä»Šé€±ã®ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                                        workHistoryFilter === 'thismonth' ? 'ä»Šæœˆã®ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“' :
                                                                            workHistoryFilter === 'lastmonth' ? 'å…ˆæœˆã®ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“' : 'ä½œæ¥­å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“'}
                                                        </p>
                                                    </div>
                                                );
                                            }

                                            return (
                                                <div className="space-y-3">
                                                    {filteredSessions.map(session => {
                                                        const sessionDate = session.date?.toDate ? session.date.toDate() : new Date(session.date);
                                                        const formattedDate = sessionDate.toLocaleDateString('ja-JP', {
                                                            year: 'numeric',
                                                            month: '2-digit',
                                                            day: '2-digit'
                                                        });

                                                        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ä¼šç¤¾æƒ…å ±ã‚’å–å¾—
                                                        const project = projects.find(p => p.id === session.projectId);
                                                        const company = companies.find(c => c.id === project?.companyId);
                                                        const companyName = company?.name || project?.companyName || session.companyName || project?.company || 'ä¼šç¤¾åä¸æ˜';

                                                        return (
                                                            <div key={session.id} className="glass-card-dark p-3 rounded-xl">
                                                                <div className="flex justify-between items-start">
                                                                    <div className="flex-1 min-w-0">
                                                                        <div className="flex items-center gap-2 mb-1">
                                                                            <span className="mobile-text-xs text-gray-400">{formattedDate}</span>
                                                                        </div>
                                                                        <h4 className="font-bold text-white mobile-text-sm truncate">
                                                                            {session.projectName}
                                                                        </h4>
                                                                        <p className="text-purple-300 mobile-text-xs truncate">
                                                                            {companyName}
                                                                        </p>
                                                                        <p className="text-gray-400 mobile-text-xs truncate">
                                                                            {session.taskName}
                                                                        </p>
                                                                    </div>
                                                                    <div className="text-right ml-2">
                                                                        <span className="font-bold text-white mobile-text-sm">
                                                                            {(session.hours || 0).toFixed(1)}h
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            );
                                        })()}
                                    </div>
                                </div>


                            </div>
                        )}

                        {deleteConfirm.show && (
                            <div className="modal-overlay" onClick={() => setDeleteConfirm({ show: false, type: '', id: null, name: '', inputName: '' })}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl w-full max-w-md mx-4" onClick={(e) => e.stopPropagation()}>
                                    <div className="text-center">
                                        {/* ã‚«ã‚¹ã‚¿ãƒ æ³¨æ„ã‚¢ã‚¤ã‚³ãƒ³ */}
                                        <div className="flex justify-center mb-4 mt-2">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="gray" strokeWidth="1.5">
                                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                                <line x1="12" y1="9" x2="12" y2="13" />
                                                <circle cx="12" cy="17" r="0.5" fill="white" />
                                            </svg>
                                        </div>
                                        <div className="text-gray-300 mb-4 text-sm">
                                            <p className="mb-3">
                                                {deleteConfirm.type === 'project' ? 'æ¡ˆä»¶' :
                                                    deleteConfirm.type === 'task' ? 'å·¥ç¨‹' :
                                                        deleteConfirm.type === 'company' ? 'ä¼šç¤¾' :
                                                            deleteConfirm.type === 'template' ? 'å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ' :
                                                                deleteConfirm.type === 'checklist' ? 'æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ' :
                                                                    deleteConfirm.type === 'projectChecklist' ? 'æ¤œæŸ»ãƒªã‚¹ãƒˆ' :
                                                                        deleteConfirm.type === 'wiring' ? 'é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ' :
                                                                            deleteConfirm.type === 'projectWiring' ? 'é…ç·šä»•æ§˜' : ''}
                                                ã€Œ{deleteConfirm.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ
                                            </p>

                                            <div className="mb-4">
                                                <p className="text-gray-400 text-xs mb-2">
                                                    å‰Šé™¤ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®åå‰ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š
                                                </p>
                                                <div className="bg-gray-800 bg-opacity-50 rounded-lg p-2 mb-2">
                                                    <span className="text-white font-mono text-sm">{deleteConfirm.name}</span>
                                                </div>
                                                <input
                                                    type="text"
                                                    value={deleteConfirm.inputName}
                                                    onChange={(e) => setDeleteConfirm({ ...deleteConfirm, inputName: e.target.value })}
                                                    placeholder="å‰Šé™¤å¯¾è±¡ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                                                    className="w-full px-3 py-2 bg-gray-700 bg-opacity-50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-yellow-500 focus:outline-none text-sm"
                                                />
                                            </div>

                                            {deleteConfirm.type === 'project' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» é–¢é€£ã™ã‚‹å·¥ç¨‹ã‚‚ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'task' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» é–¢é€£ã™ã‚‹æ¤œæŸ»ãƒªã‚¹ãƒˆã‚‚ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'company' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®ä¼šç¤¾ã®å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‚å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'template' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®å·¥ç¨‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'checklist' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®æ¤œæŸ»ãƒªã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'projectChecklist' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®æ¤œæŸ»ãƒªã‚¹ãƒˆã®å…¨ã¦ã®æ¤œæŸ»è¨˜éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'wiring' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®é…ç·šä»•æ§˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                            {deleteConfirm.type === 'projectWiring' && (
                                                <span className="block text-red-300 text-xs mt-2">
                                                    â€» ã“ã®æ¡ˆä»¶ã®é…ç·šä»•æ§˜è¨­å®šãŒå‰Šé™¤ã•ã‚Œã¾ã™
                                                </span>
                                            )}
                                        </div>
                                        <div className="flex gap-2 mb-1.5">
                                            <button
                                                onClick={() => setDeleteConfirm({ show: false, type: '', id: null, name: '', inputName: '' })}
                                                className="flex-1 glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm"
                                            >
                                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                            </button>
                                            <button
                                                onClick={handleDelete}
                                                disabled={deleteConfirm.inputName !== deleteConfirm.name}
                                                className={`flex-1 px-4 py-3 rounded-xl font-bold transition-all duration-300 text-sm ${deleteConfirm.inputName === deleteConfirm.name
                                                    ? 'gradient-red text-white hover:shadow-lg cursor-pointer'
                                                    : 'bg-gray-600 bg-opacity-50 text-gray-400 cursor-not-allowed'
                                                    }`}
                                            >
                                                å‰Šé™¤
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* æ¤œæŸ»ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showChecklistModal && currentProjectChecklist && (
                            <div className="modal-overlay" onClick={() => setShowChecklistModal(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">æ¤œæŸ»ãƒªã‚¹ãƒˆ</h3>
                                    </div>

                                    <div className="space-y-3">
                                        {currentProjectChecklist.categories.map((category, catIndex) => (
                                            <div key={catIndex} className="glass-card-dark mobile-compact-card rounded-xl">
                                                <h4 className="font-bold text-white mobile-text-sm mb-3 mt-1">{category.name}</h4>
                                                <div className="space-y-3 mb-1">
                                                    {category.items.map((item, itemIndex) => (
                                                        <div key={itemIndex} className="glass-card rounded-lg mobile-compact-card"
                                                            style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)', marginBottom: '0' }}>
                                                            <div className="flex-1 mb-3">
                                                                <p className="text-white font-medium mobile-text-sm">{item.name}</p>
                                                                {item.description && (
                                                                    <p className="text-gray-400 mobile-text-xs mt-1">{item.description}</p>
                                                                )}
                                                            </div>

                                                            {/* Combined checkbox and user info section */}
                                                            <div className="flex flex-col gap-2 mb-1">
                                                                <div className="flex items-center justify-between h-[48px]">
                                                                    <label className={`flex items-center gap-2 ${currentProjectChecklist.isTaskCompleted ? 'cursor-default opacity-50 pointer-events-none' : 'cursor-pointer'}`}>
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={item.firstCheck || false}
                                                                            onChange={(e) => {
                                                                                if (!currentProjectChecklist.isTaskCompleted) {
                                                                                    updateChecklistItem(catIndex, itemIndex, 'firstCheck', e.target.checked);
                                                                                }
                                                                            }}
                                                                            disabled={currentProjectChecklist.isTaskCompleted}
                                                                        />
                                                                        <span className="text-gray-300 mobile-text-sm">1æ¬¡</span>
                                                                    </label>
                                                                    {item.firstCheck && item.firstCheckByName && (
                                                                        <div className="mobile-text-xs text-gray-400 flex items-center gap-2">
                                                                            <span
                                                                                className="text-white font-bold px-2 py-1 rounded-full"
                                                                                style={{
                                                                                    fontSize: '8px',
                                                                                    background: getUserIconColor(item.firstCheckBy)
                                                                                }}
                                                                            >
                                                                                {item.firstCheckByName}
                                                                            </span>
                                                                            {item.firstCheckAt && (
                                                                                <span className="text-gray-400 mobile-text-xs">
                                                                                    ({new Date(item.firstCheckAt).toLocaleString('ja-JP', {
                                                                                        month: 'numeric',
                                                                                        day: 'numeric',
                                                                                        hour: '2-digit',
                                                                                        minute: '2-digit'
                                                                                    })})
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                {currentProjectChecklist.checkType !== 'single' && (
                                                                    <div className="flex items-center justify-between h-[48px]">
                                                                        <label className={`flex items-center gap-2 ${currentProjectChecklist.isTaskCompleted ? 'cursor-default opacity-50 pointer-events-none' : 'cursor-pointer'}`}>
                                                                            <input
                                                                                type="checkbox"
                                                                                checked={item.secondCheck || false}
                                                                                onChange={(e) => {
                                                                                    if (!currentProjectChecklist.isTaskCompleted) {
                                                                                        updateChecklistItem(catIndex, itemIndex, 'secondCheck', e.target.checked);
                                                                                    }
                                                                                }}
                                                                                disabled={currentProjectChecklist.isTaskCompleted}
                                                                            />
                                                                            <span className="text-gray-300 mobile-text-sm">2æ¬¡</span>
                                                                        </label>
                                                                        {item.secondCheck && item.secondCheckByName && (
                                                                            <div className="mobile-text-xs text-gray-400 flex items-center gap-2">
                                                                                <span
                                                                                    className="text-white font-bold px-2 py-1 rounded-full"
                                                                                    style={{
                                                                                        fontSize: '8px',
                                                                                        background: getUserIconColor(item.secondCheckBy)
                                                                                    }}
                                                                                >
                                                                                    {item.secondCheckByName}
                                                                                </span>
                                                                                {item.secondCheckAt && (
                                                                                    <span className="text-gray-400 mobile-text-xs">
                                                                                        ({new Date(item.secondCheckAt).toLocaleString('ja-JP', {
                                                                                            month: 'numeric',
                                                                                            day: 'numeric',
                                                                                            hour: '2-digit',
                                                                                            minute: '2-digit'
                                                                                        })})
                                                                                    </span>
                                                                                )}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-3 mobile-compact-card glass-card-dark rounded-xl">
                                        <div className={`grid gap-3 mobile-text-sm ${currentProjectChecklist.checkType === 'single' ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2'}`}>
                                            <div className="text-center sm:text-left">
                                                <span className="text-gray-400">1æ¬¡å®Œäº†: </span>
                                                <span className="text-white font-bold">
                                                    {currentProjectChecklist.categories.reduce((total, cat) =>
                                                        total + cat.items.filter(item => item.firstCheck).length, 0
                                                    )} / {currentProjectChecklist.categories.reduce((total, cat) =>
                                                        total + cat.items.length, 0
                                                    )}
                                                </span>
                                            </div>
                                            {currentProjectChecklist.checkType !== 'single' && (
                                                <div className="text-center sm:text-left">
                                                    <span className="text-gray-400">2æ¬¡å®Œäº†: </span>
                                                    <span className="text-white font-bold">
                                                        {currentProjectChecklist.categories.reduce((total, cat) =>
                                                            total + cat.items.filter(item => item.secondCheck).length, 0
                                                        )} / {currentProjectChecklist.categories.reduce((total, cat) =>
                                                            total + cat.items.length, 0
                                                        )}
                                                    </span>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="mt-6 mb-1.5">
                                        <button
                                            onClick={() => setShowChecklistModal(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            é–‰ã˜ã‚‹
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showEditChecklistModal && editingProjectChecklist && (
                            <div className="modal-overlay" onClick={() => {
                                setShowEditChecklistModal(false);
                                setEditingProjectChecklist(null);
                            }}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">æ¤œæŸ»ãƒªã‚¹ãƒˆç·¨é›†</h3>
                                    </div>

                                    {/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆåã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
                                    <input
                                        type="text"
                                        placeholder="æ¤œæŸ»ãƒªã‚¹ãƒˆå"
                                        value={editingProjectChecklist.templateName || editingProjectChecklist.name || ''}
                                        onChange={(e) => setEditingProjectChecklist({
                                            ...editingProjectChecklist,
                                            templateName: e.target.value,
                                            name: e.target.value
                                        })}
                                        className="w-full dark-input rounded-xl px-4 py-3 mb-3 text-sm focus:outline-none"
                                    />

                                    {/* ãƒã‚§ãƒƒã‚¯ã‚¿ã‚¤ãƒ—é¸æŠ */}
                                    <div className="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 mb-4">
                                        <span className="text-white font-medium mobile-text-sm">ãƒã‚§ãƒƒã‚¯é …ç›®æ•°:</span>
                                        <div className="flex gap-4">
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="editCheckType"
                                                    value="single"
                                                    checked={editingProjectChecklist.checkType === 'single'}
                                                    onChange={(e) => setEditingProjectChecklist({
                                                        ...editingProjectChecklist,
                                                        checkType: e.target.value
                                                    })}
                                                />
                                                <span className="text-gray-300 mobile-text-sm">1æ¬¡ã®ã¿</span>
                                            </label>
                                            <label className="flex items-center gap-2 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="editCheckType"
                                                    value="double"
                                                    checked={editingProjectChecklist.checkType === 'double' || !editingProjectChecklist.checkType}
                                                    onChange={(e) => setEditingProjectChecklist({
                                                        ...editingProjectChecklist,
                                                        checkType: e.target.value
                                                    })}
                                                />
                                                <span className="text-gray-300 mobile-text-sm">1æ¬¡ãƒ»2æ¬¡</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        {editingProjectChecklist.categories.map((category, catIndex) => {
                                            const isCategoryDragging = draggedChecklistCategory && draggedChecklistCategory.index === catIndex;
                                            const isCategoryDragOver = dragOverChecklistCategory && dragOverChecklistCategory.index === catIndex;

                                            return (
                                                <div key={catIndex}
                                                    data-category-index={catIndex}
                                                    className={`glass-card-dark mobile-compact-card rounded-xl task-draggable ${isCategoryDragging ? 'task-dragging' : ''} ${isCategoryDragOver ? 'task-drag-over' : ''}`}
                                                    style={{
                                                        boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                                                        marginBottom: '12px',
                                                        paddingBottom: '6px'
                                                    }}
                                                    draggable="true"
                                                    onDragStart={(e) => {
                                                        setDraggedChecklistCategory({ index: catIndex, category });
                                                        e.dataTransfer.effectAllowed = 'move';
                                                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                                                        e.target.style.opacity = '0.5';
                                                    }}
                                                    onDragEnd={(e) => {
                                                        e.target.style.opacity = '1';
                                                        setDraggedChecklistCategory(null);
                                                        setDragOverChecklistCategory(null);
                                                        setTimeout(() => {
                                                            setDragOverChecklistCategory(null);
                                                        }, 50);
                                                    }}
                                                    onDragOver={(e) => {
                                                        e.preventDefault();
                                                        e.dataTransfer.dropEffect = 'move';
                                                        const categoryElement = e.currentTarget.closest('.task-draggable');
                                                        if (categoryElement && draggedChecklistCategory) {
                                                            const categoryIndex = parseInt(categoryElement.getAttribute('data-category-index'));
                                                            if (categoryIndex !== draggedChecklistCategory.index) {
                                                                setDragOverChecklistCategory({ index: categoryIndex, category: editingProjectChecklist.categories[categoryIndex] });
                                                            }
                                                        }
                                                    }}
                                                    onDragEnter={(e) => {
                                                        e.preventDefault();
                                                        if (draggedChecklistCategory && catIndex !== draggedChecklistCategory.index) {
                                                            setDragOverChecklistCategory({ index: catIndex, category });
                                                        }
                                                    }}
                                                    onDragLeave={(e) => {
                                                        const relatedTarget = e.relatedTarget;
                                                        const currentTarget = e.currentTarget;
                                                        if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                                                            setDragOverChecklistCategory(null);
                                                        }
                                                    }}
                                                    onDrop={(e) => {
                                                        e.preventDefault();
                                                        setDragOverChecklistCategory(null);

                                                        if (!draggedChecklistCategory || draggedChecklistCategory.index === catIndex) {
                                                            return;
                                                        }

                                                        const dragIndex = draggedChecklistCategory.index;
                                                        const dropIndex = catIndex;
                                                        const updated = { ...editingProjectChecklist };
                                                        const draggedItem = updated.categories[dragIndex];
                                                        updated.categories.splice(dragIndex, 1);
                                                        updated.categories.splice(dropIndex, 0, draggedItem);
                                                        setEditingProjectChecklist(updated);
                                                    }}>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <input
                                                            type="text"
                                                            value={category.name}
                                                            onChange={(e) => {
                                                                const updated = { ...editingProjectChecklist };
                                                                updated.categories[catIndex].name = e.target.value;
                                                                setEditingProjectChecklist(updated);
                                                            }}
                                                            className={`flex-1 dark-input rounded-xl px-3 py-3 text-xs focus:outline-none ${editingProjectChecklist.categories.length > 1 ? 'mr-2' : ''}`}
                                                            placeholder="ã‚«ãƒ†ã‚´ãƒªå"
                                                        />
                                                        {editingProjectChecklist.categories.length > 1 && (
                                                            <button
                                                                onClick={() => {
                                                                    const updated = { ...editingProjectChecklist };
                                                                    updated.categories = updated.categories.filter((_, i) => i !== catIndex);
                                                                    setEditingProjectChecklist(updated);
                                                                }}
                                                                className="text-gray-400 hover:text-white text-xl flex-shrink-0"
                                                            >
                                                                âœ•
                                                            </button>
                                                        )}
                                                    </div>

                                                    <div className="space-y-2 ml-2 sm:ml-4">
                                                        {category.items.map((item, itemIndex) => {
                                                            const isItemDragging = draggedChecklistItem && draggedChecklistItem.catIndex === catIndex && draggedChecklistItem.itemIndex === itemIndex;
                                                            const isItemDragOver = dragOverChecklistItem && dragOverChecklistItem.catIndex === catIndex && dragOverChecklistItem.itemIndex === itemIndex;

                                                            return (
                                                                <div key={itemIndex}
                                                                    data-category-index={catIndex}
                                                                    data-item-index={itemIndex}
                                                                    className={`space-y-2 task-draggable ${isItemDragging ? 'task-dragging' : ''} ${isItemDragOver ? 'task-drag-over' : ''}`}
                                                                    draggable="true"
                                                                    onDragStart={(e) => {
                                                                        setDraggedChecklistItem({ catIndex, itemIndex, item });
                                                                        e.dataTransfer.effectAllowed = 'move';
                                                                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                                                                        e.target.style.opacity = '0.5';
                                                                    }}
                                                                    onDragEnd={(e) => {
                                                                        e.target.style.opacity = '1';
                                                                        setDraggedChecklistItem(null);
                                                                        setDragOverChecklistItem(null);
                                                                        setTimeout(() => {
                                                                            setDragOverChecklistItem(null);
                                                                        }, 50);
                                                                    }}
                                                                    onDragOver={(e) => {
                                                                        e.preventDefault();
                                                                        e.dataTransfer.dropEffect = 'move';
                                                                        if (draggedChecklistItem) {
                                                                            if (draggedChecklistItem.catIndex === catIndex &&
                                                                                draggedChecklistItem.itemIndex !== itemIndex) {
                                                                                setDragOverChecklistItem({ catIndex, itemIndex, item });
                                                                            }
                                                                        }
                                                                    }}
                                                                    onDragEnter={(e) => {
                                                                        e.preventDefault();
                                                                        if (draggedChecklistItem &&
                                                                            draggedChecklistItem.catIndex === catIndex &&
                                                                            draggedChecklistItem.itemIndex !== itemIndex) {
                                                                            setDragOverChecklistItem({ catIndex, itemIndex, item });
                                                                        }
                                                                    }}
                                                                    onDragLeave={(e) => {
                                                                        const relatedTarget = e.relatedTarget;
                                                                        const currentTarget = e.currentTarget;
                                                                        if (!relatedTarget || !currentTarget.contains(relatedTarget)) {
                                                                            setDragOverChecklistItem(null);
                                                                        }
                                                                    }}
                                                                    onDrop={(e) => {
                                                                        e.preventDefault();
                                                                        setDragOverChecklistItem(null);

                                                                        if (!draggedChecklistItem ||
                                                                            draggedChecklistItem.catIndex !== catIndex ||
                                                                            draggedChecklistItem.itemIndex === itemIndex) {
                                                                            return;
                                                                        }

                                                                        const dragIndex = draggedChecklistItem.itemIndex;
                                                                        const dropIndex = itemIndex;
                                                                        const updated = { ...editingProjectChecklist };
                                                                        const draggedItem = updated.categories[catIndex].items[dragIndex];
                                                                        updated.categories[catIndex].items.splice(dragIndex, 1);
                                                                        updated.categories[catIndex].items.splice(dropIndex, 0, draggedItem);
                                                                        setEditingProjectChecklist(updated);
                                                                    }}>
                                                                    <div className="flex gap-2">
                                                                        <input
                                                                            type="text"
                                                                            value={item.name}
                                                                            onChange={(e) => {
                                                                                const updated = { ...editingProjectChecklist };
                                                                                updated.categories[catIndex].items[itemIndex].name = e.target.value;
                                                                                setEditingProjectChecklist(updated);
                                                                            }}
                                                                            className="flex-1 dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                                            placeholder="æ¤œæŸ»é …ç›®"
                                                                        />
                                                                        {category.items.length > 1 && (
                                                                            <button
                                                                                onClick={() => {
                                                                                    const updated = { ...editingProjectChecklist };
                                                                                    updated.categories[catIndex].items = updated.categories[catIndex].items.filter((_, i) => i !== itemIndex);
                                                                                    setEditingProjectChecklist(updated);
                                                                                }}
                                                                                className="text-gray-400 hover:text-white text-xl flex-shrink-0"
                                                                            >
                                                                                âœ•
                                                                            </button>
                                                                        )}
                                                                    </div>
                                                                    <input
                                                                        type="text"
                                                                        value={item.description || ''}
                                                                        onChange={(e) => {
                                                                            const updated = { ...editingProjectChecklist };
                                                                            updated.categories[catIndex].items[itemIndex].description = e.target.value;
                                                                            setEditingProjectChecklist(updated);
                                                                        }}
                                                                        className="w-full dark-input rounded-xl px-3 py-3 text-xs focus:outline-none"
                                                                        placeholder="å‚™è€ƒï¼ˆä»»æ„ï¼‰"
                                                                    />
                                                                </div>
                                                            );
                                                        })}
                                                        <button
                                                            onClick={() => {
                                                                const updated = { ...editingProjectChecklist };
                                                                updated.categories[catIndex].items.push({
                                                                    name: '',
                                                                    description: '',
                                                                    firstCheck: false,
                                                                    secondCheck: false
                                                                });
                                                                setEditingProjectChecklist(updated);
                                                            }}
                                                            className="mobile-text-xs text-gray-400 hover:text-white"
                                                        >
                                                            + é …ç›®ã‚’è¿½åŠ 
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}

                                        <button
                                            onClick={() => {
                                                const updated = { ...editingProjectChecklist };
                                                updated.categories.push({
                                                    name: '',
                                                    items: [{
                                                        name: '',
                                                        description: '',
                                                        firstCheck: false,
                                                        secondCheck: false
                                                    }]
                                                });
                                                setEditingProjectChecklist(updated);
                                            }}
                                            className="w-full glass-card-dark text-white py-2 rounded-lg mobile-text-sm"
                                        >
                                            + ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ 
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-1 gap-2 mb-1.5">
                                        <button
                                            onClick={saveEditedChecklist}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            æ›´æ–°
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowEditChecklistModal(false);
                                                setEditingProjectChecklist(null); // nullã«è¨­å®šã—ã¦å®Œå…¨ã«ã‚¯ãƒªã‚¢
                                            }}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* é…ç·šä»•æ§˜ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showWiringModal && currentProjectWiring && (
                            <div className="modal-overlay" onClick={() => setShowWiringModal(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-5xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">é…ç·šä»•æ§˜: {currentProjectWiring.templateName}</h3>
                                    </div>

                                    {(() => {
                                        const specs = currentProjectWiring.specifications;

                                        return (
                                            <div className="space-y-3">
                                                {/* ä½¿ç”¨é›»ç·šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                                {((specs.wire.power.standards?.length > 0 || specs.wire.power.wiringType || Object.keys(specs.wire.power.phases || {}).some(key => specs.wire.power.phases[key]) || specs.wire.power.remarks) ||
                                                    (specs.wire.ground.caseColor || specs.wire.ground.doorColor || specs.wire.ground.panelColor || specs.wire.ground.remarks) ||
                                                    specs.wire.insulationCap ||
                                                    (specs.wire.controlAC.standards?.length > 0 || specs.wire.controlAC.commonColor || specs.wire.controlAC.nonCommonColor || specs.wire.controlAC.remarks) ||
                                                    (specs.wire.controlDC.standards?.length > 0 || specs.wire.controlDC.pBusColor || specs.wire.controlDC.nBusColor || specs.wire.controlDC.otherColor || specs.wire.controlDC.remarks) ||
                                                    specs.wire.specialSpec ||
                                                    (specs.wire.manufacturerSpecified && specs.wire.manufacturer)) && (
                                                        <div className="glass-card-dark mobile-compact-card rounded-xl mb-4" style={{ padding: '8px 12px 12px 12px' }}>
                                                            <h4 className="mobile-text-sm font-bold text-white mb-2 mt-1">é›»ç·š</h4>
                                                            <div className="space-y-3">
                                                                {/* å‹•åŠ› */}
                                                                {(specs.wire.power.standards?.length > 0 || specs.wire.power.wiringType || Object.keys(specs.wire.power.phases || {}).some(key => specs.wire.power.phases[key]) || specs.wire.power.remarks) && (
                                                                    <div>
                                                                        <h5 className="mobile-text-sm font-bold text-white mb-3">å‹•åŠ›</h5>

                                                                        <div className="space-y-3">
                                                                            {/* è¦æ ¼ */}
                                                                            {specs.wire.power.standards?.length > 0 && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">è¦æ ¼</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹é›»ç·šè¦æ ¼</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.power.standards.map((standard, index) =>
                                                                                                standard === 'ãã®ä»–' && specs.wire.power[`customStandard${index}`]
                                                                                                    ? specs.wire.power[`customStandard${index}`]
                                                                                                    : standard
                                                                                            ).join(', ')}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* é…ç·šæ–¹å¼ */}
                                                                            {specs.wire.power.wiringType && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">é…ç·šæ–¹å¼</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹é…ç·šæ–¹å¼</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.power.wiringType === 'three-phase-4' ? 'ä¸‰ç›¸4ç·š' :
                                                                                                specs.wire.power.wiringType === 'three-phase-3' ? 'ä¸‰ç›¸3ç·š' :
                                                                                                    specs.wire.power.wiringType === 'single-phase-3' ? 'å˜ç›¸3ç·š' :
                                                                                                        specs.wire.power.wiringType === 'single-phase-2' ? 'å˜ç›¸2ç·š' :
                                                                                                            specs.wire.power.wiringType}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* ç›¸ç·šè‰²ï¼ˆç›¸ã”ã¨ã«å€‹åˆ¥è¡¨ç¤ºï¼‰ */}
                                                                            {['rPhase', 'sPhase', 'tPhase', 'lPhase', 'nPhase']
                                                                                .filter(key => specs.wire.power.phases[key])
                                                                                .map((key) => (
                                                                                    <div key={key} className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                        <div className="flex-1">
                                                                                            <p className="text-white font-medium mobile-text-sm">
                                                                                                {key === 'rPhase' ? 'Rç›¸' :
                                                                                                    key === 'sPhase' ? 'Sç›¸' :
                                                                                                        key === 'tPhase' ? 'Tç›¸' :
                                                                                                            key === 'lPhase' ? 'Lç›¸' :
                                                                                                                key === 'nPhase' ? 'Nç›¸' :
                                                                                                                    key.replace('Phase', 'ç›¸')}
                                                                                            </p>
                                                                                            <p className="text-gray-400 mobile-text-xs">
                                                                                                {key === 'rPhase' ? 'Rç›¸ã®ä»•æ§˜' :
                                                                                                    key === 'sPhase' ? 'Sç›¸ã®ä»•æ§˜' :
                                                                                                        key === 'tPhase' ? 'Tç›¸ã®ä»•æ§˜' :
                                                                                                            key === 'lPhase' ? 'Lç›¸ã®ä»•æ§˜' :
                                                                                                                key === 'nPhase' ? 'Nç›¸ã®ä»•æ§˜' :
                                                                                                                    key.replace('Phase', 'ç›¸ã®ä»•æ§˜')}
                                                                                            </p>
                                                                                        </div>
                                                                                        <div className="text-right flex-1 ml-4">
                                                                                            <p className="text-white font-medium mobile-text-sm">
                                                                                                {specs.wire.power.phases[key] === 'ãã®ä»–' && specs.wire.power[`${key}Custom`]
                                                                                                    ? specs.wire.power[`${key}Custom`]
                                                                                                    : specs.wire.power.phases[key]}
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                ))}

                                                                            {/* å‚™è€ƒ */}
                                                                            {specs.wire.power.remarks && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„ç‰¹æ®Šä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right flex-1 ml-4">
                                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.power.remarks}</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* æ¥åœ° */}
                                                                {(specs.wire.ground.caseColor || specs.wire.ground.doorColor || specs.wire.ground.panelColor || specs.wire.ground.remarks) && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">æ¥åœ°</h5>

                                                                        <div className="space-y-3">
                                                                            {/* ç­ä½“ */}
                                                                            {specs.wire.ground.caseColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">ç­ä½“</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ç­ä½“æ¥åœ°ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">{specs.wire.ground.caseColor} / {specs.wire.ground.caseDiameter}sq</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* æ‰‰ */}
                                                                            {specs.wire.ground.doorColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">æ‰‰</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">æ‰‰æ¥åœ°ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">{specs.wire.ground.doorColor} / {specs.wire.ground.doorDiameter}sq</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* ç›¤é–“ */}
                                                                            {specs.wire.ground.panelColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">ç›¤é–“</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ç›¤é–“æ¥åœ°ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">{specs.wire.ground.panelColor} / {specs.wire.ground.panelDiameter}sq</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* æ¥åœ°ã®å‚™è€ƒ */}
                                                                            {specs.wire.ground.remarks && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                                    </div>
                                                                                    <div className="text-right flex-1 ml-4">
                                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.ground.remarks}</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ— */}
                                                                {((specs.wire.insulationCap && specs.wire.insulationCap !== '' && specs.wire.insulationCap !== 'é¸æŠã—ã¦ãã ã•ã„') || specs.wire.insulationCapRemarks) && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ—</h5>

                                                                        <div className="space-y-3">
                                                                            {/* è¨­å®šã‚«ãƒ¼ãƒ‰ã¯çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤º */}
                                                                            {specs.wire.insulationCap && specs.wire.insulationCap !== '' && specs.wire.insulationCap !== 'é¸æŠã—ã¦ãã ã•ã„' && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">è¨­å®š</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">çµ¶ç¸ã‚­ãƒ£ãƒƒãƒ—ã®ä½¿ç”¨è¨­å®š</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.insulationCap}
                                                                                            {specs.wire.insulationCapDiameter && ` (${specs.wire.insulationCapDiameter}sqä»¥ä¸Š)`}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* å‚™è€ƒ */}
                                                                            {specs.wire.insulationCapRemarks && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä½¿ç”¨ã‚„æ³¨æ„äº‹é …</p>
                                                                                    </div>
                                                                                    <div className="text-right flex-1 ml-4">
                                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.insulationCapRemarks}</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* åˆ¶å¾¡AC */}
                                                                {(specs.wire.controlAC.standards?.length > 0 || specs.wire.controlAC.commonColor || specs.wire.controlAC.nonCommonColor || specs.wire.controlAC.remarks) && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">åˆ¶å¾¡AC</h5>

                                                                        <div className="space-y-3">
                                                                            {/* è¦æ ¼ */}
                                                                            {specs.wire.controlAC.standards?.length > 0 && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">è¦æ ¼</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹é›»ç·šè¦æ ¼</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlAC.standards.map((standard, index) =>
                                                                                                standard === 'ãã®ä»–' && specs.wire.controlAC[`customStandard${index}`]
                                                                                                    ? specs.wire.controlAC[`customStandard${index}`]
                                                                                                    : standard
                                                                                            ).join(', ')}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* ã‚³ãƒ¢ãƒ³ */}
                                                                            {specs.wire.controlAC.commonColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">ã‚³ãƒ¢ãƒ³</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ã‚³ãƒ¢ãƒ³ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlAC.commonColor === 'ãã®ä»–' && specs.wire.controlAC.commonColorCustom
                                                                                                ? specs.wire.controlAC.commonColorCustom
                                                                                                : specs.wire.controlAC.commonColor} / {specs.wire.controlAC.commonDiameter}sq
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* ã‚³ãƒ¢ãƒ³ä»¥å¤– */}
                                                                            {specs.wire.controlAC.nonCommonColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">ã‚³ãƒ¢ãƒ³ä»¥å¤–</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">éã‚³ãƒ¢ãƒ³ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlAC.nonCommonColor === 'ãã®ä»–' && specs.wire.controlAC.nonCommonColorCustom
                                                                                                ? specs.wire.controlAC.nonCommonColorCustom
                                                                                                : specs.wire.controlAC.nonCommonColor} / {specs.wire.controlAC.nonCommonDiameter}sq
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* åˆ¶å¾¡ACã®å‚™è€ƒ */}
                                                                            {specs.wire.controlAC.remarks && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                                    </div>
                                                                                    <div className="text-right flex-1 ml-4">
                                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.controlAC.remarks}</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* åˆ¶å¾¡DC */}
                                                                {(specs.wire.controlDC.standards?.length > 0 || specs.wire.controlDC.pBusColor || specs.wire.controlDC.nBusColor || specs.wire.controlDC.otherColor || specs.wire.controlDC.remarks) && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">åˆ¶å¾¡DC</h5>

                                                                        <div className="space-y-3">
                                                                            {/* è¦æ ¼ */}
                                                                            {specs.wire.controlDC.standards?.length > 0 && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">è¦æ ¼</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹é›»ç·šè¦æ ¼</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlDC.standards.map((standard, index) =>
                                                                                                standard === 'ãã®ä»–' && specs.wire.controlDC[`customStandard${index}`]
                                                                                                    ? specs.wire.controlDC[`customStandard${index}`]
                                                                                                    : standard
                                                                                            ).join(', ')}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* Pæ¯ç·š */}
                                                                            {specs.wire.controlDC.pBusColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">Pæ¯ç·š</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">Pæ¯ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlDC.pBusColor === 'ãã®ä»–' && specs.wire.controlDC.pBusColorCustom
                                                                                                ? specs.wire.controlDC.pBusColorCustom
                                                                                                : specs.wire.controlDC.pBusColor} / {specs.wire.controlDC.pBusDiameter}sq
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* Næ¯ç·š */}
                                                                            {specs.wire.controlDC.nBusColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">Næ¯ç·š</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">Næ¯ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlDC.nBusColor === 'ãã®ä»–' && specs.wire.controlDC.nBusColorCustom
                                                                                                ? specs.wire.controlDC.nBusColorCustom
                                                                                                : specs.wire.controlDC.nBusColor} / {specs.wire.controlDC.nBusDiameter}sq
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* æ¯ç·šä»¥å¤– */}
                                                                            {specs.wire.controlDC.otherColor && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">æ¯ç·šä»¥å¤–</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">éæ¯ç·šã®ä»•æ§˜</p>
                                                                                    </div>
                                                                                    <div className="text-right">
                                                                                        <span className="text-white mobile-text-sm">
                                                                                            {specs.wire.controlDC.otherColor === 'ãã®ä»–' && specs.wire.controlDC.otherColorCustom
                                                                                                ? specs.wire.controlDC.otherColorCustom
                                                                                                : specs.wire.controlDC.otherColor} / {specs.wire.controlDC.otherDiameter}sq
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            )}

                                                                            {/* åˆ¶å¾¡DCã®å‚™è€ƒ */}
                                                                            {specs.wire.controlDC.remarks && (
                                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                                    <div className="flex-1">
                                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                                    </div>
                                                                                    <div className="text-right flex-1 ml-4">
                                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.controlDC.remarks}</span>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* ç‰¹æ®Šä»•æ§˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                                                                {specs.wire.specialSpec && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">ç‰¹æ®Šä»•æ§˜</h5>
                                                                        <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                            <div className="flex-1">
                                                                                <p className="text-white font-medium mobile-text-sm">ä»•æ§˜è©³ç´°</p>
                                                                                <p className="text-gray-400 mobile-text-xs">ç‰¹æ®Šãªä»•æ§˜ã‚„è¦æ±‚äº‹é …</p>
                                                                            </div>
                                                                            <div className="text-right flex-1 ml-4">
                                                                                <span className="text-white mobile-text-sm whitespace-pre-line">{specs.wire.specialSpec}</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {/* ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®šï¼ˆé›»ç·šï¼‰ - ç‰¹æ®Šä»•æ§˜ã®ç›´å¾Œã«é…ç½® */}
                                                                {specs.wire.manufacturerSpecified && specs.wire.manufacturer && (
                                                                    <div>
                                                                        <h5 className="text-white font-bold mobile-text-sm mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                                                        <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                            <div className="flex-1">
                                                                                <p className="text-white font-medium mobile-text-sm">æŒ‡å®šãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                                <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹é›»ç·šãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                            </div>
                                                                            <div className="text-right">
                                                                                <span className="text-white mobile-text-sm">{specs.wire.manufacturer}</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    )}

                                                {/* åœ§ç€ç«¯å­ */}
                                                {(specs.terminal.power || specs.terminal.controlAC || specs.terminal.controlDC || specs.terminal.simultaneousCrimp || specs.terminal.screwClamp || specs.terminal.screwlessClamp || specs.terminal.remarks || (specs.terminal.manufacturerSpecified && specs.terminal.manufacturer)) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm mb-2">åœ§ç€ç«¯å­</h4>

                                                        <div className="space-y-3">
                                                            {specs.terminal.power && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‹•åŠ›</p>
                                                                        <p className="text-gray-400 mobile-text-xs">å‹•åŠ›å›è·¯ç”¨åœ§ç€ç«¯å­</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.power}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.controlAC && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">åˆ¶å¾¡AC</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ACåˆ¶å¾¡å›è·¯ç”¨åœ§ç€ç«¯å­</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.controlAC}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.controlDC && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">åˆ¶å¾¡DC</p>
                                                                        <p className="text-gray-400 mobile-text-xs">DCåˆ¶å¾¡å›è·¯ç”¨åœ§ç€ç«¯å­</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.controlDC}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.simultaneousCrimp && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">åŒæ™‚åœ§ç€</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¤‡æ•°ç·šã®åŒæ™‚åœ§ç€å¯å¦</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.simultaneousCrimp}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.screwClamp && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ãƒã‚¸å¼ã‚¯ãƒ©ãƒ³ãƒ—ç«¯å­å°</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒã‚¸å¼ã‚¯ãƒ©ãƒ³ãƒ—ç«¯å­å°ã¸ã®é…ç·š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.screwClamp}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.screwlessClamp && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ã‚¹ã‚¯ãƒªãƒ¥ãƒ¼ãƒ¬ã‚¹ç«¯å­å°</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ã‚¹ã‚¯ãƒªãƒ¥ãƒ¼ãƒ¬ã‚¹ç«¯å­å°ã¸ã®é…ç·š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminal.screwlessClamp}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.terminal.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminal.manufacturerSpecified && specs.terminal.manufacturer && (
                                                                <div>
                                                                    <h5 className="text-white font-bold mobile-text-sm mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                                                    <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                        <div className="flex-1">
                                                                            <p className="text-white font-medium mobile-text-sm">æŒ‡å®šãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                            <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹åœ§ç€ç«¯å­ãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                        </div>
                                                                        <div className="text-right">
                                                                            <span className="text-white mobile-text-sm">{specs.terminal.manufacturer}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* ç«¯å­å° */}
                                                {(specs.terminalBlock.namePlate || specs.terminalBlock.cover || specs.terminalBlock.bridge || specs.terminalBlock.maxWires || specs.terminalBlock.remarks || (specs.terminalBlock.manufacturerSpecified && specs.terminalBlock.manufacturer)) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm mb-2">ç«¯å­å°</h4>

                                                        <div className="space-y-3">
                                                            {specs.terminalBlock.namePlate && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">è¨˜åæ¿</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¨˜åæ¿ã®æœ‰ç„¡</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminalBlock.namePlate}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminalBlock.cover && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ã‚«ãƒãƒ¼</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ç«¯å­å°ã‚«ãƒãƒ¼ã®æœ‰ç„¡</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminalBlock.cover}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminalBlock.bridge && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">æ¸¡ã‚Šé‡‘å…·</p>
                                                                        <p className="text-gray-400 mobile-text-xs">æ¸¡ã‚Šé‡‘å…·ã®ä½¿ç”¨è¨­å®š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.terminalBlock.bridge}
                                                                            {specs.terminalBlock.bridge === 'ä½¿ç”¨å¯ï¼ˆæŒ‡å®šæœ‰ã‚Šï¼‰' && specs.terminalBlock.bridgeSpec &&
                                                                                ` (${specs.terminalBlock.bridgeSpec})`
                                                                            }
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminalBlock.maxWires && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">é…ç·šå¯èƒ½æ•°</p>
                                                                        <p className="text-gray-400 mobile-text-xs">1ç«¯å­ã‚ãŸã‚Šã®é…ç·šå¯èƒ½æ•°</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">{specs.terminalBlock.maxWires}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminalBlock.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.terminalBlock.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.terminalBlock.manufacturerSpecified && specs.terminalBlock.manufacturer && (
                                                                <div>
                                                                    <h5 className="text-white font-bold mobile-text-sm mb-3">ãƒ¡ãƒ¼ã‚«ãƒ¼æŒ‡å®š</h5>
                                                                    <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                        <div className="flex-1">
                                                                            <p className="text-white font-medium mobile-text-sm">æŒ‡å®šãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                            <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹ç«¯å­å°ãƒ¡ãƒ¼ã‚«ãƒ¼</p>
                                                                        </div>
                                                                        <div className="text-right">
                                                                            <span className="text-white mobile-text-sm">{specs.terminalBlock.manufacturer}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* è¨˜åæ¿ */}
                                                {((specs.namePlate.fontSize && specs.namePlate.fontSize !== '' && specs.namePlate.fontSize !== 'é¸æŠã—ã¦ãã ã•ã„') || specs.namePlate.remarks) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm mb-2">è¨˜åæ¿</h4>

                                                        <div className="space-y-3">
                                                            {/* æ–‡å­—ã‚µã‚¤ã‚ºãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤º */}
                                                            {specs.namePlate.fontSize && specs.namePlate.fontSize !== '' && specs.namePlate.fontSize !== 'é¸æŠã—ã¦ãã ã•ã„' && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">æ–‡å­—ã‚µã‚¤ã‚º</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¨˜åæ¿ã®æ–‡å­—ã‚µã‚¤ã‚ºè¨­å®š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.namePlate.fontSize === 'ãã®ä»–' && specs.namePlate.customFontSize
                                                                                ? specs.namePlate.customFontSize
                                                                                : specs.namePlate.fontSize}
                                                                        </span>

                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.namePlate.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.namePlate.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ« */}
                                                {(specs.deviceSeal.fontSize || specs.deviceSeal.length || specs.deviceSeal.positions?.length > 0 || specs.deviceSeal.remarks) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm mb-2">ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«</h4>

                                                        <div className="space-y-3">
                                                            {specs.deviceSeal.fontSize && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">æ–‡å­—ã‚µã‚¤ã‚º</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«ã®æ–‡å­—ã‚µã‚¤ã‚º</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.deviceSeal.fontSize === 'ãã®ä»–' && specs.deviceSeal.customFontSize
                                                                                ? specs.deviceSeal.customFontSize
                                                                                : specs.deviceSeal.fontSize}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {specs.deviceSeal.length && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">é•·ã•</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«ã®é•·ã•è¨­å®š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.deviceSeal.length === 'ãã®ä»–' && specs.deviceSeal.customLength
                                                                                ? specs.deviceSeal.customLength
                                                                                : specs.deviceSeal.length}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {specs.deviceSeal.positions?.length > 0 && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ä½ç½®</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒ‡ãƒã‚¤ã‚¹ã‚·ãƒ¼ãƒ«ã®å–ä»˜ä½ç½®</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.deviceSeal.positions.join(', ')}
                                                                            {specs.deviceSeal.customPosition && `, ${specs.deviceSeal.customPosition}`}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.deviceSeal.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.deviceSeal.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ– */}
                                                {(Object.values(specs.markTube?.orientation || {}).some(v => v) || specs.markTube?.fontSize || specs.markTube?.length || specs.markTube?.printSpec || specs.markTube?.remarks) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm -mb-1">ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ–</h4>

                                                        {Object.values(specs.markTube.orientation || {}).some(v => v) && (
                                                            <div className="glass-card mobile-compact-card rounded-lg mb-3 mt-3 pb-16" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                <h5 className="text-white font-medium mobile-text-sm mb-3">å‘ã</h5>
                                                                <div className="flex justify-center">
                                                                    <div
                                                                        className="relative mb-3"   // â† ã“ã“ã§å›³ã‚’ä¸‹ã«ãšã‚‰ã™
                                                                        style={{
                                                                            width: '200px', height: '200px',        // 200px â†’ 150pxã«å¤‰æ›´
                                                                            transform: 'scale(0.7)'
                                                                        }}
                                                                    >
                                                                        {/* ä¸­å¤®ã®å†† */}
                                                                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-gray-600 rounded-full border-2 border-white"></div>

                                                                        {/* ä¸Š - æ ã”ã¨æ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ */}
                                                                        <div className="absolute top-2 left-1/2 transform -translate-x-1/2"
                                                                            style={{ transform: 'translateX(-50%) rotate(90deg)', transformOrigin: 'center' }}>
                                                                            <div className="w-16 h-10 border-2 border-gray-400 rounded flex items-center justify-center bg-gray-800">
                                                                                <span className={`text-white font-bold`}
                                                                                    style={{ transform: specs.markTube.orientation.up === 'é€†å‘ã' ? 'rotate(180deg)' : 'none' }}>
                                                                                    ABC
                                                                                </span>
                                                                            </div>
                                                                        </div>

                                                                        {/* ä¸‹ - æ ã”ã¨åæ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ */}
                                                                        <div className="absolute bottom-2 left-1/2 transform -translate-x-1/2"
                                                                            style={{ transform: 'translateX(-50%) rotate(-90deg)', transformOrigin: 'center' }}>
                                                                            <div className="w-16 h-10 border-2 border-gray-400 rounded flex items-center justify-center bg-gray-800">
                                                                                <span className={`text-white font-bold`}
                                                                                    style={{ transform: specs.markTube.orientation.down === 'é€†å‘ã' ? 'rotate(180deg)' : 'none' }}>
                                                                                    ABC
                                                                                </span>
                                                                            </div>
                                                                        </div>

                                                                        {/* å·¦ - æ–‡å­—ã®ã¿æ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ */}
                                                                        <div className="absolute top-1/2 left-0 transform -translate-y-1/2 w-16 h-10 border-2 border-gray-400 rounded flex items-center justify-center bg-gray-800">
                                                                            <span className="text-white font-bold"
                                                                                style={{ transform: `rotate(0deg) ${specs.markTube.orientation.left === 'é€†å‘ã' ? 'rotate(180deg)' : ''}` }}>
                                                                                ABC
                                                                            </span>
                                                                        </div>

                                                                        {/* å³ - æ–‡å­—ã®ã¿æ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ */}
                                                                        <div className="absolute top-1/2 right-0 transform -translate-y-1/2 w-16 h-10 border-2 border-gray-400 rounded flex items-center justify-center bg-gray-800">
                                                                            <span className="text-white font-bold"
                                                                                style={{ transform: `rotate(180deg) ${specs.markTube.orientation.right === 'é€†å‘ã' ? 'rotate(180deg)' : ''}` }}>
                                                                                ABC
                                                                            </span>
                                                                        </div>

                                                                        {/* ãƒ©ãƒ™ãƒ« */}
                                                                        <div className="absolute -top-10 left-1/2 transform -translate-x-1/2 text-white font-medium">ä¸Š: {specs.markTube.orientation.up || 'æœªè¨­å®š'}</div>
                                                                        <div className="absolute -bottom-10 left-1/2 transform -translate-x-1/2 text-white font-medium">ä¸‹: {specs.markTube.orientation.down || 'æœªè¨­å®š'}</div>
                                                                        <div className="absolute top-1/2 -left-20 transform -translate-y-1/2 text-white font-medium">å·¦: {specs.markTube.orientation.left || 'æœªè¨­å®š'}</div>
                                                                        <div className="absolute top-1/2 -right-20 transform -translate-y-1/2 text-white font-medium">å³: {specs.markTube.orientation.right || 'æœªè¨­å®š'}</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}

                                                        {/* ãã®ä»–ã®ä»•æ§˜ */}
                                                        <div className="space-y-3 mt-3">
                                                            {specs.markTube.fontSize && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">æ–‡å­—ã‚µã‚¤ã‚º</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ–ã®æ–‡å­—ã‚µã‚¤ã‚º</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.markTube.fontSize === 'ãã®ä»–' && specs.markTube.customFontSize
                                                                                ? specs.markTube.customFontSize
                                                                                : specs.markTube.fontSize}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.markTube.length && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">é•·ã•</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒ–ã®é•·ã•è¨­å®š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.markTube.length === 'ãã®ä»–' && specs.markTube.customLength
                                                                                ? specs.markTube.customLength
                                                                                : specs.markTube.length}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.markTube.printSpec && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å°å­—ä»•æ§˜</p>
                                                                        <p className="text-gray-400 mobile-text-xs">å°å­—ã®ä»•æ§˜ã¨è©³ç´°</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.markTube.printSpec}
                                                                            {specs.markTube.printSpecDetail && ` (${specs.markTube.printSpecDetail})`}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.markTube.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">è¿½åŠ ã®ä»•æ§˜ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.markTube.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* ãã®ä»–ç¢ºèªäº‹é … */}
                                                {(specs.otherConfirm.tighteningPen || specs.otherConfirm.matchMark || specs.otherConfirm.screw || specs.otherConfirm.hookTube || specs.otherConfirm.spiralTube || specs.otherConfirm.insulock || specs.otherConfirm.mountBase || specs.otherConfirm.routeSpecialNote || specs.otherConfirm.remarks) && (
                                                    <div className="glass-card-dark mobile-compact-card rounded-xl" style={{ padding: '8px 12px 12px 12px' }}>
                                                        <h4 className="text-lg font-bold text-white mobile-text-sm mb-2">ãã®ä»–ç¢ºèªäº‹é …</h4>

                                                        <div className="space-y-3">
                                                            {specs.otherConfirm.tighteningPen && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å¢—ã—ç· ã‚ãƒšãƒ³</p>
                                                                        <p className="text-gray-400 mobile-text-xs">å¢—ã—ç· ã‚ãƒšãƒ³ã®ä½¿ç”¨è¨­å®š</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.tighteningPen}
                                                                            {specs.otherConfirm.tighteningPenDetail && ` (${specs.otherConfirm.tighteningPenDetail})`}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.matchMark && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">åˆãƒãƒ¼ã‚¯</p>
                                                                        <p className="text-gray-400 mobile-text-xs">åˆãƒãƒ¼ã‚¯ã®è¡¨è¨˜æ–¹å¼</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.matchMark === 'ãã®ä»–' && specs.otherConfirm.matchMarkDetail
                                                                                ? specs.otherConfirm.matchMarkDetail
                                                                                : specs.otherConfirm.matchMark}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.screw && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ãƒã‚¸</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ä½¿ç”¨ã™ã‚‹ãƒã‚¸ã®ç¨®é¡</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.screw === 'ãã®ä»–' && specs.otherConfirm.screwDetail
                                                                                ? specs.otherConfirm.screwDetail
                                                                                : specs.otherConfirm.screw}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.hookTube && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ãƒ›ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒ–</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒ›ãƒƒã‚¯ãƒãƒ¥ãƒ¼ãƒ–ã®è‰²</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.hookTube === 'ãã®ä»–' && specs.otherConfirm.hookTubeDetail
                                                                                ? specs.otherConfirm.hookTubeDetail
                                                                                : specs.otherConfirm.hookTube}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.spiralTube && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒãƒ¥ãƒ¼ãƒ–</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒãƒ¥ãƒ¼ãƒ–ã®è‰²</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.spiralTube === 'ãã®ä»–' && specs.otherConfirm.spiralTubeDetail
                                                                                ? specs.otherConfirm.spiralTubeDetail
                                                                                : specs.otherConfirm.spiralTube}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.insulock && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ã‚¤ãƒ³ã‚·ãƒ¥ãƒ­ãƒƒã‚¯</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ã‚¤ãƒ³ã‚·ãƒ¥ãƒ­ãƒƒã‚¯ã®è‰²</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.insulock === 'ãã®ä»–' && specs.otherConfirm.insulockDetail
                                                                                ? specs.otherConfirm.insulockDetail
                                                                                : specs.otherConfirm.insulock}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.mountBase && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">ãƒã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãƒã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®è‰²</p>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <span className="text-white mobile-text-sm">
                                                                            {specs.otherConfirm.mountBase === 'ãã®ä»–' && specs.otherConfirm.mountBaseDetail
                                                                                ? specs.otherConfirm.mountBaseDetail
                                                                                : specs.otherConfirm.mountBase}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.routeSpecialNote && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">é…ç·šãƒ«ãƒ¼ãƒˆã«é–¢ã—ã¦ã®ç‰¹è¨˜äº‹é …</p>
                                                                        <p className="text-gray-400 mobile-text-xs">é…ç·šãƒ«ãƒ¼ãƒˆã®ç‰¹æ®Šãªè¦æ±‚ã‚„æ³¨æ„äº‹é …</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">
                                                                            {specs.otherConfirm.routeSpecialNote}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            {specs.otherConfirm.remarks && (
                                                                <div className="flex items-start justify-between mobile-compact-card glass-card rounded-lg" style={{ boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.3)' }}>
                                                                    <div className="flex-1">
                                                                        <p className="text-white font-medium mobile-text-sm">å‚™è€ƒ</p>
                                                                        <p className="text-gray-400 mobile-text-xs">ãã®ä»–ã®ç¢ºèªäº‹é …ã«é–¢ã™ã‚‹å‚™è€ƒ</p>
                                                                    </div>
                                                                    <div className="text-right flex-1 ml-4">
                                                                        <span className="text-white mobile-text-sm whitespace-pre-line">{specs.otherConfirm.remarks}</span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}

                                            </div>
                                        );
                                    })()}

                                    <div className="mt-6 mb-1.5">
                                        <button
                                            onClick={() => setShowWiringModal(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            é–‰ã˜ã‚‹
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* å·¥æ•°å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showHoursInputModal && hoursInputTask && (
                            <div className="modal-overlay" onClick={() => setShowHoursInputModal(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-sm mx-4" onClick={(e) => e.stopPropagation()}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">å·¥æ•°å…¥åŠ›</h3>
                                    </div>

                                    <div className="mb-4">
                                        <h4 className="font-bold text-white mobile-text-sm mb-2">{hoursInputTask.title}</h4>
                                        <p className="text-gray-300 mobile-text-xs">
                                            æ¡ˆä»¶: {projects.find(p => String(p.id) === String(hoursInputTask.projectId))?.name}
                                        </p>
                                    </div>

                                    <div className="space-y-3 mb-4">
                                        {/* æ—¥ä»˜å…¥åŠ› */}
                                        <div>
                                            <label className="text-gray-300 mobile-text-sm block mb-2">æ—¥ä»˜</label>
                                            <div className="relative w-full">
                                                <input
                                                    type="date"
                                                    value={selectedDate}
                                                    onChange={(e) => {
                                                        setSelectedDate(e.target.value);
                                                        // æ—¥ä»˜å¤‰æ›´æ™‚ã«æ—¢å­˜å·¥æ•°ã‚’å–å¾—
                                                        const existingSession = workSessions.find(s =>
                                                            s.userId === user.uid &&
                                                            s.taskId === hoursInputTask.id &&
                                                            s.date &&
                                                            s.date.toDate().toDateString() === new Date(e.target.value).toDateString()
                                                        );
                                                        setDailyHours(existingSession ? parseFloat(existingSession.hours).toFixed(1) : '');
                                                    }}
                                                    className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                    min="2020-01-01"
                                                    max="2030-12-31"
                                                    style={{
                                                        WebkitAppearance: 'none',
                                                        MozAppearance: 'none',
                                                        appearance: 'none',
                                                        minHeight: '44px'
                                                    }}
                                                />
                                                {selectedDate && (
                                                    <button
                                                        type="button"
                                                        onClick={() => setSelectedDate(new Date().toISOString().split('T')[0])}
                                                        className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white text-lg"
                                                        title="ä»Šæ—¥ã«æˆ»ã™"
                                                    >
                                                        â†»
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        {/* å·¥æ•°å…¥åŠ› */}
                                        <div>
                                            <label className="text-gray-300 mobile-text-sm block mb-2">å®Ÿç¸¾å·¥æ•°ï¼ˆæ™‚é–“ï¼‰</label>
                                            <div className="number-input-container">
                                                <input
                                                    type="number"
                                                    inputMode="decimal"
                                                    pattern="[0-9]*[.,]?[0-9]*"
                                                    value={dailyHours}
                                                    onChange={(e) => setDailyHours(e.target.value)}
                                                    className="w-full dark-input rounded-xl px-4 py-3 focus:outline-none text-sm"
                                                    step="0.1"
                                                    min="0"
                                                    placeholder="0.0"
                                                    style={{ minHeight: '44px' }}
                                                />
                                                <div className="custom-spin-buttons">
                                                    <button
                                                        type="button"
                                                        className="spin-button spin-button-up"
                                                        onClick={() => {
                                                            const currentValue = parseFloat(dailyHours) || 0;
                                                            setDailyHours((currentValue + 0.1).toFixed(1));
                                                        }}
                                                    />
                                                    <button
                                                        type="button"
                                                        className="spin-button spin-button-down"
                                                        onClick={() => {
                                                            const currentValue = parseFloat(dailyHours) || 0;
                                                            setDailyHours(Math.max(0, currentValue - 0.1).toFixed(1));
                                                        }}
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›ãƒœã‚¿ãƒ³ */}
                                        <div>
                                            <label className="text-gray-300 mobile-text-sm block mb-2">ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›</label>
                                            <div className="grid grid-cols-4 gap-2">
                                                {[0.5, 1, 2, 4, 6, 8].map(hours => (
                                                    <button
                                                        key={hours}
                                                        onClick={() => setDailyHours(hours.toFixed(1))}
                                                        className="glass-card-dark text-white py-2 px-2 rounded-lg mobile-text-xs font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300"
                                                    >
                                                        {hours.toFixed(1)}h
                                                    </button>
                                                ))}
                                                <button
                                                    onClick={() => setDailyHours('0')}
                                                    className="glass-card-dark text-white py-2 px-2 rounded-lg mobile-text-xs font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300"
                                                >
                                                    0h
                                                </button>
                                                <button
                                                    onClick={() => setDailyHours('')}
                                                    className="glass-card-dark text-white py-2 px-2 rounded-lg mobile-text-xs font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300"
                                                >
                                                    ã‚¯ãƒªã‚¢
                                                </button>
                                            </div>
                                        </div>

                                        {/* æ—¢å­˜å·¥æ•°ã®è¡¨ç¤º */}
                                        {(() => {
                                            const existingSession = workSessions.find(s =>
                                                s.userId === user.uid &&
                                                s.taskId === hoursInputTask.id &&
                                                s.date &&
                                                s.date.toDate().toDateString() === new Date(selectedDate).toDateString()
                                            );

                                            if (existingSession) {
                                                return (
                                                    <div className="glass-card-dark p-3 rounded-lg">
                                                        <p className="text-gray-300 mobile-text-xs">
                                                            ç¾åœ¨ã®è¨˜éŒ²: <span className="text-white font-bold">{parseFloat(existingSession.hours).toFixed(1)}æ™‚é–“</span>
                                                        </p>
                                                    </div>
                                                );
                                            }
                                            return null;
                                        })()}
                                    </div>

                                    <div className="grid grid-cols-1 gap-2 mb-1.5 mt-6">
                                        <button
                                            onClick={saveDailyHours}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            æ›´æ–°
                                        </button>
                                        <button
                                            onClick={() => setShowHoursInputModal(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showUserManagementModal && (
                            <div className="modal-overlay" onClick={() => setShowUserManagementModal(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl w-full max-w-4xl mx-4"
                                    onClick={(e) => e.stopPropagation()}
                                    style={{ maxHeight: '90vh', overflowY: 'auto' }}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
                                        </h3>
                                    </div>

                                    <div>
                                        {allUsers.length > 0 ? (
                                            <div className="space-y-2">
                                                {allUsers.map(user => (
                                                    <div key={user.id} className="glass-card-dark p-3 rounded-lg flex items-center justify-between">
                                                        <div className="flex-1">
                                                            <div className="font-bold text-white mobile-text-sm">
                                                                {user.displayName ? user.displayName : `ãƒ¦ãƒ¼ã‚¶ãƒ¼ (${user.email.split('@')[0]})`}
                                                            </div>
                                                            <div className="text-gray-400 mobile-text-xs">
                                                                {user.email}
                                                            </div>
                                                            {user.id === MASTER_ADMIN_UID && (
                                                                <span className="inline-block px-2 py-1 bg-yellow-500 text-black text-xs rounded mt-1">
                                                                    ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†è€…
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className="flex items-center">
                                                            {user.id === MASTER_ADMIN_UID ? (
                                                                <span className="text-gray-500 mobile-text-xs">å¤‰æ›´ä¸å¯</span>
                                                            ) : (
                                                                <label className="flex items-center cursor-pointer">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={adminUsers.includes(user.id)}
                                                                        onChange={(e) => {
                                                                            const isChecked = e.target.checked;
                                                                            if (isChecked) {
                                                                                setAdminUsers(prev => [...prev.filter(id => id !== user.id), user.id]);
                                                                            } else {
                                                                                setAdminUsers(prev => prev.filter(id => id !== user.id));
                                                                            }
                                                                        }}
                                                                        className="mr-2"
                                                                    />
                                                                    <span className="text-white mobile-text-xs">ç®¡ç†è€…</span>
                                                                </label>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center text-gray-400 py-8">
                                                ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                                            </div>
                                        )}
                                    </div>



                                    <div className="flex flex-col gap-2 mt-6 mb-1.5">
                                        <button
                                            onClick={async () => {
                                                try {
                                                    // ç®¡ç†è€…æ¨©é™ã®æ›´æ–°å‡¦ç†
                                                    for (const user of allUsers) {
                                                        if (user.id !== MASTER_ADMIN_UID) {
                                                            const shouldBeAdmin = adminUsers.includes(user.id);
                                                            const currentIsAdmin = user.isAdmin === true;

                                                            // æ¨©é™çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã®ã¿æ›´æ–°
                                                            if (shouldBeAdmin !== currentIsAdmin) {
                                                                await updateAdminStatus(user.id, shouldBeAdmin);
                                                            }
                                                        }
                                                    }

                                                    // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å†èª­ã¿è¾¼ã¿
                                                    await loadAllUsers();

                                                    // ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã‚’å†ç¢ºèª
                                                    await checkAdminRights(auth.currentUser);

                                                    console.log('ç®¡ç†è€…æ¨©é™æ›´æ–°å®Œäº†');
                                                } catch (error) {
                                                    console.error('ç®¡ç†è€…æ¨©é™æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                                                    alert('æ¨©é™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                                                }
                                                setShowUserManagementModal(false);
                                            }}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            æ›´æ–°
                                        </button>
                                        <button
                                            onClick={() => setShowUserManagementModal(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³è‰²é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showColorPickerModal && (
                            <div className="modal-overlay" onClick={() => {
                                setTempIconColor(userIconColor); // ä¸€æ™‚è‰²ã‚’å…ƒã«æˆ»ã™
                                setShowColorPickerModal(false);
                            }}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl w-full max-w-md mx-4"
                                    onClick={(e) => e.stopPropagation()}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’é¸æŠ
                                        </h3>
                                    </div>

                                    {/* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */}
                                    <div className="grid grid-cols-6 gap-3 mb-6">
                                        {[
                                            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåˆæœŸè‰²ã‚’å«ã‚€ï¼‰
                                            'linear-gradient(45deg, #667eea 0%, #764ba2 100%)',
                                            'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)',
                                            'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)',
                                            'linear-gradient(45deg, #43e97b 0%, #38f9d7 100%)',
                                            'linear-gradient(45deg, #fa709a 0%, #fee140 100%)',
                                            'linear-gradient(45deg, #a8edea 0%, #fed6e3 100%)',
                                            'linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%)',
                                            'linear-gradient(45deg, #ff8a80 0%, #ea4c89 100%)',
                                            // ã¯ã£ãã‚Šã¨é•ã„ãŒã‚ã‹ã‚‹åŸºæœ¬è‰²
                                            '#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4',
                                            '#8b5cf6', '#ec4899', '#374151', '#6b7280', '#e5e7eb',
                                            '#991b1b', '#92400e', '#365314', '#1e40af', '#581c87',
                                            // è¿½åŠ è‰²
                                            '#dc2626'
                                        ].map(color => (
                                            <div
                                                key={color}
                                                className={`w-10 h-10 rounded-full cursor-pointer transition-all duration-200 hover:scale-110 ${tempIconColor === color ? 'ring-2 ring-white ring-offset-2 ring-offset-gray-800' : ''
                                                    }`}
                                                style={{ background: color }}
                                                onClick={() => setTempIconColor(color)}
                                            />
                                        ))}
                                    </div>


                                    {/* ãƒœã‚¿ãƒ³ */}
                                    <div className="space-y-2 mb-1.5">
                                        <button
                                            onClick={async () => {
                                                try {
                                                    // ä¸€æ™‚è‰²ã‚’å®Ÿéš›ã®è‰²ã«åæ˜ 
                                                    setUserIconColor(tempIconColor);

                                                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’Firestoreã«ä¿å­˜
                                                    const userSettingsRef = db.collection('userSettings').doc(user.uid);
                                                    await userSettingsRef.set({
                                                        iconColor: tempIconColor,
                                                        updatedAt: new Date()
                                                    }, { merge: true });
                                                    setShowColorPickerModal(false);
                                                } catch (error) {
                                                    console.error('è‰²è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                                                    alert('è‰²è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                                                }
                                            }}
                                            className="gradient-button text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm w-full"
                                        >
                                            ä¿å­˜
                                        </button>
                                        <button
                                            onClick={() => {
                                                setTempIconColor(userIconColor); // ä¸€æ™‚è‰²ã‚’å…ƒã«æˆ»ã™
                                                setShowColorPickerModal(false);
                                            }}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showLogoutConfirm && (
                            <div className="modal-overlay" onClick={() => setShowLogoutConfirm(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl w-full max-w-md mx-4" onClick={(e) => e.stopPropagation()}>
                                    <div className="text-center">
                                        {/* ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¢ã‚¤ã‚³ãƒ³ */}
                                        <div className="flex justify-center mb-4 mt-2">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="gray" strokeWidth="1.5">
                                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                                <polyline points="16,17 21,12 16,7" />
                                                <line x1="21" y1="12" x2="9" y2="12" />
                                            </svg>
                                        </div>
                                        <p className="text-gray-300 mb-4 text-sm">
                                            ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ
                                            <span className="block text-red-300 text-xs mt-2">
                                                â€» æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯å¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
                                            </span>
                                        </p>
                                        <div className="flex gap-2 mb-1.5">
                                            <button
                                                onClick={() => setShowLogoutConfirm(false)}
                                                className="flex-1 glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm"
                                            >
                                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                            </button>
                                            <button
                                                onClick={confirmLogout}
                                                className="flex-1 gradient-red text-white px-4 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 text-sm"
                                            >
                                                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* æ—¥åˆ¥å·¥æ•°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showDailyHoursModal && (
                            <div className="modal-overlay" onClick={() => setShowDailyHoursModal(false)}>
                                <div className="modal-content glass-card mobile-compact-card rounded-2xl floating-animation w-full max-w-3xl mx-4" onClick={(e) => e.stopPropagation()}>
                                    <div className="mb-4">
                                        <h3 className="text-base font-bold text-white pt-2">
                                            {selectedDateForModal}ã®å·¥æ•°ä¸€è¦§
                                        </h3>
                                    </div>

                                    <div style={{ maxHeight: '60vh', overflowY: 'auto' }}>
                                        {dailyHoursSessions.length === 0 ? (
                                            <div className="text-center text-gray-400 py-8 mobile-text-sm">
                                                ã“ã®æ—¥ã«è¨˜éŒ²ã•ã‚ŒãŸå·¥æ•°ã¯ã‚ã‚Šã¾ã›ã‚“
                                            </div>
                                        ) : (
                                            <div className="space-y-3">
                                                {dailyHoursSessions.map((session, index) => {
                                                    const project = projects.find(p => p.id === session.projectId);
                                                    const task = tasks.find(t => t.id === session.taskId);
                                                    const company = companies.find(c => c.id === project?.companyId);


                                                    return (
                                                        <div key={index} className="glass-card-dark p-3 rounded-xl mobile-compact-card">
                                                            <div className="flex justify-between items-start mb-2">
                                                                <div className="flex-1 pr-3">
                                                                    <h4 className="text-white font-bold mobile-text-sm truncate">
                                                                        {project?.name || session.projectName || 'ä¸æ˜ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ'}
                                                                    </h4>
                                                                    <p className="text-purple-300 mobile-text-xs truncate">
                                                                        {company?.name || project?.companyName || session.companyName || project?.company || 'ä¼šç¤¾åä¸æ˜'}
                                                                    </p>
                                                                    <p className="text-gray-300 mobile-text-xs mt-0.5 -mb-2 truncate">
                                                                        {task?.name || session.taskName || 'ä¸æ˜ãªå·¥ç¨‹'}
                                                                    </p>
                                                                </div>
                                                                <div className="text-right flex-shrink-0">
                                                                    <div className="text-white font-bold mobile-text-sm">
                                                                        {parseFloat(session.hours).toFixed(1)}h
                                                                    </div>
                                                                    <div className="text-gray-400 mobile-text-xs">
                                                                        {(() => {
                                                                            const timestamp = session.updatedAt || session.createdAt;
                                                                            if (!timestamp) return 'æ™‚åˆ»ä¸æ˜';

                                                                            try {
                                                                                let date;
                                                                                if (typeof timestamp.toDate === 'function') {
                                                                                    date = timestamp.toDate();
                                                                                } else {
                                                                                    date = new Date(timestamp);
                                                                                }

                                                                                // æœ‰åŠ¹ãªæ—¥ä»˜ã‹ãƒã‚§ãƒƒã‚¯
                                                                                if (isNaN(date.getTime())) {
                                                                                    return 'æ™‚åˆ»ä¸æ˜';
                                                                                }

                                                                                return date.toLocaleTimeString('ja-JP', {
                                                                                    hour: '2-digit',
                                                                                    minute: '2-digit'
                                                                                });
                                                                            } catch (error) {
                                                                                console.warn('æ—¥ä»˜å¤‰æ›ã‚¨ãƒ©ãƒ¼:', error, timestamp);
                                                                                return 'æ™‚åˆ»ä¸æ˜';
                                                                            }
                                                                        })()}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            {session.memo && (
                                                                <div className="mt-2 p-2 bg-black bg-opacity-20 rounded mobile-text-xs text-gray-300">
                                                                    {session.memo}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}

                                                {/* åˆè¨ˆæ™‚é–“ */}
                                                <div className="mt-4 p-3 glass-card rounded-xl mobile-compact-card">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-white font-bold mobile-text-sm">åˆè¨ˆæ™‚é–“</span>
                                                        <span className="text-white font-bold mobile-text-sm">
                                                            {dailyHoursSessions.reduce((total, session) => total + session.hours, 0).toFixed(1)}h
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */}
                                    <div className="mt-6 mb-1.5">
                                        <button
                                            onClick={() => setShowDailyHoursModal(false)}
                                            className="glass-card-dark text-white px-4 py-3 rounded-xl font-bold hover:bg-gray-500 hover:bg-opacity-20 transition-all duration-300 text-sm w-full"
                                        >
                                            é–‰ã˜ã‚‹
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                    </div>
                </div>
            );
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(ProjectManagementApp));
    </script>
</body>

</html>